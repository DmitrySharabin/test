<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Expression tests</title>
	<link rel="stylesheet" href="../dist/mavo.css" />
	<link rel="stylesheet" href="style.css" />
	<style>
		[data-foo]::before {
			content: "[data-foo=" attr(data-foo) "]";
			background: #efc;
		}
	</style>
</head>
<body>

<h1>Expression tests</h1>

<script type="application/json" id="countries">{
	"country": [
		{
			"code": "",
			"name": "Online"
		},
		{
			"code": "us",
			"name": "United States"
		},
		{
			"code": "gb",
			"name": "United Kingdom"
		}
	]
}</script>

<section data-mavo="basicexpr">
	<h1>Basic</h1>

	<table class="reftest">
		<tr>
			<td property="prop1">[40 + 2]</td>
			<td>42</td>
		</tr>
		<tr>
			<td>[40 +]</td>
			<td>40 +</td>
		</tr>
		<tr>
			<td><input value="[39 + 3]"></td>
			<td><input value="42"></td>
		</tr>
		<tr>
			<td property="prop2">[prop1 + 1]</td>
			<td>43</td>
		</tr>
		<tr>
			<td property="prop3">[prop2 + 1]</td>
			<td>44</td>
		</tr>
		<tr>
			<td>[prop3 + 1]</td>
			<td>45</td>
		</tr>
		<tr>
			<td>[false]</td>
			<td>false</td>
		</tr>
	</table>

</section>

<section data-store="#countries">
	<h1>With render (country data)</h1>

	<table class="reftest">
		<tr>
			<td>[count(country)]</td>
			<td>3</td>
		</tr>
		<tr>
			<td>[count(code)]</td>
			<td>2</td>
		</tr>
		<tr>
			<td>
				<ul>
					<li property="country" data-multiple>
						<span property="code"></span> [code]
						<span property="name"></span> [name]
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>Online Online</li>
					<li>usus United States UnitedStates</li>
					<li>gbgb United Kingdom United Kingdom</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>[country]</td>
			<td data-expressions="none">[object Object], [object Object], [object Object]</td>
		</tr>
		<tr>
			<td>[count(code == us)]</td>
			<td>1</td>
		</tr>
	</table>
</section>

<section class="mavo">
	<h1>Without render</h1>

	<table class="reftest">
		<tr>
			<td>
				<ul>
					<li property="country" data-multiple>
						<span property="code">Code</span> [code]
						<span property="name">Name</span> [name]
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>Code Code Name Name</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>[country]</td>
			<td data-expressions="none">[object Object]</td>
		</tr>
		<tr>
			<td>[count(code)]</td>
			<td>1</td>
		</tr>
	</table>
</section>

<section class="mavo mv-keep-unhandled" data-source="#countries">
	<h1>Broad references</h1>

	<table class="reftest">
		<tr>
			<td>
				<select size="3">
					<option value="[code]" property="country" data-multiple typeof>[name]</option>
				</select>
			</td>
			<td>
				<select size="3">
					<option value="">Online</option>
					<option value="us">United States</option>
					<option value="gb">United Kingdom</option>
				</select>
			</td>
		</tr>
	</table>
</section>

<style>
	#customSyntax .reftest td:empty::before {
		/* If this goes inside the Mavo it will be parsed as an expression and
		 * we cannot use data-expressions="none" to escape because that's
		 * exactly what we're testing here!
		 */
		content: "[1 + 2]";
	}
</style>

<section class="mavo" id="customSyntax" data-source="#countries">
	<h1>Custom expression syntax</h1>

	<table class="reftest">
		<tr>
			<td data-expressions="[[ ]]">[[1 + 2]]</td>
			<td>3</td>
		</tr>
		<tr>
			<td data-expressions="{{ }}">{{1 + 2}}</td>
			<td>3</td>
		</tr>
		<tr>
			<td data-expressions="{{ }}">[1 + 2]</td>
			<td></td>
		</tr>
		<tr title="Inner with different syntax">
			<td data-expressions="{{ }}"><span data-expressions="( )">(1 + 2)</td>
			<td>3</td>
		</tr>
		<tr title="Inner with different syntax">
			<td data-expressions="{{ }}"><span data-expressions="( )">{{1 + 2}}</td>
			<td>{{1 + 2}}</td>
		</tr>
		<tr title="Inner with the same syntax">
			<td data-expressions="{{ }}"><span data-expressions="{{ }}">{{1 + 2}}</td>
			<td>3</td>
		</tr>
		<tr title="Escape expressions">
			<td data-expressions="none">[1 + 2]</td>
			<td></td>
		</tr>
		<tr title="Invalid delimiter (no space)">
			<td data-expressions="[]">[1 + 2]</td>
			<td></td>
		</tr>
		<tr title="Invalid delimiter (only space)">
			<td data-expressions=" ">[1 + 2]</td>
			<td></td>
		</tr>
	</table>
</section>

<section class="mavo">
	<h1>data-content</h1>

	<table class="reftest">
		<tr>
			<td><div data-content="39 + 3">Without expression syntax</div></td>
			<td>42</td>
		</tr>
		<tr>
			<td><div data-content="(39 + 3">With bug</div></td>
			<td>With bug</td>
		</tr>
		<tr>
			<td><input data-content="39 + 3" value="In attribute"></td>
			<td><input value="42"></td>
		</tr>
	</table>
</section>

<section class="mavo mv-debug" id="mvIf">
	<h1>data-if</h1>

	<table class="reftest">
		<tr>
			<td>A<span data-if="5 < 0">B</span>C</td>
			<td>AC</td>
		</tr>
		<tr>
			<td>A<span data-if="true">B</span>C</td>
			<td>ABC</td>
		</tr>
		<tr>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td></td>
			<td></td>
		</tr>
	</table>
</section>

<script src="../dist/mavo.js"></script>
<script src="test.js"></script>

</body>
</html>
