!function(){"use strict";function ee(se,ie,le){return ie=void 0===ie?1:ie,le=le||ie+1,1>=le-ie?function(){if(arguments.length<=ie||"string"===ae.type(arguments[ie]))return se.apply(this,arguments);var de,ue=arguments[ie];for(var pe in ue){var ce=Array.from(arguments);ce.splice(ie,1,pe,ue[pe]),de=se.apply(this,ce)}return de}:ee(ee(se,ie+1,le),ie,le-1)}function te(se,ie,le){var de=re(le);if("string"===de){var ue=Object.getOwnPropertyDescriptor(ie,le);!ue||ue.writable&&ue.configurable&&ue.enumerable&&!ue.get&&!ue.set?se[le]=ie[le]:(delete se[le],Object.defineProperty(se,le,ue))}else if("array"===de)le.forEach(function(ce){ce in ie&&te(se,ie,ce)});else for(var pe in ie)(!le||("regexp"!==de||le.test(pe))&&("function"!==de||le.call(ie,pe)))&&te(se,ie,pe);return se}function re(se){if(null===se)return"null";if(void 0===se)return"undefined";var ie=(Object.prototype.toString.call(se).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==ie&&isNaN(se)?"nan":ie}var ae=self.Bliss=te(function(se,ie){return(2!=arguments.length||ie)&&se?"string"===ae.type(se)?(ie||document).querySelector(se):se||null:null},self.Bliss);te(ae,{extend:te,overload:ee,type:re,property:ae.property||"_",sources:{},noop:function(){},$:function(se,ie){return se instanceof Node||se instanceof Window?[se]:2!=arguments.length||ie?Array.from("string"==typeof se?(ie||document).querySelectorAll(se):se||[]):[]},defined:function(){for(var se=0;se<arguments.length;se++)if(void 0!==arguments[se])return arguments[se]},create:function(se,ie){return se instanceof Node?ae.set(se,ie):(1===arguments.length&&("string"===ae.type(se)?ie={}:(ie=se,se=ie.tag,ie=ae.extend({},ie,function(le){return"tag"!==le}))),ae.set(document.createElement(se||"div"),ie))},each:function(se,ie,le){for(var de in le=le||{},se)le[de]=ie.call(se,de,se[de]);return le},ready:function(se){return se=se||document,new Promise(function(ie){"loading"===se.readyState?se.addEventListener("DOMContentLoaded",function(){ie()}):ie()})},Class:function(se){var ie,le=["constructor","extends","abstract","static"].concat(Object.keys(ae.classProps)),de=se.hasOwnProperty("constructor")?se.constructor:ae.noop;2==arguments.length?(ie=arguments[0],se=arguments[1]):(ie=function(){if(this.constructor.__abstract&&this.constructor===ie)throw new Error("Abstract classes cannot be directly instantiated.");ie["super"]&&ie["super"].apply(this,arguments),de.apply(this,arguments)},ie["super"]=se["extends"]||null,ie.prototype=ae.extend(Object.create(ie["super"]?ie["super"].prototype:Object),{constructor:ie}),ie.prototype["super"]=ie["super"]?ie["super"].prototype:null,ie.__abstract=!!se.abstract);var ue=function(ce){return this.hasOwnProperty(ce)&&-1===le.indexOf(ce)};if(se["static"])for(var pe in ae.extend(ie,se["static"],ue),ae.classProps)pe in se["static"]&&ae.classProps[pe](ie,se["static"][pe]);for(var pe in ae.extend(ie.prototype,se,ue),ae.classProps)pe in se&&ae.classProps[pe](ie.prototype,se[pe]);return ie},classProps:{lazy:ee(function(se,ie,le){return Object.defineProperty(se,ie,{get:function(){var de=le.call(this);return Object.defineProperty(this,ie,{value:de,configurable:!0,enumerable:!0,writable:!0}),de},set:function(de){Object.defineProperty(this,ie,{value:de,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),se}),live:ee(function(se,ie,le){return"function"===ae.type(le)&&(le={set:le}),Object.defineProperty(se,ie,{get:function(){var de=this["_"+ie],ue=le.get&&le.get.call(this,de);return void 0===ue?de:ue},set:function(de){var ue=this["_"+ie],pe=le.set&&le.set.call(this,de,ue);this["_"+ie]=void 0===pe?de:pe},configurable:le.configurable,enumerable:le.enumerable}),se})},include:function(){var se=arguments[arguments.length-1],ie=!(2!==arguments.length)&&arguments[0],le=document.createElement("script");return ie?Promise.resolve():new Promise(function(de,ue){ae.set(le,{async:!0,onload:function(){de(),ae.remove(le)},onerror:function(){ue()},src:se,inside:document.head})})},fetch:function(se,ie){if(!se)throw new TypeError("URL parameter is mandatory and cannot be "+se);var le=te({url:new URL(se,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},ie);for(var de in le.method=le.method.toUpperCase(),ae.hooks.run("fetch-args",le),"GET"===le.method&&le.data&&(le.url.search+=le.data),document.body.setAttribute("data-loading",le.url),le.xhr.open(le.method,le.url.href,!1!==le.async,le.user,le.password),ie)if(de in le.xhr)try{le.xhr[de]=ie[de]}catch(pe){self.console&&console.error(pe)}for(var ue in"GET"===le.method||le.headers["Content-type"]||le.headers["Content-Type"]||le.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),le.headers)le.xhr.setRequestHeader(ue,le.headers[ue]);return new Promise(function(pe,ce){le.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===le.xhr.status||200<=le.xhr.status&&300>le.xhr.status||304===le.xhr.status?pe(le.xhr):ce(ae.extend(Error(le.xhr.statusText),{xhr:le.xhr,get status(){return this.xhr.status}}))},le.xhr.onerror=function(){document.body.removeAttribute("data-loading"),ce(ae.extend(Error("Network Error"),{xhr:le.xhr}))},le.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),ce(ae.extend(Error("Network Timeout"),{xhr:le.xhr}))},le.xhr.send("GET"===le.method?null:le.data)})},value:function(se){var ie="string"!==ae.type(se);return ae.$(arguments).slice(+ie).reduce(function(le,de){return le&&le[de]},ie?se:self)}}),ae.Hooks=new ae.Class({add:function(se,ie,le){if("string"==typeof arguments[0])(Array.isArray(se)?se:[se]).forEach(function(de){this[de]=this[de]||[],ie&&this[de][le?"unshift":"push"](ie)},this);else for(var se in arguments[0])this.add(se,arguments[0][se],arguments[1])},run:function(se,ie){this[se]=this[se]||[],this[se].forEach(function(le){le.call(ie&&ie.context?ie.context:ie,ie)})}}),ae.hooks=new ae.Hooks;var ne=ae.property;ae.Element=function(se){this.subject=se,this.data={},this.bliss={}},ae.Element.prototype={set:ee(function(se,ie){se in ae.setProps?ae.setProps[se].call(this,ie):se in this?this[se]=ie:this.setAttribute(se,ie)},0),transition:function(se,ie){return ie=+ie||400,new Promise(function(le){if("transition"in this.style){var ue=ae.extend({},this.style,/^transition(Duration|Property)$/);ae.style(this,{transitionDuration:(ie||400)+"ms",transitionProperty:Object.keys(se).join(", ")}),ae.once(this,"transitionend",function(){clearTimeout(pe),ae.style(this,ue),le(this)});var pe=setTimeout(le,ie+50,this);ae.style(this,se)}else ae.style(this,se),le(this)}.bind(this))},fire:function(se,ie){var le=document.createEvent("HTMLEvents");return le.initEvent(se,!0,!0),this.dispatchEvent(ae.extend(le,ie))},unbind:ee(function(se,ie){(se||"").split(/\s+/).forEach(function(le){if(ne in this&&(-1<le.indexOf(".")||!ie)){le=(le||"").split(".");var de=le[1];le=le[0];var ue=this[ne].bliss.listeners=this[ne].bliss.listeners||{};for(var pe in ue)if(!le||pe===le)for(var ce,ge=0;ce=ue[pe][ge];ge++)de&&de!==ce.className||ie&&ie!==ce.callback||(this.removeEventListener(pe,ce.callback,ce.capture),ge--)}else this.removeEventListener(le,ie)},this)},0)},ae.setProps={style:function(se){for(var ie in se)ie in this.style?this.style[ie]=se[ie]:this.style.setProperty(ie,se[ie])},attributes:function(se){for(var ie in se)this.setAttribute(ie,se[ie])},properties:function(se){ae.extend(this,se)},events:function(se){if(se&&se.addEventListener){var ie=this;if(se[ne]&&se[ne].bliss){var le=se[ne].bliss.listeners;for(var de in le)le[de].forEach(function(he){ie.addEventListener(de,he.callback,he.capture)})}for(var ue in se)0===ue.indexOf("on")&&(this[ue]=se[ue])}else if(1<arguments.length&&"string"===ae.type(se)){var pe=arguments[1],ce=arguments[2];se.split(/\s+/).forEach(function(he){this.addEventListener(he,pe,ce)},this)}else for(var ge in se)ae.events(this,ge,se[ge])},once:ee(function(se,ie){se=se.split(/\s+/);var le=this,de=function(){return se.forEach(function(ue){le.removeEventListener(ue,de)}),ie.apply(le,arguments)};se.forEach(function(ue){le.addEventListener(ue,de)})},0),delegate:ee(function(se,ie,le){this.addEventListener(se,function(de){de.target.closest(ie)&&le.call(this,de)})},0,2),contents:function(se){(se||0===se)&&(Array.isArray(se)?se:[se]).forEach(function(ie){var le=ae.type(ie);/^(string|number)$/.test(le)?ie=document.createTextNode(ie+""):"object"===le&&(ie=ae.create(ie)),ie instanceof Node&&this.appendChild(ie)},this)},inside:function(se){se.appendChild(this)},before:function(se){se.parentNode.insertBefore(this,se)},after:function(se){se.parentNode.insertBefore(this,se.nextSibling)},start:function(se){se.insertBefore(this,se.firstChild)},around:function(se){se.parentNode&&ae.before(this,se),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(se)}},ae.Array=function(se){this.subject=se},ae.Array.prototype={all:function(se){var ie=$$(arguments).slice(1);return this[se].apply(this,ie)}},ae.add=ee(function(se,ie,le,de){le=ae.extend({$:!0,element:!0,array:!0},le),"function"==ae.type(ie)&&(!le.element||se in ae.Element.prototype&&de||(ae.Element.prototype[se]=function(){return this.subject&&ae.defined(ie.apply(this.subject,arguments),this.subject)}),!le.array||se in ae.Array.prototype&&de||(ae.Array.prototype[se]=function(){var ue=arguments;return this.subject.map(function(pe){return pe&&ae.defined(ie.apply(pe,ue),pe)})}),le.$&&(ae.sources[se]=ae[se]=ie,(le.array||le.element)&&(ae[se]=function(){var ue=[].slice.apply(arguments),pe=ue.shift(),ce=le.array&&Array.isArray(pe)?"Array":"Element";return ae[ce].prototype[se].apply({subject:pe},ue)})))},0),ae.add(ae.Array.prototype,{element:!1}),ae.add(ae.Element.prototype),ae.add(ae.setProps),ae.add(ae.classProps,{element:!1,array:!1});var oe=document.createElement("_");ae.add(ae.extend({},HTMLElement.prototype,function(se){return"function"===ae.type(oe[se])}),null,!0)}(),function(ee){"use strict";if(Bliss&&!Bliss.shy){var te=Bliss.property;if(ee.add({clone:function(){var se=this.cloneNode(!0),ie=ee.$("*",se).concat(se);return ee.$("*",this).concat(this).forEach(function(le,de){ee.events(ie[de],le),ie[de]._.data=ee.extend({},le._.data)}),se}},{array:!1}),Object.defineProperty(Node.prototype,te,{get:function se(){return Object.defineProperty(Node.prototype,te,{get:void 0}),Object.defineProperty(this,te,{value:new ee.Element(this)}),Object.defineProperty(Node.prototype,te,{get:se}),this[te]},configurable:!0}),Object.defineProperty(Array.prototype,te,{get:function(){return Object.defineProperty(this,te,{value:new ee.Array(this)}),this[te]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var re=EventTarget.prototype.addEventListener,ae=EventTarget.prototype.removeEventListener,ne=function(se,ie,le){return le.callback===se&&le.capture==ie},oe=function(){return!ne.apply(this,arguments)};EventTarget.prototype.addEventListener=function(se,ie,le){if(this&&this[te]&&this[te].bliss&&ie){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};if(-1<se.indexOf(".")){se=se.split(".");var ue=se[1];se=se[0]}de[se]=de[se]||[],0===de[se].filter(ne.bind(null,ie,le)).length&&de[se].push({callback:ie,capture:le,className:ue})}return re.call(this,se,ie,le)},EventTarget.prototype.removeEventListener=function(se,ie,le){if(this&&this[te]&&this[te].bliss&&ie){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};de[se]&&(de[se]=de[se].filter(oe.bind(null,ie,le)))}return ae.call(this,se,ie,le)}}self.$=self.$||ee,self.$$=self.$$||ee.$}}(Bliss),function(){function ee(ae,ne){return ae instanceof Node||ae instanceof Window?[ae]:[].slice.call("string"==typeof ae?(ne||document).querySelectorAll(ae):ae||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),!!Element.prototype.matches)){var te=self.Stretchy={selectors:{base:"textarea, select:not([size]), input:not([type]), input[type=\""+"text url email tel".split(" ").join("\"], input[type=\"")+"\"]",filter:"*"},script:document.currentScript||ee("script").pop(),resize:function(ae){if(te.resizes(ae)){var ne=getComputedStyle(ae),oe=0;if(!ae.value&&ae.placeholder){ae.value=ae.placeholder}var ie=ae.nodeName.toLowerCase();if("textarea"==ie)ae.style.height="0","border-box"==ne.boxSizing?oe=ae.offsetHeight:"content-box"==ne.boxSizing&&(oe=-ae.clientHeight),ae.style.height=ae.scrollHeight+oe+"px";else if("input"==ie){if(ae.style.width="1000px",ae.offsetWidth){ae.style.width="0","border-box"==ne.boxSizing?oe=ae.offsetWidth:"padding-box"==ne.boxSizing&&(oe=ae.clientWidth),ae.scrollLeft=1e10;var le=Math.max(ae.scrollLeft+oe,ae.scrollWidth-ae.clientWidth);ae.style.width=le+"px"}else ae.style.width=ae.value.length+1+"ch";}else if("select"==ie){var de=0<ae.selectedIndex?ae.selectedIndex:0,ue=document.createElement("_");ue.textContent=ae.options[de].textContent,ae.parentNode.insertBefore(ue,ae.nextSibling);var pe;for(var ce in ne){var ge=ne[ce];/^(width|webkitLogicalWidth|length)$/.test(ce)||"string"!=typeof ge||(ue.style[ce]=ge,/appearance$/i.test(ce)&&(pe=ce))}ue.style.width="",0<ue.offsetWidth&&(ae.style.width=ue.offsetWidth+"px",(!ne[pe]||"none"!==ne[pe])&&(ae.style.width="calc("+ae.style.width+" + 2em)")),ue.parentNode.removeChild(ue),ue=null}ae.value=""}},resizeAll:function(ae){ee(ae||te.selectors.base).forEach(function(ne){te.resize(ne)})},active:!0,resizes:function(ae){return ae&&ae.parentNode&&ae.matches&&ae.matches(te.selectors.base)&&ae.matches(te.selectors.filter)},init:function(){te.selectors.filter=te.script.getAttribute("data-filter")||(ee("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",te.resizeAll()},$$:ee};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",te.init):te.init();var re=function(ae){te.active&&te.resize(ae.target)};document.documentElement.addEventListener("input",re),document.documentElement.addEventListener("change",re),self.MutationObserver&&new MutationObserver(function(ae){te.active&&ae.forEach(function(ne){"childList"==ne.type&&Stretchy.resizeAll(ne.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}(),!function(ee){"use strict";var te="Compound",ae="MemberExpression",ne="Literal",ce=46,ge=44,fe=40,ye=41,be=91,xe=93,Ae=function($e,qe){var Ge=new Error($e+" at character "+qe);throw Ge.index=qe,Ge.description=$e,Ge},Pe=!0,Ne={"-":Pe,"!":Pe,"~":Pe,"+":Pe},we={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Le=function($e){var qe,Ge=0;for(var Me in $e)(qe=Me.length)>Ge&&$e.hasOwnProperty(Me)&&(Ge=qe);return Ge},Oe=Le(Ne),Te=Le(we),Se={"true":!0,"false":!1,"null":null},De=function($e){return we[$e]||0},Ve=function($e,qe,Ge){var Me="||"===$e||"&&"===$e?"LogicalExpression":"BinaryExpression";return{type:Me,operator:$e,left:qe,right:Ge}},je=function($e){return 48<=$e&&57>=$e},ze=function($e){return 36===$e||95===$e||65<=$e&&90>=$e||97<=$e&&122>=$e||128<=$e&&!we[String.fromCharCode($e)]},Be=function($e){return 36===$e||95===$e||65<=$e&&90>=$e||97<=$e&&122>=$e||48<=$e&&57>=$e||128<=$e&&!we[String.fromCharCode($e)]},Ue=function($e){for(var qe,Ge,Me=0,He=$e.charAt,Fe=$e.charCodeAt,Ye=function(ut){return He.call($e,ut)},We=function(ut){return Fe.call($e,ut)},Je=$e.length,Ke=function(){for(var ut=We(Me);32===ut||9===ut;)ut=We(++Me)},Ze=function(){var ut,pt,ct=Qe();return Ke(),We(Me)===63?(Me++,ut=Ze(),ut||Ae("Expected expression",Me),Ke(),We(Me)===58?(Me++,pt=Ze(),pt||Ae("Expected expression",Me),{type:"ConditionalExpression",test:ct,consequent:ut,alternate:pt}):void Ae("Expected :",Me)):ct},Xe=function(){Ke();for(var ut=$e.substr(Me,Te),pt=ut.length;0<pt;){if(we.hasOwnProperty(ut))return Me+=pt,ut;ut=ut.substr(0,--pt)}return!1},Qe=function(){var ut,pt,ct,mt,gt,ht,vt,ft;if(ht=tt(),pt=Xe(),!pt)return ht;for(gt={value:pt,prec:De(pt)},vt=tt(),vt||Ae("Expected expression after "+pt,Me),mt=[ht,gt,vt];(pt=Xe())&&(ct=De(pt),0!==ct);){for(gt={value:pt,prec:ct};2<mt.length&&ct<=mt[mt.length-2].prec;)vt=mt.pop(),pt=mt.pop().value,ht=mt.pop(),ut=Ve(pt,ht,vt),mt.push(ut);ut=tt(),ut||Ae("Expected expression after "+pt,Me),mt.push(gt,ut)}for(ft=mt.length-1,ut=mt[ft];1<ft;)ut=Ve(mt[ft-1].value,mt[ft-2],ut),ft-=2;return ut},tt=function(){var ut,pt,ct;if(Ke(),ut=We(Me),je(ut)||ut===ce)return rt();if(ut===39||ut===34)return at();if(ze(ut)||ut===fe)return st();if(ut===be)return lt();for(pt=$e.substr(Me,Oe),ct=pt.length;0<ct;){if(Ne.hasOwnProperty(pt))return Me+=ct,{type:"UnaryExpression",operator:pt,argument:tt(),prefix:!0};pt=pt.substr(0,--ct)}return!1},rt=function(){for(var ut,pt,ct="";je(We(Me));)ct+=Ye(Me++);if(We(Me)===ce)for(ct+=Ye(Me++);je(We(Me));)ct+=Ye(Me++);if(ut=Ye(Me),"e"===ut||"E"===ut){for(ct+=Ye(Me++),ut=Ye(Me),"+"!==ut&&"-"!==ut||(ct+=Ye(Me++));je(We(Me));)ct+=Ye(Me++);je(We(Me-1))||Ae("Expected exponent ("+ct+Ye(Me)+")",Me)}return pt=We(Me),ze(pt)?Ae("Variable names cannot start with a number ("+ct+Ye(Me)+")",Me):pt===ce&&Ae("Unexpected period",Me),{type:ne,value:parseFloat(ct),raw:ct}},at=function(){for(var ut,pt="",ct=Ye(Me++),mt=!1;Me<Je;){if(ut=Ye(Me++),ut===ct){mt=!0;break}if("\\"===ut)switch(ut=Ye(Me++)){case"n":pt+="\n";break;case"r":pt+="\r";break;case"t":pt+="\t";break;case"b":pt+="\b";break;case"f":pt+="\f";break;case"v":pt+="\x0B";break;default:pt+="\\"+ut;}else pt+=ut}return mt||Ae("Unclosed quote after \""+pt+"\"",Me),{type:ne,value:pt,raw:ct+pt+ct}},nt=function(){var ut,pt=We(Me),ct=Me;for(ze(pt)?Me++:Ae("Unexpected "+Ye(Me),Me);Me<Je&&(pt=We(Me),Be(pt));)Me++;return ut=$e.slice(ct,Me),Se.hasOwnProperty(ut)?{type:ne,value:Se[ut],raw:ut}:ut==="this"?{type:"ThisExpression"}:{type:"Identifier",name:ut}},ot=function(ut){for(var pt,ct,mt=[],gt=!1;Me<Je;){if(Ke(),pt=We(Me),pt===ut){gt=!0,Me++;break}pt===ge?Me++:(ct=Ze(),ct&&ct.type!==te||Ae("Expected comma",Me),mt.push(ct))}return gt||Ae("Expected "+String.fromCharCode(ut),Me),mt},st=function(){var ut,pt;for(ut=We(Me),pt=ut===fe?it():nt(),Ke(),ut=We(Me);ut===ce||ut===be||ut===fe;)Me++,ut===ce?(Ke(),pt={type:ae,computed:!1,object:pt,property:nt()}):ut===be?(pt={type:ae,computed:!0,object:pt,property:Ze()},Ke(),ut=We(Me),ut!=xe&&Ae("Unclosed [",Me),Me++):ut==fe&&(pt={type:"CallExpression",arguments:ot(ye),callee:pt}),Ke(),ut=We(Me);return pt},it=function(){Me++;var ut=Ze();return Ke(),We(Me)===ye?(Me++,ut):void Ae("Unclosed (",Me)},lt=function(){return Me++,{type:"ArrayExpression",elements:ot(xe)}},dt=[];Me<Je;)qe=We(Me),qe===59||qe===ge?Me++:(Ge=Ze())?dt.push(Ge):Me<Je&&Ae("Unexpected \""+Ye(Me)+"\"",Me);return 1===dt.length?dt[0]:{type:te,body:dt}};if(Ue.version="0.3.1",Ue.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Ue.version},Ue.addUnaryOp=function($e){return Oe=Math.max($e.length,Oe),Ne[$e]=Pe,this},Ue.addBinaryOp=function($e,qe){return Te=Math.max($e.length,Te),we[$e]=qe,this},Ue.addLiteral=function($e,qe){return Se[$e]=qe,this},Ue.removeUnaryOp=function($e){return delete Ne[$e],$e.length===Oe&&(Oe=Le(Ne)),this},Ue.removeBinaryOp=function($e){return delete we[$e],$e.length===Te&&(Te=Le(we)),this},Ue.removeLiteral=function($e){return delete Se[$e],this},"undefined"==typeof exports){var Re=ee.jsep;ee.jsep=Ue,Ue.noConflict=function(){return ee.jsep===Ue&&(ee.jsep=Re),Ue}}else"undefined"!=typeof module&&module.exports?exports=module.exports=Ue:exports.parse=Ue}(this),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=self.Mavo=ee.Class({constructor:function(ue){var pe=this;this.treeBuilt=Mavo.defer(),this.element=ue,this.index=re.length+1,Object.defineProperty(re.all,this.index-1,{value:this});var ce=re.attributes.map(function(Te){return"[data-"+Te+"]"}).join(", ");if([this.element].concat(_toConsumableArray(te(ce,this.element))).forEach(function(Te){var De,Se=!0,Ie=!1;try{for(var je,Ve=re.attributes[Symbol.iterator]();!(Se=(je=Ve.next()).done);Se=!0){var ze=je.value,Be=Te.getAttribute("data-"+ze);null!==Be&&Te.setAttribute(ze,Be)}}catch(Ue){Ie=!0,De=Ue}finally{try{!Se&&Ve.return&&Ve.return()}finally{if(Ie)throw De}}}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index,this.id in re.all){for(var ge=2;this.id+ge in re.all;ge++);this.id+=ge}re.all[this.id]=this,this.element.setAttribute("mv-app",this.id),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||3),this.element.setAttribute("typeof",""),Mavo.hooks.run("init-start",this);var fe,he=!0,ve=!1;try{for(var be,ye=te(re.selectors.primitive,this.element)[Symbol.iterator]();!(he=(be=ye.next()).done);he=!0){var ue=be.value,xe=ee(re.selectors.not(re.selectors.formControl)+", "+re.selectors.property,ue);if(xe){var ke=Mavo.Primitive.getConfig(ue),Ce=Mavo.is("multiple",ue);!Ce&&(ke.attribute||ke.hasChildren)||ue.setAttribute("typeof","")}}}catch(Te){ve=!0,fe=Te}finally{try{!he&&ye.return&&ye.return()}finally{if(ve)throw fe}}this.expressions=new Mavo.Expressions(this),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var Ne,Ee=["source","storage","init"],Ae=!0,Pe=!1;try{for(var Le,Oe,we=Ee[Symbol.iterator]();!(Ae=(Le=we.next()).done);Ae=!0)Oe=Le.value,this.updateBackend(Oe)}catch(Te){Pe=!0,Ne=Te}finally{try{!Ae&&we.return&&we.return()}finally{if(Pe)throw Ne}}this.backendObserver=new Mavo.Observer(this.element,Ee.map(function(Te){return"mv-"+Te}),function(Te){var Se={},Ie=Te.map(function(De){var Ve=De.attributeName.replace(/^mv-/,"");return Se[Ve]=pe.updateBackend(Ve),Ve});Se.source?pe.load():!pe.source&&(Se.storage||Se.init&&!pe.root.data)&&pe.load()}),this.permissions.can("login",function(){("login"in Mavo.Functions.$url&&1==pe.index||pe.id+"-login"in Mavo.Functions.$url)&&pe.primaryBackend.login()}),this.element.addEventListener("mavo:login.mavo",function(Te){Te.backend!=(pe.source||pe.storage)||pe.root.data||pe.unsavedChanges||pe.load()}),this.bar=new Mavo.UI.Bar(this),ee("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(Te){Te.target!=document.activeElement&&Te.preventDefault()}),this.needsEdit=this.some(function(Te){return Te!=pe.root&&!Te.modes&&"read"==Te.mode}),this.setUnsavedChanges(!1),this.permissions.onchange(function(Te){var Se=Te.action,Ie=Te.value,De=pe.element.getAttribute("mv-permissions")||"";De=De.trim().split(/\s+/).filter(function(Ve){return Ve!=Se}),Ie&&De.push(Se),pe.element.setAttribute("mv-permissions",De.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],function(){pe.modeObserver=new Mavo.Observer(pe.element,"mv-mode",function(Te){var De,Se=!0,Ie=!1;try{for(var je,Ve=Te[Symbol.iterator]();!(Se=(je=Ve.next()).done);Se=!0){var ze=je.value,Be=ze.target,Ue=!0,Re=!1,$e=void 0;try{nodeloop:for(var Ge,qe=re.Node.children(Be)[Symbol.iterator]();!(Ue=(Ge=qe.next()).done);Ue=!0){var Me=Ge.value,He=Me.mode,Fe=void 0;if(Me.element==Be)Fe=Me.element.getAttribute("mv-mode"),Me.modes=Fe;else{if(Me.modes)continue nodeloop;Fe=re.getStyle(Me.element.parentNode,"--mv-mode")}Me.mode=Fe,He!=Me.mode&&Me["edit"==Me.mode?"edit":"done"]()}}catch(Ye){Re=!0,$e=Ye}finally{try{!Ue&&qe.return&&qe.return()}finally{if(Re)throw $e}}}}catch(Ye){Ie=!0,De=Ye}finally{try{!Se&&Ve.return&&Ve.return()}finally{if(Ie)throw De}}},{subtree:!0}),pe.autoEdit&&pe.edit()},function(){pe.modeObserver&&pe.modeObserver.destroy()}),this.storage||this.source?this.permissions.can("read",function(){return pe.load()}):ee.fire(this.element,"mavo:load"),this.permissions.can("save",function(){pe.autoSave&&pe.element.addEventListener("mavo:load.mavo:autosave",function(){var Se=re.debounce(function(){pe.save()},pe.autoSaveDelay),Ie=function(Ve){Ve.node.saved&&Se()};requestAnimationFrame(function(){pe.permissions.can("save",function(){pe.element.addEventListener("mavo:datachange.mavo:autosave",Ie)},function(){pe.element.removeEventListener("mavo:datachange.mavo:autosave",Ie)})})}),pe.element.addEventListener("keydown.mavo:save",function(Te){83==Te.keyCode&&Te[re.superKey]&&(Te.preventDefault(),pe.save())})},function(){ee.unbind(pe.element,".mavo:save .mavo:autosave")}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(){return this.root.getData()},toJSON:function(){return re.toJSON(this.getData())},message:function(ue,pe){return new re.UI.Message(this,ue,pe)},error:function(ue){this.message(ue,{classes:"mv-error",dismiss:["button","timeout"]});for(var pe=arguments.length,ce=Array(1<pe?pe-1:0),ge=1;ge<pe;ge++)ce[ge-1]=arguments[ge];if(0<ce.length){var he;(he=console).log.apply(he,["%c"+this.id+": "+ue,"color: red; font-weight: bold"].concat(ce))}},render:function(ue){var pe=this;this.expressions.active=!1;var ce={context:this,data:ue};re.hooks.run("render-start",ce),ce.data&&this.root.render(ce.data),this.unsavedChanges=!1,this.expressions.active=!0,requestAnimationFrame(function(){return pe.expressions.update()}),re.hooks.run("render-end",ce)},clear:function(){var ue=this;confirm("This will delete all your data. Are you sure?")&&this.store(null).then(function(){return ue.root.clear()})},edit:function(){this.root.edit(),ee.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(ue){if(ue.target.matches(re.selectors.multiple)){ue.target.classList.remove("mv-has-hovered-item");var pe=ue.target.parentNode.closest(re.selectors.multiple);pe&&pe.classList.toggle("mv-has-hovered-item","mouseenter"==ue.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(ue){var pe=!!ue;return ue||this.walk(function(ce){if(ce.unsavedChanges)return pe=!0,!1===ue&&(ce.unsavedChanges=!1),!1}),this.unsavedChanges=pe},done:function(){this.root.done(),ee.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},updateBackend:function(ue){var ce,pe=this[ue];1==this.index&&(ce=re.Functions.$url[ue]),ce||(ce=re.Functions.$url[this.id+"-"+ue]||this.element.getAttribute("mv-"+ue)||null),ce&&(ce=ce.trim(),"none"==ce&&(ce=null)),!ce||pe&&pe.equals(ce)?!ce&&(this[ue]=null):this[ue]=ce=re.Backend.create(ce,{mavo:this,format:this.element.getAttribute("mv-format-"+ue)||this.element.getAttribute("mv-format")});var ge=ce?!ce.equals(pe):!!pe;if(ge){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);var he=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});he.parent=this.source&&this.source.permissions,this.permissions.parent=he,this.primaryBackend=this.storage||this.source}return ge},load:function(){var ue=this,pe=this.source||this.storage;return pe?(this.inProgress="Loading",pe.ready.then(function(){return pe.load()}).catch(function(ce){return ue.init&&ue.init!=pe?(pe=ue.init,ue.init.ready.then(function(){return ue.init.load()})):Promise.reject(ce)}).catch(function(ce){if(ce){var ge=ce instanceof XMLHttpRequest?ce:ce.xhr;if(ge&&404==ge.status)ue.render(null);else{var he="Problem loading data";ge&&(he+=ge.status?": HTTP error "+ce.status+": "+ce.statusText:": Can\u2019t connect to the Internet"),ue.error(he,ce)}}return null}).then(function(ce){return ue.render(ce)}).then(function(){ue.inProgress=!1,ee.fire(ue.element,"mavo:load")})):Promise.resolve()},store:function(){var ue=this;return this.storage?(this.inProgress="Saving",this.storage.login().then(function(){return ue.storage.store(ue.getData())}).catch(function(pe){if(pe){var ce="Problem saving data";pe instanceof XMLHttpRequest&&(ce+=pe.status?": HTTP error "+pe.status+": "+pe.statusText:": Can\u2019t connect to the Internet"),ue.error(ce,pe)}return null}).then(function(pe){return ue.inProgress=!1,pe})):Promise.resolve()},upload:function(ue){var pe=this,ce=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"images/"+ue.name;return this.uploadBackend?(this.inProgress="Uploading",this.uploadBackend.upload(ue,ce).then(function(ge){return pe.inProgress=!1,ge}).catch(function(ge){return pe.error("Error uploading file",ge),pe.inProgress=!1,null})):Promise.reject()},save:function(){var ue=this;return this.store().then(function(pe){pe&&(ee.fire(ue.element,"mavo:save",pe),ue.lastSaved=Date.now(),ue.root.save(),ue.unsavedChanges=!1)})},walk:function(ue){return this.root.walk(ue)},some:function(ue){return!this.walk(function(pe,ce){var ge=ue(pe,ce);if(!0===ge)return!1})},live:{inProgress:function(ue){ee.toggleAttribute(this.element,"mv-progress",ue,ue)},unsavedChanges:function(ue){this.element.classList.toggle("mv-unsaved-changes",ue)},needsEdit:function(ue){this.bar.toggle("edit",ue)},storage:function(ue){if(ue!==this._storage&&!ue){var pe=new Mavo.Permissions({edit:!0,save:!1});pe.parent=this.permissions.parent,this.permissions.parent=pe}},primaryBackend:function(ue){if(ue=ue||null,ue!=this._primaryBackend)return ue?this.element.style.setProperty("--mv-backend","\""+ue.id+"\""):this.element.style.removeProperty("--mv-backend"),ue},uploadBackend:{get:function(){if(this.storage&&this.storage.upload)return this.storage}}},static:{all:{},get length(){return Object.keys(re.all).length},get:function(ue){if(ue instanceof Element){for(var pe in re.all)if(re.all[pe].element==ue)return re.all[pe];return null}var pe="number"==typeof ue?Object.keys(re.all)[ue]:ue;return re.all[pe]||null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",base:"about:"==location.protocol?document.currentScript?document.currentScript.src:"http://mavo.io":location,dependencies:[],init:function(){var ue=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document;return te(re.selectors.init,ue).filter(function(pe){return!re.get(pe)}).map(function(pe){return new re(pe)})},UI:{},hooks:new ee.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions","mv-rel"]}});{var ae=re.selectors={init:".mv-app, [mv-app], [data-mv-app]",property:"[property], [itemprop]",specificProperty:function(ue){return"[property="+ue+"], [itemprop="+ue+"]"},group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},ne=ae.arr=function(de){return de.split(/\s*,\s*/g)},oe=ae.not=function(de){return ne(de).map(function(ue){return":not("+ue+")"}).join("")},se=ae.or=function(de,ue){return de+", "+ue},ie=ae.and=function(de,ue){var pe=[],ce=ne(ue);return ne(de).forEach(function(ge){return pe.push.apply(pe,_toConsumableArray(ce.map(function(he){return ge+he})))}),pe.join(", ")},le=ae.andNot=function(de,ue){return ie(de,oe(ue))};ee.extend(re.selectors,{primitive:le(ae.property,ae.group),rootGroup:le(ae.group,ae.property),output:se(ae.specificProperty("output"),".mv-output")})}requestAnimationFrame(function(){var de=Array.from&&window.Intl&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype;re.dependencies.push(ee.ready(),re.Plugins.load(),ee.include(de,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")),re.ready=re.all(re.dependencies),re.inited=re.ready.catch(console.error).then(function(){return Mavo.init()})}),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize"})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){function re(ne,oe){for(ne="mv-"+ne+"-within",te("."+ne).forEach(function(se){return se.classList.remove(ne)});oe&&oe.classList;)oe.classList.add(ne),oe=oe.parentNode}var ae=ee.extend(Mavo,{load:function(oe){var se=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.currentScript?document.currentScript.src:location;if(ae.loaded=ae.loaded||new Set,!ae.loaded.has(oe+""))return oe=new URL(oe,se),/\.css$/.test(oe.pathname)?(ee.create("link",{href:oe,rel:"stylesheet",inside:document.head}),Promise.resolve()):ee.include(oe)},readFile:function(oe){var se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"DataURL",ie=new FileReader;return new Promise(function(le,de){ie.onload=function(){return le(ie.result)},ie.onerror=ie.onabort=de,ie["readAs"+se](oe)})},toJSON:function(oe){return null===oe?"":"string"==typeof oe?oe:JSON.stringify(oe,null,"\t")},toArray:function(oe){return oe===void 0?[]:Array.isArray(oe)?oe:[oe]},delete:function(oe,se){var ie=oe&&oe.indexOf(se);-1<ie&&oe.splice(ie,1)},hasIntersection:function(oe,se){return oe&&se&&!oe.every(function(ie){return-1==se.indexOf(ie)})},flatten:function(oe){return Array.isArray(oe)?oe.reduce(function(se,ie){return ae.toArray(se).concat(ae.flatten(ie))},[]):[oe]},pushUnique:function(oe,se){-1===oe.indexOf(se)&&oe.push(se)},is:function(oe){for(var se=arguments.length,ie=Array(1<se?se-1:0),le=1;le<se;le++)ie[le-1]=arguments[le];var de=!0,ue=!1,pe;try{for(var ge,he,ce=ie[Symbol.iterator]();!(de=(ge=ce.next()).done);de=!0)if(he=ge.value,he&&he.matches&&he.matches(ae.selectors[oe]))return!0}catch(ve){ue=!0,pe=ve}finally{try{!de&&ce.return&&ce.return()}finally{if(ue)throw pe}}return!1},getStyle:function(oe,se){return oe&&getComputedStyle(oe).getPropertyValue(se).trim()},data:function(oe,se,ie){return 2==arguments.length?ee.value(oe,"_","data","mavo",se):(oe._.data.mavo=oe._.data.mavo||{},oe._.data.mavo[se]=ie)},revocably:{add:function(oe,se){var ie=ae.revocably.isRemoved(oe);return ie&&ie.parentNode?ie.parentNode.replaceChild(oe,ie):oe&&se&&!oe.parentNode&&se.appendChild(oe),ie},remove:function(oe,se){if(oe){var ie=ae.data(oe,"commentstub");return ie||(se=se||oe.id||oe.className||oe.nodeName,ie=ae.data(oe,"commentstub",document.createComment(se))),oe.parentNode&&oe.parentNode.replaceChild(ie,oe),ie}},isRemoved:function(oe){if(!oe||oe.parentNode)return!1;var se=ae.data(oe,"commentstub");return se&&se.parentNode&&se}},inViewport:function(oe){var se=oe.getBoundingClientRect();return(0<=se.bottom&&se.bottom<=innerHeight||0<=se.top&&se.top<=innerHeight)&&(0<=se.right&&se.right<=innerWidth||0<=se.left&&se.left<=innerWidth)},scrollIntoViewIfNeeded:function(oe){oe&&!Mavo.inViewport(oe)&&oe.scrollIntoView({behavior:"smooth"})},getAttribute:function(oe){for(var se=arguments.length,ie=Array(1<se?se-1:0),le=1;le<se;le++)ie[le-1]=arguments[le];for(var ue,pe,de=0;ue=ie[de];de++)if(pe=oe.getAttribute(ue),pe)return pe;return null},subset:function(oe,se,ie){if(3==arguments.length){if(se.length){var le=ee.value.apply(ee,[oe].concat(_toConsumableArray(se.slice(0,-1))));return le[se[se.length-1]]=ie,oe}return ie}return"object"==("undefined"==typeof oe?"undefined":_typeof(oe))&&se&&se.length?se.reduce(function(de,ue,pe){if(de&&ue in de)return de[ue];if(Array.isArray(de)&&isNaN(ue))for(var ce=0;ce<de.length;ce++)if(de[ce]&&de[ce].id==ue)return se[pe]=ce,de[ce];return de},oe):oe},clone:function(oe){var se=new WeakSet;return JSON.parse(JSON.stringify(oe,function(ie,le){if("object"===("undefined"==typeof le?"undefined":_typeof(le))&&null!==le){if(se.has(le))return;se.add(le)}return le}))},debounce:function(oe,se){if(!se)return oe;var le,ie=null;return function(){var de=this,ue=arguments;le=function(){oe.apply(de,ue),removeEventListener("beforeunload",le)},clearTimeout(ie),ie=setTimeout(le,se),addEventListener("beforeunload",le)}},escapeRegExp:function(oe){return oe.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Observer:ee.Class({constructor:function(oe,se,ie){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};ie instanceof MutationObserver&&(this.observer=ie),this.observer=this.observer||new MutationObserver(ie),this.element=oe,this.callback=ie,this.attribute=se,this.options=ee.extend({},le),se&&ee.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!le.oldValue}),this.attribute&&"all"!=this.attribute||ee.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!le.oldValue}),this.run()},stop:function(){return this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(oe){if(this.running){this.stop();var se=oe();this.run()}else var se=oe();return se},destroy:function(){this.observer.disconnect(),this.observer=this.element=null},static:{sneak:function(oe,se){return oe?oe.sneak(se):se()}}}),defer:function(oe){var se,ie,le=new Promise(function(de,ue){oe&&oe(de,ue),se=de,ie=ue});return le.resolve=function(de){return se(de),le},le.reject=function(de){return ie(de),le},le},all:function(oe){var se=!0,ie=!1,le;try{for(var ue,pe,de=oe[Symbol.iterator]();!(se=(ue=de.next()).done);se=!0)pe=ue.value,"promise"==ee.type(pe)&&(pe=pe.catch(function(ce){return ce}))}catch(ce){ie=!0,le=ce}finally{try{!se&&de.return&&de.return()}finally{if(ie)throw le}}return Promise.all(oe).then(function(ce){return oe.length==ce.length?ce:ae.all(oe)})},rr:function(oe){return oe(),oe}});ee.add("toggleAttribute",function(ne,oe){var se=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null!==oe;se?this.setAttribute(ne,oe):this.removeAttribute(ne)}),ee.proxy=ee.classProps.proxy=ee.overload(function(ne,oe,se){return Object.defineProperty(ne,oe,{get:function(){return this[se][oe]},set:function(le){this[se][oe]=le},configurable:!0,enumerable:!0}),ne}),ee.classProps.propagated=function(ne,oe){Mavo.toArray(oe).forEach(function(se){var ie=ne[se];ne[se]=function(){var le=ie&&ie.apply(this,arguments);this.propagate&&!1!==le&&this.propagate(se)}})};document.addEventListener("focus",function(ne){re("focus",ne.target)},!0),document.addEventListener("blur",function(){re("focus",null)},!0),addEventListener("hashchange",function(){re("target",ee(location.hash))}),document.documentElement.addEventListener("mavo:datachange",function(){re("target",ee(location.hash))}),re("focus",document.activeElement===document.body?null:document.activeElement)})(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee){Mavo.attributes.push("mv-plugins");var te=Mavo.Plugins={loaded:{},load:function(){te.plugins=new Set;var ae=!0,ne=!1,oe;try{for(var ie,se=$$("[mv-plugins]")[Symbol.iterator]();!(ae=(ie=se.next()).done);ae=!0){var le=ie.value,de=le.getAttribute("mv-plugins").trim().split(/\s+/),ue=!0,pe=!1,ce=void 0;try{for(var he,ve,ge=de[Symbol.iterator]();!(ue=(he=ge.next()).done);ue=!0)ve=he.value,te.plugins.add(ve)}catch(fe){pe=!0,ce=fe}finally{try{!ue&&ge.return&&ge.return()}finally{if(pe)throw ce}}}}catch(fe){ne=!0,oe=fe}finally{try{!ae&&se.return&&se.return()}finally{if(ne)throw oe}}return te.plugins.size?ee.fetch(te.url+"/plugins.json",{responseType:"json"}).then(function(fe){return Mavo.all(fe.response.plugin.filter(function(ye){return te.plugins.has(ye.id)}).map(function(ye){if(ye.repo)var be="https://raw.githubusercontent.com/"+ye.repo+"/";else var be=te.url+"/"+ye.id+"/";var xe=be+"mavo-"+ye.id+".js";return ee.include(te.loaded[ye.id],xe)}))}):Promise.resolve()},register:function(ae){if(!(ae.name&&te.loaded[ae.name])){for(var ne in Mavo.hooks.add(ae.hooks),ae.extend){var oe="Mavo"==ne?Mavo:Mavo[ne];"function"===ee.type(oe)?ee.Class(oe,ae.extend[ne]):ee.extend(oe,ae.extend[ne])}var se=[];if(ae.ready&&se.push(ae.ready),ae.dependencies){var ie=document.currentScript?document.currentScript.src:location,le=ae.dependencies.map(function(ue){return Mavo.load(ue,ie)});se.push.apply(se,_toConsumableArray(le))}if(se.length){var de;(de=Mavo.dependencies).push.apply(de,se)}ae.name&&(te.loaded[ae.name]=ae),ae.init&&Promise.all(se).then(function(){return ae.init()})}},url:"https://plugins.mavo.io/"}})(Bliss),"use strict",function(ee){Mavo.attributes.push("mv-bar");var re=Mavo.UI.Bar=ee.Class({constructor:function(ne){var oe=this;this.mavo=ne,this.element=ee(".mv-bar",this.mavo.element)||ee.create({className:"mv-bar mv-ui",start:this.mavo.element,innerHTML:"<button>&nbsp;</button>"}),this.element.classList.contains("mv-compact")&&(this.noResize=!0),this.order=this.mavo.element.getAttribute("mv-bar")||this.element.getAttribute("mv-bar"),this.order=this.order?"none"==this.order?[]:this.order.split(/\s+/):Object.keys(re.controls),this.order=this.order.filter(function(fe){return re.controls[fe]}),this.order.length&&(this.targetHeight=this.element.offsetHeight),this.element.innerHTML="";var se=function(ye){var be=re.controls[ye];for(he in be.create?oe[ye]=be.create.call(oe.mavo):(ge=be.label||Mavo.Functions.readable(ye),oe[ye]=ee.create("button",{className:"mv-"+ye,textContent:ge,title:ge})),oe.add(ye),be.permission?oe.permissions.can(be.permission,function(){oe.toggle(ye,!be.condition||be.condition.call(oe.mavo))},function(){oe.remove(ye)}):be.condition&&!be.condition.call(oe.mavo)&&oe.remove(ye),be.events)ee.events(oe[ye],he,be.events[he].bind(oe.mavo));be.action&&ee.delegate(oe.element,"click",".mv-"+ye,function(){(!be.permission||oe.permissions.is(be.permission))&&be.action.call(oe.mavo)})},ie=!0,le=!1,de;try{for(var pe,ue=this.order[Symbol.iterator]();!(ie=(pe=ue.next()).done);ie=!0){var ce=pe.value,ge,he;se(ce)}}catch(fe){le=!0,de=fe}finally{try{!ie&&ue.return&&ue.return()}finally{if(le)throw de}}if(this.order.length&&!this.noResize&&(this.resize(),self.ResizeObserver)){var ve=null;this.resizeObserver=new ResizeObserver(function(fe){var ye=fe[fe.length-1].contentRect;ve&&ve.width==ye.width&&ve.height==ye.height||(oe.resize(),ve=ye)}),this.resizeObserver.observe(this.element)}},resize:function(){return this.targetHeight?void(this.resizeObserver&&this.resizeObserver.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),this.element.offsetHeight>1.5*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight&&this.element.classList.add("mv-tiny")),this.resizeObserver&&this.resizeObserver.observe(this.element)):void(this.targetHeight=this.element.offsetHeight)},add:function(ne){var oe=this,se=re.controls[ne];se.prepare&&se.prepare.call(this.mavo),Mavo.revocably.add(this[ne],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return oe.resize()})},remove:function(ne){var oe=this,se=re.controls[ne];Mavo.revocably.remove(this[ne],"mv-"+ne),se.cleanup&&se.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return oe.resize()})},toggle:function(ne,oe){return this[oe?"add":"remove"](ne)},proxy:{permissions:"mavo"},static:{controls:{status:{create:function(){var ne=ee.create({className:"mv-status"});return ne},prepare:function(){var ne=this.primaryBackend;if(ne&&ne.user){var oe=ne.user,se=oe.name||"";oe.avatar&&(se="<img class=\"mv-avatar\" src=\""+oe.avatar+"\" /> "+se),oe.url&&(se="<a href=\""+oe.url+"\" target=\"_blank\">"+se+"</a>"),this.bar.status.innerHTML=se}},permission:"logout"},edit:{action:function(){this.editing?this.done():this.edit()},permission:["edit","add","delete"],cleanup:function(){this.editing&&this.done()}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},clear:{action:function(){this.clear()},permission:"delete"},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}})}(Bliss,Bliss.$),"use strict",function(ee){Mavo.UI.Message=ee.Class({constructor:function(ne,oe,se){var ie=this;if(this.mavo=ne,this.message=oe,this.closed=Mavo.defer(),this.element=ee.create({className:"mv-ui mv-message",innerHTML:this.message,events:{click:function(){return Mavo.scrollIntoViewIfNeeded(ie.mavo.element)}},after:this.mavo.bar.element}),se.classes&&this.element.classList.add(se.classes),se.dismiss=se.dismiss||{},"string"==typeof se.dismiss||Array.isArray(se.dismiss)){var pe,le={},de=!0,ue=!1;try{for(var ge,he,ce=Mavo.toArray(se.dismiss)[Symbol.iterator]();!(de=(ge=ce.next()).done);de=!0)he=ge.value,le[he]=!0}catch(ye){ue=!0,pe=ye}finally{try{!de&&ce.return&&ce.return()}finally{if(ue)throw pe}}se.dismiss=le}if(se.dismiss.button&&ee.create("button",{className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){return ie.close()}},start:this.element}),se.dismiss.timeout){var fe,ve="number"==typeof se.dismiss.timeout?se.dismiss.timeout:5e3;ee.events(this.element,{mouseenter:function(){return clearTimeout(fe)},mouseleave:Mavo.rr(function(){return fe=setTimeout(function(){return ie.close()},ve)})})}se.dismiss.submit&&this.element.addEventListener("submit",function(ye){ye.preventDefault(),ie.close(ye.target)})},close:function(ne){var oe=this;ee.transition(this.element,{opacity:0}).then(function(){ee.remove(oe.element),oe.closed.resolve(ne)})}})}(Bliss,Bliss.$),"use strict",function(ee){var te=Mavo.Permissions=ee.Class({constructor:function(ae){this.triggers=[],this.hooks=new ee.Hooks,this.parentChanged=te.prototype.parentChanged.bind(this),this.set(ae)},set:function(ae){for(var ne in ae)this[ne]=ae[ne]},on:function(ae){var ne=this;return Mavo.toArray(ae).forEach(function(oe){return ne[oe]=!0}),this},off:function(ae){var ne=this;return ae=Array.isArray(ae)?ae:[ae],ae.forEach(function(oe){return ne[oe]=!1}),this},can:function(ae,ne,oe){this.observe(ae,!0,ne),oe&&this.cannot(ae,oe)},cannot:function(ae,ne){this.observe(ae,!1,ne)},observe:function(ae,ne,oe){ae=Mavo.toArray(ae),this.is(ae,ne)&&oe(),this.triggers.push({actions:ae,value:ne,callback:oe,active:!0})},is:function(ae){var ne=this,oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,se=Mavo.toArray(ae).map(function(ie){return!!ne[ie]}).reduce(function(ie,le){return ie||le});return oe?se:!se},onchange:function(ae){this.hooks.add("change",ae);var ne=!0,oe=!1,se;try{for(var le,de,ie=te.actions[Symbol.iterator]();!(ne=(le=ie.next()).done);ne=!0)de=le.value,ae.call(this,{action:de,value:this[de]})}catch(ue){oe=!0,se=ue}finally{try{!ne&&ie.return&&ie.return()}finally{if(oe)throw se}}},parentChanged:function(){var ae=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},ne=this["_"+ae.action];void 0!==ne||ae.from==ae.value||(this.fireTriggers(ae.action),this.hooks.run("change",ee.extend({context:this},ae)))},changed:function(ae,ne,oe){oe=!!oe,ne=!!ne;ne==oe||(this["_"+ae]=ne,this.fireTriggers(ae),this.hooks.run("change",{action:ae,value:ne,from:oe,context:this}))},fireTriggers:function(ae){var ne=!0,oe=!1,se;try{for(var le,ie=this.triggers[Symbol.iterator]();!(ne=(le=ie.next()).done);ne=!0){var de=le.value,ue=this.is(de.actions,de.value);de.active&&-1<de.actions.indexOf(ae)&&ue?(de.active=!1,de.callback()):!ue&&(de.active=!0)}}catch(pe){oe=!0,se=pe}finally{try{!ne&&ie.return&&ie.return()}finally{if(oe)throw se}}},or:function(ae){var ne=!0,oe=!1,se;try{for(var le,de,ie=te.actions[Symbol.iterator]();!(ne=(le=ie.next()).done);ne=!0)de=le.value,this[de]=this[de]||ae[de]}catch(ue){oe=!0,se=ue}finally{try{!ne&&ie.return&&ie.return()}finally{if(oe)throw se}}return this},live:{parent:function(ae){var ne=this._parent;if(ne!=ae){this._parent=ae,ne&&Mavo.delete(ne.hooks.change,this.parentChanged);var ie,oe=!0,se=!1;try{for(var de,ue,le=te.actions[Symbol.iterator]();!(oe=(de=le.next()).done);oe=!0)ue=de.value,this.parentChanged({action:ue,value:ae?ae[ue]:void 0,from:ne?ne[ue]:void 0})}catch(pe){se=!0,ie=pe}finally{try{!oe&&le.return&&le.return()}finally{if(se)throw ie}}ae&&ae.onchange(this.parentChanged)}}},static:{actions:[],register:function(ae,ne){return Array.isArray(ae)?void ae.forEach(function(oe){return te.register(oe,ne)}):void(ee.live(te.prototype,ae,{get:function(){var se=this["_"+ae];return void 0===se&&this.parent?this.parent[ae]:se},set:function(se,ie){ne&&ne.call(this,se,ie),this.changed(ae,se,ie)}}),te.actions.push(ae))}}});te.register(["read","save"]),te.register("login",function(re){re&&this.logout&&(this.logout=!1)}),te.register("logout",function(re){re&&this.login&&(this.login=!1)}),te.register("edit",function(re){re&&(this.add=this.delete=!0)}),te.register(["add","delete"],function(re){re||(this.edit=!1)})}(Bliss),"use strict",function(ee){var te=Mavo.Backend=ee.Class({constructor:function(ae){var ne=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};this.source=ae,this.url=new URL(this.source,Mavo.base),this.mavo=ne.mavo,this.format=Mavo.Formats.create(ne.format,this),this.permissions=new Mavo.Permissions},get:function(){var ae=new URL(this.url);return ae.searchParams.set("timestamp",Date.now()),ee.fetch(this.url.href).then(function(ne){return Promise.resolve(ne.responseText)},function(){return Promise.resolve(null)})},load:function(){var ae=this;return this.ready.then(function(){return ae.get()}).then(function(ne){return"string"==typeof ne?(ne=ne.replace(/^\ufeff/,""),ae.format.parse(ne)):ne})},store:function(ae){var ne=this,oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},se=oe.path,ie=oe.format,le=ie===void 0?this.format:ie;return this.ready.then(function(){var de="string"==typeof ae?Promise.resolve(ae):le.stringify(ae);return de.then(function(ue){return ne.put(ue,se).then(function(){return{data:ae,serialized:ue}})})})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},isAuthenticated:function(){return!!this.accessToken},oAuthParams:function(){return""},toString:function(){return this.id+" ("+this.url+")"},equals:function(ae){return ae===this||ae&&this.id==ae.id&&this.source==ae.source},request:function(ae,ne){var oe=this,se=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",ie=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return ie.method=ie.method||se,ie.responseType=ie.responseType||"json",ie.headers=ie.headers||{},ie.headers["Content-Type"]=ie.headers["Content-Type"]||"application/json; charset=utf-8",ie.data=ne,this.isAuthenticated()&&(ie.headers.Authorization=ie.headers.Authorization||"Bearer "+this.accessToken),"object"===ee.type(ie.data)&&("GET"==ie.method?ie.data=Object.keys(ie.data).map(function(le){return le+"="+encodeURIComponent(ie.data[le])}).join("&"):ie.data=JSON.stringify(ie.data)),ae=new URL(ae,this.constructor.apiDomain),ee.fetch(ae,ie).catch(function(le){return le&&le.xhr?Promise.reject(le.xhr):void oe.mavo.error("Something went wrong while connecting to "+oe.id,le)}).then(function(le){return"HEAD"==ie.method?le:le.response})},oAuthenticate:function(ae){var ne=this;return this.ready.then(function(){return ne.isAuthenticated()?Promise.resolve():new Promise(function(oe,se){var ie=ne.id.toLowerCase();if(ae)ne.accessToken=localStorage["mavo:"+ie+"token"],ne.accessToken&&oe(ne.accessToken);else{var le={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};le.top=(innerHeight-le.height)/2+(screen.top||screenTop),le.left=(innerWidth-le.width)/2+(screen.left||screenLeft);var de={url:location.href,backend:ne.id};ne.authPopup=open(ne.constructor.oAuth+"?client_id="+ne.key+"&state="+encodeURIComponent(JSON.stringify(de))+ne.oAuthParams(),"popup","width="+le.width+",height="+le.height+",left="+le.left+",top="+le.top),addEventListener("message",function(ue){ue.source===ne.authPopup&&(ue.data.backend==ne.id&&(ne.accessToken=localStorage["mavo:"+ie+"token"]=ue.data.token),!ne.accessToken&&se(Error("Authentication error")),oe(ne.accessToken))})}})})},oAuthLogout:function(){if(this.isAuthenticated()){var ae=this.id.toLowerCase();localStorage.removeItem("mavo:"+ae+"token"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this})}return Promise.resolve()},static:{create:function(ae,ne){if(ae){var oe=te.types.filter(function(se){return se.test(ae)})[0]||te.Remote;return new oe(ae,ne)}return null},types:[],register:function(ae){return te[ae.prototype.id]=ae,te.types.push(ae),ae}}});te.register(ee.Class({id:"Element",extends:te,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=ee(this.source)||ee.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(ae){return Promise.resolve(this.element.textContent=ae)},static:{test:function(ae){return 0===ae.indexOf("#")}}})),te.register(ee.Class({id:"Remote",extends:te,constructor:function(){this.permissions.on("read")},static:{test:function(){return!1}}})),te.register(ee.Class({extends:te,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(ae){return ae?localStorage[this.key]=ae:delete localStorage[this.key],Promise.resolve(ae)},static:{test:function(ae){return"local"==ae}}}))}(Bliss),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}(function(ee){var re=Mavo.Formats={},ae=re.Base=ee.Class({abstract:!0,constructor:function(le){this.backend=le},proxy:{mavo:"backend"},parse:function(le){return this.constructor.parse(le,this)},stringify:function(le){return this.constructor.stringify(le,this)},static:{parse:function(le){return Promise.resolve(le)},stringify:function(le){return Promise.resolve(le)},extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(function(le){return ee.include(le.test(),le.url)}))}}}),ne=re.JSON=ee.Class({extends:re.Base,static:{parse:function(le){return Promise.resolve(le?JSON.parse(le):null)},stringify:function(le){return Promise.resolve(Mavo.toJSON(le))},extensions:[".json",".jsonld"]}}),oe=re.Text=ee.Class({extends:re.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:function(le,de){return Promise.resolve(_defineProperty({},de?de.property:"content",le))},stringify:function(le,de){return Promise.resolve(le[de?de.property:"content"])}}}),se=re.CSV=ee.Class({extends:re.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=ee.extend({},re.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:function(){return self.Papa},url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:ae.ready,parse:function(le,de){return se.ready().then(function(){var ue=Papa.parse(le,se.defaultOptions),pe=de?de.property:"content";if(de&&(de.options.delimiter=ue.meta.delimiter,de.options.linebreak=ue.meta.linebreak),ue.meta.aborted)throw ue.meta.errors.pop();return _defineProperty({},pe,ue.data)})},stringify:function(le,de){return se.ready().then(function(){var ue=de?de.property:"content",pe=de?de.options:se.defaultOptions;return Papa.unparse(data[ue],pe)})}}});Object.defineProperty(re,"create",{value:function(le,de){if(le&&"object"===("undefined"==typeof le?"undefined":_typeof(le)))return le;if("string"==typeof le)for(var ue in le=le.toLowerCase(),re){var pe=re[ue];if(ue.toLowerCase()==le)return new pe(de)}if(!le){var ce=de.url?de.url.pathname:de.source,ge=(ce.match(/\.\w+$/)||[])[0]||".json",pe=re.JSON;for(var ue in re)-1<re[ue].extensions.indexOf(ge)&&(pe=re[ue]);return new pe(de)}}})})(Bliss,Bliss.$),"use strict";function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Node=ee.Class({abstract:!0,constructor:function(ne,oe){var se=this,ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(!ne||!oe)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var le={context:this,options:ie};this.uid=++re.maxId,this.nodeType=this.nodeType,this.property=null,this.element=ne,ee.extend(this,le.options),re.all.set(ne,[].concat(_toConsumableArray(re.all.get(this.element)||[]),[this])),this.template=le.options.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=oe,this.group=this.parentGroup=le.options.group,this.fromTemplate("property","type")||(this.property=re.getProperty(ne),this.type=Mavo.Group.normalize(ne),this.storage=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",le),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=le.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup);var de=this.template;de&&de.expressions&&(this.expressions=de.expressions.map(function(ue){return new Mavo.DOMExpression({template:ue,item:se,mavo:se.mavo})})),Mavo.hooks.run("node-init-end",le)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.storage},get path(){var ae=this.parentGroup?this.parentGroup.path:[];return this.property?[].concat(_toConsumableArray(ae),[this.property]):ae},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){this.template&&Mavo.delete(this.template.copies,this)},getData:function(){var ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(this.isDataNull(ne))return null},isDataNull:function(ne){var oe={context:this,options:ne,result:this.deleted||!this.saved&&!ne.live};return Mavo.hooks.run("unit-isdatanull",oe),oe.result},walk:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return function ie(le,de){var ue=ne(le,de);if(!1!==ue)for(var pe in le.children){var ce=le.children[pe];if(ce instanceof Mavo.Node){var ue=ie.call(ce,ce,[].concat(_toConsumableArray(de),[pe]));if(!1===ue)return!1}}return!1!==ue}(this,oe)},walkUp:function(ne){for(var se,oe=this;oe=oe.parentGroup;)if(se=ne(oe),void 0!==se)return se},edit:function(){return this.mode="edit","edit"==this.mode&&void Mavo.hooks.run("node-edit-end",this)},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(ee.unbind(this.element,".mavo:edit"),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(ne){for(var oe in this.children){var se=this.children[oe];se instanceof Mavo.Node&&("function"==typeof ne?ne.call(se,se):ne in se&&se[ne]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var ne=arguments.length,oe=Array(ne),se=0;se<ne;se++)oe[se]=arguments[se];var ie=!0,le=!1,de;try{for(var pe,ce,ue=oe[Symbol.iterator]();!(ie=(pe=ue.next()).done);ie=!0)ce=pe.value,this[ce]=this.template[ce]}catch(ge){le=!0,de=ge}finally{try{!ie&&ue.return&&ue.return()}finally{if(le)throw de}}}return!!this.template},render:function(ne){this.oldData=this.data,this.data=ne,ne=Mavo.subset(ne,this.inPath);var oe={context:this,data:ne};if(Mavo.hooks.run("node-render-start",oe),"Collection"!=this.nodeType&&Array.isArray(ne)){var se;this.isRoot&&1===(se=Object.keys(this.children)).length&&"Collection"===this.children[se[0]].nodeType?oe.data=_defineProperty({},se[0],oe.data):(this.inPath.push("0"),oe.data=oe.data[0])}this.editing?(this.done(),this.dataRender(oe.data),this.edit()):this.dataRender(oe.data),this.save(),Mavo.hooks.run("node-render-end",oe)},dataChanged:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};ee.fire(oe.element||this.element,"mavo:datachange",ee.extend({property:this.property,action:ne,mavo:this.mavo,node:this},oe))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},getClosestCollection:function(){return this.collection||this.group.collection||(this.parentGroup?this.parentGroup.closestCollection:null)},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},lazy:{closestCollection:function(){return this.getClosestCollection()},inPath:function(){return"Collection"==this.nodeType?[]:(this.element.getAttribute("mv-path")||"").split("/").filter(function(ne){return ne.length})}},live:{store:function(ne){ee.toggleAttribute(this.element,"mv-storage",ne)},unsavedChanges:function(ne){return!ne||this.saved&&this.editing||(ne=!1),this.element.classList.toggle("mv-unsaved-changes",ne),ne},mode:function(ne){var oe=this;if(this._mode!=ne){if(this.modes&&ne!=this.modes&&(ne=this.modes),this._mode=ne,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var se=this.modes||"edit"==ne;Mavo.Observer.sneak(this.mavo.modeObserver,function(){ee.toggleAttribute(oe.element,"mv-mode",ne,se)})}return ne}},modes:function(ne){return ne&&"read"!=ne&&"edit"!=ne?null:void(this._modes=ne,ne&&this.mode!=ne&&(this.mode=ne))},deleted:function(ne){var oe=this;this.element.classList.toggle("mv-deleted",ne),ne?(this.elementContents=document.createDocumentFragment(),te(this.element.childNodes).forEach(function(se){oe.elementContents.appendChild(se)}),ee.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){ee.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(){return oe.deleted=!1}}}]),this.element.classList.remove("mv-highlight")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"))}},static:{maxId:0,all:new WeakMap,create:function(ne,oe){var se=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return Mavo.is("multiple",ne)&&!se.collection?new Mavo.Collection(ne,oe,se):new Mavo[Mavo.is("group",ne)?"Group":"Primitive"](ne,oe,se)},getProperty:function(ne){var oe=ne.getAttribute("property")||ne.getAttribute("itemprop");return!oe&&ne.hasAttribute("property")&&(oe=ne.name||ne.id||ne.classList[0]),oe&&ne.setAttribute("property",oe),oe},get:function(ne,oe){var se=(re.all.get(ne)||[]).filter(function(ie){return!(ie instanceof Mavo.Collection)});return 2>se.length||!oe?se[0]:se[0]instanceof Mavo.Group?node[1]:void 0},children:function(ne){var oe=Mavo.Node.get(ne);return oe?[oe]:(oe=te(Mavo.selectors.property,ne).map(function(se){return Mavo.Node.get(se)}).filter(function(se){return!ne.contains(se.parentGroup.element)}).map(function(se){return se.collection||se}),Mavo.Functions.unique(oe))}}})})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Group=ee.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){var ie=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});te(Mavo.selectors.property,this.element).forEach(function(ue){var pe=Mavo.Node.getProperty(ue);if(ie.contains(ue)){var ce=ie.children[pe],ge=ie.template?ie.template.children[pe]:null,he={template:ge,group:ie};if(ce){var ve=ce;ce instanceof Mavo.Collection||(ve=new Mavo.Collection(ce.element,ie.mavo,he),ie.children[pe]=ce.collection=ve,ve.add(ce)),!ve.mutable&&Mavo.is("multiple",ue)&&(ve.mutable=!0),ve.add(ue)}else{var fe=Mavo.Node.create(ue,ie.mavo,he);ie.children[pe]=fe}}});var de=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=de.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(){var ne=this,oe=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"Node";return Object.keys(this.children).filter(function(se){return ne.children[se]instanceof Mavo[oe]})},getData:function(){var ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:this.super.getData.call(this,ne)};if(void 0!==oe.data)return oe.data;for(var se in oe.data=this.data?Mavo.clone(Mavo.subset(this.data,this.inPath)):{},this.children){var ie=this.children[se];if(ie.saved||oe.options.live){var le=ie.getData(ne);(null!==le||oe.options.live)&&(oe.data[ie.property]=le)}}oe.options.live||(oe.data=Mavo.subset(this.data,this.inPath,oe.data));var de=Object.keys(oe.data);return 1==de.length&&de[0]==this.property&&(oe.data=oe.data[this.property]),oe.options.live||(de.length||this.isRoot?oe.data&&"object"===_typeof(oe.data)&&(this.type&&this.type!=re.DEFAULT_TYPE&&(oe.data["@type"]=this.type),this.vocab&&(oe.data["@context"]=this.vocab)):oe.data=null),Mavo.hooks.run("node-getdata-end",oe),oe.data},find:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(this.property==ne)return this;if(ne in this.children)return this.children[ne].find(ne,oe);var se=[];for(var ie in this.children){var le=this.children[ie].find(ne,oe);if(le!==void 0)if(Array.isArray(le))se.push.apply(se,_toConsumableArray(le));else return le}if(se.length)return se},edit:function(){return!1!==this.super.edit.call(this)&&void this.propagate("edit")},save:function(){this.unsavedChanges=!1},propagated:["save","import","clear"],dataRender:function(ne){var oe=this;if(ne)if("object"!==("undefined"==typeof ne?"undefined":_typeof(ne))){var se=function(ce){return(ce==oe.property)+!oe.children[ce].expressionText+(oe.children[ce]instanceof Mavo.Primitive)},ie=Object.keys(this.children).sort(function(pe,ce){return se(pe)-se(ce)}).reverse()[0];ne=_defineProperty({},ie,ne),this.data=Mavo.subset(this.data,this.inPath,ne),this.propagate(function(pe){pe.render(ne[pe.property])})}else{this.propagate(function(pe){pe.render(ne[pe.property])});var le=Mavo.subset(this.oldData,this.inPath);for(var de in ne)if(!(de in this.children)){var ue=ne[de];"object"==("undefined"==typeof ue?"undefined":_typeof(ue))||le&&le[de]==ue||this.dataChanged("propertychange",{property:de})}}},contains:function(ne){return ne instanceof Mavo.Node?ne.parentGroup===this:ne.parentNode&&this.element===ne.parentNode.closest(Mavo.selectors.group)},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(ne){if(Mavo.is("group",ne)){var oe=Mavo.getAttribute(ne,"typeof","itemtype")||re.DEFAULT_TYPE;return ne.setAttribute("typeof",oe),oe}return null}}})})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Primitive=ee.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(ne){var ie=this;if(this.fromTemplate("config","attribute","templateValue")||(this.config=re.getConfig(ne),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&(this.expressionText.primitive=this,this.storage=this.storage||"none",this.modes="read"),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&ee.events(this.element,this.config.changeEvents,function(de){de.target===ie.element&&(ie.value=ie.getValue())}),!this.editor&&this.element.hasAttribute("mv-edit")){var le=ee(this.element.getAttribute("mv-edit"));le&&(this.editor=le.cloneNode(!0),!this.template&&new Mavo.Observer(le,"all",function(){var ge,ue=ie.copies.concat(ie),pe=!0,ce=!1;try{for(var ve,fe,he=ue[Symbol.iterator]();!(pe=(ve=he.next()).done);pe=!0)fe=ve.value,fe.editor=le.cloneNode(!0),fe.setValue(fe.value,{force:!0,silent:!0})}catch(ye){ce=!0,ge=ye}finally{try{!pe&&he.return&&he.return()}finally{if(ce)throw ge}}}))}this.editor||this.attribute||(this.editor=te(this.element.children).filter(function(de){return de.matches(Mavo.selectors.formControl)&&!de.matches(Mavo.selectors.property)})[0],this.editor&&(this.element.textContent=this.editorValue,ee.remove(this.editor))),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this._default="read"===this.modes?this.templateValue:this.editor?this.editorValue:void 0:""===this.default?this._default=this.templateValue:this.defaultObserver=new Mavo.Observer(this.element,"mv-default",function(){ie.default=ie.element.getAttribute("mv-default")}),this.initialValue=(this.template||void 0!==this.default?this.default:this.templateValue)||this.emptyValue,this.setValue(this.initialValue,{silent:!0}),this.observer=new Mavo.Observer(this.element,this.attribute,function(){(ie.attribute||!ie.editing)&&(ie.value=ie.getValue())}),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){if(this.config.getEditorValue)return this.config.getEditorValue.call(this);if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return re.getValue(this.editor,{datatype:this.datatype});var ae=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(ae)return re.getValue(ae)}},set editorValue(ae){if(this.config.setEditorValue)return this.config.setEditorValue.call(this,ae);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))re.setValue(this.editor,ae,{config:this.editorDefaults});else{var ne=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);ne&&re.setValue(ne,ae)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(){var ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:this.super.getData.call(this,ne)};return void 0===oe.data?(oe.data=this.value,""===oe.data&&(oe.data=null),!ne.live&&this.inPath.length&&(oe.data=Mavo.subset(this.data,this.inPath,oe.data)),Mavo.hooks.run("node-getdata-end",oe),oe.data):oe.data},sneak:function(ne){return Mavo.Observer.sneak(this.observer,ne)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){var ne=this;if(!this.editor){var oe=this.config.editor||Mavo.Elements.defaultEditors[this.datatype]||Mavo.Elements.defaultEditors.string;this.editor=ee.create("function"===ee.type(oe)?oe.call(this):oe),this.editorValue=this.value}ee.events(this.editor,{"input change":function(){ne.value=ne.editorValue},focus:function(){ne.editor.select&&ne.editor.select()},"mavo:datachange":function(le){"output"===le.property&&(le.stopPropagation(),ee.fire(ne.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var se=/^mv-edit-/i;te(this.element.attributes).forEach(function(ie){se.test(ie.name)&&this.editor.setAttribute(ie.name.replace(se,""),ie.value)},this),(this.attribute||this.config.popup)&&(this.popup=new Mavo.UI.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var ne=this;return!1!==this.super.edit.call(this)&&(this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0,this.element.addEventListener("click.mavo:edit",function(oe){return oe.preventDefault()}),this.preEdit=Mavo.defer(function(oe){if(ne.empty&&!ne.attribute)return requestAnimationFrame(oe);var ie,le="click focus dragover dragenter".split(" ").map(function(de){return de+".mavo:preedit"}).join(" ");ee.events(ne.element,le,oe),ne.attribute||ee.events(ne.element,{"mouseenter.mavo:preedit":function(){clearTimeout(ie),ie=setTimeout(oe,150)},"mouseleave.mavo:preedit":function(){clearTimeout(ie)}})}).then(function(){return ee.unbind(ne.element,".mavo:preedit")}),this.config.edit?void this.config.edit.call(this):void this.preEdit.then(function(){ne.initEdit&&ne.initEdit(),ne.popup&&ne.popup.show(),ne.attribute||ne.popup||ne.editor.parentNode==ne.element||(ne.editorValue=ne.value,ne.element.textContent="",ne.element.appendChild(ne.editor))}))},done:function(){var ne=this;return!1!==this.super.done.call(this)&&void("preEdit"in this&&ee.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return ne.config.done?void ne.config.done.call(ne):void(ne.popup?ne.popup.close():!ne.attribute&&ne.editor&&(ee.remove(ne.editor),ne.element.textContent=ne.editorValue))}),null===this.element._.data.prevTabindex?this.element.removeAttribute("tabindex"):this.element.tabIndex=this.element._.data.prevTabindex)},clear:function(){this.value=this.templateValue},dataRender:function(ne){if(ne&&"object"===("undefined"==typeof ne?"undefined":_typeof(ne)))if(Symbol.toPrimitive in ne)ne=ne[Symbol.toPrimitive]();else for(var ie,oe=[this.property,"value"].concat(_toConsumableArray(Object.keys(ne))),se=0;se<oe.length;se++)if(ie=oe[se],ie in ne){ne=ne[ie],this.inPath.push(ie);break}ne===void 0?"read"!=this.modes&&(this.value=this.closestCollection?this.default:this.templateValue):this.value=ne},find:function(ne){if(this.property==ne)return this},getValue:function(){return re.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&re.getConfig(this.editor)}},setValue:function(ne){var oe=this,se=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.sneak(function(){if("object"==ee.type(ne)&&"value"in ne){var ie=ne.presentational;ne=ne.value}return ne=ne||0===ne?ne:"",oe.datatype||"number"!=typeof ne&&"boolean"!=typeof ne||(oe.datatype="undefined"==typeof ne?"undefined":_typeof(ne)),ne=re.safeCast(ne,oe.datatype),ne!=oe._value||se.force?void(oe.editor&&document.activeElement!=oe.editor&&(oe.editorValue=ne),oe.config.humanReadable&&oe.attribute&&(ie=oe.config.humanReadable.call(oe,ne)),(!oe.editing||oe.popup||!oe.editor)&&(oe.config.setValue?oe.config.setValue.call(oe,oe.element,ne):(oe.editor&&oe.editor.matches("select")&&oe.editor.selectedOptions[0]&&(ie=oe.editor.selectedOptions[0].textContent),!se.dataOnly&&re.setValue(oe.element,{value:ne,presentational:ie},{config:oe.config,attribute:oe.attribute,datatype:oe.datatype}))),oe.empty=""===ne,oe._value=ne,!se.silent&&(oe.saved&&(oe.unsavedChanges=oe.mavo.unsavedChanges=!0),oe.dataChanged("propertychange",{value:ne}))):ne}),ne},dataChanged:function(){var ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"propertychange",oe=arguments[1];return this.super.dataChanged.call(this,ne,oe)},live:{default:function(ne){this.value==this._default&&(this.value=ne)},value:function(ne){return this.setValue(ne)},empty:function(ne){var oe=ne&&!this.modes&&this.config.default&&!(this.attribute&&ee(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!oe)}},static:{all:new WeakMap,getValueAttribute:function(ne){var oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mavo.Elements.search(ne),se=ne.getAttribute("mv-attribute")||oe.attribute;return se&&"null"!==se&&"none"!==se||(se=null),se},safeCast:function(ne,oe){var se="undefined"==typeof ne?"undefined":_typeof(ne),ie=re.cast(ne,oe);return null===ne||void 0===ne?ne:"boolean"==oe?"false"===ne||0===ne||""===ne?!1:"true"===ne||0<ne||ne:"number"==oe?/^[-+]?[0-9.e]+$/i.test(ne+"")?ie:ne:ie},cast:function(ne,oe){return"number"===oe?+ne:"boolean"===oe?!!ne:"string"===oe?ne+"":ne},getValue:function(ne){var oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},se=oe.config,ie=oe.attribute,le=oe.datatype;if(se||(se=re.getConfig(ne,ie)),ie=se.attribute,le=se.datatype,se.getValue&&ie==se.attribute)return se.getValue(ne);var de;return de=ie in ne&&re.useProperty(ne,ie)?ne[ie]:ie?ne.getAttribute(ie):ne.getAttribute("content")||ne.textContent||null,re.safeCast(de,le)},getConfig:function(ne,oe,se){void 0===oe&&(oe=ne.getAttribute("mv-attribute")||void 0),("null"==oe||"none"==oe)&&(oe=null),se=ne.getAttribute("datatype")||void 0;var ie=Mavo.Elements.search(ne,oe,se);return void 0===ie.attribute&&(ie.attribute=oe||null),void 0===ie.datatype&&(ie.datatype=se),ie},setValue:function(ne,oe){var se=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},ie=se.config,le=se.attribute,de=se.datatype;if("object"==ee.type(oe)&&"value"in oe){var ue=oe.presentational;oe=oe.value}if(1===ne.nodeType&&(ie||(ie=re.getConfig(ne,le)),le=ie.attribute,de=void 0===de?ie.datatype:de,ie.setValue&&le==ie.attribute))return ie.setValue(ne,oe);if(le){if(le in ne&&re.useProperty(ne,le)&&ne[le]!==oe)try{ne[le]=oe}catch(pe){}"boolean"==de?oe!=ne.hasAttribute(le)&&ee.toggleAttribute(ne,le,oe,oe):ne.getAttribute(le)!=oe&&(ne.setAttribute(le,oe),ue&&(ne.textContent=ue))}else"number"!==de||ue||(ue=re.formatNumber(oe)),ne.textContent=ue||oe,ue&&ne.setAttribute&&ne.setAttribute("content",oe)},useProperty:function(ne,oe){return!(-1<["href","src"].indexOf(oe))&&"http://www.w3.org/2000/svg"!=ne.namespaceURI},lazy:{formatNumber:function(){var ne=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(oe){return oe===Infinity||oe===-Infinity?0>oe?"-\u221E":"\u221E":ne.format(oe)}}}}})})(Bliss,Bliss.$),"use strict",function(ee){Mavo.UI.Popup=ee.Class({constructor:function(ne){var oe=this;this.primitive=ne,this.position=function(){var ie=oe.element.getBoundingClientRect(),le=ie.left,de=ie.bottom;if(oe.popup.offsetHeight){var ue=oe.popup.getBoundingClientRect();ue.height+de>innerHeight&&(de=innerHeight-ue.height-20)}ee.style(oe.popup,{top:de+"px",left:le+"px"})},this.popup=ee.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:function(ie){(13==ie.keyCode||27==ie.keyCode)&&(oe.popup.contains(document.activeElement)&&oe.element.focus(),ie.stopPropagation(),oe.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var ne=this;ee.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(oe){ne.popup.contains(oe.target)||ne.element.contains(oe.target)||ne.hide()},this.position(),document.body.appendChild(this.popup),requestAnimationFrame(function(){return ne.popup.removeAttribute("hidden")}),ee.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var ne=this;ee.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){ee.remove(ne.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),ee.events(this.element,{"click.mavo:showpopup":function(){ne.show()},"keyup.mavo:showpopup":function(se){-1<[13,113].indexOf(se.keyCode)&&(ne.show(),ne.editor.focus())}})},close:function(){this.hide(),ee.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})}(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};(function(ee){var re=Mavo.Elements={};Object.defineProperties(re,{register:{value:function(ne){if("object"===_typeof(arguments[0])){for(var se in arguments[0])re.register(se,arguments[0][se]);return}var ie=Mavo.toArray(arguments[1]),le=!0,de=!1,ue;try{for(var ce,pe=ie[Symbol.iterator]();!(le=(ce=pe.next()).done);le=!0){config=ce.value,config.attribute=Mavo.toArray(config.attribute||null);var ge=!0,he=!1,ve=void 0;try{for(var ye,fe=config.attribute[Symbol.iterator]();!(ge=(ye=fe.next()).done);ge=!0){attribute=ye.value;var be=ee.extend({},config);be.attribute=attribute,be.selector=be.selector||ne,be.id=ne,re[ne]=re[ne]||[],re[ne].push(be)}}catch(xe){he=!0,ve=xe}finally{try{!ge&&fe.return&&fe.return()}finally{if(he)throw ve}}}}catch(xe){de=!0,ue=xe}finally{try{!le&&pe.return&&pe.return()}finally{if(de)throw ue}}return re}},search:{value:function(ne,oe,se){var ie=re.matches(ne,oe,se);return ie[ie.length-1]||{attribute:oe}}},matches:{value:function(ne,oe,se){var ie=[];selectorloop:for(var le in re){var de=!0,ue=!1,pe=void 0;try{for(var ge,ce=re[le][Symbol.iterator]();!(de=(ge=ce.next()).done);de=!0){var he=ge.value,ve=oe===void 0&&he.default||oe===he.attribute;if(ve&&(void 0===se||"string"===se||se===he.datatype)){var fe=he.selector||le;ne.matches(fe)&&(!he.test||he.test(ne,oe,se))&&ie.push(he)}}}catch(ye){ue=!0,pe=ye}finally{try{!de&&ce.return&&ce.return()}finally{if(ue)throw pe}}}return ie}},isSVG:{value:function(ne){return"http://www.w3.org/2000/svg"==ne.namespaceURI}},defaultEditors:{value:{string:{tag:"input"},number:{tag:"input",type:"number"},boolean:{tag:"input",type:"checkbox"}}}}),re.register({"*":[{test:function(ne,oe){return"hidden"==oe},attribute:"hidden",datatype:"boolean"},{test:re.isSVG,attribute:"y",datatype:"number"},{default:!0,test:re.isSVG,attribute:"x",datatype:"number"}],media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var ne=this,oe=this.mavo.storage&&this.mavo.storage.upload?this.mavo.storage:this.uploadBackend,se=ee.create("input",{type:"url",placeholder:"http://example.com/image.png",className:"mv-output","aria-label":"URL to image"});if(oe&&self.FileReader){var ie,le=this.element.nodeName.toLowerCase();le="img"==le?"image":le;var de=this.element.getAttribute("mv-uploads")||le+"s",ue=function(ge){var he=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ge.name;ge&&0===ge.type.indexOf(le+"/")&&ne.mavo.upload(ge,de+"/"+he).then(function(ve){se.value=ve,ee.fire(se,"input")})},pe={paste:function(ge){var he=ge.clipboardData.items[0];if("file"==he.kind&&0===he.type.indexOf(le+"/")){var ve="pasted-"+le+"-"+Date.now()+"."+he.type.slice(6);ue(he.getAsFile(),ve),ge.preventDefault()}},"drag dragstart dragend dragover dragenter dragleave drop":function(ge){ge.preventDefault(),ge.stopPropagation()},"dragover dragenter":function(){ie.classList.add("mv-dragover"),ne.element.classList.add("mv-dragover")},"dragleave dragend drop":function(){ie.classList.remove("mv-dragover"),ne.element.classList.remove("mv-dragover")},drop:function(ge){ue(ge.dataTransfer.files[0])}};return ee.events(this.element,pe),ie=ee.create({className:"mv-upload-popup",contents:[se,{tag:"input",type:"file","aria-label":"Upload image",accept:le+"/*",events:{change:function(ge){var he=ge.target.files[0];he&&ue(he)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:pe})}return se}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},"select, input":{default:!0,attribute:"value",modes:"read",changeEvents:"input change"},textarea:{default:!0,modes:"read",changeEvents:"input",getValue:function(ne){return ne.value},setValue:function(ne,oe){return ne.value=oe}},"input[type=range], input[type=number]":{default:!0,attribute:"value",datatype:"number",modes:"read",changeEvents:"input change"},"input[type=checkbox]":{default:!0,attribute:"checked",datatype:"boolean",modes:"read",changeEvents:"click"},"input[type=radio]":{default:!0,attribute:"checked",modes:"read",getValue:function(ne){if(ne.form)return ne.form[ne.name].value;var oe=ee("input[type=radio][name=\""+ne.name+"\"]:checked");return oe&&oe.value},setValue:function(ne,oe){if(ne.form)return void(ne.form[ne.name].value=oe);var se=ee("input[type=radio][name=\""+ne.name+"\"][value=\""+oe+"\"]");ee.properties(se,{checked:!0})},init:function(ne){var oe=this;this.mavo.element.addEventListener("change",function(se){se.target.name==ne.name&&(oe.value=oe.getValue())})}},"button, .counter":{default:!0,attribute:"mv-clicked",datatype:"number",modes:"read",init:function(ne){var oe=this;"mv-clicked"===this.attribute&&(ne.setAttribute("mv-clicked","0"),ne.addEventListener("click",function(){var ie=+ne.getAttribute("mv-clicked")||0;oe.value=++ie}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var ne=this,oe=+this.element.getAttribute("min")||0,se=+this.element.getAttribute("max")||1,ie=se-oe,le=+this.element.getAttribute("mv-edit-step")||(1<ie?1:ie/100);this.element.addEventListener("mousemove.mavo:edit",function(de){var ue=ne.element.getBoundingClientRect().left,pe=Math.max(0,(de.clientX-ue)/ne.element.offsetWidth),ce=oe+ie*pe,ge=ce%le;ce+=ge>le/2?le-ge:-ge,ce=Math.max(oe,Math.min(ce,se)),ne.sneak(function(){return ne.element.setAttribute("value",ce)})}),this.element.addEventListener("mouseleave.mavo:edit",function(){ne.sneak(function(){return ne.element.setAttribute("value",ne.value)})}),this.element.addEventListener("click.mavo:edit",function(){ne.value=ne.getValue()}),this.element.addEventListener("keydown.mavo:edit",function(de){if(de.target==ne.element&&(37==de.keyCode||39==de.keyCode)){var ue=le*(39==de.keyCode?1:-1)*(de.shiftKey?10:1),pe=ne.value+ue;pe=Math.max(oe,Math.min(pe,se)),ne.element.setAttribute("value",pe)}})},done:function(){ee.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address",editor:function(){var ne=getComputedStyle(this.element).display,oe=0===ne.indexOf("inline")?"input":"textarea",ae=ee.create(oe);if("textarea"==oe){var se=this.element.offsetWidth;se&&(ae.width=se)}return ae},setEditorValue:function(ne){this.datatype&&"string"!=this.datatype&&(ne+="");var oe=getComputedStyle(this.element);return ne=ne||"",-1<["normal","nowrap"].indexOf(oe.whiteSpace)&&(ne=ne.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(oe.whiteSpace)&&(ne=ne.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=ne,!0}},time:{attribute:"datetime",default:!0,editor:function(){var ne={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},oe=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var se in ne)if(ne[se].test(oe))break;return{tag:"input",type:se}},humanReadable:function(ne){var oe=new Date(ne);if(!ne||isNaN(oe))return"(No "+this.label+")";var se={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},ie=se[this.editor&&this.editor.type]||se.date;return ie.timeZone="UTC",oe.toLocaleString("en-GB",ie)}},circle:[{default:!0,attribute:"r",datatype:"number"},{attribute:["cx","cy"],datatype:"number"}],text:{default:!0,popup:!0},"[role=checkbox]":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){var ne=this;this.element.addEventListener("click.mavo:edit",function(oe){ne.value=!ne.value,oe.preventDefault()})},done:function(){ee.unbind(this.element,".mavo:edit")}}})})(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var re=Mavo.Collection=ee.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){if(this.templateElement=this.element,this.children=[],this.fromTemplate("properties","mutable","templateElement","accepts")||(this.properties=te(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0)),this.mutable){var ie=this.createItem(this.element);this.add(ie),this.itemTemplate=ie.template||ie}this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var le,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:[]},se=!0,ie=!1;try{for(var ue,de=this.children[Symbol.iterator]();!(se=(ue=de.next()).done);se=!0)if(item=ue.value,!item.deleted||oe.options.live){var pe=item.getData(oe.options);(pe||oe.options.live)&&oe.data.push(pe)}}catch(ge){ie=!0,le=ge}finally{try{!se&&de.return&&de.return()}finally{if(ie)throw le}}if(!this.mutable)if(oe.data=oe.data.filter(function(ge){return null!==ge}),oe.options.live&&1===oe.data.length)oe.data=oe.data[0];else if(this.data&&!oe.options.live){var ce=Mavo.subset(this.data,this.inPath);oe.data=oe.data.concat(ce.slice(oe.data.length))}return Mavo.hooks.run("node-getdata-end",oe),oe.data},createItem:function(ne){ne||(ne=this.templateElement.cloneNode(!0));var oe=Mavo.Node.create(ne,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return oe},add:function(ne,oe){var se=this,ie=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(ne=ne instanceof Node?Mavo.Node.get(ne)||this.createItem(ne):ne||this.createItem(),ne.collection!=this&&this.adopt(ne),this.mutable){var le=this.children[oe]?this.children[oe].element:this.marker;ee[this.bottomUp?"after":"before"](ne.element,le),void 0===oe&&(oe=this.bottomUp?0:this.length)}else oe=this.length;var de={context:this,item:ne};return de.previousIndex=ne.index,de.changed=this.splice({remove:de.item},{index:oe,add:de.item}),requestAnimationFrame(function(){ie.silent||(de.changed.forEach(function(ue){ue.dataChanged(ue==de.item&&void 0===de.previousIndex?"add":"move"),ue.unsavedChanges=!0}),se.unsavedChanges=se.mavo.unsavedChanges=!0),se.mavo.expressions.update(de.item.element)}),Mavo.hooks.run("collection-add-end",de),de.item},splice:function(){for(var ne=arguments.length,oe=Array(ne),se=0;se<ne;se++)oe[se]=arguments[se];var ie=!0,le=!1,de;try{for(var pe,ce,ue=oe[Symbol.iterator]();!(ie=(pe=ue.next()).done);ie=!0)ce=pe.value,void 0===ce.index&&ce.remove&&isNaN(ce.remove)&&(ce.index=this.children.indexOf(ce.remove),ce.remove=1)}catch(Ae){le=!0,de=Ae}finally{try{!ie&&ue.return&&ue.return()}finally{if(le)throw de}}oe.sort(function(Ae,Pe){return Pe.index-Ae.index});var ge=!0,he=!1,ve;try{for(var ye,be,fe=oe[Symbol.iterator]();!(ge=(ye=fe.next()).done);ge=!0)if(be=ye.value,-1<be.index&&(be.remove||be.add)){var xe;be.remove=be.remove||0,be.add=Mavo.toArray(be.add),(xe=this.children).splice.apply(xe,[be.index,+be.remove].concat(_toConsumableArray(be.add)))}}catch(Ae){he=!0,ve=Ae}finally{try{!ge&&fe.return&&fe.return()}finally{if(he)throw ve}}for(var Ee,ke=[],Ce=0;Ce<this.length;Ce++)Ee=this.children[Ce],Ee&&Ee.index!==Ce&&(Ee.index=Ce,ke.push(Ee));return ke},adopt:function(ne){var oe=this;ne.collection&&(ne.collection.splice({remove:ne}),ne.collection.dataChanged("delete")),this.walk(function(se){se.closestCollection===ne.collection&&(se.closestCollection=oe),ne.mavo!=oe.mavo&&(ne.mavo=oe.mavo)}),ne.collection=this,ne.template&&(Mavo.delete(ne.template.copies,ne),ne.template=this.itemTemplate)},delete:function(ne,oe){var se=this;return oe?(ee.remove(ne.element),this.splice({remove:ne}),void ne.destroy()):ee.transition(ne.element,{opacity:0}).then(function(){ne.deleted=!0,ne.element.style.opacity="",ne.dataChanged("delete"),se.unsavedChanges=ne.unsavedChanges=se.mavo.unsavedChanges=!0})},move:function(ne,oe){index=ne.index+oe+(0<oe),0>index?index=this.children.length:index>this.children.length&&(index=0),this.add(ne,index)},editItem:function(ne){ne.itemControls||(ne.itemControls=new Mavo.UI.Itembar(ne)),ne.itemControls.add(),ne.edit()},edit:function(){var ne=this;if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var oe=this.element.tagName.toLowerCase(),se=Mavo.selectors.container[oe],ie=se?this.marker.parentNode.closest(se):this.marker;ee[this.bottomUp?"before":"after"](this.addButton,ie)}this.propagate(function(le){ne.editItem(le)}),re.dragula.then(function(){ne.getDragula()})}},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(function(ne){ne.itemControls&&ne.itemControls.remove()})))},clear:function(){if(this.mutable){for(var oe,ne=1;oe=this.children[ne];ne++)oe.element.remove(),oe.destroy();this.children=this.children.slice(0,1),this.dataChanged("clear")}this.propagate("clear")},dataChanged:function(ne){var oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return oe.element=oe.element||this.marker,this.super.dataChanged.call(this,ne,oe)},save:function(){var ne=!0,oe=!1,se;try{for(var le,de,ie=this.children[Symbol.iterator]();!(ne=(le=ie.next()).done);ne=!0)de=le.value,de.deleted?this.delete(de,!0):de.unsavedChanges=!1}catch(ue){oe=!0,se=ue}finally{try{!ne&&ie.return&&ie.return()}finally{if(oe)throw se}}},propagated:["save"],dataRender:function(ne){if(ne)if(ne=Mavo.toArray(ne),!this.mutable)this.children.forEach(function(ue,pe){return ue.render(ne&&ne[pe])});else{for(var oe=0;oe<this.children.length;oe++)oe<ne.length?this.children[oe].render(ne[oe]):(this.children[oe].dataChanged("delete"),this.delete(this.children[oe],!0));if(ne.length>oe){for(var le,se=document.createDocumentFragment(),ie=oe;ie<ne.length;ie++){le=this.createItem(),le.render(ne[ie]),this.children.push(le),le.index=ie,se.appendChild(le.element);var de={context:this,item:le};Mavo.hooks.run("collection-add-end",de),le.dataChanged("add")}this.bottomUp?ee.after(se,0<oe?this.children[oe-1].element:this.marker):ee.before(se,this.marker)}}},find:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},se=this.children.filter(function(le){return!le.deleted});if(this.property==ne)return oe.collections?this:se;if(-1<this.properties.indexOf(ne)){var ie=se.map(function(le){return le.find(ne,oe)});return Mavo.flatten(ie)}},isCompatible:function(ne){return ne&&this.itemTemplate.nodeType==ne.itemTemplate.nodeType&&(ne===this||ne.template==this||this.template==ne||this.template&&this.template==ne.template||-1<this.accepts.indexOf(ne.property))},live:{mutable:function(ne){ne&&ne!==this.mutable&&(this._mutable=ne,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),ee.after(this.marker,this.templateElement))}},getDragula:function(){var ne=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(ie){return!!ne.accepts.length&&-1<Mavo.flatten(ne.accepts.map(function(le){return ne.mavo.root.find(le,{collections:!0})})).filter(function(le){return le&&le instanceof re}).map(function(le){return le.marker.parentNode}).indexOf(ie)},moves:function(ie,le,de){return de.classList.contains("mv-drag-handle")&&de.closest(Mavo.selectors.multiple)==ie},accepts:function(ie,le,de,ue){if(ie.contains(le))return!1;var pe=ue?ue.previousElementSibling:le.lastElementChild,ce=re.get(pe)||re.get(ue);if(!ce)return!1;var ge=Mavo.Node.get(ie);return ge&&ge.collection.isCompatible(ce)}}),this.dragula.on("drop",function(se){var de=Mavo.Node.get(se),ue=de&&de.index,pe=se.nextElementSibling,ce=se.previousElementSibling,ge=re.get(ce)||re.get(pe),he=Mavo.Node.get(ce)||Mavo.Node.get(pe);if(he&&he.collection!=ge&&(he=null),de.collection.isCompatible(ge)){var ve=he?he.index+(he.element===ce):ge.length;ge.add(de,ve)}else return ne.dragula.cancel(!0)}),re.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var ne=this.templateElement.getAttribute("mv-order");return null===ne?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(ne)},closestCollection:function(){var ne=this.marker?this.marker.parentNode:this.templateElement.parentNode;return ne.closest(Mavo.selectors.multiple)},addButton:function(){var ne=this,oe="button.mv-add-"+this.property,se=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(se)var ie=te(oe,se).filter(function(le){return!ne.templateElement.contains(le)})[0];return ie||(ie=ee.create("button",{className:"mv-add",textContent:"Add "+this.name})),ie.classList.add("mv-ui","mv-add"),Mavo.data(ie,"collection",this),this.property&&ie.classList.add("mv-add-"+this.property),ie.addEventListener("click",function(le){le.preventDefault(),ne.editItem(ne.add())}),ie}},static:{dragulas:[],get:function(ne){var oe=Mavo.data(ne,"collection");if(oe)return oe;var se=Mavo.Node.get(ne);return se&&se.collection||null},lazy:{dragula:function(){return ee.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}})})(Bliss,Bliss.$),"use strict",function(ee,te){Mavo.UI.Itembar=ee.Class({constructor:function(ne){var oe=this;this.item=ne,this.element=te(".mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel=\""+this.item.property+"\"]",this.item.element).filter(function(se){return se.closest(Mavo.selectors.multiple)==oe.item.element&&!Mavo.data(se,"item")})[0],this.element=this.element||ee.create({className:"mv-item-bar mv-ui"}),Mavo.data(this.element,"item",this.item),ee.set(this.element,{"mv-rel":this.item.property,contents:[{tag:"button",title:"Delete this "+this.item.name,className:"mv-delete",events:{click:function(){return oe.item.collection.delete(ne)}}},{tag:"button",title:"Add new "+this.item.name.replace(/s$/i,"")+" "+(this.collection.bottomUp?"after":"before"),className:"mv-add",events:{click:function(ie){var le=oe.collection.add(null,oe.item.index);return ie[Mavo.superKey]&&le.render(oe.item.data),Mavo.scrollIntoViewIfNeeded(le.element),oe.collection.editItem(le)}}},{tag:"button",title:"Drag to reorder "+this.item.name,className:"mv-drag-handle",events:{click:function(ie){return ie.target.focus()},keydown:function(ie){37<=ie.keyCode&&40>=ie.keyCode&&(oe.move(oe.item,38>=ie.keyCode?-1:1),ie.stopPropagation(),ie.preventDefault(),ie.target.focus())}}}],events:{mouseenter:function(){oe.item.element.classList.add("mv-highlight")},mouseleave:function(){oe.item.element.classList.remove("mv-highlight")}}})},add:function(){this.element.parentNode||Mavo.revocably.add(this.element)||(this.item instanceof Mavo.Primitive&&!this.item.attribute?(this.element.classList.add("mv-adjacent"),ee.after(this.element,this.item.element)):this.item.element.appendChild(this.element))},remove:function(){Mavo.revocably.remove(this.element)},proxy:{collection:"item",mavo:"item"}})}(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee){Mavo.attributes.push("mv-expressions");var te=Mavo.Expression=ee.Class({constructor:function(ae){this.expression=ae},eval:function(ae){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this.function||(this.function=te.compile(this.expression),this.identifiers=this.expression.match(/[$a-z][$\w]*/ig)||[]),this.value=this.function(ae)}catch(ne){console.info("%cExpression error!","color: red; font-weight: bold",ne.message+" in expression "+this.expression),Mavo.hooks.run("expression-eval-error",{context:this,exception:ne}),this.value=ne}return this.value},toString:function(){return this.expression},changedBy:function(ae){if(!ae)return!0;if(!this.identifiers)return!1;if(-1<this.identifiers.indexOf(ae.property))return!0;if(Mavo.hasIntersection(ae.properties,this.identifiers))return!0;if("propertychange"!=ae.action){if(Mavo.hasIntersection(["$index","$all","$previous","$next"],this.identifiers))return!0;var ne=ae.node.collection||ae.node;if(Mavo.hasIntersection(ne.properties,this.identifiers))return!0}return!1},live:{expression:function(ae){ae=ae;this.function=null}},static:{serializers:{BinaryExpression:function(ae){return te.serialize(ae.left)+" "+ae.operator+" "+te.serialize(ae.right)},UnaryExpression:function(ae){return""+ae.operator+te.serialize(ae.argument)},CallExpression:function(ae){return te.serialize(ae.callee)+"("+ae.arguments.map(te.serialize).join(", ")+")"},ConditionalExpression:function(ae){return te.serialize(ae.test)+"? "+te.serialize(ae.consequent)+" : "+te.serialize(ae.alternate)},MemberExpression:function(ae){return"get("+te.serialize(ae.object)+", \""+(ae.property.name||ae.property.value)+"\")"},ArrayExpression:function(ae){return"["+ae.elements.map(te.serialize).join(", ")+"]"},Literal:function(ae){return ae.raw},Identifier:function(ae){return ae.name},ThisExpression:function(){return"this"},Compound:function(ae){return ae.body.map(te.serialize).join(" ")}},transformations:{BinaryExpression:function(ae){var ne=Mavo.Script.getOperatorName(ae.operator),oe=Mavo.Script.operators[ne],se=ae,ie=[];do ie.unshift(se.right),se=se.left;while(Mavo.Script.getOperatorName(se.operator)===ne);if(ie.unshift(se),1<ie.length)return ne+"("+ie.map(te.serialize).join(", ")+")"},CallExpression:function(ae){"Identifier"==ae.callee.type&&"if"==ae.callee.name&&(ae.callee.name="iff")}},serialize:function(ae){if(te.transformations[ae.type]){var ne=te.transformations[ae.type](ae);if(ne!==void 0)return ne}return te.serializers[ae.type](ae)},rewrite:function(ae){try{return te.serialize(te.parse(ae))}catch(ne){return ae}},compile:function(ae){return ae=te.rewrite(ae),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\t\twith (data || {}) {\n\t\t\t\t\t\treturn "+ae+";\n\t\t\t\t\t}")},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.addBinaryOp("mod",10),jsep.removeBinaryOp("===")),te.serializers.LogicalExpression=te.serializers.BinaryExpression,te.transformations.LogicalExpression=te.transformations.BinaryExpression,te.Syntax=ee.Class({constructor:function(ae,ne){this.start=ae,this.end=ne,this.regex=RegExp(Mavo.escapeRegExp(ae)+"([\\S\\s]+?)"+Mavo.escapeRegExp(ne),"gi")},test:function(ae){return this.regex.lastIndex=0,this.regex.test(ae)},tokenize:function(ae){var ne,oe=[],se=0;for(this.regex.lastIndex=0;null!==(ne=this.regex.exec(ae));)ne.index>se&&oe.push(ae.substring(se,ne.index)),se=this.regex.lastIndex,oe.push(new Mavo.Expression(ne[1]));return se<ae.length&&oe.push(ae.substring(se)),oe},static:{create:function(ae){if(ae){var ne=ae.getAttribute("mv-expressions");if(ne)return ne=ne.trim(),/\s/.test(ne)?new(Function.prototype.bind.apply(te.Syntax,[null].concat(_toConsumableArray(ne.split(/\s+/))))):te.Syntax.ESCAPE}},ESCAPE:-1}}),te.Syntax.default=new te.Syntax("[","]")})(Bliss),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee){var te=Mavo.DOMExpression=ee.Class({constructor:function(){var ae=this,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.mavo=ne.mavo,this.template=ne.template&&ne.template.template||ne.template;for(var ie,oe=["item","path","syntax","fallback","attribute"],se=0;se<oe.length;se++)ie=oe[se],this[ie]=void 0===ne[ie]&&this.template?this.template[ie]:ne[ie];if(this.node=ne.node,this.node||(this.node=this.path.reduce(function(de,ue){return de.childNodes[ue]},this.item.element)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),!this.expression){if(3===this.node.nodeType&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var le=this.node.firstChild.textContent.match(/^\s*|\s*$/g);le[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-le[1].length),ee.after(this.node.lastChild,this.node)),le[0]&&(this.node.firstChild.splitText(le[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=ne.template?ne.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(de){return de instanceof Mavo.Expression?de.expression:de}),this.mavo.treeBuilt.then(function(){ae.template||(ae.item=Mavo.Node.get(ae.element.closest(Mavo.selectors.multiple+", "+Mavo.selectors.group)),ae.item.expressions=[].concat(_toConsumableArray(ae.item.expressions||[]),[ae])),Mavo.hooks.run("domexpression-init-treebuilt",ae)}),Mavo.hooks.run("domexpression-init-end",this),te.elements.set(this.element,[].concat(_toConsumableArray(te.elements.get(this.element)||[]),[this]))},changedBy:function(ae){return!this.parsed.every(function(ne){return!(ne instanceof Mavo.Expression)||!ne.changedBy(ae)})},update:function(){var ae=this,ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data,oe=arguments[1],se={context:this,ret:{},event:oe},ie=se;this.data=ne,se.ret={},Mavo.hooks.run("domexpression-update-start",se),this.oldValue=this.value,se.ret.value=this.value=this.parsed.map(function(le,de){if(le instanceof Mavo.Expression){if(le.changedBy(ie.event)){var ue={context:ae,expr:le,parentEnv:ie};return Mavo.hooks.run("domexpression-update-beforeeval",ue),ue.value=ue.expr.eval(ne),Mavo.hooks.run("domexpression-update-aftereval",ue),ue.value instanceof Error?void 0===ae.fallback?ue.expr.expression:ae.fallback:void 0===ue.value||null===ue.value?"":ue.value}return ae.oldValue[de]}return le}),this.attribute||(se.ret.presentational=this.value.map(function(le){return Array.isArray(le)?le.join(", "):"number"==typeof le?Mavo.Primitive.formatNumber(le):le}),se.ret.presentational=1===se.ret.presentational.length?se.ret.presentational[0]:se.ret.presentational.join("")),se.ret.value=1===se.ret.value.length?se.ret.value[0]:se.ret.value.join(""),this.primitive&&1===this.parsed.length&&("number"==typeof se.ret.value?this.primitive.datatype="number":"boolean"==typeof se.ret.value&&(this.primitive.datatype="boolean")),se.ret.presentational===se.ret.value&&(ret=se.ret.value),this.output(se.ret),Mavo.hooks.run("domexpression-update-end",se)},output:function(ae){this.primitive?this.primitive.value=ae:(ae=ae.presentational||ae,Mavo.Primitive.setValue(this.node,ae,{attribute:this.attribute}))},static:{elements:new WeakMap,search:function(ae,ne){var oe=te.elements.get(ae)||[];return 1<arguments.length?oe.length?oe.filter(function(se){return se.attribute===ne})[0]||null:null:oe}}})})(Bliss),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Expressions=ee.Class({constructor:function(ne){var oe=this;this.mavo=ne,this.active=!0,this.expressions=[];var se=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,se),this.scheduled=new Set,this.mavo.treeBuilt.then(function(){oe.expressions=[],document.documentElement.addEventListener("mavo:datachange",function(ie){oe.active&&("propertychange"==ie.action&&ie.node.closestCollection?!oe.scheduled.has(ie.property)&&(setTimeout(function(){oe.scheduled.delete(ie.property),oe.update(ie)},re.PROPERTYCHANGE_THROTTLE),oe.scheduled.add(ie.property)):requestAnimationFrame(function(){return oe.update(ie)}))}),oe.update()})},update:function(ne){var oe=this,se,ie;ne instanceof Element&&(se=ne.closest(Mavo.selectors.group),ne=null),se=se||this.mavo.element,ie=Mavo.Node.get(se);var le=ie.getData({live:!0});ie.walk(function(de,ue){if(de.expressions&&de.expressions.length&&!de.isDeleted()){var pe={context:oe,data:ee.value.apply(ee,[le].concat(_toConsumableArray(ue)))};Mavo.hooks.run("expressions-update-start",pe);var ce=!0,ge=!1,he;try{for(var fe,ye,ve=de.expressions[Symbol.iterator]();!(ce=(fe=ve.next()).done);ce=!0)ye=fe.value,ye.changedBy(ne)&&ye.update(pe.data,ne)}catch(be){ge=!0,he=be}finally{try{!ce&&ve.return&&ve.return()}finally{if(ge)throw he}}}})},extract:function(ne,oe,se,ie){oe&&"mv-expressions"==oe.name||(oe&&-1<re.directives.indexOf(oe.name)||ie.test(oe?oe.value:ne.textContent))&&this.expressions.push(new Mavo.DOMExpression({node:ne,syntax:ie,path:se?se.slice(1).split("/").map(function(le){return+le}):[],attribute:oe&&oe.name,mavo:this.mavo}))},traverse:function(ne){var oe=this,se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",ie=arguments[2];if(8!==ne.nodeType)if(3===ne.nodeType)this.extract(ne,null,se,ie);else{if(ne.normalize(),ie=Mavo.Expression.Syntax.create(ne)||ie,ie===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("multiple",ne)&&(se=""),te(ne.attributes).forEach(function(le){return oe.extract(ne,le,se,ie)}),te(ne.childNodes).forEach(function(le,de){return oe.traverse(le,se+"/"+de,ie)})}},static:{directives:[],PROPERTYCHANGE_THROTTLE:50,directive:function(ne,oe){re.directives.push(ne),Mavo.attributes.push(ne),oe.name=ne,Mavo.Plugins.register(oe)}}});self.Proxy&&Mavo.hooks.add("node-getdata-end",function(ae){var ne=this;if(ae.options.live&&ae.data&&("object"===_typeof(ae.data)||this.collection)){var oe=ae.data;if("object"!==_typeof(ae.data)){var se;ae.data=(se={},_defineProperty(se,Symbol.toPrimitive,function(){return oe}),_defineProperty(se,this.property,oe),se)}ae.data=new Proxy(ae.data,{get:function(le,de,ue){if(de in le||de in ue&&de in le)return le[de]},has:function(le,de){if(de in le)return!0;switch(de){case"$index":return le[de]=ne.index||0,!0;case"$all":return le[de]=ne.closestCollection?ne.closestCollection.getData(ae.options):[ae.data];case"$next":case"$previous":return ne.closestCollection?le[de]=ne.closestCollection.getData(ae.options)[ne.index+("$next"==de?1:-1)]:(le[de]=null,null);case"$edit":return le[de]=ne.editing,!0;}if(ne instanceof Mavo.Group&&de==ne.property&&ne.collection)return le[de]=ae.data;var ue=ne.walkUp(function(pe){if(de in pe.children)return pe.children[de]});return void 0===ue&&(ue=ne.find(de)),void 0===ue?de in Mavo.all&&Mavo.all[de].root&&(le[de]=Mavo.all[de].root.getData(ae.options)):(Array.isArray(ue)?ue=ue.map(function(pe){return pe.getData(ae.options)}).filter(function(pe){return null!==pe}):ue instanceof Mavo.Node&&(ue=ue.getData(ae.options)),le[de]=ue,!0)},set:function(){throw Error("You can\u2019t set data via expressions.")}})}})})(Bliss,Bliss.$),"use strict",function(ee,te){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(ae){this._hidden!==ae&&(this._hidden=ae,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var ae=this;if("mv-if"==this.attribute){var ne=te(Mavo.selectors.property,this.element).filter(function(oe){return oe.closest("[mv-if]")==ae.element}).map(function(oe){return Mavo.Node.get(oe)});return this.element.addEventListener("mavo:datachange",function(oe){requestAnimationFrame(function(){ae.element.parentNode||ae.item.element.dispatchEvent(oe)})}),ne}}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){var ae=this;if("mv-if"==this.attribute){var ne=this.value[0],oe=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(ae.parentIf){var se=ae.parentIf.value[0];ae.value[0]=ne=ne&&se}if(ne!==oe){if(!1!==se&&(ne?Mavo.revocably.add(ae.element):ae.element.parentNode&&Mavo.revocably.remove(ae.element,"mv-if")),ae.childProperties){var de,ie=!0,le=!1;try{for(var pe,ce,ue=ae.childProperties[Symbol.iterator]();!(ie=(pe=ue.next()).done);ie=!0)ce=pe.value,ce.hidden=!ne}catch(xe){le=!0,de=xe}finally{try{!ie&&ue.return&&ue.return()}finally{if(le)throw de}}}if(ae.childIfs){var ve,ge=!0,he=!1;try{for(var ye,be,fe=ae.childIfs[Symbol.iterator]();!(ge=(ye=fe.next()).done);ge=!0)be=ye.value,be.update()}catch(xe){he=!0,ve=xe}finally{try{!ge&&fe.return&&fe.return()}finally{if(he)throw ve}}}}})}},"unit-isdatanull":function(ae){ae.result=ae.result||this.hidden&&ae.options.live}}})}(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}Mavo.Expressions.directive("mv-value",{hooks:{"node-init-start":function(){if(this instanceof Mavo.Group||this.collection){var te=Mavo.DOMExpression.search(this.element).filter(function(re){return"mv-value"==re.originalAttribute})[0];te&&(te.mavoNode=this,this.expressionText=te,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[].concat(_toConsumableArray(this.collection.expressions||[]),[te]),te.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}},"domexpression-init-start":function(){"mv-value"!=this.attribute||(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end)},"domexpression-init-treebuilt":function(){"mv-value"==this.originalAttribute&&this.mavoNode&&(this.mavoNode==this.item||this.mavoNode==this.item.collection)&&(this.mavoNode==this.item.collection&&Mavo.delete(this.item.expressions,this),this.output=function(te){te=te.value||te,this.mavoNode.render(te)},this.changedBy=function(){return!0})},"domexpression-update-start":function(){"mv-value"==this.originalAttribute&&this.mavoNode==this.item}}}),"use strict";var _slicedToArray=function(){function ee(te,re){var ae=[],ne=!0,oe=!1,se;try{for(var le,ie=te[Symbol.iterator]();!(ne=(le=ie.next()).done)&&(ae.push(le.value),!(re&&ae.length===re));ne=!0);}catch(de){oe=!0,se=de}finally{try{!ne&&ie["return"]&&ie["return"]()}finally{if(oe)throw se}}return ae}return function(te,re){if(Array.isArray(te))return te;if(Symbol.iterator in Object(te))return ee(te,re);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(){function ee(ue,pe){return ue=Array.isArray(ue)?ue:pe?$$(pe):[ue],ue.filter(function(ce){return!isNaN(ce)&&""!==ce}).map(function(ce){return+ce})}function te(ue){if(!ue)return null;if("string"===$.type(ue)){-1===ue.indexOf(":")?ue+="T00:00:00":ue=ue.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"),ue=ue.replace(/\s+/g,"");var pe=(ue.match(/[+-]\d{2}:?\d{2}|Z$/)||[])[0];if(!pe){var ce=ae.localTimezone,ge=Math.abs(ce%60),he=(Math.abs(ce)-ge)/60,ve=0>ce?"-":"+";ue+=ve+de(he)+":"+de(ge)}}return ue=new Date(ue),isNaN(ue)?null:ue}function re(ue){var pe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"numeric",ce=arguments[2],ge=document.documentElement.lang||"en-GB";return function(he){var ve,fe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:pe;if(he=te(he),!he)return"";var ye=$.extend((ve={},_defineProperty(ve,ue,fe),_defineProperty(ve,"hour12",!1),ve),ce);if("weekday"==ue&&"numeric"==fe)be=he.getDay()||7;else var be=he.toLocaleString(ge,ye);return"numeric"!=fe||isNaN(be)||(be=new Number(be),("month"==ue||"weekday"==ue)&&(ye[ue]="long",be.name=he.toLocaleString(ge,ye),ye[ue]="short",be.shortname=he.toLocaleString(ge,ye)),"weekday"!=ue&&(ye[ue]="2-digit",be.twodigit=he.toLocaleString(ge,ye))),be}}var ae=Mavo.Functions={operators:{"=":"eq"},get:function(pe,ce){if(pe&&void 0!==pe[ce])return pe[ce];if(Array.isArray(pe)&&isNaN(ce)&&"object"===_typeof(pe[0]))for(var ge=0;ge<pe.length;ge++)if(pe[ge]&&pe[ge].id==ce)return pe[ge];return null},unique:function(pe){return[].concat(_toConsumableArray(new Set(pe)))},sum:function(pe){return ee(pe,arguments).reduce(function(ce,ge){return+ce+(+ge||0)},0)},average:function(pe){return pe=ee(pe,arguments),pe.length&&ae.sum(pe)/pe.length},min:function(pe){return Math.min.apply(Math,_toConsumableArray(ee(pe,arguments)))},max:function(pe){return Math.max.apply(Math,_toConsumableArray(ee(pe,arguments)))},count:function(pe){return Mavo.toArray(pe).filter(function(ce){return null!==ce&&!1!==ce&&""!==ce}).length},round:function(pe,ce){return pe&&ce&&isFinite(pe)?+pe.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:ce}):Math.round(pe)},iff:function(pe,ce){var ge=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return Array.isArray(pe)?pe.map(function(he,ve){var fe=he?ce:ge;return Array.isArray(fe)?fe[Math.min(ve,fe.length-1)]:fe}):pe?ce:ge},replace:function(pe,ce){var ge=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",he=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(Array.isArray(pe))return pe.map(function(xe){return ae.replace(xe,ce,ge)});for(var ye,ve=RegExp(Mavo.escapeRegExp(ce),"g"),fe=pe,be=0;fe!=ye&&be++<he;)ye=fe,fe=fe.replace(ve,ge);return fe},len:function(pe){return(pe||"").length},search:function(pe,ce){return pe&&ce?(pe+"").toLowerCase().indexOf((ce+"").toLowerCase()):-1},starts:function(pe,ce){return 0===ae.search(pe+"",ce+"")},ends:function(pe,ce){pe+="",ce+="";var ge=ae.search(pe,ce);return-1<ge&&ge===pe.length-ce.length},join:function(pe){var ce=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return Mavo.toArray(pe).join(ce)},idify:function(pe){return((pe||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},readable:function(pe){return pe&&pe.replace(/([a-z])([A-Z])(?=[a-z])/g,function(ce,ge,he){return ge+" "+he.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(ce){return ce.toUpperCase()})},uppercase:function(pe){return(pe+"").toUpperCase()},lowercase:function(pe){return(pe+"").toLowerCase()},get $now(){return new Date},year:re("year"),month:re("month"),day:re("day"),weekday:re("weekday"),hour:re("hour"),hour12:re("hour","numeric",{hour12:!0}),minute:re("minute"),second:re("second"),date:function(pe){return ae.year(pe)+"-"+ae.month(pe).twodigit+"-"+ae.day(pe).twodigit},time:function(pe){return ae.hour(pe).twodigit+":"+ae.minute(pe).twodigit+":"+ae.second(pe).twodigit},minutes:function(pe){return Math.floor(Math.abs(pe)/60)},hours:function(pe){return Math.floor(Math.abs(pe)/3600)},days:function(pe){return Math.floor(Math.abs(pe)/86400)},weeks:function(pe){return Math.floor(Math.abs(pe)/604800)},months:function(pe){return Math.floor(Math.abs(pe)/(30.4368*86400))},years:function(pe){return Math.floor(Math.abs(pe)/(12*(30.4368*86400)))},localTimezone:-new Date().getTimezoneOffset(),log:function(){for(var pe=arguments.length,ce=Array(pe),ge=0;ge<pe;ge++)ce[ge]=arguments[ge];return console.log(ce),ce[0]}};for(var ne in $.lazy(Mavo.Functions,"$url",function(){var he,ue={},pe=new URL(location),ce=!0,ge=!1;try{for(var fe,ye,ve=pe.searchParams[Symbol.iterator]();!(ce=(fe=ve.next()).done);ce=!0)ye=fe.value,ue[ye[0]]=ye[1]}catch(be){ge=!0,he=be}finally{try{!ce&&ve.return&&ve.return()}finally{if(ge)throw he}}return Object.defineProperty(ue,"toString",{value:function(){return new URL(location)}}),ue}),Mavo.Script={addUnaryOperator:function(pe,ce){return function(ge){return Array.isArray(ge)?ge.map(ce.scalar):ce.scalar(ge)}},addBinaryOperator:function(pe,ce){if(ce.symbol){var ve,ge=!0,he=!1;try{for(var ye,be,fe=Mavo.toArray(ce.symbol)[Symbol.iterator]();!(ge=(ye=fe.next()).done);ge=!0)be=ye.value,Mavo.Script.symbols[be]=pe}catch(xe){he=!0,ve=xe}finally{try{!ge&&fe.return&&fe.return()}finally{if(he)throw ve}}}return ce.identity=void 0===ce.identity?0:ce.identity,ae[pe]=ce.code||function(){for(var xe=arguments.length,ke=Array(xe),Ce=0;Ce<xe;Ce++)ke[Ce]=arguments[Ce];1===ke.length&&Array.isArray(ke[0])&&(ke=[].concat(_toConsumableArray(ke[0])));for(var Ae,Ee=ce.logical?ce.identity:ke[0],Pe=function(Le){var Oe=ce.logical?ke[Le-1]:Ee,Te=ke[Le];Array.isArray(Te)?("number"==typeof ce.identity&&(Te=ee(Te)),Ae=Array.isArray(Oe)?[].concat(_toConsumableArray(Te.map(function(Se,Ie){return ce.scalar(void 0===Oe[Ie]?ce.identity:Oe[Ie],Se)})),_toConsumableArray(Oe.slice(Te.length))):Te.map(function(Se){return ce.scalar(Oe,Se)})):Array.isArray(Oe)?Ae=Oe.map(function(Se){return ce.scalar(Se,Te)}):Ae=ce.scalar(Oe,Te),Ee=ce.reduce?ce.reduce(Ee,Ae,Oe,Te):ce.logical?Ee&&Ae:Ae},Ne=1;Ne<ke.length;Ne++)Pe(Ne);return Ee}},symbols:{},getOperatorName:function(pe){return Mavo.Script.symbols[pe]||pe},operators:{not:{scalar:function(){return function(ce){return!ce}}},multiply:{scalar:function(pe,ce){return pe*ce},identity:1,symbol:"*"},divide:{scalar:function(pe,ce){return pe/ce},identity:1,symbol:"/"},add:{scalar:function(pe,ce){return+pe+ +ce},symbol:"+"},subtract:{scalar:function(pe,ce){if(isNaN(pe)||isNaN(ce)){var ge=te(pe),he=te(ce);if(ge&&he)return(ge-he)/1e3}return pe-ce},symbol:"-"},mod:{scalar:function(pe,ce){var ge=pe%ce;return ge+=0>ge?ce:0,ge}},lte:{logical:!0,scalar:function(pe,ce){var ge=Mavo.Script.getNumericalOperands(pe,ce),he=_slicedToArray(ge,2);return pe=he[0],ce=he[1],pe<=ce},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(pe,ce){var ge=Mavo.Script.getNumericalOperands(pe,ce),he=_slicedToArray(ge,2);return pe=he[0],ce=he[1],pe<ce},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(pe,ce){var ge=Mavo.Script.getNumericalOperands(pe,ce),he=_slicedToArray(ge,2);return pe=he[0],ce=he[1],pe>=ce},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(pe,ce){var ge=Mavo.Script.getNumericalOperands(pe,ce),he=_slicedToArray(ge,2);return pe=he[0],ce=he[1],pe>ce},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(pe,ce){return pe==ce},symbol:["=","=="],identity:!0},neq:{logical:!0,scalar:function(pe,ce){return pe!=ce},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(pe,ce){return!!pe&&!!ce},identity:!0,symbol:"&&"},or:{logical:!0,scalar:function(pe,ce){return!!pe||!!ce},reduce:function(pe,ce){return pe||ce},identity:!1,symbol:"||"},concatenate:{symbol:"&",identity:"",scalar:function(pe,ce){return""+(pe||"")+(ce||"")}},filter:{scalar:function(pe,ce){return ce?pe:null}}},getNumericalOperands:function(pe,ce){if(isNaN(pe)||isNaN(ce)){var ge=te(pe),he=te(ce);if(ge&&he)return[ge,he]}return[pe,ce]}},Mavo.Script.operators){var oe=Mavo.Script.operators[ne];2>oe.scalar.length?Mavo.Script.addUnaryOperator(ne,oe):Mavo.Script.addBinaryOperator(ne,oe)}var se={average:"avg",iff:"iff IF",subtract:"minus",multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"},ie=function(pe){se[pe].split(/\s+/g).forEach(function(ce){return ae[ce]=ae[pe]})};for(var le in se)ie(le);Mavo.Functions._Trap=self.Proxy?new Proxy(ae,{get:function(pe,ce){if(ce in pe)return pe[ce];var ge=ce.toLowerCase&&ce.toLowerCase();return ge&&pe.hasOwnProperty(ge)?pe[ge]:ce in Math||ge in Math?Math[ce]||Math[ge]:ce in self?self[ce]:ce},has:function(pe,ce){return"data"!=ce}}):Mavo.Functions;var de=new Intl.NumberFormat("en",{minimumIntegerDigits:"2"});de=de.format.bind(de)})(),"use strict",function(ee){var te=Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-dropbox-key")||"2mx6061p054bpbp",this.url=te.fixShareURL(this.url),this.login(!0)},upload:function(ae,ne){var oe=this;return ne=this.path.replace(/[^/]+$/,"")+ne,this.put(ae,ne).then(function(){return oe.getURL(ne)})},getURL:function(ae){return this.request("sharing/create_shared_link_with_settings",{path:ae},"POST").then(function(ne){return te.fixShareURL(ne.url)})},put:function(ae){var ne=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path,oe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return this.request("https://content.dropboxapi.com/2/files/upload",ae,"POST",{headers:{"Dropbox-API-Arg":JSON.stringify({path:ne,mode:"overwrite"}),"Content-Type":"application/octet-stream"}})},oAuthParams:function(){return"&redirect_uri="+encodeURIComponent("https://auth.mavo.io")+"&response_type=code"},getUser:function(){var ae=this;return this.user?Promise.resolve(this.user):this.request("users/get_current_account","null","POST").then(function(ne){ae.user={username:ne.email,name:ne.name.display_name,avatar:ne.profile_photo_url,info:ne}})},login:function(ae){var ne=this;return this.oAuthenticate(ae).then(function(){return ne.getUser()}).then(function(){ne.user&&(ne.permissions.logout=!0,ne.request("sharing/get_shared_link_metadata",{url:ne.source},"POST").then(function(se){ne.path=se.path_lower,ne.permissions.on(["edit","save"])}))})},logout:function(){return this.oAuthLogout()},static:{apiDomain:"https://api.dropboxapi.com/2/",oAuth:"https://www.dropbox.com/oauth2/authorize",test:function(ae){return ae=new URL(ae,Mavo.base),/dropbox.com/.test(ae.host)},fixShareURL:function(ae){return ae=new URL(ae,Mavo.base),ae.hostname="dl.dropboxusercontent.com",ae.search=ae.search.replace(/\bdl=0|^$/,"raw=1"),ae}}}))}(Bliss),"use strict",function(ee){var te=Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var ae=te.parseURL(this.url);ae.username?(ee.extend(this,ae),this.repo=this.repo||"mv-data",this.path=this.path||this.mavo.id+".json",this.apiCall="repos/"+this.username+"/"+this.repo+"/contents/"+this.path):this.apiCall=this.url.pathname.slice(1),this.login(!0)},get:function(){var ae=this;return this.request(this.apiCall).then(function(ne){return Promise.resolve(ae.repo?te.atob(ne.content):ne)})},upload:function(ae){var ne=this,oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path;return Mavo.readFile(ae).then(function(se){var ie=se.slice(5),le=ie.match(/^\w+\/[\w+]+/)[0];return ie=ie.replace(RegExp("^"+le+"(;base64)?,"),""),oe=ne.path.replace(/[^/]+$/,"")+oe,ne.put(ie,oe,{isEncoded:!0})}).then(function(se){return ne.getURL(oe,se.commit.sha)})},put:function(ae){var ne=this,oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.path,se=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(oe){var ie="repos/"+this.username+"/"+this.repo,le=ie+"/contents/"+oe,de=this.mavo.element.getAttribute("mv-github-commit-prefix"),ue=this.repoInfo||this.request("user/repos",{name:this.repo},"POST").then(function(pe){return ne.repoInfo=pe});return ae=se.isEncoded?ae:te.btoa(ae),Promise.resolve(ue).then(function(pe){return ne.canPush()?pe:ne.request(ie+"/forks",{name:ne.repo},"POST").then(function(ce){return le="repos/"+ce.full_name+"/contents/"+oe,ne.forkInfo=ce}).then(function(ce){var ge;return new Promise(function ve(fe){clearTimeout(ge),ne.request("repos/"+ce.full_name+"/commits",{until:"1970-01-01T00:00:00Z"},"HEAD").then(function(){fe(ce)}).catch(function(){ge=setTimeout(ve,1e3)})})})}).then(function(){return ne.request(le,{ref:ne.branch}).then(function(ce){return ne.request(le,{message:de+" Updated "+(ce.name||"file"),content:ae,branch:ne.branch,sha:ce.sha},"PUT")},function(ce){return 404==ce.status?ne.request(le,{message:de+"Created file",content:ae,branch:ne.branch},"PUT"):ce})}).then(function(pe){return ne.forkInfo&&ne.request("repos/"+ne.username+"/"+ne.repo+"/pulls",{head:ne.user.username+":"+ne.branch,base:ne.branch}).then(function(ce){ne.pullRequest(ce[0])}),pe})}},pullRequest:function(ae){var ne=this,oe=new URL(location);oe.searchParams.set(this.mavo.id+"-storage","https://github.com/"+this.forkInfo.full_name+"/"+this.path);var se="Your edits are saved to <a href=\""+oe+"\" target=\"_blank\">your own profile</a>, because you are not allowed to edit this page.";this.notice&&this.notice.close(),ae?(this.notice=this.mavo.message(se+"\n\t\t\t\tYou have selected to suggest your edits to the page admins. Your suggestions have not been reviewed yet.\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<button class=\"mv-danger\">Revoke edit suggestion</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(ie){ie&&ne.request("repos/"+ne.username+"/"+ne.repo+"/pulls/"+ae.number,{state:"closed"},"POST").then(function(le){new Mavo.UI.Message(ne.mavo,"<a href=\""+le.html_url+"\">Edit suggestion cancelled successfully!</a>",{dismiss:["button","timeout"]}),ne.pullRequest()})})):(this.notice=this.mavo.message(se+"\n\t\t\t\tWrite a short description of your edits below to suggest them to the page admins:\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<textarea name=\"edits\" class=\"mv-autosize\" placeholder=\"I added / corrected / deleted ...\"></textarea>\n\t\t\t\t\t<button>Send edit suggestion</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(ie){ie&&ne.request("repos/"+ne.username+"/"+ne.repo+"/pulls",{title:"Suggested edits to data",body:"Hello there! I used Mavo to suggest the following edits:\n"+ie.elements.edits.value+"\nPreview my changes here: "+oe,head:ne.user.username+":"+ne.branch,base:ne.branch},"POST").then(function(le){new Mavo.UI.Message(ne.mavo,"<a href=\""+le.html_url+"\">Edit suggestion sent successfully!</a>",{dismiss:["button","timeout"]}),ne.pullRequest(le)})}))},login:function(ae){var ne=this;return this.oAuthenticate(ae).then(function(){return ne.getUser()}).catch(function(oe){401==oe.status&&ne.logout()}).then(function(){if(ne.user&&(ne.permissions.on(["edit","save","logout"]),ne.repo))return ne.request("repos/"+ne.username+"/"+ne.repo).then(function(se){return void 0===ne.branch&&(ne.branch=se.default_branch),ne.repoInfo=se})})},canPush:function(){return this.repoInfo?this.repoInfo.permissions.push:this.user&&this.user.username.toLowerCase()==this.username.toLowerCase()},oAuthParams:function(){return"&scope=repo,gist"},logout:function(){var ae=this;return this.oAuthLogout().then(function(){ae.user=null})},getUser:function(){var ae=this;return this.user?Promise.resolve(this.user):this.request("user").then(function(ne){ae.user={username:ne.login,name:ne.name||ne.login,avatar:ne.avatar_url,url:"https://github.com/"+ne.login,info:ne},ee.fire(ae.mavo.element,"mavo:login",{backend:ae})})},getURL:function(){var ae=this,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.path,oe=arguments[1],se=this.username+"/"+this.repo;return ne=ne.replace(/ /g,"%20"),this.request("repos/"+se+"/pages",{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}).then(function(ie){return ie.html_url+ne}).catch(function(){return oe?"https://cdn.rawgit.com/"+se+"/"+oe+"/"+ne:"https://rawgit.com/"+se+"/"+ae.branch+"/"+ne})},static:{apiDomain:"https://api.github.com/",oAuth:"https://github.com/login/oauth/authorize",test:function(ae){return ae=new URL(ae,Mavo.base),/\bgithub.com|raw.githubusercontent.com/.test(ae.host)},parseURL:function(ae){var ne={};ae=new URL(ae,Mavo.base);var oe=ae.pathname.slice(1).split("/");if(ne.username=oe.shift(),ne.repo=oe.shift(),/raw.githubusercontent.com$/.test(ae.host))ne.branch=oe.shift();else{if(/api.github.com$/.test(ae.host))return{};/github.com$/.test(ae.host)&&"blob"==oe[0]&&(oe.shift(),ne.branch=oe.shift())}return ne.path=oe.join("/"),ne},btoa:function(re){function ae(){return re.apply(this,arguments)}return ae.toString=function(){return re.toString()},ae}(function(re){return btoa(unescape(encodeURIComponent(re)))}),atob:function(ae){return decodeURIComponent(escape(window.atob(ae)))}}}))}(Bliss);
//# sourceMappingURL=maps/mavo.es5.min.js.map
