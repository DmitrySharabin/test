!function(){"use strict";function ee(ie,se,le){return se=void 0===se?1:se,le=le||se+1,1>=le-se?function(){if(arguments.length<=se||"string"===ae.type(arguments[se]))return ie.apply(this,arguments);var de,ue=arguments[se];for(var pe in ue){var ce=Array.from(arguments);ce.splice(se,1,pe,ue[pe]),de=ie.apply(this,ce)}return de}:ee(ee(ie,se+1,le),se,le-1)}function te(ie,se,le){var de=re(le);if("string"===de){var ue=Object.getOwnPropertyDescriptor(se,le);!ue||ue.writable&&ue.configurable&&ue.enumerable&&!ue.get&&!ue.set?ie[le]=se[le]:(delete ie[le],Object.defineProperty(ie,le,ue))}else if("array"===de)le.forEach(function(ce){ce in se&&te(ie,se,ce)});else for(var pe in se)(!le||("regexp"!==de||le.test(pe))&&("function"!==de||le.call(se,pe)))&&te(ie,se,pe);return ie}function re(ie){if(null===ie)return"null";if(void 0===ie)return"undefined";var se=(Object.prototype.toString.call(ie).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==se&&isNaN(ie)?"nan":se}var ae=self.Bliss=te(function(ie,se){return(2!=arguments.length||se)&&ie?"string"===ae.type(ie)?(se||document).querySelector(ie):ie||null:null},self.Bliss);te(ae,{extend:te,overload:ee,type:re,property:ae.property||"_",sources:{},noop:function(){},$:function(ie,se){return ie instanceof Node||ie instanceof Window?[ie]:2!=arguments.length||se?Array.from("string"==typeof ie?(se||document).querySelectorAll(ie):ie||[]):[]},defined:function(){for(var ie=0;ie<arguments.length;ie++)if(void 0!==arguments[ie])return arguments[ie]},create:function(ie,se){return ie instanceof Node?ae.set(ie,se):(1===arguments.length&&("string"===ae.type(ie)?se={}:(se=ie,ie=se.tag,se=ae.extend({},se,function(le){return"tag"!==le}))),ae.set(document.createElement(ie||"div"),se))},each:function(ie,se,le){for(var de in le=le||{},ie)le[de]=se.call(ie,de,ie[de]);return le},ready:function(ie){return ie=ie||document,new Promise(function(se){"loading"===ie.readyState?ie.addEventListener("DOMContentLoaded",function(){se()}):se()})},Class:function(ie){var se,le=["constructor","extends","abstract","static"].concat(Object.keys(ae.classProps)),de=ie.hasOwnProperty("constructor")?ie.constructor:ae.noop;2==arguments.length?(se=arguments[0],ie=arguments[1]):(se=function(){if(this.constructor.__abstract&&this.constructor===se)throw new Error("Abstract classes cannot be directly instantiated.");se["super"]&&se["super"].apply(this,arguments),de.apply(this,arguments)},se["super"]=ie["extends"]||null,se.prototype=ae.extend(Object.create(se["super"]?se["super"].prototype:Object),{constructor:se}),se.prototype["super"]=se["super"]?se["super"].prototype:null,se.__abstract=!!ie.abstract);var ue=function(ce){return this.hasOwnProperty(ce)&&-1===le.indexOf(ce)};if(ie["static"])for(var pe in ae.extend(se,ie["static"],ue),ae.classProps)pe in ie["static"]&&ae.classProps[pe](se,ie["static"][pe]);for(var pe in ae.extend(se.prototype,ie,ue),ae.classProps)pe in ie&&ae.classProps[pe](se.prototype,ie[pe]);return se},classProps:{lazy:ee(function(ie,se,le){return Object.defineProperty(ie,se,{get:function(){var de=le.call(this);return Object.defineProperty(this,se,{value:de,configurable:!0,enumerable:!0,writable:!0}),de},set:function(de){Object.defineProperty(this,se,{value:de,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),ie}),live:ee(function(ie,se,le){return"function"===ae.type(le)&&(le={set:le}),Object.defineProperty(ie,se,{get:function(){var de=this["_"+se],ue=le.get&&le.get.call(this,de);return void 0===ue?de:ue},set:function(de){var ue=this["_"+se],pe=le.set&&le.set.call(this,de,ue);this["_"+se]=void 0===pe?de:pe},configurable:le.configurable,enumerable:le.enumerable}),ie})},include:function(){var ie=arguments[arguments.length-1],se=!(2!==arguments.length)&&arguments[0],le=document.createElement("script");return se?Promise.resolve():new Promise(function(de,ue){ae.set(le,{async:!0,onload:function(){de(),ae.remove(le)},onerror:function(){ue()},src:ie,inside:document.head})})},fetch:function(ie,se){if(!ie)throw new TypeError("URL parameter is mandatory and cannot be "+ie);var le=te({url:new URL(ie,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},se);for(var de in le.method=le.method.toUpperCase(),ae.hooks.run("fetch-args",le),"GET"===le.method&&le.data&&(le.url.search+=le.data),document.body.setAttribute("data-loading",le.url),le.xhr.open(le.method,le.url.href,!1!==le.async,le.user,le.password),se)if(de in le.xhr)try{le.xhr[de]=se[de]}catch(pe){self.console&&console.error(pe)}for(var ue in"GET"===le.method||le.headers["Content-type"]||le.headers["Content-Type"]||le.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),le.headers)le.xhr.setRequestHeader(ue,le.headers[ue]);return new Promise(function(pe,ce){le.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===le.xhr.status||200<=le.xhr.status&&300>le.xhr.status||304===le.xhr.status?pe(le.xhr):ce(ae.extend(Error(le.xhr.statusText),{xhr:le.xhr,get status(){return this.xhr.status}}))},le.xhr.onerror=function(){document.body.removeAttribute("data-loading"),ce(ae.extend(Error("Network Error"),{xhr:le.xhr}))},le.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),ce(ae.extend(Error("Network Timeout"),{xhr:le.xhr}))},le.xhr.send("GET"===le.method?null:le.data)})},value:function(ie){var se="string"!==ae.type(ie);return ae.$(arguments).slice(+se).reduce(function(le,de){return le&&le[de]},se?ie:self)}}),ae.Hooks=new ae.Class({add:function(ie,se,le){if("string"==typeof arguments[0])(Array.isArray(ie)?ie:[ie]).forEach(function(de){this[de]=this[de]||[],se&&this[de][le?"unshift":"push"](se)},this);else for(var ie in arguments[0])this.add(ie,arguments[0][ie],arguments[1])},run:function(ie,se){this[ie]=this[ie]||[],this[ie].forEach(function(le){le.call(se&&se.context?se.context:se,se)})}}),ae.hooks=new ae.Hooks;var ne=ae.property;ae.Element=function(ie){this.subject=ie,this.data={},this.bliss={}},ae.Element.prototype={set:ee(function(ie,se){ie in ae.setProps?ae.setProps[ie].call(this,se):ie in this?this[ie]=se:this.setAttribute(ie,se)},0),transition:function(ie,se){return se=+se||400,new Promise(function(le){if("transition"in this.style){var ue=ae.extend({},this.style,/^transition(Duration|Property)$/);ae.style(this,{transitionDuration:(se||400)+"ms",transitionProperty:Object.keys(ie).join(", ")}),ae.once(this,"transitionend",function(){clearTimeout(pe),ae.style(this,ue),le(this)});var pe=setTimeout(le,se+50,this);ae.style(this,ie)}else ae.style(this,ie),le(this)}.bind(this))},fire:function(ie,se){var le=document.createEvent("HTMLEvents");return le.initEvent(ie,!0,!0),this.dispatchEvent(ae.extend(le,se))},unbind:ee(function(ie,se){(ie||"").split(/\s+/).forEach(function(le){if(ne in this&&(-1<le.indexOf(".")||!se)){le=(le||"").split(".");var de=le[1];le=le[0];var ue=this[ne].bliss.listeners=this[ne].bliss.listeners||{};for(var pe in ue)if(!le||pe===le)for(var ce,he=0;ce=ue[pe][he];he++)de&&de!==ce.className||se&&se!==ce.callback||(this.removeEventListener(pe,ce.callback,ce.capture),he--)}else this.removeEventListener(le,se)},this)},0)},ae.setProps={style:function(ie){for(var se in ie)se in this.style?this.style[se]=ie[se]:this.style.setProperty(se,ie[se])},attributes:function(ie){for(var se in ie)this.setAttribute(se,ie[se])},properties:function(ie){ae.extend(this,ie)},events:function(ie){if(ie&&ie.addEventListener){var se=this;if(ie[ne]&&ie[ne].bliss){var le=ie[ne].bliss.listeners;for(var de in le)le[de].forEach(function(ge){se.addEventListener(de,ge.callback,ge.capture)})}for(var ue in ie)0===ue.indexOf("on")&&(this[ue]=ie[ue])}else if(1<arguments.length&&"string"===ae.type(ie)){var pe=arguments[1],ce=arguments[2];ie.split(/\s+/).forEach(function(ge){this.addEventListener(ge,pe,ce)},this)}else for(var he in ie)ae.events(this,he,ie[he])},once:ee(function(ie,se){ie=ie.split(/\s+/);var le=this,de=function(){return ie.forEach(function(ue){le.removeEventListener(ue,de)}),se.apply(le,arguments)};ie.forEach(function(ue){le.addEventListener(ue,de)})},0),delegate:ee(function(ie,se,le){this.addEventListener(ie,function(de){de.target.closest(se)&&le.call(this,de)})},0,2),contents:function(ie){(ie||0===ie)&&(Array.isArray(ie)?ie:[ie]).forEach(function(se){var le=ae.type(se);/^(string|number)$/.test(le)?se=document.createTextNode(se+""):"object"===le&&(se=ae.create(se)),se instanceof Node&&this.appendChild(se)},this)},inside:function(ie){ie.appendChild(this)},before:function(ie){ie.parentNode.insertBefore(this,ie)},after:function(ie){ie.parentNode.insertBefore(this,ie.nextSibling)},start:function(ie){ie.insertBefore(this,ie.firstChild)},around:function(ie){ie.parentNode&&ae.before(this,ie),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(ie)}},ae.Array=function(ie){this.subject=ie},ae.Array.prototype={all:function(ie){var se=$$(arguments).slice(1);return this[ie].apply(this,se)}},ae.add=ee(function(ie,se,le,de){le=ae.extend({$:!0,element:!0,array:!0},le),"function"==ae.type(se)&&(!le.element||ie in ae.Element.prototype&&de||(ae.Element.prototype[ie]=function(){return this.subject&&ae.defined(se.apply(this.subject,arguments),this.subject)}),!le.array||ie in ae.Array.prototype&&de||(ae.Array.prototype[ie]=function(){var ue=arguments;return this.subject.map(function(pe){return pe&&ae.defined(se.apply(pe,ue),pe)})}),le.$&&(ae.sources[ie]=ae[ie]=se,(le.array||le.element)&&(ae[ie]=function(){var ue=[].slice.apply(arguments),pe=ue.shift(),ce=le.array&&Array.isArray(pe)?"Array":"Element";return ae[ce].prototype[ie].apply({subject:pe},ue)})))},0),ae.add(ae.Array.prototype,{element:!1}),ae.add(ae.Element.prototype),ae.add(ae.setProps),ae.add(ae.classProps,{element:!1,array:!1});var oe=document.createElement("_");ae.add(ae.extend({},HTMLElement.prototype,function(ie){return"function"===ae.type(oe[ie])}),null,!0)}(),function(ee){"use strict";if(Bliss&&!Bliss.shy){var te=Bliss.property;if(ee.add({clone:function(){var ie=this.cloneNode(!0),se=ee.$("*",ie).concat(ie);return ee.$("*",this).concat(this).forEach(function(le,de){ee.events(se[de],le),se[de]._.data=ee.extend({},le._.data)}),ie}},{array:!1}),Object.defineProperty(Node.prototype,te,{get:function ie(){return Object.defineProperty(Node.prototype,te,{get:void 0}),Object.defineProperty(this,te,{value:new ee.Element(this)}),Object.defineProperty(Node.prototype,te,{get:ie}),this[te]},configurable:!0}),Object.defineProperty(Array.prototype,te,{get:function(){return Object.defineProperty(this,te,{value:new ee.Array(this)}),this[te]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var re=EventTarget.prototype.addEventListener,ae=EventTarget.prototype.removeEventListener,ne=function(ie,se,le){return le.callback===ie&&le.capture==se},oe=function(){return!ne.apply(this,arguments)};EventTarget.prototype.addEventListener=function(ie,se,le){if(this&&this[te]&&this[te].bliss&&se){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};if(-1<ie.indexOf(".")){ie=ie.split(".");var ue=ie[1];ie=ie[0]}de[ie]=de[ie]||[],0===de[ie].filter(ne.bind(null,se,le)).length&&de[ie].push({callback:se,capture:le,className:ue})}return re.call(this,ie,se,le)},EventTarget.prototype.removeEventListener=function(ie,se,le){if(this&&this[te]&&this[te].bliss&&se){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};de[ie]&&(de[ie]=de[ie].filter(oe.bind(null,se,le)))}return ae.call(this,ie,se,le)}}self.$=self.$||ee,self.$$=self.$$||ee.$}}(Bliss),function(){function ee(ae,ne){return ae instanceof Node||ae instanceof Window?[ae]:[].slice.call("string"==typeof ae?(ne||document).querySelectorAll(ae):ae||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),!!Element.prototype.matches)){var te=self.Stretchy={selectors:{base:"textarea, select:not([size]), input:not([type]), input[type=\""+"text url email tel".split(" ").join("\"], input[type=\"")+"\"]",filter:"*"},script:document.currentScript||ee("script").pop(),resize:function(ae){if(te.resizes(ae)){var ne=getComputedStyle(ae),oe=0;if(!ae.value&&ae.placeholder){ae.value=ae.placeholder}var se=ae.nodeName.toLowerCase();if("textarea"==se)ae.style.height="0","border-box"==ne.boxSizing?oe=ae.offsetHeight:"content-box"==ne.boxSizing&&(oe=-ae.clientHeight),ae.style.height=ae.scrollHeight+oe+"px";else if("input"==se){if(ae.style.width="1000px",ae.offsetWidth){ae.style.width="0","border-box"==ne.boxSizing?oe=ae.offsetWidth:"padding-box"==ne.boxSizing&&(oe=ae.clientWidth),ae.scrollLeft=1e10;var le=Math.max(ae.scrollLeft+oe,ae.scrollWidth-ae.clientWidth);ae.style.width=le+"px"}else ae.style.width=ae.value.length+1+"ch";}else if("select"==se){var de=0<ae.selectedIndex?ae.selectedIndex:0,ue=document.createElement("_");ue.textContent=ae.options[de].textContent,ae.parentNode.insertBefore(ue,ae.nextSibling);var pe;for(var ce in ne){var he=ne[ce];/^(width|webkitLogicalWidth|length)$/.test(ce)||"string"!=typeof he||(ue.style[ce]=he,/appearance$/i.test(ce)&&(pe=ce))}ue.style.width="",0<ue.offsetWidth&&(ae.style.width=ue.offsetWidth+"px",(!ne[pe]||"none"!==ne[pe])&&(ae.style.width="calc("+ae.style.width+" + 2em)")),ue.parentNode.removeChild(ue),ue=null}ae.value=""}},resizeAll:function(ae){ee(ae||te.selectors.base).forEach(function(ne){te.resize(ne)})},active:!0,resizes:function(ae){return ae&&ae.parentNode&&ae.matches&&ae.matches(te.selectors.base)&&ae.matches(te.selectors.filter)},init:function(){te.selectors.filter=te.script.getAttribute("data-filter")||(ee("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",te.resizeAll()},$$:ee};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",te.init):te.init();var re=function(ae){te.active&&te.resize(ae.target)};document.documentElement.addEventListener("input",re),document.documentElement.addEventListener("change",re),self.MutationObserver&&new MutationObserver(function(ae){te.active&&ae.forEach(function(ne){"childList"==ne.type&&Stretchy.resizeAll(ne.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}(),!function(ee){"use strict";var te="Compound",ae="MemberExpression",ne="Literal",ce=46,he=44,fe=40,ye=41,be=91,xe=93,Ae=function(Ge,Re){var Me=new Error(Ge+" at character "+Re);throw Me.index=Re,Me.description=Ge,Me},Ne=!0,Pe={"-":Ne,"!":Ne,"~":Ne,"+":Ne},we={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Le=function(Ge){var Re,Me=0;for(var qe in Ge)(Re=qe.length)>Me&&Ge.hasOwnProperty(qe)&&(Me=Re);return Me},Oe=Le(Pe),Se=Le(we),Te={"true":!0,"false":!1,"null":null},De=function(Ge){return we[Ge]||0},Ie=function(Ge,Re,Me){var qe="||"===Ge||"&&"===Ge?"LogicalExpression":"BinaryExpression";return{type:qe,operator:Ge,left:Re,right:Me}},je=function(Ge){return 48<=Ge&&57>=Ge},Be=function(Ge){return 36===Ge||95===Ge||65<=Ge&&90>=Ge||97<=Ge&&122>=Ge||128<=Ge&&!we[String.fromCharCode(Ge)]},ze=function(Ge){return 36===Ge||95===Ge||65<=Ge&&90>=Ge||97<=Ge&&122>=Ge||48<=Ge&&57>=Ge||128<=Ge&&!we[String.fromCharCode(Ge)]},Ue=function(Ge){for(var Re,Me,qe=0,Fe=Ge.charAt,He=Ge.charCodeAt,We=function(ut){return Fe.call(Ge,ut)},Je=function(ut){return He.call(Ge,ut)},Ye=Ge.length,Ke=function(){for(var ut=Je(qe);32===ut||9===ut;)ut=Je(++qe)},Xe=function(){var ut,pt,ct=Qe();return Ke(),Je(qe)===63?(qe++,ut=Xe(),ut||Ae("Expected expression",qe),Ke(),Je(qe)===58?(qe++,pt=Xe(),pt||Ae("Expected expression",qe),{type:"ConditionalExpression",test:ct,consequent:ut,alternate:pt}):void Ae("Expected :",qe)):ct},Ze=function(){Ke();for(var ut=Ge.substr(qe,Se),pt=ut.length;0<pt;){if(we.hasOwnProperty(ut))return qe+=pt,ut;ut=ut.substr(0,--pt)}return!1},Qe=function(){var ut,pt,ct,mt,ht,gt,vt,ft;if(gt=tt(),pt=Ze(),!pt)return gt;for(ht={value:pt,prec:De(pt)},vt=tt(),vt||Ae("Expected expression after "+pt,qe),mt=[gt,ht,vt];(pt=Ze())&&(ct=De(pt),0!==ct);){for(ht={value:pt,prec:ct};2<mt.length&&ct<=mt[mt.length-2].prec;)vt=mt.pop(),pt=mt.pop().value,gt=mt.pop(),ut=Ie(pt,gt,vt),mt.push(ut);ut=tt(),ut||Ae("Expected expression after "+pt,qe),mt.push(ht,ut)}for(ft=mt.length-1,ut=mt[ft];1<ft;)ut=Ie(mt[ft-1].value,mt[ft-2],ut),ft-=2;return ut},tt=function(){var ut,pt,ct;if(Ke(),ut=Je(qe),je(ut)||ut===ce)return rt();if(ut===39||ut===34)return at();if(Be(ut)||ut===fe)return it();if(ut===be)return lt();for(pt=Ge.substr(qe,Oe),ct=pt.length;0<ct;){if(Pe.hasOwnProperty(pt))return qe+=ct,{type:"UnaryExpression",operator:pt,argument:tt(),prefix:!0};pt=pt.substr(0,--ct)}return!1},rt=function(){for(var ut,pt,ct="";je(Je(qe));)ct+=We(qe++);if(Je(qe)===ce)for(ct+=We(qe++);je(Je(qe));)ct+=We(qe++);if(ut=We(qe),"e"===ut||"E"===ut){for(ct+=We(qe++),ut=We(qe),"+"!==ut&&"-"!==ut||(ct+=We(qe++));je(Je(qe));)ct+=We(qe++);je(Je(qe-1))||Ae("Expected exponent ("+ct+We(qe)+")",qe)}return pt=Je(qe),Be(pt)?Ae("Variable names cannot start with a number ("+ct+We(qe)+")",qe):pt===ce&&Ae("Unexpected period",qe),{type:ne,value:parseFloat(ct),raw:ct}},at=function(){for(var ut,pt="",ct=We(qe++),mt=!1;qe<Ye;){if(ut=We(qe++),ut===ct){mt=!0;break}if("\\"===ut)switch(ut=We(qe++)){case"n":pt+="\n";break;case"r":pt+="\r";break;case"t":pt+="\t";break;case"b":pt+="\b";break;case"f":pt+="\f";break;case"v":pt+="\x0B";break;default:pt+="\\"+ut;}else pt+=ut}return mt||Ae("Unclosed quote after \""+pt+"\"",qe),{type:ne,value:pt,raw:ct+pt+ct}},nt=function(){var ut,pt=Je(qe),ct=qe;for(Be(pt)?qe++:Ae("Unexpected "+We(qe),qe);qe<Ye&&(pt=Je(qe),ze(pt));)qe++;return ut=Ge.slice(ct,qe),Te.hasOwnProperty(ut)?{type:ne,value:Te[ut],raw:ut}:ut==="this"?{type:"ThisExpression"}:{type:"Identifier",name:ut}},ot=function(ut){for(var pt,ct,mt=[],ht=!1;qe<Ye;){if(Ke(),pt=Je(qe),pt===ut){ht=!0,qe++;break}pt===he?qe++:(ct=Xe(),ct&&ct.type!==te||Ae("Expected comma",qe),mt.push(ct))}return ht||Ae("Expected "+String.fromCharCode(ut),qe),mt},it=function(){var ut,pt;for(ut=Je(qe),pt=ut===fe?st():nt(),Ke(),ut=Je(qe);ut===ce||ut===be||ut===fe;)qe++,ut===ce?(Ke(),pt={type:ae,computed:!1,object:pt,property:nt()}):ut===be?(pt={type:ae,computed:!0,object:pt,property:Xe()},Ke(),ut=Je(qe),ut!=xe&&Ae("Unclosed [",qe),qe++):ut==fe&&(pt={type:"CallExpression",arguments:ot(ye),callee:pt}),Ke(),ut=Je(qe);return pt},st=function(){qe++;var ut=Xe();return Ke(),Je(qe)===ye?(qe++,ut):void Ae("Unclosed (",qe)},lt=function(){return qe++,{type:"ArrayExpression",elements:ot(xe)}},dt=[];qe<Ye;)Re=Je(qe),Re===59||Re===he?qe++:(Me=Xe())?dt.push(Me):qe<Ye&&Ae("Unexpected \""+We(qe)+"\"",qe);return 1===dt.length?dt[0]:{type:te,body:dt}};if(Ue.version="0.3.1",Ue.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Ue.version},Ue.addUnaryOp=function(Ge){return Oe=Math.max(Ge.length,Oe),Pe[Ge]=Ne,this},Ue.addBinaryOp=function(Ge,Re){return Se=Math.max(Ge.length,Se),we[Ge]=Re,this},Ue.addLiteral=function(Ge,Re){return Te[Ge]=Re,this},Ue.removeUnaryOp=function(Ge){return delete Pe[Ge],Ge.length===Oe&&(Oe=Le(Pe)),this},Ue.removeBinaryOp=function(Ge){return delete we[Ge],Ge.length===Se&&(Se=Le(we)),this},Ue.removeLiteral=function(Ge){return delete Te[Ge],this},"undefined"==typeof exports){var $e=ee.jsep;ee.jsep=Ue,Ue.noConflict=function(){return ee.jsep===Ue&&(ee.jsep=$e),Ue}}else"undefined"!=typeof module&&module.exports?exports=module.exports=Ue:exports.parse=Ue}(this),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){"use strict";var re=self.Mavo=ee.Class({constructor:function(ue){var pe=this;this.treeBuilt=Mavo.defer(),this.element=ue,this.index=re.all.push(this);var ce=re.attributes.map(function(De){return"[data-"+De+"]"}),he=!0,ge=!1,ve;try{for(var ye,fe=te(ce.join(", "),this.element).concat(this.element)[Symbol.iterator]();!(he=(ye=fe.next()).done);he=!0){var be=ye.value,xe=!0,Ce=!1,Ee=void 0;try{for(var Ae,ke=re.attributes[Symbol.iterator]();!(xe=(Ae=ke.next()).done);xe=!0){var Ne=Ae.value,Pe=be.getAttribute("data-"+Ne);null!==Pe&&be.setAttribute(Ne,Pe)}}catch(De){Ce=!0,Ee=De}finally{try{!xe&&ke.return&&ke.return()}finally{if(Ce)throw Ee}}}}catch(De){ge=!0,ve=De}finally{try{!he&&fe.return&&fe.return()}finally{if(ge)throw ve}}re.allIds.push(this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index),this.element.setAttribute("mv-app",this.id),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.element.setAttribute("typeof",""),te(re.selectors.primitive,ue).forEach(function(De){var Ie=ee(re.selectors.not(re.selectors.formControl)+", "+re.selectors.property,De);if(Ie){var je=Mavo.Primitive.getConfig(De),Be=Mavo.is("multiple",De);!Be&&(je.attribute||je.hasChildren)||De.setAttribute("typeof","")}}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.ui={bar:ee(".mv-bar",this.element)||ee.create({className:"mv-bar mv-ui",start:this.element})},this.ui.bar.classList.toggle("mv-compact",400>this.ui.bar.parentNode.offsetWidth),this.ui.bar.classList.toggle("mv-tiny",250>this.ui.bar.parentNode.offsetWidth),this.ui.status=ee(".mv-status",this.ui.bar)||ee.create("span",{className:"mv-status",inside:this.ui.bar});for(var Oe,we=["storage","source","init"],Le=0;Le<we.length;Le++)Oe=we[Le],1==this.index&&(this[Oe]=re.Functions.urlOption(Oe)),this[Oe]||(this[Oe]=re.Functions.urlOption(this.id+"_"+Oe)||this.element.getAttribute("mv-"+Oe)||null),this[Oe]&&(this[Oe]=this[Oe].trim(),this[Oe]="none"==this[Oe]?null:re.Backend.create(this[Oe],{mavo:this,format:this.element.getAttribute("mv-format-"+Oe)||this.element.getAttribute("mv-format")}));this.storage||this.source||!this.init||(this.source=this.init,this.init=null);for(var Ve,Se=["storage","source","init"],Te=0;Te<Se.length;Te++)if(Ve=Se[Te],this[Ve]){this.primaryBackend=this[Ve],this.permissions=this[Ve].permissions;break}this.permissions=this.permissions||new Mavo.Permissions,this.primaryBackend&&(this.authControls={},ee.style(this.ui.bar,{"--mv-backend":"\""+this.primaryBackend.id+"\""}),this.permissions.can("login",function(){pe.loginHash="#login"+(Mavo.all[0]===pe?"":"-"+pe.id),pe.authControls.login=ee.create({tag:"a",href:pe.loginHash,textContent:"Login",title:"Login",className:"mv-login mv-button",events:{click:function(je){je.preventDefault(),pe.primaryBackend.login()}},after:ee(".mv-status",pe.ui.bar)});var De;(De=function(){location.hash===pe.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),pe.primaryBackend.login())})(),window.addEventListener("hashchange.mavo",De)},function(){ee.remove(pe.authControls.login),pe.element._.unbind("hashchange.mavo")}),this.element.addEventListener("mavo:login.mavo",function(De){if(De.backend==pe.primaryBackend){var Ie=ee(".mv-status",pe.ui.bar);Ie.innerHTML="",ee.set(Ie,{contents:[{tag:"strong",innerHTML:De.name},{tag:"button",textContent:"Logout",className:"mv-logout",events:{click:function(){return De.backend.logout()}}}]}),pe.root.data||pe.unsavedChanges||pe.load()}}),this.element.addEventListener("mavo:logout.mavo",function(){ee(".mv-status",pe.ui.bar).textContent=""})),ee("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(De){De.target!=document.activeElement&&De.preventDefault()}),this.needsEdit=this.some(function(De){return De!=pe.root&&!De.modes&&"read"==De.mode}),this.setUnsavedChanges(!1),this.permissions.onchange(function(De){var Ie=De.action,je=De.value,Be=pe.element.getAttribute("mv-permissions")||"";Be=Be.trim().split(/\s+/).filter(function(ze){return ze!=Ie}),je&&Be.push(Ie),pe.element.setAttribute("mv-permissions",Be.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],function(){pe.ui.edit=ee.create("button",{className:"mv-edit",textContent:"Edit",title:"Edit",inside:pe.ui.bar}),pe.modeObserver=new Mavo.Observer(pe.element,"mv-mode",function(De){var Ie=!0,je=!1,Be;try{for(var Ue,ze=De[Symbol.iterator]();!(Ie=(Ue=ze.next()).done);Ie=!0){var $e=Ue.value,Ge=$e.target,Re=!0,Me=!1,qe=void 0;try{nodeloop:for(var He,Fe=re.Node.children(Ge)[Symbol.iterator]();!(Re=(He=Fe.next()).done);Re=!0){var We=He.value,Je=We.mode,Ye=void 0;if(We.element==Ge)Ye=We.element.getAttribute("mv-mode"),We.modes=Ye;else{if(We.modes)continue nodeloop;Ye=re.getStyle(We.element.parentNode,"--mv-mode")}We.mode=Ye,Je!=We.mode&&We["edit"==We.mode?"edit":"done"]()}}catch(Ke){Me=!0,qe=Ke}finally{try{!Re&&Fe.return&&Fe.return()}finally{if(Me)throw qe}}}}catch(Ke){je=!0,Be=Ke}finally{try{!Ie&&ze.return&&ze.return()}finally{if(je)throw Be}}},{subtree:!0}),pe.autoEdit&&pe.edit()},function(){ee.remove(pe.ui.edit),pe.editing&&pe.done(),pe.modeObserver&&pe.modeObserver.destroy()}),this.storage&&this.permissions.can("delete",function(){pe.ui.clear=ee.create("button",{className:"mv-clear",textContent:"Clear",title:"Clear"}),pe.ui.bar.appendChild(pe.ui.clear)},function(){ee.remove(pe.ui.clear)}),this.storage||this.source?this.permissions.can("read",function(){return pe.load()}):(this.permissions.on(["read","edit"]),ee.fire(this.element,"mavo:load")),this.permissions.can("save",function(){if(pe.autoSave){var De=1e3*(pe.element.getAttribute("mv-autosave")||3);pe.element.addEventListener("mavo:load.mavo:autosave",function(){var je=re.debounce(function(){pe.save()},De),Be=function(Ue){Ue.node.saved&&je()};requestAnimationFrame(function(){pe.permissions.can("save",function(){pe.element.addEventListener("mavo:datachange.mavo:autosave",Be)},function(){pe.element.removeEventListener("mavo:datachange.mavo:autosave",Be)})})})}(!pe.autoSave||0<De)&&(pe.ui.save=ee.create("button",{className:"mv-save",textContent:"Save",title:"Save",inside:pe.ui.bar})),ee.events(pe.ui.save,{"mouseenter focus":function(){pe.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){return pe.element.classList.remove("mv-highlight-unsaved")}})},function(){ee.remove(pe.ui.save),pe.ui.save=null,pe.element.removeEventListener(".mavo:autosave")}),ee.delegate(this.element,"click",{".mv-save":function(){pe.permissions.save&&pe.save()},".mv-edit":function(){pe.editing||!pe.permissions.edit?pe.done():pe.edit()},".mv-clear":function(){pe.permissions.delete&&pe.clear()}}),this.element.addEventListener("keydown",function(De){83==De.keyCode&&De[re.superKey]&&(De.preventDefault(),pe.save())}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(){return this.root.getData()},toJSON:function(){return re.toJSON(this.getData())},error:function(ue){for(var he,pe=this,ce=function(){return ee.transition(de,{opacity:0}).then(ee.remove)},de=ee.create("p",{className:"mv-error mv-ui",contents:[ue,{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:ce}}],events:{mouseenter:function(){return clearTimeout(he)},mouseleave:re.rr(function(){return he=setTimeout(ce,5e3)}),click:function(){return pe.element.scrollIntoView({behavior:"smooth"})}},start:this.element}),ge=arguments.length,ve=Array(1<ge?ge-1:0),fe=1;fe<ge;fe++)ve[fe-1]=arguments[fe];if(0<ve.length){var ye;(ye=console).log.apply(ye,["%c"+this.id+": "+ue,"color: red; font-weight: bold"].concat(ve))}},render:function(ue){var pe={context:this,data:ue};re.hooks.run("render-start",pe),pe.data&&this.root.render(pe.data),this.unsavedChanges=!1,re.hooks.run("render-end",pe)},clear:function(){var ue=this;confirm("This will delete all your data. Are you sure?")&&this.store(null).then(function(){return ue.root.clear()})},edit:function(){this.root.edit(),ee.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(ue){if(ue.target.matches(".mv-item-controls *")){var pe=ue.target.closest(".mv-item-controls"),ce=Mavo.data(pe,"item");ce&&ce.element&&ce.element.classList.toggle("mv-highlight","mouseenter"==ue.type)}if(ue.target.matches(re.selectors.multiple)){ue.target.classList.remove("mv-has-hovered-item");var he=ue.target.parentNode.closest(re.selectors.multiple);he&&he.classList.toggle("mv-has-hovered-item","mouseenter"==ue.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(ue){var pe=!!ue;return ue||this.walk(function(ce){if(ce.unsavedChanges)return pe=!0,!1===ue&&(ce.unsavedChanges=!1),!1}),this.unsavedChanges=pe},done:function(){this.root.done(),ee.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},load:function(){var ue=this;this.inProgress="Loading";var pe=this.source||this.storage;return pe.ready.then(function(){return pe.load()}).catch(function(ce){return ue.init&&ue.init!=pe?(pe=ue.init,ue.init.ready.then(function(){return ue.init.load()})):Promise.reject(ce)}).catch(function(ce){if(ce){var he=ce instanceof XMLHttpRequest?ce:ce.xhr;if(he&&404==he.status)ue.render(null);else{var ge="Problem loading data";he&&(ge+=he.status?": HTTP error "+ce.status+": "+ce.statusText:": Can\u2019t connect to the Internet"),ue.error(ge,ce)}}return null}).then(function(ce){return ue.render(ce)}).then(function(){ue.inProgress=!1,ee.fire(ue.element,"mavo:load")})},store:function(){var ue=this;if(this.storage)return this.inProgress="Saving",this.storage.login().then(function(){return ue.storage.store(ue.getData())}).catch(function(pe){if(pe){var ce="Problem saving data";pe instanceof XMLHttpRequest&&(ce+=xhr.status?": HTTP error "+pe.status+": "+pe.statusText:": Can\u2019t connect to the Internet"),ue.error(ce,pe)}return null}).then(function(pe){return ue.inProgress=!1,pe})},save:function(){var ue=this;return this.store().then(function(pe){pe&&(ee.fire(ue.element,"mavo:save",pe),ue.lastSaved=Date.now(),ue.root.save(),ue.unsavedChanges=!1)})},walk:function(ue){return this.root.walk(ue)},some:function(ue){return!this.walk(function(pe,ce){var he=ue(pe,ce);if(!0===he)return!1})},live:{inProgress:function(ue){ee.toggleAttribute(this.element,"mv-progress",ue,ue)},unsavedChanges:function(ue){this.element.classList.toggle("mv-unsaved-changes",ue)},needsEdit:function(){ee.remove(this.ui.edit)}},static:{all:[],allIds:[],get:function(ue){var pe=!0,ce=!1,he;try{for(var ve,fe,ge=re.all[Symbol.iterator]();!(pe=(ve=ge.next()).done);pe=!0)if(fe=ve.value,fe.id===ue)return fe}catch(ye){ce=!0,he=ye}finally{try{!pe&&ge.return&&ge.return()}finally{if(ce)throw he}}return null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",init:function(ue){return te(re.selectors.init,ue||document).filter(function(pe){return pe==document.documentElement||!pe.parentNode.closest(re.selectors.init)}).map(function(pe){return new re(pe)})},plugin:function(ue){for(var pe in re.hooks.add(ue.hooks),ue.extend){var ce="Mavo"==pe?re:re[pe];ee.Class(ce,ue.extend[pe])}},hooks:new ee.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions"]}});{var ae=re.selectors={init:".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]",property:"[property], [itemprop]",specificProperty:function(ue){return"[property="+ue+"], [itemprop="+ue+"]"},group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},ne=ae.arr=function(de){return de.split(/\s*,\s*/g)},oe=ae.not=function(de){return ne(de).map(function(ue){return":not("+ue+")"}).join("")},ie=ae.or=function(de,ue){return de+", "+ue},se=ae.and=function(de,ue){var pe=[],ce=ne(ue);return ne(de).forEach(function(he){return pe.push.apply(pe,_toConsumableArray(ce.map(function(ge){return he+ge})))}),pe.join(", ")},le=ae.andNot=function(de,ue){return se(de,oe(ue))};ee.extend(re.selectors,{primitive:le(ae.property,ae.group),rootGroup:le(ae.group,ae.property),output:ie(ae.specificProperty("output"),".mv-output, .mv-value")})}Promise.all([ee.ready(),ee.include(Array.from&&window.Intl&&document.documentElement.closest,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")]).catch(function(de){return console.error(de)}).then(function(){return Mavo.init()}),Stretchy.selectors.filter=".mv-editor:not([property])"})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){function re(ne,oe){for(ne="mv-"+ne+"-within",te("."+ne).forEach(function(ie){return ie.classList.remove(ne)});oe&&oe.classList;)oe.classList.add(ne),oe=oe.parentNode}var ae=ee.extend(Mavo,{toJSON:function(oe){return null===oe?"":"string"==typeof oe?oe:JSON.stringify(oe,null,"\t")},queryJSON:function(oe,ie){return ie&&oe?ee.value.apply(ee,[oe].concat(ie.split("/"))):oe},toArray:function(oe){return oe===void 0?[]:Array.isArray(oe)?oe:[oe]},delete:function(oe,ie){var se=oe&&oe.indexOf(ie);-1<se&&oe.splice(se,1)},hasIntersection:function(oe,ie){return oe&&ie&&!oe.every(function(se){return-1==ie.indexOf(se)})},flatten:function(oe){return Array.isArray(oe)?oe.reduce(function(ie,se){return ae.toArray(ie).concat(ae.flatten(se))},[]):[oe]},is:function(oe){for(var ie=arguments.length,se=Array(1<ie?ie-1:0),le=1;le<ie;le++)se[le-1]=arguments[le];var de=!0,ue=!1,pe;try{for(var he,ge,ce=se[Symbol.iterator]();!(de=(he=ce.next()).done);de=!0)if(ge=he.value,ge&&ge.matches&&ge.matches(ae.selectors[oe]))return!0}catch(ve){ue=!0,pe=ve}finally{try{!de&&ce.return&&ce.return()}finally{if(ue)throw pe}}return!1},getStyle:function(oe,ie){return oe&&getComputedStyle(oe).getPropertyValue(ie).trim()},data:function(oe,ie,se){return 2==arguments.length?ee.value(oe,"_","data","mavo",ie):(oe._.data.mavo=oe._.data.mavo||{},oe._.data.mavo[ie]=se)},revocably:{add:function(oe){var ie=ae.revocably.isRemoved(oe);return ie&&ie.parentNode.replaceChild(oe,ie),ie},remove:function(oe,ie){if(oe){var se=ae.data(oe,"commentstub");return se||(ie=ie||oe.id||oe.className||oe.nodeName,se=ae.data(oe,"commentstub",document.createComment(ie))),oe.parentNode&&oe.parentNode.replaceChild(se,oe),se}},isRemoved:function(oe){if(!oe||oe.parentNode)return!1;var ie=ae.data(oe,"commentstub");return ie&&ie.parentNode&&ie}},inViewport:function(oe){var ie=oe.getBoundingClientRect();return(0<=ie.bottom&&ie.bottom<=innerHeight||0<=ie.top&&ie.top<=innerHeight)&&(0<=ie.right&&ie.right<=innerWidth||0<=ie.left&&ie.left<=innerWidth)},scrollIntoViewIfNeeded:function(oe){Mavo.inViewport(oe)||oe.scrollIntoView({behavior:"smooth"})},pushUnique:function(oe,ie){-1===oe.indexOf(ie)&&oe.push(ie)},subset:function(oe,ie,se){if(3==arguments.length){if(ie.length){var le=ee.value.apply(ee,[oe].concat(_toConsumableArray(ie.slice(0,-1))));return le[ie[ie.length-1]]=se,oe}return se}return"object"==("undefined"==typeof oe?"undefined":_typeof(oe))&&ie&&ie.length?ee.value.apply(ee,[oe].concat(_toConsumableArray(ie))):oe},getAttribute:function(oe){for(var ie=arguments.length,se=Array(1<ie?ie-1:0),le=1;le<ie;le++)se[le-1]=arguments[le];for(var ue,pe,de=0;ue=se[de];de++)if(pe=oe.getAttribute(ue),pe)return pe;return null},debounce:function(oe,ie){if(!ie)return oe;var le,se=null;return function(){var de=this,ue=arguments;le=function(){oe.apply(de,ue),removeEventListener("beforeunload",le)},clearTimeout(se),se=setTimeout(le,ie),addEventListener("beforeunload",le)}},escapeRegExp:function(oe){return oe.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Observer:ee.Class({constructor:function(oe,ie,se){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};se instanceof MutationObserver&&(this.observer=se),this.observer=this.observer||new MutationObserver(se),this.element=oe,this.callback=se,this.attribute=ie,this.options=ee.extend({},le),ie&&ee.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:[this.attribute],attributeOldValue:!!le.oldValue}),this.attribute&&"all"!=this.attribute||ee.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!le.oldValue}),this.run()},stop:function(){return this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(oe){if(this.running){this.stop();var ie=oe();this.run()}else var ie=oe();return ie},destroy:function(){this.observer.disconnect(),this.observer=this.element=null},static:{sneak:function(oe,ie){return oe?oe.sneak(ie):ie()}}}),defer:function(oe){var ie,se,le=new Promise(function(de,ue){oe&&oe(de,ue),ie=de,se=ue});return le.resolve=function(de){return ie(de),le},le.reject=function(de){return se(de),le},le},rr:function(oe){return oe(),oe}});ee.add("toggleAttribute",function(ne,oe){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null!==oe;ie?this.setAttribute(ne,oe):this.removeAttribute(ne)}),ee.proxy=ee.classProps.proxy=ee.overload(function(ne,oe,ie){return Object.defineProperty(ne,oe,{get:function(){return this[ie][oe]},set:function(le){this[ie][oe]=le},configurable:!0,enumerable:!0}),ne}),ee.classProps.propagated=function(ne,oe){Mavo.toArray(oe).forEach(function(ie){var se=ne[ie];ne[ie]=function(){var le=se&&se.apply(this,arguments);this.propagate&&!1!==le&&this.propagate(ie)}})};document.addEventListener("focus",function(ne){re("focus",ne.target)},!0),document.addEventListener("blur",function(){re("focus",null)},!0),addEventListener("hashchange",function(){re("target",ee(location.hash))}),document.documentElement.addEventListener("mavo:datachange",function(){re("target",ee(location.hash))}),re("focus",document.activeElement===document.body?null:document.activeElement)})(Bliss,Bliss.$),"use strict",function(ee){var te=Mavo.Permissions=ee.Class({constructor:function(ae){this.triggers=[],this.set(ae),this.hooks=new ee.Hooks},set:function(ae){for(var ne in ae)this[ne]=ae[ne]},on:function(ae){var ne=this;return Mavo.toArray(ae).forEach(function(oe){return ne[oe]=!0}),this},off:function(ae){var ne=this;return ae=Array.isArray(ae)?ae:[ae],ae.forEach(function(oe){return ne[oe]=!1}),this},can:function(ae,ne,oe){this.observe(ae,!0,ne),oe&&this.cannot(ae,oe)},cannot:function(ae,ne){this.observe(ae,!1,ne)},when:function(ae){var ne=this;return new Promise(function(oe,ie){ne.can(ae,oe,ie)})},observe:function(ae,ne,oe){ae=Mavo.toArray(ae),this.is(ae,ne)&&oe(),this.triggers.push({actions:ae,value:ne,callback:oe,active:!0})},is:function(ae,ne){var oe=this,ie=ae.map(function(se){return!!oe[se]}).reduce(function(se,le){return se||le});return ne?ie:!ie},onchange:function(ae){this.hooks.add("change",ae);var ne=!0,oe=!1,ie;try{for(var le,de,se=te.actions[Symbol.iterator]();!(ne=(le=se.next()).done);ne=!0)de=le.value,ae.call(this,{action:de,value:this[de],permissions:this})}catch(ue){oe=!0,ie=ue}finally{try{!ne&&se.return&&se.return()}finally{if(oe)throw ie}}},changed:function(ae,ne,oe){var ie=this;oe=!!oe,ne=!!ne;ne==oe||(this["_"+ae]=ne,this.triggers.forEach(function(se){var le=ie.is(se.actions,se.value);se.active&&-1<se.actions.indexOf(ae)&&le?(se.active=!1,se.callback()):!le&&(se.active=!0)}),this.hooks.run("change",{action:ae,value:ne,permissions:this}))},or:function(ae){var ne=!0,oe=!1,ie;try{for(var le,de,se=te.actions[Symbol.iterator]();!(ne=(le=se.next()).done);ne=!0)de=le.value,this[de]=this[de]||ae[de]}catch(ue){oe=!0,ie=ue}finally{try{!ne&&se.return&&se.return()}finally{if(oe)throw ie}}return this},static:{actions:[],register:function(ae,ne){return Array.isArray(ae)?void ae.forEach(function(oe){return te.register(oe,ne)}):void(ee.live(te.prototype,ae,function(oe,ie){ne&&ne.call(this,oe,ie),this.changed(ae,oe,ie)}),te.actions.push(ae))}}});te.register(["read","save"]),te.register("login",function(re){re&&this.logout&&(this.logout=!1)}),te.register("logout",function(re){re&&this.login&&(this.login=!1)}),te.register("edit",function(re){re&&(this.add=this.delete=!0)}),te.register(["add","delete"],function(re){re||(this.edit=!1)})}(Bliss),"use strict",function(ee){var te=Mavo.Backend=ee.Class({constructor:function(ae){var ne=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};this.raw=ae,this.url=new URL(this.raw,location),this.mavo=ne.mavo,this.format=Mavo.Formats.create(ne.format,this),this.permissions=new Mavo.Permissions},get:function(){return ee.fetch(this.url.href).then(function(ae){return Promise.resolve(ae.responseText)},function(){return Promise.resolve(null)})},load:function(){var ae=this;return this.ready.then(function(){return ae.get()}).then(function(ne){return"string"==typeof ne?(ne=ne.replace(/^\ufeff/,""),ae.format.parse(ne)):ne})},store:function(ae){var ne=this,oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},ie=oe.path,se=oe.format,le=se===void 0?this.format:se;return this.ready.then(function(){var de="string"==typeof ae?Promise.resolve(ae):le.stringify(ae);return de.then(function(ue){return ne.put(ue,ie).then(function(){return{data:ae,serialized:ue}})})})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},toString:function(){return this.id+" ("+this.url+")"},static:{create:function(ae,ne){if(ae){var oe=te.types.filter(function(ie){return ie.test(ae)})[0]||te.Remote;return new oe(ae,ne)}return null},types:[],register:function(ae){return te[ae.prototype.id]=ae,te.types.push(ae),ae}}});te.register(ee.Class({id:"Element",extends:te,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=ee(this.raw)||ee.create("script",{type:"application/json",id:this.raw.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(ae){return Promise.resolve(this.element.textContent=ae)},static:{test:function(ae){return 0===ae.indexOf("#")}}})),te.register(ee.Class({id:"Remote",extends:te,constructor:function(){this.permissions.on("read")},static:{test:function(){return!1}}})),te.register(ee.Class({extends:te,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(ae){return ae?localStorage[this.key]=ae:delete localStorage[this.key],Promise.resolve(ae)},static:{test:function(ae){return"local"==ae}}}))}(Bliss),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}(function(ee){var re=Mavo.Formats={},ae=re.Base=ee.Class({abstract:!0,constructor:function(le){this.backend=le},proxy:{mavo:"backend"},parse:function(le){return this.constructor.parse(le,this)},stringify:function(le){return this.constructor.stringify(le,this)},static:{parse:function(le){return Promise.resolve(le)},stringify:function(le){return Promise.resolve(le)},extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(function(le){return ee.include(le.test,le.url)}))}}}),ne=re.JSON=ee.Class({extends:re.Base,static:{parse:function(le){return Promise.resolve(le?JSON.parse(le):null)},stringify:function(le){return Promise.resolve(Mavo.toJSON(le))},extensions:[".json",".jsonld"]}}),oe=re.Text=ee.Class({extends:re.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt",".md",".markdown"],parse:function(le,de){return Promise.resolve(_defineProperty({},de?de.property:"content",le))},stringify:function(le,de){return Promise.resolve(le[de?de.property:"content"])}}}),ie=re.CSV=ee.Class({extends:re.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=ee.extend({},re.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:ae.ready,parse:function(le,de){return ie.ready(function(){var ue=Papa.parse(le,ie.defaultOptions),pe=de?de.property:"content";if(de&&(de.options.delimiter=ue.meta.delimiter,de.options.linebreak=ue.meta.linebreak),ue.meta.aborted)throw ue.meta.errors.pop();return _defineProperty({},pe,ue.data)})},stringify:function(le,de){return ie.ready(function(){var ue=de?de.property:"content",pe=de?de.options:ie.defaultOptions;return Papa.unparse(data[ue],pe)})}}});Object.defineProperty(re,"create",{value:function(le,de){if(le&&"object"===("undefined"==typeof le?"undefined":_typeof(le)))return le;if("string"==typeof le)for(var ue in le=le.toLowerCase(),re){var pe=re[ue];if(ue.toLowerCase()==le)return new pe(de)}if(!le){var ce=de.url?de.url.pathname:de.raw,he=(ce.match(/\.\w+$/)||[])[0]||".json",pe=re.JSON;for(var ue in re)-1<re[ue].extensions.indexOf(he)&&(pe=re[ue]);return new pe(de)}}})})(Bliss,Bliss.$),"use strict";function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Node=ee.Class({abstract:!0,constructor:function(ne,oe){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(!ne||!oe)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var se={context:this,options:ie};this.uid=++re.maxId,this.nodeType=this.nodeType,this.property=null,ee.extend(this,se.options),re.all.set(ne,[].concat(_toConsumableArray(re.all.get(this.element)||[]),[this])),this.element=ne,this.template=se.options.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=oe,this.group=this.parentGroup=se.options.group,this.fromTemplate("property","type")||(this.property=re.getProperty(ne),this.type=Mavo.Group.normalize(ne),this.store=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",se),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=se.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup),Mavo.hooks.run("node-init-end",se)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.store},get path(){var ae=this.parentGroup?this.parentGroup.path:[];return this.property?[].concat(_toConsumableArray(ae),[this.property]):ae},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){},getData:function(){var ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(this.isDataNull(ne))return null},isDataNull:function(ne){var oe={context:this,options:ne,result:this.deleted||!this.saved&&"*"!=ne.store};return Mavo.hooks.run("unit-isdatanull",oe),oe.result},walk:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return function se(le,de){var ue=ne(le,de);if(!1!==ue)for(var pe in le.children){var ce=le.children[pe];if(ce instanceof Mavo.Node){var ue=se.call(ce,ce,[].concat(_toConsumableArray(de),[pe]));if(!1===ue)return!1}}return!1!==ue}(this,oe)},walkUp:function(ne){for(var ie,oe=this;oe=oe.parentGroup;)if(ie=ne(oe),void 0!==ie)return ie},edit:function(){return this.mode="edit","edit"==this.mode&&void(this.propagate("edit"),Mavo.hooks.run("node-edit-end",this))},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(ee.unbind(this.element,".mavo:edit"),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(ne){for(var oe in this.children){var ie=this.children[oe];ie instanceof Mavo.Node&&("function"==typeof ne?ne.call(ie,ie):ne in ie&&ie[ne]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var ne=arguments.length,oe=Array(ne),ie=0;ie<ne;ie++)oe[ie]=arguments[ie];var se=!0,le=!1,de;try{for(var pe,ce,ue=oe[Symbol.iterator]();!(se=(pe=ue.next()).done);se=!0)ce=pe.value,this[ce]=this.template[ce]}catch(he){le=!0,de=he}finally{try{!se&&ue.return&&ue.return()}finally{if(le)throw de}}}return!!this.template},render:function(ne){this.data=ne,ne=Mavo.subset(ne,this.inPath);var oe={context:this,data:ne};if(Mavo.hooks.run("node-render-start",oe),"Collection"!=this.nodeType&&Array.isArray(ne)){var ie;this.isRoot&&1===(ie=Object.keys(this.children)).length&&"Collection"===this.children[ie[0]].nodeType?oe.data=_defineProperty({},ie[0],oe.data):(this.inPath.push("0"),oe.data=oe.data[0])}this.editing?(this.done(),this.dataRender(oe.data),this.edit()):this.dataRender(oe.data),this.save(),Mavo.hooks.run("node-render-end",oe)},dataChanged:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};ee.fire(oe.element||this.element,"mavo:datachange",ee.extend({property:this.property,action:ne,mavo:this.mavo,node:this},oe))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},getClosestCollection:function(){return this.collection||this.group.collection||(this.parentGroup?this.parentGroup.closestCollection:null)},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},lazy:{closestCollection:function(){return this.getClosestCollection()},inPath:function(){return"Collection"==this.nodeType?[]:(this.element.getAttribute("mv-path")||"").split("/").filter(function(ne){return ne.length})}},live:{store:function(ne){ee.toggleAttribute(this.element,"mv-storage",ne)},unsavedChanges:function(ne){return!ne||this.saved&&this.editing||(ne=!1),this.element.classList.toggle("mv-unsaved-changes",ne),ne},mode:function(ne){var oe=this;if(this._mode!=ne){if(this.modes&&ne!=this.modes&&(ne=this.modes),this._mode=ne,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var ie=this.modes||"edit"==ne;Mavo.Observer.sneak(this.mavo.modeObserver,function(){ee.toggleAttribute(oe.element,"mv-mode",ne,ie)})}return ne}},modes:function(ne){return ne&&"read"!=ne&&"edit"!=ne?null:void(this._modes=ne,ne&&this.mode!=ne&&(this.mode=ne))},deleted:function(ne){var oe=this;this.element.classList.toggle("mv-deleted",ne),ne?(this.elementContents=document.createDocumentFragment(),te(this.element.childNodes).forEach(function(ie){oe.elementContents.appendChild(ie)}),ee.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){ee.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(){return oe.deleted=!1}}}]),this.element.classList.remove("mv-highlight")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"))}},static:{maxId:0,all:new WeakMap,create:function(ne,oe){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return Mavo.is("multiple",ne)&&!ie.collection?new Mavo.Collection(ne,oe,ie):new Mavo[Mavo.is("group",ne)?"Group":"Primitive"](ne,oe,ie)},getProperty:function(ne){var oe=ne.getAttribute("property")||ne.getAttribute("itemprop");return!oe&&ne.hasAttribute("property")&&(oe=ne.name||ne.id||ne.classList[0]),oe&&ne.setAttribute("property",oe),oe},get:function(ne,oe){var ie=(re.all.get(ne)||[]).filter(function(se){return!(se instanceof Mavo.Collection)});return 2>ie.length||!oe?ie[0]:ie[0]instanceof Mavo.Group?node[1]:void 0},children:function(ne){var oe=Mavo.Node.get(ne);return oe?[oe]:(oe=te(Mavo.selectors.property,ne).map(function(ie){return Mavo.Node.get(ie)}).filter(function(ie){return!ne.contains(ie.parentGroup.element)}).map(function(ie){return ie.collection||ie}),Mavo.Functions.unique(oe))}}})})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Group=ee.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){var se=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});te(Mavo.selectors.property,this.element).forEach(function(ue){var pe=Mavo.Node.getProperty(ue);if(se.contains(ue)){var ce=se.children[pe],he=se.template?se.template.children[pe]:null,ge={template:he,group:se};if(ce){var ve=ce;ce instanceof Mavo.Collection||(ve=new Mavo.Collection(ce.element,se.mavo,ge),se.children[pe]=ce.collection=ve,ve.add(ce)),!ve.mutable&&Mavo.is("multiple",ue)&&(ve.mutable=!0),ve.add(ue)}else{var fe=Mavo.Node.create(ue,se.mavo,ge);se.children[pe]=fe}}});var de=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=de.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(){var ne=this,oe=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"Node";return Object.keys(this.children).filter(function(ie){return ne.children[ie]instanceof Mavo[oe]})},getData:function(){var ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:this.super.getData.call(this,ne)};return void 0===oe.data?(oe.data={},this.propagate(function(ie){if((ie.saved||"*"==ne.store)&&!(ie.property in oe.data)){var se=ie.getData(ne);(null!==se||oe.options.null)&&(oe.data[ie.property]=se)}}),ee.extend(oe.data,this.unhandled),this.type&&this.type!=re.DEFAULT_TYPE&&(oe.data["@type"]=this.type),this.vocab&&(oe.data["@context"]=this.vocab),oe.data.summary&&(oe.data.toString=function(){return this.summary}),"*"!=ne.store&&this.inPath.length&&(oe.data=Mavo.subset(this.data,this.inPath,oe.data)),Mavo.hooks.run("node-getdata-end",oe),oe.data):oe.data},find:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(this.property==ne)return this;if(ne in this.children)return this.children[ne].find(ne,oe);var ie=[];for(var se in this.children){var le=this.children[se].find(ne,oe);if(le!==void 0)if(Array.isArray(le))ie.push.apply(ie,_toConsumableArray(le));else return le}if(ie.length)return ie},save:function(){this.unsavedChanges=!1},propagated:["save","import","clear"],dataRender:function(ne){var oe=this;if(ne){var ie=this.unhandled;for(var se in this.unhandled=ee.extend({},ne,function(de){return!(de in oe.children)}),this.propagate(function(de){de.render(ne[de.property])}),this.unhandled){var le=this.unhandled[se];"object"==("undefined"==typeof le?"undefined":_typeof(le))||ie&&ie[se]==le||this.dataChanged("propertychange",{property:se})}}},contains:function(ne){return ne instanceof Mavo.Node?ne.parentGroup===this:ne.parentNode&&this.element===ne.parentNode.closest(Mavo.selectors.group)},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(ne){if(Mavo.is("group",ne)){var oe=Mavo.getAttribute(ne,"typeof","itemtype")||re.DEFAULT_TYPE;return ne.setAttribute("typeof",oe),oe}return null}}})})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Primitive=ee.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(ne){var se=this;if(this.fromTemplate("config","attribute","templateValue")||(this.config=re.getConfig(ne),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&ee.events(this.element,this.config.changeEvents,function(de){de.target===se.element&&(se.value=se.getValue())}),this.editor||this.attribute||(this.editor=te(this.element.children).filter(function(de){return de.matches(Mavo.selectors.formControl)&&!de.matches(Mavo.selectors.property)})[0],this.editor&&(this.element.textContent=this.editorValue,ee.remove(this.editor))),!this.editor&&this.element.hasAttribute("mv-edit")){var le=ee(this.element.getAttribute("mv-edit"));le&&Mavo.is("formControl",le)&&(this.editor=le.cloneNode(!0),!this.template&&new Mavo.Observer(le,"all",function(){var ce,ue=!0,pe=!1;try{for(var ge,ve,he=se.copies[Symbol.iterator]();!(ue=(ge=he.next()).done);ue=!0)ve=ge.value,ve.editor=le.cloneNode(!0),ve.setValue(ve.value,{force:!0,silent:!0})}catch(fe){pe=!0,ce=fe}finally{try{!ue&&he.return&&he.return()}finally{if(pe)throw ce}}}))}this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this._default="read"===this.modes?this.templateValue:this.editor?this.editorValue:void 0:""===this.default?this._default=this.templateValue:this.defaultObserver=new Mavo.Observer(this.element,"mv-default",function(){se.default=se.element.getAttribute("mv-default")}),this.initialValue=(this.template||void 0!==this.default?this.default:this.templateValue)||this.emptyValue,this.setValue(this.initialValue,{silent:!0}),this.observer=new Mavo.Observer(this.element,this.attribute,function(){(se.attribute||!se.editing)&&(se.value=se.getValue())}),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){if(this.config.getEditorValue)return this.config.getEditorValue.call(this);if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return re.getValue(this.editor,{datatype:this.datatype});var ae=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(ae)return re.getValue(ae)}},set editorValue(ae){if(this.config.setEditorValue)return this.config.setEditorValue.call(this,ae);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))re.setValue(this.editor,ae,{config:this.editorDefaults});else{var ne=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);ne&&re.setValue(ne,ae)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(){var ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:this.super.getData.call(this,ne)};return void 0===oe.data?(oe.data=this.value,""===oe.data&&(oe.data=null),"*"!=ne.store&&this.inPath.length&&(oe.data=Mavo.subset(this.data,this.inPath,oe.data)),Mavo.hooks.run("node-getdata-end",oe),oe.data):oe.data},sneak:function(ne){return Mavo.Observer.sneak(this.observer,ne)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){var ne=this;if(!this.editor){var oe=this.config.editor||Mavo.Elements.defaultEditors[this.datatype]||Mavo.Elements.defaultEditors.string;this.editor=ee.create("function"===ee.type(oe)?oe.call(this):oe),this.editorValue=this.value}ee.events(this.editor,{"input change":function(){ne.value=ne.editorValue},focus:function(){ne.editor.select&&ne.editor.select()},"mavo:datachange":function(le){"output"===le.property&&(le.stopPropagation(),ee.fire(ne.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var ie=/^mv-edit-/i;te(this.element.attributes).forEach(function(se){ie.test(se.name)&&this.editor.setAttribute(se.name.replace(ie,""),se.value)},this),(this.attribute||this.config.popup)&&(this.popup=new re.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var ne=this;return!1!==this.super.edit.call(this)&&(this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0,this.element.addEventListener("click.mavo:edit",function(oe){return oe.preventDefault()}),this.preEdit=Mavo.defer(function(oe){if(ne.empty&&!ne.attribute)return oe();var se;ee.events(ne.element,{"click.mavo:preedit":oe,"focus.mavo:preedit":oe}),ne.attribute||ee.events(ne.element,{"mouseenter.mavo:preedit":function(){clearTimeout(se),se=setTimeout(oe,150)},"mouseleave.mavo:preedit":function(){clearTimeout(se)}})}),this.config.edit?void this.config.edit.call(this):void this.preEdit.then(function(){ee.unbind(ne.element,".mavo:preedit"),ne.initEdit&&ne.initEdit(),ne.popup&&ne.popup.show(),ne.attribute||ne.popup||ne.editor.parentNode==ne.element||(ne.editorValue=ne.value,ne.element.textContent="",ne.element.appendChild(ne.editor))}))},done:function(){var ne=this;return!1!==this.super.done.call(this)&&void("preEdit"in this&&ee.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return ne.config.done?void ne.config.done.call(ne):void(ne.popup?ne.popup.close():!ne.attribute&&ne.editor&&(ee.remove(ne.editor),ne.element.textContent=ne.editorValue))}),null===this.element._.data.prevTabindex?this.element.removeAttribute("tabindex"):this.element.tabIndex=this.element._.data.prevTabindex)},clear:function(){"read"!=this.modes&&(this.value=this.emptyValue)},dataRender:function(ne){if(ne&&"object"===("undefined"==typeof ne?"undefined":_typeof(ne)))if(Symbol.toPrimitive in ne)ne=ne[Symbol.toPrimitive]();else for(var se,oe=[this.property,"value"].concat(_toConsumableArray(Object.keys(ne))),ie=0;ie<oe.length;ie++)if(se=oe[ie],se in ne){ne=ne[se],this.inPath.push(se);break}this.value=void 0===ne?this.closestCollection?this.default:this.templateValue:ne},find:function(ne){if(this.property==ne)return this},getValue:function(){return re.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&re.getConfig(this.editor)}},setValue:function(ne){var oe=this,ie=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.sneak(function(){if("object"==ee.type(ne)&&"value"in ne){var se=ne.presentational;ne=ne.value}return ne=ne||0===ne?ne:"",oe.datatype||"number"!=typeof ne&&"boolean"!=typeof ne||(oe.datatype="undefined"==typeof ne?"undefined":_typeof(ne)),ne=re.safeCast(ne,oe.datatype),ne!=oe._value||ie.force?void(oe.editor&&document.activeElement!=oe.editor&&(oe.editorValue=ne),oe.config.humanReadable&&oe.attribute&&(se=oe.config.humanReadable.call(oe,ne)),(!oe.editing||oe.popup||!oe.editor)&&(oe.config.setValue?oe.config.setValue.call(oe,oe.element,ne):(oe.editor&&oe.editor.matches("select")&&oe.editor.selectedOptions[0]&&(se=oe.editor.selectedOptions[0].textContent),!ie.dataOnly&&re.setValue(oe.element,{value:ne,presentational:se},{config:oe.config,attribute:oe.attribute,datatype:oe.datatype}))),oe.empty=""===ne,oe._value=ne,!ie.silent&&(oe.saved&&(oe.unsavedChanges=oe.mavo.unsavedChanges=!0),oe.dataChanged("propertychange",{value:ne}))):ne}),ne},dataChanged:function(){var ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"propertychange",oe=arguments[1];return this.super.dataChanged.call(this,ne,oe)},live:{default:function(ne){this.value==this._default&&(this.value=ne)},value:function(ne){return this.setValue(ne)},empty:function(ne){var oe=ne&&!this.modes&&this.config.default&&!(this.attribute&&ee(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!oe)}},static:{all:new WeakMap,getValueAttribute:function(ne){var oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mavo.Elements.search(ne),ie=ne.getAttribute("mv-attribute")||oe.attribute;return ie&&"null"!==ie||(ie=null),ie},safeCast:function(ne,oe){var ie="undefined"==typeof ne?"undefined":_typeof(ne),se=re.cast(ne,oe);return null===ne||void 0===ne?ne:"boolean"==oe?"false"===ne||0===ne||""===ne?!1:"true"===ne||0<ne||ne:"number"==oe?/^[-+]?[0-9.e]+$/i.test(ne+"")?se:ne:se},cast:function(ne,oe){return"number"===oe?+ne:"boolean"===oe?!!ne:"string"===oe?ne+"":ne},getValue:function(ne,oe){var ie=oe.config,se=oe.attribute,le=oe.datatype;if(ie||(ie=re.getConfig(ne,se)),se=ie.attribute,le=ie.datatype,ie.getValue&&se==ie.attribute)return ie.getValue(ne);var de;return de=se in ne&&re.useProperty(ne,se)?ne[se]:se?ne.getAttribute(se):ne.getAttribute("content")||ne.textContent||null,re.safeCast(de,le)},getConfig:function(ne,oe){void 0===oe&&(oe=ne.getAttribute("mv-attribute")||void 0),("null"==oe||"none"==oe)&&(oe=null);var ie=Mavo.Elements.search(ne,oe);return void 0===ie.attribute&&(ie.attribute=oe||null),ie},setValue:function(ne,oe,ie){var se=ie.config,le=ie.attribute,de=ie.datatype;if("object"==ee.type(oe)&&"value"in oe){var ue=oe.presentational;oe=oe.value}if(1===ne.nodeType&&(se||(se=re.getConfig(ne,le)),le=se.attribute,de=void 0===de?se.datatype:de,se.setValue&&le==se.attribute))return se.setValue(ne,oe);if(le){if(le in ne&&re.useProperty(ne,le)&&ne[le]!==oe)try{ne[le]=oe}catch(pe){}"boolean"==de?oe!=ne.hasAttribute(le)&&ee.toggleAttribute(ne,le,oe,oe):ne.getAttribute(le)!=oe&&(ne.setAttribute(le,oe),ue&&(ne.textContent=ue))}else"number"!==de||ue||(ue=re.formatNumber(oe)),ne.textContent=ue||oe,ue&&ne.setAttribute&&ne.setAttribute("content",oe)},useProperty:function(ne,oe){return!(-1<["href","src"].indexOf(oe))&&"http://www.w3.org/2000/svg"!=ne.namespaceURI},lazy:{formatNumber:function(){var ne=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(oe){return oe===Infinity||oe===-Infinity?0>oe?"-\u221E":"\u221E":ne.format(oe)}}}}});re.Popup=ee.Class({constructor:function(ne){var oe=this;this.primitive=ne,this.popup=ee.create("div",{className:"mv-popup",hidden:!0,contents:[this.primitive.label+":",this.editor],events:{keyup:function(se){(13==se.keyCode||27==se.keyCode)&&(oe.popup.contains(document.activeElement)&&oe.element.focus(),se.stopPropagation(),oe.hide())}}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var ne=this;ee.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(oe){ne.popup.contains(oe.target)||ne.element.contains(oe.target)||ne.hide()},this.position=function(){var ie=ne.element.getBoundingClientRect(),se=ie.left,le=ie.bottom;ee.style(ne.popup,{top:le+"px",left:se+"px"})},this.position(),document.body.appendChild(this.popup),requestAnimationFrame(function(){return ne.popup.removeAttribute("hidden")}),ee.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var ne=this;ee.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){ee.remove(ne.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),ee.events(this.element,{"click.mavo:showpopup":function(){ne.show()},"keyup.mavo:showpopup":function(ie){-1<[13,113].indexOf(ie.keyCode)&&(ne.show(),ne.editor.focus())}})},close:function(){this.hide(),ee.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})})(Bliss,Bliss.$),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};(function(ee){var re=Mavo.Elements={};Object.defineProperties(re,{register:{value:function(ne){if("object"===_typeof(arguments[0])){for(var ie in arguments[0])re.register(ie,arguments[0][ie]);return}var se=Mavo.toArray(arguments[1]),le=!0,de=!1,ue;try{for(var ce,pe=se[Symbol.iterator]();!(le=(ce=pe.next()).done);le=!0){config=ce.value,config.attribute=Mavo.toArray(config.attribute||null);var he=!0,ge=!1,ve=void 0;try{for(var ye,fe=config.attribute[Symbol.iterator]();!(he=(ye=fe.next()).done);he=!0){attribute=ye.value;var be=ee.extend({},config);be.attribute=attribute,re[ne]=re[ne]||[],re[ne].push(be)}}catch(xe){ge=!0,ve=xe}finally{try{!he&&fe.return&&fe.return()}finally{if(ge)throw ve}}}}catch(xe){de=!0,ue=xe}finally{try{!le&&pe.return&&pe.return()}finally{if(de)throw ue}}return re}},search:{value:function(ne,oe,ie){var se=re.matches(ne,oe,ie);return se[se.length-1]||{attribute:oe}}},matches:{value:function(ne,oe,ie){var se=[];selectorloop:for(var le in re)if(ne.matches(le)){var de=re[le],ue=!0,pe=!1,ce=void 0;try{for(var ge,he=de[Symbol.iterator]();!(ue=(ge=he.next()).done);ue=!0){var ve=ge.value,fe=oe===void 0&&ve.default||oe===ve.attribute;fe&&(void 0===ie||"string"===ie||ie===ve.datatype)&&(!ve.test||ve.test(ne,oe,ie))&&se.push(ve)}}catch(ye){pe=!0,ce=ye}finally{try{!ue&&he.return&&he.return()}finally{if(pe)throw ce}}}return se}},isSVG:{value:function(ne){return"http://www.w3.org/2000/svg"==ne.namespaceURI}},defaultEditors:{value:{string:{tag:"input"},number:{tag:"input",type:"number"},boolean:{tag:"input",type:"checkbox"}}}}),re.register({"*":[{test:function(ne,oe){return"hidden"==oe},attribute:"hidden",datatype:"boolean"},{test:re.isSVG,attribute:"y",datatype:"number"},{default:!0,test:re.isSVG,attribute:"x",datatype:"number"}],"img, video, audio":{default:!0,attribute:"src",editor:{tag:"input",type:"url",placeholder:"http://example.com"}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},"select, input":{attribute:"value",default:!0,modes:"read",changeEvents:"input change"},textarea:{default:!0,modes:"read",changeEvents:"input",getValue:function(ne){return ne.value},setValue:function(ne,oe){return ne.value=oe}},"input[type=range], input[type=number]":{default:!0,attribute:"value",datatype:"number",modes:"read",changeEvents:"input change"},"input[type=checkbox]":{default:!0,attribute:"checked",datatype:"boolean",modes:"read",changeEvents:"click"},"input[type=radio]":{default:!0,attribute:"checked",modes:"read",getValue:function(ne){if(ne.form)return ne.form[ne.name].value;var oe=ee("input[type=radio][name=\""+ne.name+"\"]:checked");return oe&&oe.value},setValue:function(ne,oe){if(ne.form)return void(ne.form[ne.name].value=oe);var ie=ee("input[type=radio][name=\""+ne.name+"\"][value=\""+oe+"\"]");ee.properties(ie,{checked:!0})},init:function(ne){var oe=this;this.mavo.element.addEventListener("change",function(ie){ie.target.name==ne.name&&(oe.value=oe.getValue())})}},"button, .counter":{default:!0,attribute:"mv-clicked",datatype:"number",modes:"read",init:function(ne){var oe=this;"mv-clicked"===this.attribute&&(ne.setAttribute("mv-clicked","0"),ne.addEventListener("click",function(){var se=+ne.getAttribute("mv-clicked")||0;oe.value=++se}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var ne=this,oe=+this.element.getAttribute("min")||0,ie=+this.element.getAttribute("max")||1,se=ie-oe,le=+this.element.getAttribute("mv-edit-step")||(1<se?1:se/100);this.element.addEventListener("mousemove.mavo:edit",function(de){var ue=ne.element.getBoundingClientRect().left,pe=Math.max(0,(de.clientX-ue)/ne.element.offsetWidth),ce=oe+se*pe,he=ce%le;ce+=he>le/2?le-he:-he,ce=Math.max(oe,Math.min(ce,ie)),ne.sneak(function(){return ne.element.setAttribute("value",ce)})}),this.element.addEventListener("mouseleave.mavo:edit",function(){ne.sneak(function(){return ne.element.setAttribute("value",ne.value)})}),this.element.addEventListener("click.mavo:edit",function(){ne.value=ne.getValue()}),this.element.addEventListener("keydown.mavo:edit",function(de){if(de.target==ne.element&&(37==de.keyCode||39==de.keyCode)){var ue=le*(39==de.keyCode?1:-1)*(de.shiftKey?10:1),pe=ne.value+ue;pe=Math.max(oe,Math.min(pe,ie)),ne.element.setAttribute("value",pe)}})},done:function(){ee.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address":{default:!0,editor:function(){var ne=getComputedStyle(this.element).display,oe=0===ne.indexOf("inline")?"input":"textarea",ae=ee.create(oe);if("textarea"==oe){var ie=this.element.offsetWidth;ie&&(ae.width=ie)}return ae},setEditorValue:function(ne){if(!(this.datatype&&"string"!=this.datatype)){var oe=getComputedStyle(this.element);return ne=ne||"",-1<["normal","nowrap"].indexOf(oe.whiteSpace)&&(ne=ne.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(oe.whiteSpace)&&(ne=ne.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=ne,!0}}},time:{attribute:"datetime",default:!0,editor:function(){var ne={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},oe=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var ie in ne)if(ne[ie].test(oe))break;return{tag:"input",type:ie}},humanReadable:function(ne){var oe=new Date(ne);if(!ne||isNaN(oe))return"(No "+this.label+")";var ie={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},se=ie[this.editor&&this.editor.type]||ie.date;return se.timeZone="UTC",oe.toLocaleString("en-GB",se)}},circle:[{default:!0,attribute:"r",datatype:"number"},{attribute:["cx","cy"],datatype:"number"}],text:{default:!0,popup:!0}})})(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var re=Mavo.Collection=ee.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){if(this.templateElement=this.element,this.children=[],this.fromTemplate("properties","mutable","templateElement","accepts")||(this.properties=te(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0)),this.mutable){var se=this.createItem(this.element);this.add(se),this.itemTemplate=se.template||se}this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var le,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},oe={context:this,options:ne,data:[]},ie=!0,se=!1;try{for(var ue,de=this.children[Symbol.iterator]();!(ie=(ue=de.next()).done);ie=!0)if(item=ue.value,!item.deleted||ne.null){var pe=item.getData(oe.options);(pe||ne.null)&&oe.data.push(pe)}}catch(ce){se=!0,le=ce}finally{try{!ie&&de.return&&de.return()}finally{if(se)throw le}}return this.unhandled&&(oe.data=this.unhandled.before.concat(oe.data,this.unhandled.after)),this.mutable||1!=oe.data.length||(oe.data=oe.data[0]),Mavo.hooks.run("node-getdata-end",oe),oe.data},createItem:function(ne){ne||(ne=this.templateElement.cloneNode(!0));var oe=Mavo.Node.create(ne,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return oe},add:function(ne,oe){var ie=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(ne=ne instanceof Node?Mavo.Node.get(ne)||this.createItem(ne):ne||this.createItem(),ne.collection!=this&&this.adopt(ne),this.mutable){var se=this.children[oe]?this.children[oe].element:this.marker;ee[this.bottomUp?"after":"before"](ne.element,se),void 0===oe&&(oe=this.bottomUp?0:this.length)}var le={context:this,item:ne};return le.previousIndex=ne.index,le.changed=this.splice({remove:le.item},{index:oe,add:le.item}),ie.silent||(le.changed.forEach(function(de){de.dataChanged(de==le.item&&void 0===le.previousIndex?"add":"move"),de.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0),Mavo.hooks.run("collection-add-end",le),le.item},splice:function(){for(var ne=arguments.length,oe=Array(ne),ie=0;ie<ne;ie++)oe[ie]=arguments[ie];var se=!0,le=!1,de;try{for(var pe,ce,ue=oe[Symbol.iterator]();!(se=(pe=ue.next()).done);se=!0)ce=pe.value,void 0===ce.index&&ce.remove&&isNaN(ce.remove)&&(ce.index=this.children.indexOf(ce.remove),ce.remove=1)}catch(Ae){le=!0,de=Ae}finally{try{!se&&ue.return&&ue.return()}finally{if(le)throw de}}oe.sort(function(Ae,Ne){return Ne.index-Ae.index});var he=!0,ge=!1,ve;try{for(var ye,be,fe=oe[Symbol.iterator]();!(he=(ye=fe.next()).done);he=!0)if(be=ye.value,-1<be.index&&(be.remove||be.add)){var xe;be.remove=be.remove||0,be.add=Mavo.toArray(be.add),(xe=this.children).splice.apply(xe,[be.index,+be.remove].concat(_toConsumableArray(be.add)))}}catch(Ae){ge=!0,ve=Ae}finally{try{!he&&fe.return&&fe.return()}finally{if(ge)throw ve}}for(var ke,Ce=[],Ee=0;Ee<this.length;Ee++)ke=this.children[Ee],ke&&ke.index!==Ee&&(ke.index=Ee,Ce.push(ke));return Ce},adopt:function(ne){var oe=this;ne.collection&&(ne.collection.splice({remove:ne}),ne.collection.dataChanged("delete")),this.walk(function(ie){ie.closestCollection===ne.collection&&(ie.closestCollection=oe),ne.mavo!=oe.mavo&&(ne.mavo=oe.mavo)}),ne.collection=this,ne.template&&(Mavo.delete(ne.template.copies,ne),ne.template=this.itemTemplate)},delete:function(ne,oe){var ie=this;return oe?(ee.remove(ne.element),this.splice({remove:ne}),void ne.destroy()):ee.transition(ne.element,{opacity:0}).then(function(){ne.deleted=!0,ne.element.style.opacity="",ne.dataChanged("delete"),ie.unsavedChanges=ne.unsavedChanges=ie.mavo.unsavedChanges=!0})},move:function(ne,oe){index=ne.index+oe+(0<oe),0>index?index=this.children.length:index>this.children.length&&(index=0),this.add(ne,index)},editItem:function(ne){var oe=this;ne.itemControls||(ne.itemControls=te(".mv-item-controls",ne.element).filter(function(ie){return ie.closest(Mavo.selectors.multiple)==ne.element&&!Mavo.data(ie,"item")})[0],ne.itemControls=ne.itemControls||ee.create({className:"mv-item-controls mv-ui"}),Mavo.data(ne.itemControls,"item",ne),ee.set(ne.itemControls,{contents:[{tag:"button",title:"Delete this "+ne.name,className:"mv-delete",events:{click:function(){return ne.collection.delete(ne)}}},{tag:"button",title:"Add new "+ne.name.replace(/s$/i,"")+" "+(this.bottomUp?"after":"before"),className:"mv-add",events:{click:function(se){var le=oe.add(null,ne.index);return se[Mavo.superKey]&&le.render(ne.data),Mavo.scrollIntoViewIfNeeded(le.element),oe.editItem(le)}}},{tag:"button",title:"Drag to reorder "+ne.name,className:"mv-drag-handle",events:{click:function(se){return se.target.focus()},keydown:function(se){37<=se.keyCode&&40>=se.keyCode&&(oe.move(ne,38>=se.keyCode?-1:1),se.stopPropagation(),se.preventDefault(),se.target.focus())}}}]})),ne.itemControls.parentNode||Mavo.revocably.add(ne.itemControls)||(ne instanceof Mavo.Primitive&&!ne.attribute?(ne.itemControls.classList.add("mv-adjacent"),ee.after(ne.itemControls,ne.element)):ne.element.appendChild(ne.itemControls)),ne.edit()},edit:function(){var ne=this;if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var oe=this.element.tagName.toLowerCase(),ie=Mavo.selectors.container[oe],se=ie?this.marker.parentNode.closest(ie):this.marker;ee[this.bottomUp?"before":"after"](this.addButton,se)}this.propagate(function(le){ne.editItem(le)}),re.dragula.then(function(){ne.getDragula()})}},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(function(ne){return Mavo.revocably.remove(ne.itemControls,"item controls")})))},clear:function(){this.mutable&&(this.propagate(function(ne){ne.element.remove(),ne.destroy()}),this.children=[],this.dataChanged("clear"))},dataChanged:function(ne){var oe=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return oe.element=oe.element||this.marker,this.super.dataChanged.call(this,ne,oe)},save:function(){var ne=!0,oe=!1,ie;try{for(var le,de,se=this.children[Symbol.iterator]();!(ne=(le=se.next()).done);ne=!0)de=le.value,de.deleted?this.delete(de,!0):de.unsavedChanges=!1}catch(ue){oe=!0,ie=ue}finally{try{!ne&&se.return&&se.return()}finally{if(oe)throw ie}}},propagated:["save"],dataRender:function(ne){if(this.unhandled={before:[],after:[]},!!ne)if(ne=Mavo.toArray(ne),!this.mutable)this.children.forEach(function(ue,pe){return ue.render(ne&&ne[pe])}),ne&&(this.unhandled.after=ne.slice(this.length));else{for(var oe=0;oe<this.children.length;oe++)oe<ne.length?this.children[oe].render(ne[oe]):this.delete(this.children[oe],!0);if(ne.length>oe){for(var le,ie=document.createDocumentFragment(),se=oe;se<ne.length;se++){le=this.createItem(),le.render(ne[se]),this.children.push(le),le.index=se,ie.appendChild(le.element);var de={context:this,item:le};Mavo.hooks.run("collection-add-end",de)}this.bottomUp?ee.after(ie,0<oe?this.children[oe-1].element:this.marker):ee.before(ie,this.marker)}}},find:function(ne){var oe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},ie=this.children.filter(function(le){return!le.deleted});if(this.property==ne)return oe.collections?this:ie;if(-1<this.properties.indexOf(ne)){var se=ie.map(function(le){return le.find(ne,oe)});return Mavo.flatten(se)}},isCompatible:function(ne){return ne&&this.itemTemplate.nodeType==ne.itemTemplate.nodeType&&(ne===this||ne.template==this||this.template==ne||this.template&&this.template==ne.template||-1<this.accepts.indexOf(ne.property))},live:{mutable:function(ne){ne&&ne!==this.mutable&&(this._mutable=ne,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),ee.after(this.marker,this.templateElement))}},getDragula:function(){var ne=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(se){return!!ne.accepts.length&&-1<Mavo.flatten(ne.accepts.map(function(le){return ne.mavo.root.find(le,{collections:!0})})).filter(function(le){return le&&le instanceof re}).map(function(le){return le.marker.parentNode}).indexOf(se)},moves:function(se,le,de){return de.classList.contains("mv-drag-handle")&&de.closest(Mavo.selectors.multiple)==se},accepts:function(se,le,de,ue){if(se.contains(le))return!1;var pe=ue?ue.previousElementSibling:le.lastElementChild,ce=re.get(pe)||re.get(ue);if(!ce)return!1;var he=Mavo.Node.get(se);return he&&he.collection.isCompatible(ce)}}),this.dragula.on("drop",function(ie){var de=Mavo.Node.get(ie),ue=de&&de.index,pe=ie.nextElementSibling,ce=ie.previousElementSibling,he=re.get(ce)||re.get(pe),ge=Mavo.Node.get(ce)||Mavo.Node.get(pe);if(ge&&ge.collection!=he&&(ge=null),de.collection.isCompatible(he)){var ve=ge?ge.index+(ge.element===ce):he.length;he.add(de,ve)}else return ne.dragula.cancel(!0)}),re.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var ne=this.templateElement.getAttribute("mv-order");return null===ne?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(ne)},closestCollection:function(){var ne=this.marker?this.marker.parentNode:this.templateElement.parentNode;return ne.closest(Mavo.selectors.multiple)},addButton:function(){var ne=this,oe="button.mv-add-"+this.property,ie=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(ie)var se=te(oe,ie).filter(function(le){return!ne.templateElement.contains(le)})[0];return se||(se=ee.create("button",{className:"mv-add",textContent:"Add "+this.name})),se.classList.add("mv-ui","mv-add"),Mavo.data(se,"collection",this),this.property&&se.classList.add("mv-add-"+this.property),se.addEventListener("click",function(le){le.preventDefault(),ne.editItem(ne.add())}),se}},static:{dragulas:[],get:function(ne){var oe=Mavo.data(ne,"collection");if(oe)return oe;var ie=Mavo.Node.get(ne);return ie&&ie.collection||null},lazy:{dragula:function(){return ee.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}})})(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee){Mavo.attributes.push("mv-expressions");var te=Mavo.Expression=ee.Class({constructor:function(ae){this.expression=ae},eval:function(ae){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this.function||(this.function=te.compile(this.expression),this.identifiers=this.expression.match(/[$a-z][$\w]*/ig)||[]),this.value=this.function(ae)}catch(ne){console.info("%cExpression error!","color: red; font-weight: bold",ne.message+" in expression "+this.expression),Mavo.hooks.run("expression-eval-error",{context:this,exception:ne}),this.value=ne}return this.value},toString:function(){return this.expression},changedBy:function(ae){if(!ae)return!0;if(!this.identifiers)return!1;if(-1<this.identifiers.indexOf(ae.property))return!0;if(Mavo.hasIntersection(ae.properties,this.identifiers))return!0;if("propertychange"!=ae.action){if(Mavo.hasIntersection(["$index","$all","$previous","$next"],this.identifiers))return!0;var ne=ae.node.collection||ae.node;if(Mavo.hasIntersection(ne.properties,this.identifiers))return!0}return!!Mavo.hasIntersection(Mavo.allIds,this.identifiers)},live:{expression:function(ae){ae=ae;this.function=null}},static:{serializers:{BinaryExpression:function(ae){return te.serialize(ae.left)+" "+ae.operator+" "+te.serialize(ae.right)},UnaryExpression:function(ae){return""+ae.operator+te.serialize(ae.argument)},CallExpression:function(ae){return te.serialize(ae.callee)+"("+ae.arguments.map(te.serialize).join(", ")+")"},ConditionalExpression:function(ae){return te.serialize(ae.test)+"? "+te.serialize(ae.consequent)+" : "+te.serialize(ae.alternate)},MemberExpression:function(ae){return"get("+te.serialize(ae.object)+", \""+(ae.property.name||ae.property.value)+"\")"},ArrayExpression:function(ae){return"["+ae.elements.map(te.serialize).join(", ")+"]"},Literal:function(ae){return ae.raw},Identifier:function(ae){return ae.name},ThisExpression:function(){return"this"},Compound:function(ae){return ae.body.map(te.serialize).join(" ")}},transformations:{BinaryExpression:function(ae){var ne=Mavo.Script.getOperatorName(ae.operator),oe=Mavo.Script.operators[ne],ie=ae,se=[];do se.unshift(ie.right),ie=ie.left;while(Mavo.Script.getOperatorName(ie.operator)===ne);if(se.unshift(ie),1<se.length)return ne+"("+se.map(te.serialize).join(", ")+")"},CallExpression:function(ae){"Identifier"==ae.callee.type&&"if"==ae.callee.name&&(ae.callee.name="iff")}},serialize:function(ae){if(te.transformations[ae.type]){var ne=te.transformations[ae.type](ae);if(ne!==void 0)return ne}return te.serializers[ae.type](ae)},rewrite:function(ae){try{return te.serialize(te.parse(ae))}catch(ne){return ae}},compile:function(ae){return ae=te.rewrite(ae),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\t\twith(data) {\n\t\t\t\t\t\treturn "+ae+";\n\t\t\t\t\t}")},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.addBinaryOp("mod",10),jsep.removeBinaryOp("===")),te.serializers.LogicalExpression=te.serializers.BinaryExpression,te.transformations.LogicalExpression=te.transformations.BinaryExpression,te.Syntax=ee.Class({constructor:function(ae,ne){this.start=ae,this.end=ne,this.regex=RegExp(Mavo.escapeRegExp(ae)+"([\\S\\s]+?)"+Mavo.escapeRegExp(ne),"gi")},test:function(ae){return this.regex.lastIndex=0,this.regex.test(ae)},tokenize:function(ae){var ne,oe=[],ie=0;for(this.regex.lastIndex=0;null!==(ne=this.regex.exec(ae));)ne.index>ie&&oe.push(ae.substring(ie,ne.index)),ie=this.regex.lastIndex,oe.push(new Mavo.Expression(ne[1]));return ie<ae.length&&oe.push(ae.substring(ie)),oe},static:{create:function(ae){if(ae){var ne=ae.getAttribute("mv-expressions");if(ne)return ne=ne.trim(),/\s/.test(ne)?new(Function.prototype.bind.apply(te.Syntax,[null].concat(_toConsumableArray(ne.split(/\s+/))))):te.Syntax.ESCAPE}},ESCAPE:-1}}),te.Syntax.default=new te.Syntax("[","]")})(Bliss),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee){var te=Mavo.DOMExpression=ee.Class({constructor:function(){var ae=this,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.mavo=ne.mavo,this.template=ne.template&&ne.template.template||ne.template;for(var se,oe=["item","path","syntax","fallback","attribute"],ie=0;ie<oe.length;ie++)se=oe[ie],this[se]=void 0===ne[se]&&this.template?this.template[se]:ne[se];if(this.node=ne.node,this.node||(this.node=this.path.reduce(function(de,ue){return de.childNodes[ue]},this.item.element)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),!this.expression){if(3===this.node.nodeType&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var le=this.node.firstChild.textContent.match(/^\s*|\s*$/g);le[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-le[1].length),ee.after(this.node.lastChild,this.node)),le[0]&&(this.node.firstChild.splitText(le[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=ne.template?ne.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(de){return de instanceof Mavo.Expression?de.expression:de}),this.mavo.treeBuilt.then(function(){ae.template||(ae.item=Mavo.Node.get(ae.element.closest(Mavo.selectors.multiple+", "+Mavo.selectors.group)),ae.item.expressions=[].concat(_toConsumableArray(ae.item.expressions||[]),[ae])),Mavo.hooks.run("domexpression-init-treebuilt",ae)}),Mavo.hooks.run("domexpression-init-end",this),te.elements.set(this.element,[].concat(_toConsumableArray(te.elements.get(this.element)||[]),[this]))},changedBy:function(ae){return!this.parsed.every(function(ne){return!(ne instanceof Mavo.Expression)||!ne.changedBy(ae)})},update:function(){var ae=this,ne=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data,oe=arguments[1],ie={context:this,ret:{},event:oe},se=ie;this.data=ne,ie.ret={},Mavo.hooks.run("domexpression-update-start",ie),this.oldValue=this.value,ie.ret.value=this.value=this.parsed.map(function(le,de){if(le instanceof Mavo.Expression){if(le.changedBy(se.event)){var ue={context:ae,expr:le,parentEnv:se};return Mavo.hooks.run("domexpression-update-beforeeval",ue),ue.value=ue.expr.eval(ne),Mavo.hooks.run("domexpression-update-aftereval",ue),ue.value instanceof Error?void 0===ae.fallback?ue.expr.expression:ae.fallback:void 0===ue.value||null===ue.value?"":ue.value}return ae.oldValue[de]}return le}),this.attribute||(ie.ret.presentational=this.value.map(function(le){return Array.isArray(le)?le.join(", "):"number"==typeof le?Mavo.Primitive.formatNumber(le):le}),ie.ret.presentational=1===ie.ret.presentational.length?ie.ret.presentational[0]:ie.ret.presentational.join("")),ie.ret.value=1===ie.ret.value.length?ie.ret.value[0]:ie.ret.value.join(""),this.primitive&&1===this.parsed.length&&("number"==typeof ie.ret.value?this.primitive.datatype="number":"boolean"==typeof ie.ret.value&&(this.primitive.datatype="boolean")),ie.ret.presentational===ie.ret.value&&(ret=ie.ret.value),this.output(ie.ret),Mavo.hooks.run("domexpression-update-end",ie)},output:function(ae){this.primitive?this.primitive.value=ae:(ae=ae.presentational||ae,Mavo.Primitive.setValue(this.node,ae,{attribute:this.attribute}))},static:{elements:new WeakMap,search:function(ae,ne){var oe=te.elements.get(ae)||[];return 1<arguments.length?oe.length?oe.filter(function(ie){return ie.attribute===ne})[0]||null:null:oe}}});Mavo.hooks.add("primitive-init-start",function(){var re=Mavo.DOMExpression.search(this.element,this.attribute);re&&!re.mavoNode&&(re.primitive=this,this.storage=this.storage||"none",this.modes="read")})})(Bliss),"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ee){return typeof ee}:function(ee){return ee&&"function"==typeof Symbol&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee};function _defineProperty(ee,te,re){return te in ee?Object.defineProperty(ee,te,{value:re,enumerable:!0,configurable:!0,writable:!0}):ee[te]=re,ee}function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(ee,te){var re=Mavo.Expressions=ee.Class({constructor:function(ne){var oe=this;this.mavo=ne,this.active=!0,this.expressions=[];var ie=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,ie),this.scheduled=new Set,this.mavo.treeBuilt.then(function(){oe.expressions=[],oe.mavo.element.addEventListener("mavo:datachange",function(se){oe.active&&("propertychange"==se.action&&se.node.closestCollection?!oe.scheduled.has(se.property)&&(setTimeout(function(){oe.scheduled.delete(se.property),oe.update(se)},re.PROPERTYCHANGE_THROTTLE),oe.scheduled.add(se.property)):requestAnimationFrame(function(){return oe.update(se)}))}),oe.update()})},update:function(ne){var oe=this,ie,se;ne instanceof Element&&(ie=ne.closest(Mavo.selectors.group),ne=null),ie=ie||this.mavo.element,se=Mavo.Node.get(ie);var le=se.getData({relative:!0,store:"*",null:!0});se.walk(function(de,ue){if(de.expressions&&de.expressions.length&&!de.isDeleted()){var pe={context:oe,data:ee.value.apply(ee,[le].concat(_toConsumableArray(ue)))};Mavo.hooks.run("expressions-update-start",pe);var ce=!0,he=!1,ge;try{for(var fe,ye,ve=de.expressions[Symbol.iterator]();!(ce=(fe=ve.next()).done);ce=!0)ye=fe.value,ye.changedBy(ne)&&ye.update(pe.data,ne)}catch(be){he=!0,ge=be}finally{try{!ce&&ve.return&&ve.return()}finally{if(he)throw ge}}}})},extract:function(ne,oe,ie,se){oe&&"mv-expressions"==oe.name||(oe&&-1<re.directives.indexOf(oe.name)||se.test(oe?oe.value:ne.textContent))&&this.expressions.push(new Mavo.DOMExpression({node:ne,syntax:se,path:ie?ie.slice(1).split("/").map(function(le){return+le}):[],attribute:oe&&oe.name,mavo:this.mavo}))},traverse:function(ne){var oe=this,ie=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",se=arguments[2];if(8!==ne.nodeType)if(3===ne.nodeType)this.extract(ne,null,ie,se);else{if(ne.normalize(),se=Mavo.Expression.Syntax.create(ne)||se,se===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("multiple",ne)&&(ie=""),te(ne.attributes).forEach(function(le){return oe.extract(ne,le,ie,se)}),te(ne.childNodes).forEach(function(le,de){return oe.traverse(le,ie+"/"+de,se)})}},static:{directives:[],PROPERTYCHANGE_THROTTLE:50,directive:function(ne,oe){re.directives.push(ne),Mavo.attributes.push(ne),Mavo.plugin(oe)}}});Mavo.hooks.add({"init-tree-before":function(){this.expressions=new Mavo.Expressions(this)},"node-init-end":function(){var ne=this,oe=this.template;oe&&oe.expressions&&(this.expressions=oe.expressions.map(function(ie){return new Mavo.DOMExpression({template:ie,item:ne,mavo:ne.mavo})}))},"render-start":function(){this.expressions.active=!1},"render-end":function(){this.expressions.active=!0,this.expressions.update()},"collection-add-end":function(ne){var oe=this;this.mavo.treeBuilt.then(function(){return oe.mavo.expressions.update(ne.item.element)})},"node-getdata-end":self.Proxy&&function(ae){var ne=this;if(ae.options.relative&&(ae.data&&"object"===_typeof(ae.data)||this.collection)){var oe=ae.data;if(this instanceof Mavo.Primitive){var ie;ae.data=(ie={},_defineProperty(ie,Symbol.toPrimitive,function(){return oe}),_defineProperty(ie,this.property,oe),ie)}ae.data=new Proxy(ae.data,{get:function(le,de,ue){if(de in le||de in ue&&de in le)return le[de]},has:function(le,de){if(de in le)return!0;if("$index"==de)return le[de]=ne.index||0,!0;if("$all"==de)return le[de]=ne.closestCollection?ne.closestCollection.getData(ae.options):[ae.data];if("$next"==de||"$previous"==de)return ne.closestCollection?le[de]=ne.closestCollection.getData(ae.options)[ne.index+("$next"==de?1:-1)]:(le[de]=null,null);if(de==ne.mavo.id)return le[de]=ne.mavo.root.getData(ae.options);if(ne instanceof Mavo.Group&&de==ne.property&&ne.collection)return le[de]=ae.data;var ue=ne.walkUp(function(pe){if(de in pe.children)return pe.children[de]});return void 0===ue&&(ue=ne.find(de)),void 0!==ue&&(Array.isArray(ue)?ue=ue.map(function(pe){return pe.getData(ae.options)}).filter(function(pe){return null!==pe}):ue instanceof Mavo.Node&&(ue=ue.getData(ae.options)),le[de]=ue,!0)},set:function(){throw Error("You can\u2019t set data via expressions.")}})}}})})(Bliss,Bliss.$),"use strict",function(ee,te){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(ae){this._hidden!==ae&&(this._hidden=ae,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var ae=this;if("mv-if"==this.attribute){var ne=te(Mavo.selectors.property,this.element).filter(function(oe){return oe.closest("[mv-if]")==ae.element}).map(function(oe){return Mavo.Node.get(oe)});return this.element.addEventListener("mavo:datachange",function(oe){requestAnimationFrame(function(){ae.element.parentNode||ae.item.element.dispatchEvent(oe)})}),ne}}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){var ae=this;if("mv-if"==this.attribute){var ne=this.value[0],oe=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(ae.parentIf){var ie=ae.parentIf.value[0];ae.value[0]=ne=ne&&ie}if(ne!==oe){if(!1!==ie&&(ne?Mavo.revocably.add(ae.element):ae.element.parentNode&&Mavo.revocably.remove(ae.element,"mv-if")),ae.childProperties){var de,se=!0,le=!1;try{for(var pe,ce,ue=ae.childProperties[Symbol.iterator]();!(se=(pe=ue.next()).done);se=!0)ce=pe.value,ce.hidden=!ne}catch(xe){le=!0,de=xe}finally{try{!se&&ue.return&&ue.return()}finally{if(le)throw de}}}if(ae.childIfs){var ve,he=!0,ge=!1;try{for(var ye,be,fe=ae.childIfs[Symbol.iterator]();!(he=(ye=fe.next()).done);he=!0)be=ye.value,be.update()}catch(xe){ge=!0,ve=xe}finally{try{!he&&fe.return&&fe.return()}finally{if(ge)throw ve}}}}})}},"unit-isdatanull":function(ae){ae.result=ae.result||this.hidden&&"*"==ae.options.store}}})}(Bliss,Bliss.$),"use strict";function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}Mavo.Expressions.directive("mv-value",{hooks:{"node-init-start":function(){if(this instanceof Mavo.Group||this.collection){var te=Mavo.DOMExpression.search(this.element).filter(function(re){return"mv-value"==re.originalAttribute})[0];te&&(te.mavoNode=this,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[].concat(_toConsumableArray(this.collection.expressions||[]),[te]),te.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}},"domexpression-init-start":function(){"mv-value"!=this.attribute||(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end)},"domexpression-init-treebuilt":function(){"mv-value"==this.originalAttribute&&this.mavoNode&&(this.mavoNode==this.item||this.mavoNode==this.item.collection)&&(this.mavoNode==this.item.collection&&Mavo.delete(this.item.expressions,this),this.output=function(te){te=te.value||te,this.mavoNode.render(te)},this.changedBy=function(){return!0})},"domexpression-update-start":function(){"mv-value"==this.originalAttribute&&this.mavoNode==this.item}}}),"use strict";var _slicedToArray=function(){function ee(te,re){var ae=[],ne=!0,oe=!1,ie;try{for(var le,se=te[Symbol.iterator]();!(ne=(le=se.next()).done)&&(ae.push(le.value),!(re&&ae.length===re));ne=!0);}catch(de){oe=!0,ie=de}finally{try{!ne&&se["return"]&&se["return"]()}finally{if(oe)throw ie}}return ae}return function(te,re){if(Array.isArray(te))return te;if(Symbol.iterator in Object(te))return ee(te,re);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(ee){if(Array.isArray(ee)){for(var te=0,re=Array(ee.length);te<ee.length;te++)re[te]=ee[te];return re}return Array.from(ee)}(function(){function ee(se,le){return se=Array.isArray(se)?se:le?$$(le):[se],se.filter(function(de){return!isNaN(de)&&""!==de}).map(function(de){return+de})}var te=Mavo.Functions={operators:{"=":"eq"},get $now(){return new Date},urlOption:function(){for(var le=("searchParams"in URL.prototype)?new URL(location).searchParams:null,de=null,ue=arguments.length,pe=Array(ue),ce=0;ce<ue;ce++)pe[ce]=arguments[ce];var ve,he=!0,ge=!1;try{for(var ye,be,fe=pe[Symbol.iterator]();!(he=(ye=fe.next()).done);he=!0){if(be=ye.value,le)de=le.get(be);else{var xe=location.search.match(RegExp("[?&]"+be+"(?:=([^&]+))?(?=&|$)","i"));de=xe&&(xe[1]||"")}if(null!==de)return de}}catch(Ce){ge=!0,ve=Ce}finally{try{!he&&fe.return&&fe.return()}finally{if(ge)throw ve}}return null},get:function(le,de){return le&&void 0!==le[de]?le[de]:null},unique:function(le){return[].concat(_toConsumableArray(new Set(le)))},sum:function(le){return ee(le,arguments).reduce(function(de,ue){return+de+(+ue||0)},0)},average:function(le){return le=ee(le,arguments),le.length&&te.sum(le)/le.length},min:function(le){return Math.min.apply(Math,_toConsumableArray(ee(le,arguments)))},max:function(le){return Math.max.apply(Math,_toConsumableArray(ee(le,arguments)))},count:function(le){return Mavo.toArray(le).filter(function(de){return null!==de&&!1!==de&&""!==de}).length},round:function(le,de){return le&&de&&isFinite(le)?+le.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:de}):Math.round(le)},iff:function(le,de){var ue=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return Array.isArray(le)?le.map(function(pe,ce){var he=pe?de:ue;return Array.isArray(he)?he[Math.min(ce,he.length-1)]:he}):le?de:ue},replace:function(le,de){var ue=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",pe=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(Array.isArray(le))return le.map(function(fe){return te.replace(fe,de,ue)});for(var ge,ce=RegExp(Mavo.escapeRegExp(de),"g"),he=le,ve=0;he!=ge&&ve++<pe;)ge=he,he=he.replace(ce,ue);return he},len:function(le){return(le||"").length},search:function(le,de){return le&&de?le.toLowerCase().indexOf(de.toLowerCase()):-1},starts:function(le,de){return 0===te.search(le,de)},ends:function(le,de){var ue=te.search(le,de);return-1<ue&&ue===le.length-de.length},join:function(le){var de=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return Mavo.toArray(le).join(de)},idify:function(le){return((le||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},readable:function(le){return le&&le.replace(/([a-z])([A-Z])(?=[a-z])/g,function(de,ue,pe){return ue+" "+pe.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(de){return de.toUpperCase()})},uppercase:function(le){return(le+"").toUpperCase()},lowercase:function(le){return(le+"").toLowerCase()}};for(var re in Mavo.Script={addUnaryOperator:function(le,de){return function(ue){return Array.isArray(ue)?ue.map(de.scalar):de.scalar(ue)}},addBinaryOperator:function(le,de){if(de.symbol){var ce,ue=!0,pe=!1;try{for(var ge,ve,he=Mavo.toArray(de.symbol)[Symbol.iterator]();!(ue=(ge=he.next()).done);ue=!0)ve=ge.value,Mavo.Script.symbols[ve]=le}catch(fe){pe=!0,ce=fe}finally{try{!ue&&he.return&&he.return()}finally{if(pe)throw ce}}}return de.identity=void 0===de.identity?0:de.identity,te[le]=de.code||function(){for(var fe=arguments.length,ye=Array(fe),be=0;be<fe;be++)ye[be]=arguments[be];1===ye.length&&Array.isArray(ye[0])&&(ye=[].concat(_toConsumableArray(ye[0])));for(var Ce,xe=de.logical?de.identity:ye[0],Ee=function(Ne){var Pe=de.logical?ye[Ne-1]:xe,we=ye[Ne];Array.isArray(we)?("number"==typeof de.identity&&(we=ee(we)),Ce=Array.isArray(Pe)?[].concat(_toConsumableArray(we.map(function(Le,Oe){return de.scalar(void 0===Pe[Oe]?de.identity:Pe[Oe],Le)})),_toConsumableArray(Pe.slice(we.length))):we.map(function(Le){return de.scalar(Pe,Le)})):("number"==typeof de.identity&&(we=+we),Ce=Array.isArray(Pe)?Pe.map(function(Le){return de.scalar(Le,we)}):de.scalar(Pe,we)),xe=de.reduce?de.reduce(xe,Ce,Pe,we):de.logical?xe&&Ce:Ce},ke=1;ke<ye.length;ke++)Ee(ke);return xe}},symbols:{},getOperatorName:function(le){return Mavo.Script.symbols[le]||le},operators:{not:{scalar:function(){return function(de){return!de}}},multiply:{scalar:function(le,de){return le*de},identity:1,symbol:"*"},divide:{scalar:function(le,de){return le/de},identity:1,symbol:"/"},add:{scalar:function(le,de){return+le+ +de},symbol:"+"},subtract:{scalar:function(le,de){return le-de},symbol:"-"},mod:{scalar:function(le,de){return le%de}},lte:{logical:!0,scalar:function(le,de){var ue=Mavo.Script.getNumericalOperands(le,de),pe=_slicedToArray(ue,2);return le=pe[0],de=pe[1],le<=de},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(le,de){var ue=Mavo.Script.getNumericalOperands(le,de),pe=_slicedToArray(ue,2);return le=pe[0],de=pe[1],le<de},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(le,de){var ue=Mavo.Script.getNumericalOperands(le,de),pe=_slicedToArray(ue,2);return le=pe[0],de=pe[1],le>=de},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(le,de){var ue=Mavo.Script.getNumericalOperands(le,de),pe=_slicedToArray(ue,2);return le=pe[0],de=pe[1],le>de},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(le,de){return le==de},symbol:["=","=="],identity:!0},neq:{logical:!0,scalar:function(le,de){return le!=de},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(le,de){return!!le&&!!de},identity:!0,symbol:"&&"},or:{logical:!0,scalar:function(le,de){return!!le||!!de},reduce:function(le,de){return le||de},identity:!1,symbol:"||"},concatenate:{symbol:"&",identity:"",scalar:function(le,de){return""+le+de}},filter:{scalar:function(le,de){return de?le:null}}},getNumericalOperands:function(le,de){if(isNaN(le)||isNaN(de)){var ue=new Date(le),pe=new Date(de);if(!isNaN(ue)&&!isNaN(pe))return[ue,pe]}return[le,de]}},Mavo.Script.operators){var ae=Mavo.Script.operators[re];2>ae.scalar.length?Mavo.Script.addUnaryOperator(re,ae):Mavo.Script.addBinaryOperator(re,ae)}var ne={average:"avg",iff:"iff IF",subtract:"minus",multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"},oe=function(le){ne[le].split(/\s+/g).forEach(function(de){return te[de]=te[le]})};for(var ie in ne)oe(ie);Mavo.Functions._Trap=self.Proxy?new Proxy(te,{get:function(le,de){if(de in le)return le[de];var ue=de.toLowerCase&&de.toLowerCase();return ue&&le.hasOwnProperty(ue)?le[ue]:de in Math||ue in Math?Math[de]||Math[ue]:de in self?self[de]:de},has:function(le,de){return"data"!=de}}):Mavo.Functions})(),"use strict",function(ee){if(self.Mavo){Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){var ae=this;this.url=new URL(this.url,location),"dropbox:"!=this.url.protocol&&(this.url.hostname="dl.dropboxusercontent.com",this.url.search=this.url.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.on("read")),this.permissions.on("login"),this.ready=ee.include(self.Dropbox,"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js").then(function(){var ne=new URL(document.referrer,location);return"www.dropbox.com"===ne.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),ee.fire(window,"load"),void close()):void(ae.path=(ae.mavo.element.getAttribute("mv-dropbox-path")||"")+new URL(ae.url).pathname.match(/[^/]*$/)[0],ae.key=ae.mavo.element.getAttribute("mv-dropbox-key")||"fle6gsc61w5v79j",ae.client=new Dropbox.Client({key:ae.key}))}).then(function(){ae.login(!0)})},put:function(){var ae=this,ne=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getFile();return new Promise(function(oe,ie){ae.client.writeFile(ne.name,ne.dataString,function(se,le){return se?ie(Error(se)):void(console.log("File saved as revision "+le.versionTag),oe(ne))})})},login:function(ae){var ne=this;return this.ready.then(function(){return ne.client.isAuthenticated()?Promise.resolve():new Promise(function(oe,ie){ne.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),ne.client.authenticate({interactive:!ae},function(se){se&&ie(Error(se)),ne.client.isAuthenticated()?(ne.permissions.on(["logout","edit"]),oe()):(ne.permissions.off(["logout","edit","add","delete"]),ie())})})}).then(function(){ne.client.getAccountInfo(function(oe,ie){oe||ee.fire(ne.mavo.element,"mavo:login",ee.extend({backend:ne},ie))})}).catch(function(){})},logout:function(){var ae=this;return this.client.isAuthenticated()?new Promise(function(ne){ae.client.signOut(null,function(){ae.permissions.off(["edit","add","delete"]).on("login"),ae.mavo.element._.fire("mavo:logout",{backend:ae}),ne()})}):Promise.resolve()},static:{test:function(ae){return ae=new URL(ae,location),/dropbox.com/.test(ae.host)||"dropbox:"===ae.protocol}}}))}}(Bliss),"use strict",function(ee){if(self.Mavo)var te=Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on("login"),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var ae=te.parseURL(this.url);ae.username?(ee.extend(this,ae),this.repo=this.repo||"mv-data",this.branch=this.branch||"master",this.path=this.path||this.mavo.id+".json",this.apiCall="repos/"+this.username+"/"+this.repo+"/contents/"+this.path):this.apiCall=this.url.pathname.slice(1),this.permissions.on("read"),this.login(!0)},get authenticated(){return!!this.accessToken},req:function(ae,ne){var oe=this,ie=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",se=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{method:ie};ne&&(se.data=JSON.stringify(ne));var le=ee.extend(se,{responseType:"json"});return this.authenticated&&(le.headers={Authorization:"token "+this.accessToken}),ee.fetch(te.apiDomain+ae,le).catch(function(de){return de&&de.xhr?Promise.reject(de.xhr):void oe.mavo.error("Something went wrong while connecting to Github",de)}).then(function(de){return Promise.resolve(de.response)})},get:function(){var ae=this;return this.req(this.apiCall).then(function(ne){return Promise.resolve(ae.repo?te.atob(ne.content):ne)})},put:function(ae,ne){var oe=this,ie=ne?"repos/"+this.username+"/"+this.repo+"/contents/"+ne:this.apiCall;return Promise.resolve(this.repoInfo||this.req("user/repos",{name:this.repo},"POST")).then(function(se){return oe.repoInfo=se,oe.req(ie,{ref:oe.branch})}).then(function(se){return oe.req(ie,{message:"Updated "+(se.name||"file"),content:te.btoa(ae),branch:oe.branch,sha:se.sha},"PUT")},function(se){return 404==se.status?oe.req(ie,{message:"Created file",content:te.btoa(ae),branch:oe.branch},"PUT"):se})},login:function(ae){var ne=this;return this.ready.then(function(){return ne.authenticated?Promise.resolve():new Promise(function(oe,ie){if(ae)ne.accessToken=localStorage["mavo:githubtoken"],ne.accessToken&&oe(ne.accessToken);else{var se={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};se.top=(innerHeight-se.height)/2+(screen.top||screenTop),se.left=(innerWidth-se.width)/2+(screen.left||screenLeft),ne.authPopup=open("https://github.com/login/oauth/authorize?client_id="+ne.key+"&scope=repo,gist&state="+location.href,"popup","width="+se.width+",height="+se.height+",left="+se.left+",top="+se.top),addEventListener("message",function(le){le.source===ne.authPopup&&(ne.accessToken=localStorage["mavo:githubtoken"]=le.data,!ne.accessToken&&ie(Error("Authentication error")),oe(ne.accessToken))})}}).then(function(){return ne.getUser()}).catch(function(oe){401==oe.status&&ne.logout()}).then(function(){if(ne.user&&(ne.permissions.on("logout"),ne.repo))return ne.req("repos/"+ne.username+"/"+ne.repo).then(function(ie){ne.repoInfo=ie,ie.permissions.push&&ne.permissions.on(["edit","save"])}).catch(function(ie){404==ie.status&&ne.user.login.toLowerCase()==ne.username.toLowerCase()&&ne.permissions.on(["edit","save"])})})})},logout:function(){return this.authenticated&&(localStorage.removeItem("mavo:githubtoken"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this})),Promise.resolve()},getUser:function(){var ae=this;return this.req("user").then(function(ne){ae.user=ne;var oe=ne.name||ne.login;ee.fire(ae.mavo.element,"mavo:login",{backend:ae,name:"<a href=\"https://github.com/"+ne.login+"\" target=\"_blank\">\n\t\t\t\t\t\t\t<img class=\"mv-avatar\" src=\""+ne.avatar_url+"\" /> "+oe+"\n\t\t\t\t\t\t</a>"})})},static:{apiDomain:"https://api.github.com/",test:function(ae){return ae=new URL(ae,location),/\bgithub.com|raw.githubusercontent.com/.test(ae.host)},parseURL:function(ae){var ne={};ae=new URL(ae,location);var oe=ae.pathname.slice(1).split("/");if(ne.username=oe.shift(),ne.repo=oe.shift(),/raw.githubusercontent.com$/.test(ae.host))ne.branch=oe.shift();else{if(/api.github.com$/.test(ae.host))return{};/github.com$/.test(ae.host)&&"blob"==oe[0]&&(oe.shift(),ne.branch=oe.shift())}return ne.path=oe.join("/"),ne},btoa:function(re){function ae(){return re.apply(this,arguments)}return ae.toString=function(){return re.toString()},ae}(function(re){return btoa(unescape(encodeURIComponent(re)))}),atob:function(ae){return decodeURIComponent(escape(window.atob(ae)))}}}))}(Bliss);
//# sourceMappingURL=maps/mavo.es5.min.js.map
