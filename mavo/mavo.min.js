!function(){"use strict";function ee(ie,se,le){return se=void 0===se?1:se,le=le||se+1,1>=le-se?function(){if(arguments.length<=se||"string"===re.type(arguments[se]))return ie.apply(this,arguments);var de,pe=arguments[se];for(var ue in pe){var ce=Array.from(arguments);ce.splice(se,1,ue,pe[ue]),de=ie.apply(this,ce)}return de}:ee(ee(ie,se+1,le),se,le-1)}function te(ie,se,le){var de=ae(le);if("string"===de){var pe=Object.getOwnPropertyDescriptor(se,le);!pe||pe.writable&&pe.configurable&&pe.enumerable&&!pe.get&&!pe.set?ie[le]=se[le]:(delete ie[le],Object.defineProperty(ie,le,pe))}else if("array"===de)le.forEach(function(ce){ce in se&&te(ie,se,ce)});else for(var ue in se)(!le||("regexp"!==de||le.test(ue))&&("function"!==de||le.call(se,ue)))&&te(ie,se,ue);return ie}function ae(ie){if(null===ie)return"null";if(void 0===ie)return"undefined";var se=(Object.prototype.toString.call(ie).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==se&&isNaN(ie)?"nan":se}var re=self.Bliss=te(function(ie,se){return(2!=arguments.length||se)&&ie?"string"===re.type(ie)?(se||document).querySelector(ie):ie||null:null},self.Bliss);te(re,{extend:te,overload:ee,type:ae,property:re.property||"_",sources:{},noop:function(){},$:function(ie,se){return ie instanceof Node||ie instanceof Window?[ie]:2!=arguments.length||se?Array.from("string"==typeof ie?(se||document).querySelectorAll(ie):ie||[]):[]},defined:function(){for(var ie=0;ie<arguments.length;ie++)if(void 0!==arguments[ie])return arguments[ie]},create:function(ie,se){return ie instanceof Node?re.set(ie,se):(1===arguments.length&&("string"===re.type(ie)?se={}:(se=ie,ie=se.tag,se=re.extend({},se,function(le){return"tag"!==le}))),re.set(document.createElement(ie||"div"),se))},each:function(ie,se,le){for(var de in le=le||{},ie)le[de]=se.call(ie,de,ie[de]);return le},ready:function(ie){return ie=ie||document,new Promise(function(se){"loading"===ie.readyState?ie.addEventListener("DOMContentLoaded",function(){se()}):se()})},Class:function(ie){var se,le=["constructor","extends","abstract","static"].concat(Object.keys(re.classProps)),de=ie.hasOwnProperty("constructor")?ie.constructor:re.noop;2==arguments.length?(se=arguments[0],ie=arguments[1]):(se=function(){if(this.constructor.__abstract&&this.constructor===se)throw new Error("Abstract classes cannot be directly instantiated.");se["super"]&&se["super"].apply(this,arguments),de.apply(this,arguments)},se["super"]=ie["extends"]||null,se.prototype=re.extend(Object.create(se["super"]?se["super"].prototype:Object),{constructor:se}),se.prototype["super"]=se["super"]?se["super"].prototype:null,se.__abstract=!!ie.abstract);var pe=function(ce){return this.hasOwnProperty(ce)&&-1===le.indexOf(ce)};if(ie["static"])for(var ue in re.extend(se,ie["static"],pe),re.classProps)ue in ie["static"]&&re.classProps[ue](se,ie["static"][ue]);for(var ue in re.extend(se.prototype,ie,pe),re.classProps)ue in ie&&re.classProps[ue](se.prototype,ie[ue]);return se},classProps:{lazy:ee(function(ie,se,le){return Object.defineProperty(ie,se,{get:function(){var de=le.call(this);return Object.defineProperty(this,se,{value:de,configurable:!0,enumerable:!0,writable:!0}),de},set:function(de){Object.defineProperty(this,se,{value:de,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),ie}),live:ee(function(ie,se,le){return"function"===re.type(le)&&(le={set:le}),Object.defineProperty(ie,se,{get:function(){var de=this["_"+se],pe=le.get&&le.get.call(this,de);return void 0===pe?de:pe},set:function(de){var pe=this["_"+se],ue=le.set&&le.set.call(this,de,pe);this["_"+se]=void 0===ue?de:ue},configurable:le.configurable,enumerable:le.enumerable}),ie})},include:function(){var ie=arguments[arguments.length-1],se=!(2!==arguments.length)&&arguments[0],le=document.createElement("script");return se?Promise.resolve():new Promise(function(de,pe){re.set(le,{async:!0,onload:function(){de(),re.remove(le)},onerror:function(){pe()},src:ie,inside:document.head})})},fetch:function(ie,se){if(!ie)throw new TypeError("URL parameter is mandatory and cannot be "+ie);var le=te({url:new URL(ie,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},se);for(var de in le.method=le.method.toUpperCase(),re.hooks.run("fetch-args",le),"GET"===le.method&&le.data&&(le.url.search+=le.data),document.body.setAttribute("data-loading",le.url),le.xhr.open(le.method,le.url.href,!1!==le.async,le.user,le.password),se)if(de in le.xhr)try{le.xhr[de]=se[de]}catch(ue){self.console&&console.error(ue)}for(var pe in"GET"===le.method||le.headers["Content-type"]||le.headers["Content-Type"]||le.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),le.headers)le.xhr.setRequestHeader(pe,le.headers[pe]);return new Promise(function(ue,ce){le.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===le.xhr.status||200<=le.xhr.status&&300>le.xhr.status||304===le.xhr.status?ue(le.xhr):ce(re.extend(Error(le.xhr.statusText),{xhr:le.xhr,get status(){return this.xhr.status}}))},le.xhr.onerror=function(){document.body.removeAttribute("data-loading"),ce(re.extend(Error("Network Error"),{xhr:le.xhr}))},le.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),ce(re.extend(Error("Network Timeout"),{xhr:le.xhr}))},le.xhr.send("GET"===le.method?null:le.data)})},value:function(ie){var se="string"!==re.type(ie);return re.$(arguments).slice(+se).reduce(function(le,de){return le&&le[de]},se?ie:self)}}),re.Hooks=new re.Class({add:function(ie,se,le){if("string"==typeof arguments[0])(Array.isArray(ie)?ie:[ie]).forEach(function(de){this[de]=this[de]||[],se&&this[de][le?"unshift":"push"](se)},this);else for(var ie in arguments[0])this.add(ie,arguments[0][ie],arguments[1])},run:function(ie,se){this[ie]=this[ie]||[],this[ie].forEach(function(le){le.call(se&&se.context?se.context:se,se)})}}),re.hooks=new re.Hooks;var ne=re.property;re.Element=function(ie){this.subject=ie,this.data={},this.bliss={}},re.Element.prototype={set:ee(function(ie,se){ie in re.setProps?re.setProps[ie].call(this,se):ie in this?this[ie]=se:this.setAttribute(ie,se)},0),transition:function(ie,se){return se=+se||400,new Promise(function(le){if("transition"in this.style){var pe=re.extend({},this.style,/^transition(Duration|Property)$/);re.style(this,{transitionDuration:(se||400)+"ms",transitionProperty:Object.keys(ie).join(", ")}),re.once(this,"transitionend",function(){clearTimeout(ue),re.style(this,pe),le(this)});var ue=setTimeout(le,se+50,this);re.style(this,ie)}else re.style(this,ie),le(this)}.bind(this))},fire:function(ie,se){var le=document.createEvent("HTMLEvents");return le.initEvent(ie,!0,!0),this.dispatchEvent(re.extend(le,se))},unbind:ee(function(ie,se){(ie||"").split(/\s+/).forEach(function(le){if(ne in this&&(-1<le.indexOf(".")||!se)){le=(le||"").split(".");var de=le[1];le=le[0];var pe=this[ne].bliss.listeners=this[ne].bliss.listeners||{};for(var ue in pe)if(!le||ue===le)for(var ce,ve=0;ce=pe[ue][ve];ve++)de&&de!==ce.className||se&&se!==ce.callback||(this.removeEventListener(ue,ce.callback,ce.capture),ve--)}else this.removeEventListener(le,se)},this)},0)},re.setProps={style:function(ie){for(var se in ie)se in this.style?this.style[se]=ie[se]:this.style.setProperty(se,ie[se])},attributes:function(ie){for(var se in ie)this.setAttribute(se,ie[se])},properties:function(ie){re.extend(this,ie)},events:function(ie){if(ie&&ie.addEventListener){var se=this;if(ie[ne]&&ie[ne].bliss){var le=ie[ne].bliss.listeners;for(var de in le)le[de].forEach(function(he){se.addEventListener(de,he.callback,he.capture)})}for(var pe in ie)0===pe.indexOf("on")&&(this[pe]=ie[pe])}else if(1<arguments.length&&"string"===re.type(ie)){var ue=arguments[1],ce=arguments[2];ie.split(/\s+/).forEach(function(he){this.addEventListener(he,ue,ce)},this)}else for(var ve in ie)re.events(this,ve,ie[ve])},once:ee(function(ie,se){ie=ie.split(/\s+/);var le=this,de=function(){return ie.forEach(function(pe){le.removeEventListener(pe,de)}),se.apply(le,arguments)};ie.forEach(function(pe){le.addEventListener(pe,de)})},0),delegate:ee(function(ie,se,le){this.addEventListener(ie,function(de){de.target.closest(se)&&le.call(this,de)})},0,2),contents:function(ie){(ie||0===ie)&&(Array.isArray(ie)?ie:[ie]).forEach(function(se){var le=re.type(se);/^(string|number)$/.test(le)?se=document.createTextNode(se+""):"object"===le&&(se=re.create(se)),se instanceof Node&&this.appendChild(se)},this)},inside:function(ie){ie.appendChild(this)},before:function(ie){ie.parentNode.insertBefore(this,ie)},after:function(ie){ie.parentNode.insertBefore(this,ie.nextSibling)},start:function(ie){ie.insertBefore(this,ie.firstChild)},around:function(ie){ie.parentNode&&re.before(this,ie),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(ie)}},re.Array=function(ie){this.subject=ie},re.Array.prototype={all:function(ie){var se=$$(arguments).slice(1);return this[ie].apply(this,se)}},re.add=ee(function(ie,se,le,de){le=re.extend({$:!0,element:!0,array:!0},le),"function"==re.type(se)&&(!le.element||ie in re.Element.prototype&&de||(re.Element.prototype[ie]=function(){return this.subject&&re.defined(se.apply(this.subject,arguments),this.subject)}),!le.array||ie in re.Array.prototype&&de||(re.Array.prototype[ie]=function(){var pe=arguments;return this.subject.map(function(ue){return ue&&re.defined(se.apply(ue,pe),ue)})}),le.$&&(re.sources[ie]=re[ie]=se,(le.array||le.element)&&(re[ie]=function(){var pe=[].slice.apply(arguments),ue=pe.shift(),ce=le.array&&Array.isArray(ue)?"Array":"Element";return re[ce].prototype[ie].apply({subject:ue},pe)})))},0),re.add(re.Array.prototype,{element:!1}),re.add(re.Element.prototype),re.add(re.setProps),re.add(re.classProps,{element:!1,array:!1});var oe=document.createElement("_");re.add(re.extend({},HTMLElement.prototype,function(ie){return"function"===re.type(oe[ie])}),null,!0)}(),function(ee){"use strict";if(Bliss&&!Bliss.shy){var te=Bliss.property;if(ee.add({clone:function(){var ie=this.cloneNode(!0),se=ee.$("*",ie).concat(ie);return ee.$("*",this).concat(this).forEach(function(le,de){ee.events(se[de],le),se[de]._.data=ee.extend({},le._.data)}),ie}},{array:!1}),Object.defineProperty(Node.prototype,te,{get:function ie(){return Object.defineProperty(Node.prototype,te,{get:void 0}),Object.defineProperty(this,te,{value:new ee.Element(this)}),Object.defineProperty(Node.prototype,te,{get:ie}),this[te]},configurable:!0}),Object.defineProperty(Array.prototype,te,{get:function(){return Object.defineProperty(this,te,{value:new ee.Array(this)}),this[te]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var ae=EventTarget.prototype.addEventListener,re=EventTarget.prototype.removeEventListener,ne=function(ie,se,le){return le.callback===ie&&le.capture==se},oe=function(){return!ne.apply(this,arguments)};EventTarget.prototype.addEventListener=function(ie,se,le){if(this&&this[te]&&this[te].bliss&&se){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};if(-1<ie.indexOf(".")){ie=ie.split(".");var pe=ie[1];ie=ie[0]}de[ie]=de[ie]||[],0===de[ie].filter(ne.bind(null,se,le)).length&&de[ie].push({callback:se,capture:le,className:pe})}return ae.call(this,ie,se,le)},EventTarget.prototype.removeEventListener=function(ie,se,le){if(this&&this[te]&&this[te].bliss&&se){var de=this[te].bliss.listeners=this[te].bliss.listeners||{};de[ie]&&(de[ie]=de[ie].filter(oe.bind(null,se,le)))}return re.call(this,ie,se,le)}}self.$=self.$||ee,self.$$=self.$$||ee.$}}(Bliss),!function(ee){"use strict";var te="Compound",re="MemberExpression",ne="Literal",ce=46,ve=44,fe=40,ye=41,be=91,xe=93,Ae=function($e,Ge){var Re=new Error($e+" at character "+Ge);throw Re.index=Ge,Re.description=$e,Re},Ne=!0,Pe={"-":Ne,"!":Ne,"~":Ne,"+":Ne},we={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Le=function($e){var Ge,Re=0;for(var qe in $e)(Ge=qe.length)>Re&&$e.hasOwnProperty(qe)&&(Re=Ge);return Re},Oe=Le(Pe),Se=Le(we),Te={"true":!0,"false":!1,"null":null},De=function($e){return we[$e]||0},Ie=function($e,Ge,Re){var qe="||"===$e||"&&"===$e?"LogicalExpression":"BinaryExpression";return{type:qe,operator:$e,left:Ge,right:Re}},je=function($e){return 48<=$e&&57>=$e},Be=function($e){return 36===$e||95===$e||65<=$e&&90>=$e||97<=$e&&122>=$e||128<=$e&&!we[String.fromCharCode($e)]},ze=function($e){return 36===$e||95===$e||65<=$e&&90>=$e||97<=$e&&122>=$e||48<=$e&&57>=$e||128<=$e&&!we[String.fromCharCode($e)]},_e=function($e){for(var Ge,Re,qe=0,Me=$e.charAt,Fe=$e.charCodeAt,He=function(dt){return Me.call($e,dt)},We=function(dt){return Fe.call($e,dt)},Je=$e.length,Ye=function(){for(var dt=We(qe);32===dt||9===dt;)dt=We(++qe)},Ke=function(){var dt,pt,ut=Ze();return Ye(),We(qe)===63?(qe++,dt=Ke(),dt||Ae("Expected expression",qe),Ye(),We(qe)===58?(qe++,pt=Ke(),pt||Ae("Expected expression",qe),{type:"ConditionalExpression",test:ut,consequent:dt,alternate:pt}):void Ae("Expected :",qe)):ut},Xe=function(){Ye();for(var dt=$e.substr(qe,Se),pt=dt.length;0<pt;){if(we.hasOwnProperty(dt))return qe+=pt,dt;dt=dt.substr(0,--pt)}return!1},Ze=function(){var dt,pt,ut,ct,mt,vt,ht,gt;if(vt=Qe(),pt=Xe(),!pt)return vt;for(mt={value:pt,prec:De(pt)},ht=Qe(),ht||Ae("Expected expression after "+pt,qe),ct=[vt,mt,ht];(pt=Xe())&&(ut=De(pt),0!==ut);){for(mt={value:pt,prec:ut};2<ct.length&&ut<=ct[ct.length-2].prec;)ht=ct.pop(),pt=ct.pop().value,vt=ct.pop(),dt=Ie(pt,vt,ht),ct.push(dt);dt=Qe(),dt||Ae("Expected expression after "+pt,qe),ct.push(mt,dt)}for(gt=ct.length-1,dt=ct[gt];1<gt;)dt=Ie(ct[gt-1].value,ct[gt-2],dt),gt-=2;return dt},Qe=function(){var dt,pt,ut;if(Ye(),dt=We(qe),je(dt)||dt===ce)return tt();if(dt===39||dt===34)return at();if(Be(dt)||dt===fe)return ot();if(dt===be)return st();for(pt=$e.substr(qe,Oe),ut=pt.length;0<ut;){if(Pe.hasOwnProperty(pt))return qe+=ut,{type:"UnaryExpression",operator:pt,argument:Qe(),prefix:!0};pt=pt.substr(0,--ut)}return!1},tt=function(){for(var dt,pt,ut="";je(We(qe));)ut+=He(qe++);if(We(qe)===ce)for(ut+=He(qe++);je(We(qe));)ut+=He(qe++);if(dt=He(qe),"e"===dt||"E"===dt){for(ut+=He(qe++),dt=He(qe),"+"!==dt&&"-"!==dt||(ut+=He(qe++));je(We(qe));)ut+=He(qe++);je(We(qe-1))||Ae("Expected exponent ("+ut+He(qe)+")",qe)}return pt=We(qe),Be(pt)?Ae("Variable names cannot start with a number ("+ut+He(qe)+")",qe):pt===ce&&Ae("Unexpected period",qe),{type:ne,value:parseFloat(ut),raw:ut}},at=function(){for(var dt,pt="",ut=He(qe++),ct=!1;qe<Je;){if(dt=He(qe++),dt===ut){ct=!0;break}if("\\"===dt)switch(dt=He(qe++)){case"n":pt+="\n";break;case"r":pt+="\r";break;case"t":pt+="\t";break;case"b":pt+="\b";break;case"f":pt+="\f";break;case"v":pt+="\x0B";break;default:pt+="\\"+dt;}else pt+=dt}return ct||Ae("Unclosed quote after \""+pt+"\"",qe),{type:ne,value:pt,raw:ut+pt+ut}},rt=function(){var dt,pt=We(qe),ut=qe;for(Be(pt)?qe++:Ae("Unexpected "+He(qe),qe);qe<Je&&(pt=We(qe),ze(pt));)qe++;return dt=$e.slice(ut,qe),Te.hasOwnProperty(dt)?{type:ne,value:Te[dt],raw:dt}:dt==="this"?{type:"ThisExpression"}:{type:"Identifier",name:dt}},nt=function(dt){for(var pt,ut,ct=[],mt=!1;qe<Je;){if(Ye(),pt=We(qe),pt===dt){mt=!0,qe++;break}pt===ve?qe++:(ut=Ke(),ut&&ut.type!==te||Ae("Expected comma",qe),ct.push(ut))}return mt||Ae("Expected "+String.fromCharCode(dt),qe),ct},ot=function(){var dt,pt;for(dt=We(qe),pt=dt===fe?it():rt(),Ye(),dt=We(qe);dt===ce||dt===be||dt===fe;)qe++,dt===ce?(Ye(),pt={type:re,computed:!1,object:pt,property:rt()}):dt===be?(pt={type:re,computed:!0,object:pt,property:Ke()},Ye(),dt=We(qe),dt!=xe&&Ae("Unclosed [",qe),qe++):dt==fe&&(pt={type:"CallExpression",arguments:nt(ye),callee:pt}),Ye(),dt=We(qe);return pt},it=function(){qe++;var dt=Ke();return Ye(),We(qe)===ye?(qe++,dt):void Ae("Unclosed (",qe)},st=function(){return qe++,{type:"ArrayExpression",elements:nt(xe)}},lt=[];qe<Je;)Ge=We(qe),Ge===59||Ge===ve?qe++:(Re=Ke())?lt.push(Re):qe<Je&&Ae("Unexpected \""+He(qe)+"\"",qe);return 1===lt.length?lt[0]:{type:te,body:lt}};if(_e.version="0.3.1",_e.toString=function(){return"JavaScript Expression Parser (JSEP) v"+_e.version},_e.addUnaryOp=function($e){return Oe=Math.max($e.length,Oe),Pe[$e]=Ne,this},_e.addBinaryOp=function($e,Ge){return Se=Math.max($e.length,Se),we[$e]=Ge,this},_e.addLiteral=function($e,Ge){return Te[$e]=Ge,this},_e.removeUnaryOp=function($e){return delete Pe[$e],$e.length===Oe&&(Oe=Le(Pe)),this},_e.removeBinaryOp=function($e){return delete we[$e],$e.length===Se&&(Se=Le(we)),this},_e.removeLiteral=function($e){return delete Te[$e],this},"undefined"==typeof exports){var Ue=ee.jsep;ee.jsep=_e,_e.noConflict=function(){return ee.jsep===_e&&(ee.jsep=Ue),_e}}else"undefined"!=typeof module&&module.exports?exports=module.exports=_e:exports.parse=_e}(this),function(){function ee(re,ne){return re instanceof Node||re instanceof Window?[re]:[].slice.call("string"==typeof re?(ne||document).querySelectorAll(re):re||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),!!Element.prototype.matches)){var te=self.Stretchy={selectors:{base:"textarea, select:not([size]), input:not([type]), input[type=\""+"text url email tel".split(" ").join("\"], input[type=\"")+"\"]",filter:"*"},script:document.currentScript||ee("script").pop(),resize:function(re){if(te.resizes(re)){var ne=getComputedStyle(re),oe=0;if(!re.value&&re.placeholder){re.value=re.placeholder}var se=re.nodeName.toLowerCase();if("textarea"==se)re.style.height="0","border-box"==ne.boxSizing?oe=re.offsetHeight:"content-box"==ne.boxSizing&&(oe=-re.clientHeight),re.style.height=re.scrollHeight+oe+"px";else if("input"==se){if(re.style.width="1000px",re.offsetWidth){re.style.width="0","border-box"==ne.boxSizing?oe=re.offsetWidth:"padding-box"==ne.boxSizing&&(oe=re.clientWidth),re.scrollLeft=1e10;var le=Math.max(re.scrollLeft+oe,re.scrollWidth-re.clientWidth);re.style.width=le+"px"}else re.style.width=re.value.length+1+"ch";}else if("select"==se){var de=0<re.selectedIndex?re.selectedIndex:0,pe=document.createElement("_");pe.textContent=re.options[de].textContent,re.parentNode.insertBefore(pe,re.nextSibling);var ue;for(var ce in ne){var ve=ne[ce];/^(width|webkitLogicalWidth|length)$/.test(ce)||"string"!=typeof ve||(pe.style[ce]=ve,/appearance$/i.test(ce)&&(ue=ce))}pe.style.width="",0<pe.offsetWidth&&(re.style.width=pe.offsetWidth+"px",(!ne[ue]||"none"!==ne[ue])&&(re.style.width="calc("+re.style.width+" + 2em)")),pe.parentNode.removeChild(pe),pe=null}re.value=""}},resizeAll:function(re){ee(re||te.selectors.base).forEach(function(ne){te.resize(ne)})},active:!0,resizes:function(re){return re&&re.parentNode&&re.matches&&re.matches(te.selectors.base)&&re.matches(te.selectors.filter)},init:function(){te.selectors.filter=te.script.getAttribute("data-filter")||(ee("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",te.resizeAll()},$$:ee};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",te.init):te.init();var ae=function(re){te.active&&te.resize(re.target)};document.documentElement.addEventListener("input",ae),document.documentElement.addEventListener("change",ae),self.MutationObserver&&new MutationObserver(function(re){te.active&&re.forEach(function(ne){"childList"==ne.type&&Stretchy.resizeAll(ne.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}(),function(ee,te){"use strict";var ae=self.Mavo=ee.Class({constructor:function(re){this.treeBuilt=Mavo.defer(),this.element=re,this.index=ae.all.push(this);var ne=ae.attributes.map(oe=>`[data-${oe}]`);for(let oe of te(ne.join(", "),this.element).concat(this.element))for(let ie of ae.attributes){let se=oe.getAttribute("data-"+ie);null!==se&&oe.setAttribute(ie,se)}ae.allIds.push(this.id=Mavo.getAttribute(this.element,"mv-app","id")||`mavo${this.index}`),this.element.setAttribute("mv-app",this.id),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.element.setAttribute("typeof",""),te(ae.selectors.primitive,re).forEach(oe=>{var ie=ee(`${ae.selectors.not(ae.selectors.formControl)}, ${ae.selectors.property}`,oe);if(ie){var se=Mavo.Primitive.getConfig(oe),le=Mavo.is("multiple",oe);!le&&(se.attribute||se.hasChildren)||oe.setAttribute("typeof","")}}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.ui={bar:ee(".mv-bar",this.element)||ee.create({className:"mv-bar mv-ui",start:this.element})},this.ui.bar.classList.toggle("mv-compact",400>this.ui.bar.parentNode.offsetWidth),this.ui.bar.classList.toggle("mv-tiny",250>this.ui.bar.parentNode.offsetWidth),this.ui.status=ee(".mv-status",this.ui.bar)||ee.create("span",{className:"mv-status",inside:this.ui.bar});for(let oe of["storage","source","init"])1==this.index&&(this[oe]=ae.Functions.urlOption(oe)),this[oe]||(this[oe]=ae.Functions.urlOption(`${this.id}_${oe}`)||this.element.getAttribute("mv-"+oe)||null),this[oe]&&(this[oe]=this[oe].trim(),this[oe]="none"==this[oe]?null:ae.Backend.create(this[oe],{mavo:this,format:this.element.getAttribute("mv-format-"+oe)||this.element.getAttribute("mv-format")}));this.storage||this.source||!this.init||(this.source=this.init,this.init=null);for(let oe of["storage","source","init"])if(this[oe]){this.primaryBackend=this[oe],this.permissions=this[oe].permissions;break}this.permissions=this.permissions||new Mavo.Permissions,this.primaryBackend&&(this.authControls={},ee.style(this.ui.bar,{"--mv-backend":`"${this.primaryBackend.id}"`}),this.permissions.can("login",()=>{this.loginHash="#login"+(Mavo.all[0]===this?"":"-"+this.id),this.authControls.login=ee.create({tag:"a",href:this.loginHash,textContent:"Login",title:"Login",className:"mv-login mv-button",events:{click:ie=>{ie.preventDefault(),this.primaryBackend.login()}},after:ee(".mv-status",this.ui.bar)});var oe;(oe=()=>{location.hash===this.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),this.primaryBackend.login())})(),window.addEventListener("hashchange.mavo",oe)},()=>{ee.remove(this.authControls.login),this.element._.unbind("hashchange.mavo")}),this.element.addEventListener("mavo:login.mavo",oe=>{if(oe.backend==this.primaryBackend){var ie=ee(".mv-status",this.ui.bar);ie.innerHTML="",ee.set(ie,{contents:[{tag:"strong",innerHTML:oe.name},{tag:"button",textContent:"Logout",className:"mv-logout",events:{click:()=>oe.backend.logout()}}]}),this.root.data||this.unsavedChanges||this.load()}}),this.element.addEventListener("mavo:logout.mavo",()=>{ee(".mv-status",this.ui.bar).textContent=""})),ee("summary [property]:not([typeof])")&&this.element.addEventListener("click",oe=>{oe.target!=document.activeElement&&oe.preventDefault()}),this.needsEdit=this.some(oe=>oe!=this.root&&!oe.modes&&"read"==oe.mode),this.setUnsavedChanges(!1),this.permissions.onchange(({action:oe,value:ie})=>{var se=this.element.getAttribute("mv-permissions")||"";se=se.trim().split(/\s+/).filter(le=>le!=oe),ie&&se.push(oe),this.element.setAttribute("mv-permissions",se.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],()=>{this.ui.edit=ee.create("button",{className:"mv-edit",textContent:"Edit",title:"Edit",inside:this.ui.bar}),this.modeObserver=new Mavo.Observer(this.element,"mv-mode",oe=>{for(let ie of oe){let se=ie.target;nodeloop:for(let le of ae.Node.children(se)){let pe,de=le.mode;if(le.element==se)pe=le.element.getAttribute("mv-mode"),le.modes=pe;else{if(le.modes)continue nodeloop;pe=ae.getStyle(le.element.parentNode,"--mv-mode")}le.mode=pe,de!=le.mode&&le["edit"==le.mode?"edit":"done"]()}}},{subtree:!0}),this.autoEdit&&this.edit()},()=>{ee.remove(this.ui.edit),this.editing&&this.done(),this.modeObserver&&this.modeObserver.destroy()}),this.storage&&this.permissions.can("delete",()=>{this.ui.clear=ee.create("button",{className:"mv-clear",textContent:"Clear",title:"Clear"}),this.ui.bar.appendChild(this.ui.clear)},()=>{ee.remove(this.ui.clear)}),this.storage||this.source?this.permissions.can("read",()=>this.load()):(this.permissions.on(["read","edit"]),ee.fire(this.element,"mavo:load")),this.permissions.can("save",()=>{if(this.autoSave){var oe=1e3*(this.element.getAttribute("mv-autosave")||3);this.element.addEventListener("mavo:load.mavo:autosave",()=>{var se=ae.debounce(()=>{this.save()},oe),le=de=>{de.node.saved&&se()};requestAnimationFrame(()=>{this.permissions.can("save",()=>{this.element.addEventListener("mavo:datachange.mavo:autosave",le)},()=>{this.element.removeEventListener("mavo:datachange.mavo:autosave",le)})})})}(!this.autoSave||0<oe)&&(this.ui.save=ee.create("button",{className:"mv-save",textContent:"Save",title:"Save",inside:this.ui.bar})),ee.events(this.ui.save,{"mouseenter focus":()=>{this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":()=>this.element.classList.remove("mv-highlight-unsaved")})},()=>{ee.remove(this.ui.save),this.ui.save=null,this.element.removeEventListener(".mavo:autosave")}),ee.delegate(this.element,"click",{".mv-save":()=>{this.permissions.save&&this.save()},".mv-edit":()=>{this.editing||!this.permissions.edit?this.done():this.edit()},".mv-clear":()=>{this.permissions.delete&&this.clear()}}),this.element.addEventListener("keydown",oe=>{83==oe.keyCode&&oe[ae.superKey]&&(oe.preventDefault(),this.save())}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(){return this.root.getData()},toJSON:function(){return ae.toJSON(this.getData())},error:function(re,...ne){var oe=()=>ee.transition(se,{opacity:0}).then(ee.remove),ie,se=ee.create("p",{className:"mv-error mv-ui",contents:[re,{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:oe}}],events:{mouseenter:()=>clearTimeout(ie),mouseleave:ae.rr(()=>ie=setTimeout(oe,5e3)),click:()=>this.element.scrollIntoView({behavior:"smooth"})},start:this.element});0<ne.length&&console.log(`%c${this.id}: ${re}`,"color: red; font-weight: bold",...ne)},render:function(re){var ne={context:this,data:re};ae.hooks.run("render-start",ne),ne.data&&this.root.render(ne.data),this.unsavedChanges=!1,ae.hooks.run("render-end",ne)},clear:function(){confirm("This will delete all your data. Are you sure?")&&this.store(null).then(()=>this.root.clear())},edit:function(){this.root.edit(),ee.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",re=>{if(re.target.matches(".mv-item-controls *")){var ne=re.target.closest(".mv-item-controls"),oe=Mavo.data(ne,"item");oe&&oe.element&&oe.element.classList.toggle("mv-highlight","mouseenter"==re.type)}if(re.target.matches(ae.selectors.multiple)){re.target.classList.remove("mv-has-hovered-item");var ie=re.target.parentNode.closest(ae.selectors.multiple);ie&&ie.classList.toggle("mv-has-hovered-item","mouseenter"==re.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(re){var ne=!!re;return re||this.walk(oe=>{if(oe.unsavedChanges)return ne=!0,!1===re&&(oe.unsavedChanges=!1),!1}),this.unsavedChanges=ne},done:function(){this.root.done(),ee.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},load:function(){this.inProgress="Loading";var re=this.source||this.storage;return re.ready.then(()=>re.load()).catch(ne=>{return this.init&&this.init!=re?(re=this.init,this.init.ready.then(()=>this.init.load())):Promise.reject(ne)}).catch(ne=>{if(ne){var oe=ne instanceof XMLHttpRequest?ne:ne.xhr;if(oe&&404==oe.status)this.render(null);else{var ie="Problem loading data";oe&&(ie+=oe.status?`: HTTP error ${ne.status}: ${ne.statusText}`:": Can\u2019t connect to the Internet"),this.error(ie,ne)}}return null}).then(ne=>this.render(ne)).then(()=>{this.inProgress=!1,ee.fire(this.element,"mavo:load")})},store:function(){if(this.storage)return this.inProgress="Saving",this.storage.login().then(()=>this.storage.store(this.getData())).catch(re=>{if(re){var ne="Problem saving data";re instanceof XMLHttpRequest&&(ne+=xhr.status?`: HTTP error ${re.status}: ${re.statusText}`:": Can\u2019t connect to the Internet"),this.error(ne,re)}return null}).then(re=>{return this.inProgress=!1,re})},save:function(){return this.store().then(re=>{re&&(ee.fire(this.element,"mavo:save",re),this.lastSaved=Date.now(),this.root.save(),this.unsavedChanges=!1)})},walk:function(re){return this.root.walk(re)},some:function(re){return!this.walk((ne,oe)=>{var ie=re(ne,oe);if(!0===ie)return!1})},live:{inProgress:function(re){ee.toggleAttribute(this.element,"mv-progress",re,re)},unsavedChanges:function(re){this.element.classList.toggle("mv-unsaved-changes",re)},needsEdit:function(){ee.remove(this.ui.edit)}},static:{all:[],allIds:[],get:function(re){for(let ne of ae.all)if(ne.id===re)return ne;return null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",init:function(re){return te(ae.selectors.init,re||document).filter(ne=>ne==document.documentElement||!ne.parentNode.closest(ae.selectors.init)).map(ne=>new ae(ne))},plugin:function(re){for(let ne in ae.hooks.add(re.hooks),re.extend){let oe="Mavo"==ne?ae:ae[ne];ee.Class(oe,re.extend[ne])}},hooks:new ee.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions"]}});{let re=ae.selectors={init:".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]",property:"[property], [itemprop]",specificProperty:de=>`[property=${de}], [itemprop=${de}]`,group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},ne=re.arr=de=>de.split(/\s*,\s*/g),oe=re.not=de=>ne(de).map(pe=>`:not(${pe})`).join(""),ie=re.or=(de,pe)=>de+", "+pe,se=re.and=(de,pe)=>{var ue=[],ce=ne(pe);return ne(de).forEach(ve=>ue.push(...ce.map(he=>ve+he))),ue.join(", ")},le=re.andNot=(de,pe)=>se(de,oe(pe));ee.extend(ae.selectors,{primitive:le(re.property,re.group),rootGroup:le(re.group,re.property),output:ie(re.specificProperty("output"),".mv-output, .mv-value")})}Promise.all([ee.ready(),ee.include(Array.from&&window.Intl&&document.documentElement.closest,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")]).catch(re=>console.error(re)).then(()=>Mavo.init()),Stretchy.selectors.filter=".mv-editor:not([property])"}(Bliss,Bliss.$),function(ee,te){function ae(ne,oe){for(ne="mv-"+ne+"-within",te("."+ne).forEach(ie=>ie.classList.remove(ne));oe&&oe.classList;)oe.classList.add(ne),oe=oe.parentNode}var re=ee.extend(Mavo,{toJSON:ne=>{return null===ne?"":"string"==typeof ne?ne:JSON.stringify(ne,null,"\t")},queryJSON:function(ne,oe){return oe&&ne?ee.value.apply(ee,[ne].concat(oe.split("/"))):ne},toArray:ne=>{return ne===void 0?[]:Array.isArray(ne)?ne:[ne]},delete:(ne,oe)=>{var ie=ne&&ne.indexOf(oe);-1<ie&&ne.splice(ie,1)},hasIntersection:(ne,oe)=>ne&&oe&&!ne.every(ie=>-1==oe.indexOf(ie)),flatten:ne=>{return Array.isArray(ne)?ne.reduce((oe,ie)=>re.toArray(oe).concat(re.flatten(ie)),[]):[ne]},is:function(ne,...oe){for(let ie of oe)if(ie&&ie.matches&&ie.matches(re.selectors[ne]))return!0;return!1},getStyle:(ne,oe)=>ne&&getComputedStyle(ne).getPropertyValue(oe).trim(),data:function(ne,oe,ie){return 2==arguments.length?ee.value(ne,"_","data","mavo",oe):(ne._.data.mavo=ne._.data.mavo||{},ne._.data.mavo[oe]=ie)},revocably:{add:function(ne){var oe=re.revocably.isRemoved(ne);return oe&&oe.parentNode.replaceChild(ne,oe),oe},remove:function(ne,oe){if(ne){var ie=re.data(ne,"commentstub");return ie||(oe=oe||ne.id||ne.className||ne.nodeName,ie=re.data(ne,"commentstub",document.createComment(oe))),ne.parentNode&&ne.parentNode.replaceChild(ie,ne),ie}},isRemoved:function(ne){if(!ne||ne.parentNode)return!1;var oe=re.data(ne,"commentstub");return oe&&oe.parentNode&&oe}},inViewport:ne=>{var oe=ne.getBoundingClientRect();return(0<=oe.bottom&&oe.bottom<=innerHeight||0<=oe.top&&oe.top<=innerHeight)&&(0<=oe.right&&oe.right<=innerWidth||0<=oe.left&&oe.left<=innerWidth)},scrollIntoViewIfNeeded:ne=>{Mavo.inViewport(ne)||ne.scrollIntoView({behavior:"smooth"})},pushUnique:(ne,oe)=>{-1===ne.indexOf(oe)&&ne.push(oe)},subset:function(ne,oe,ie){if(3==arguments.length){if(oe.length){var se=ee.value(ne,...oe.slice(0,-1));return se[oe[oe.length-1]]=ie,ne}return ie}return"object"==typeof ne&&oe&&oe.length?ee.value(ne,...oe):ne},getAttribute:function(ne,...oe){for(let se,le,ie=0;se=oe[ie];ie++)if(le=ne.getAttribute(se),le)return le;return null},debounce:function(ne,oe){if(!oe)return ne;var se,ie=null;return function(){var le=this,de=arguments;se=function(){ne.apply(le,de),removeEventListener("beforeunload",se)},clearTimeout(ie),ie=setTimeout(se,oe),addEventListener("beforeunload",se)}},escapeRegExp:ne=>ne.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),Observer:ee.Class({constructor:function(ne,oe,ie,se={}){ie instanceof MutationObserver&&(this.observer=ie),this.observer=this.observer||new MutationObserver(ie),this.element=ne,this.callback=ie,this.attribute=oe,this.options=ee.extend({},se),oe&&ee.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:[this.attribute],attributeOldValue:!!se.oldValue}),this.attribute&&"all"!=this.attribute||ee.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!se.oldValue}),this.run()},stop:function(){return this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(ne){if(this.running){this.stop();var oe=ne();this.run()}else var oe=ne();return oe},destroy:function(){this.observer.disconnect(),this.observer=this.element=null},static:{sneak:function(ne,oe){return ne?ne.sneak(oe):oe()}}}),defer:function(ne){var oe,ie,se=new Promise((le,de)=>{ne&&ne(le,de),oe=le,ie=de});return se.resolve=le=>{return oe(le),se},se.reject=le=>{return ie(le),se},se},rr:function(ne){return ne(),ne}});ee.add("toggleAttribute",function(ne,oe,ie=null!==oe){ie?this.setAttribute(ne,oe):this.removeAttribute(ne)}),ee.proxy=ee.classProps.proxy=ee.overload(function(ne,oe,ie){return Object.defineProperty(ne,oe,{get:function(){return this[ie][oe]},set:function(se){this[ie][oe]=se},configurable:!0,enumerable:!0}),ne}),ee.classProps.propagated=function(ne,oe){Mavo.toArray(oe).forEach(ie=>{var se=ne[ie];ne[ie]=function(){var le=se&&se.apply(this,arguments);this.propagate&&!1!==le&&this.propagate(ie)}})};document.addEventListener("focus",ne=>{ae("focus",ne.target)},!0),document.addEventListener("blur",()=>{ae("focus",null)},!0),addEventListener("hashchange",()=>{ae("target",ee(location.hash))}),document.documentElement.addEventListener("mavo:datachange",()=>{ae("target",ee(location.hash))}),ae("focus",document.activeElement===document.body?null:document.activeElement)}(Bliss,Bliss.$),function(ee){var te=Mavo.Permissions=ee.Class({constructor:function(ae){this.triggers=[],this.set(ae),this.hooks=new ee.Hooks},set:function(ae){for(var re in ae)this[re]=ae[re]},on:function(ae){return Mavo.toArray(ae).forEach(re=>this[re]=!0),this},off:function(ae){return ae=Array.isArray(ae)?ae:[ae],ae.forEach(re=>this[re]=!1),this},can:function(ae,re,ne){this.observe(ae,!0,re),ne&&this.cannot(ae,ne)},cannot:function(ae,re){this.observe(ae,!1,re)},when:function(ae){return new Promise((re,ne)=>{this.can(ae,re,ne)})},observe:function(ae,re,ne){ae=Mavo.toArray(ae),this.is(ae,re)&&ne(),this.triggers.push({actions:ae,value:re,callback:ne,active:!0})},is:function(ae,re){var ne=ae.map(oe=>!!this[oe]).reduce((oe,ie)=>oe||ie);return re?ne:!ne},onchange:function(ae){this.hooks.add("change",ae);for(let re of te.actions)ae.call(this,{action:re,value:this[re],permissions:this})},changed:function(ae,re,ne){ne=!!ne,re=!!re;re==ne||(this["_"+ae]=re,this.triggers.forEach(oe=>{var ie=this.is(oe.actions,oe.value);oe.active&&-1<oe.actions.indexOf(ae)&&ie?(oe.active=!1,oe.callback()):!ie&&(oe.active=!0)}),this.hooks.run("change",{action:ae,value:re,permissions:this}))},or:function(ae){for(let re of te.actions)this[re]=this[re]||ae[re];return this},static:{actions:[],register:function(ae,re){return Array.isArray(ae)?void ae.forEach(ne=>te.register(ne,re)):void(ee.live(te.prototype,ae,function(ne,oe){re&&re.call(this,ne,oe),this.changed(ae,ne,oe)}),te.actions.push(ae))}}});te.register(["read","save"]),te.register("login",function(ae){ae&&this.logout&&(this.logout=!1)}),te.register("logout",function(ae){ae&&this.login&&(this.login=!1)}),te.register("edit",function(ae){ae&&(this.add=this.delete=!0)}),te.register(["add","delete"],function(ae){ae||(this.edit=!1)})}(Bliss),function(ee){var te=Mavo.Backend=ee.Class({constructor:function(ae,re={}){this.raw=ae,this.url=new URL(this.raw,location),this.mavo=re.mavo,this.format=Mavo.Formats.create(re.format,this),this.permissions=new Mavo.Permissions},get:function(){return ee.fetch(this.url.href).then(ae=>Promise.resolve(ae.responseText),()=>Promise.resolve(null))},load:function(){return this.ready.then(()=>this.get()).then(ae=>{return"string"==typeof ae?(ae=ae.replace(/^\ufeff/,""),this.format.parse(ae)):ae})},store:function(ae,{path:re,format:ne=this.format}={}){return this.ready.then(()=>{var oe="string"==typeof ae?Promise.resolve(ae):ne.stringify(ae);return oe.then(ie=>this.put(ie,re).then(()=>{return{data:ae,serialized:ie}}))})},ready:Promise.resolve(),login:()=>Promise.resolve(),logout:()=>Promise.resolve(),toString:function(){return`${this.id} (${this.url})`},static:{create:function(ae,re){if(ae){var ne=te.types.filter(oe=>oe.test(ae))[0]||te.Remote;return new ne(ae,re)}return null},types:[],register:function(ae){return te[ae.prototype.id]=ae,te.types.push(ae),ae}}});te.register(ee.Class({id:"Element",extends:te,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=ee(this.raw)||ee.create("script",{type:"application/json",id:this.raw.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(ae){return Promise.resolve(this.element.textContent=ae)},static:{test:ae=>0===ae.indexOf("#")}})),te.register(ee.Class({id:"Remote",extends:te,constructor:function(){this.permissions.on("read")},static:{test:()=>!1}})),te.register(ee.Class({extends:te,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(ae){return ae?localStorage[this.key]=ae:delete localStorage[this.key],Promise.resolve(ae)},static:{test:ae=>"local"==ae}}))}(Bliss),function(ee){var ae=Mavo.Formats={},re=ae.Base=ee.Class({abstract:!0,constructor:function(se){this.backend=se},proxy:{mavo:"backend"},parse:function(se){return this.constructor.parse(se,this)},stringify:function(se){return this.constructor.stringify(se,this)},static:{parse:se=>Promise.resolve(se),stringify:se=>Promise.resolve(se),extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(se=>ee.include(se.test,se.url)))}}}),ne=ae.JSON=ee.Class({extends:ae.Base,static:{parse:se=>Promise.resolve(se?JSON.parse(se):null),stringify:se=>Promise.resolve(Mavo.toJSON(se)),extensions:[".json",".jsonld"]}}),oe=ae.Text=ee.Class({extends:ae.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt",".md",".markdown"],parse:(se,le)=>Promise.resolve({[le?le.property:"content"]:se}),stringify:(se,le)=>Promise.resolve(se[le?le.property:"content"])}}),ie=ae.CSV=ee.Class({extends:ae.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=ee.extend({},ae.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:re.ready,parse:(se,le)=>ie.ready(()=>{var de=Papa.parse(se,ie.defaultOptions),pe=le?le.property:"content";if(le&&(le.options.delimiter=de.meta.delimiter,le.options.linebreak=de.meta.linebreak),de.meta.aborted)throw de.meta.errors.pop();return{[pe]:de.data}}),stringify:(se,le)=>ie.ready(()=>{var de=le?le.property:"content",pe=le?le.options:ie.defaultOptions;return Papa.unparse(data[de],pe)})}});Object.defineProperty(ae,"create",{value:function(se,le){if(se&&"object"==typeof se)return se;if("string"==typeof se)for(var de in se=se.toLowerCase(),ae){var pe=ae[de];if(de.toLowerCase()==se)return new pe(le)}if(!se){var ue=le.url?le.url.pathname:le.raw,ce=(ue.match(/\.\w+$/)||[])[0]||".json",pe=ae.JSON;for(var de in ae)-1<ae[de].extensions.indexOf(ce)&&(pe=ae[de]);return new pe(le)}}})}(Bliss,Bliss.$),function(ee,te){var ae=Mavo.Node=ee.Class({abstract:!0,constructor:function(re,ne,oe={}){if(!re||!ne)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var ie={context:this,options:oe};this.uid=++ae.maxId,this.nodeType=this.nodeType,this.property=null,ee.extend(this,ie.options),ae.all.set(re,[...(ae.all.get(this.element)||[]),this]),this.element=re,this.template=ie.options.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=ne,this.group=this.parentGroup=ie.options.group,this.fromTemplate("property","type")||(this.property=ae.getProperty(re),this.type=Mavo.Group.normalize(re),this.store=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",ie),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=ie.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup),Mavo.hooks.run("node-init-end",ie)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.store},get path(){var re=this.parentGroup?this.parentGroup.path:[];return this.property?[...re,this.property]:re},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){},getData:function(re={}){if(this.isDataNull(re))return null},isDataNull:function(re){var ne={context:this,options:re,result:this.deleted||!this.saved&&"*"!=re.store};return Mavo.hooks.run("unit-isdatanull",ne),ne.result},walk:function(re,ne=[]){var oe=(ie,se)=>{var le=re(ie,se);if(!1!==le)for(let de in ie.children){let pe=ie.children[de];if(pe instanceof Mavo.Node){var le=oe.call(pe,pe,[...se,de]);if(!1===le)return!1}}return!1!==le};return oe(this,ne)},walkUp:function(re){for(var oe,ne=this;ne=ne.parentGroup;)if(oe=re(ne),void 0!==oe)return oe},edit:function(){return this.mode="edit","edit"==this.mode&&void(this.propagate("edit"),Mavo.hooks.run("node-edit-end",this))},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(ee.unbind(this.element,".mavo:edit"),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(re){for(let ne in this.children){let oe=this.children[ne];oe instanceof Mavo.Node&&("function"==typeof re?re.call(oe,oe):re in oe&&oe[re]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(...re){if(this.template)for(let ne of re)this[ne]=this.template[ne];return!!this.template},render:function(re){this.data=re,re=Mavo.subset(re,this.inPath);var ne={context:this,data:re};if(Mavo.hooks.run("node-render-start",ne),"Collection"!=this.nodeType&&Array.isArray(re)){var oe;this.isRoot&&1===(oe=Object.keys(this.children)).length&&"Collection"===this.children[oe[0]].nodeType?ne.data={[oe[0]]:ne.data}:(this.inPath.push("0"),ne.data=ne.data[0])}this.editing?(this.done(),this.dataRender(ne.data),this.edit()):this.dataRender(ne.data),this.save(),Mavo.hooks.run("node-render-end",ne)},dataChanged:function(re,ne={}){ee.fire(ne.element||this.element,"mavo:datachange",ee.extend({property:this.property,action:re,mavo:this.mavo,node:this},ne))},toString:function(){return`#${this.uid}: ${this.nodeType} (${this.property})`},getClosestCollection:function(){return this.collection||this.group.collection||(this.parentGroup?this.parentGroup.closestCollection:null)},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},lazy:{closestCollection:function(){return this.getClosestCollection()},inPath:function(){return"Collection"==this.nodeType?[]:(this.element.getAttribute("mv-path")||"").split("/").filter(re=>re.length)}},live:{store:function(re){ee.toggleAttribute(this.element,"mv-storage",re)},unsavedChanges:function(re){return!re||this.saved&&this.editing||(re=!1),this.element.classList.toggle("mv-unsaved-changes",re),re},mode:function(re){if(this._mode!=re){if(this.modes&&re!=this.modes&&(re=this.modes),this._mode=re,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var ne=this.modes||"edit"==re;Mavo.Observer.sneak(this.mavo.modeObserver,()=>{ee.toggleAttribute(this.element,"mv-mode",re,ne)})}return re}},modes:function(re){return re&&"read"!=re&&"edit"!=re?null:void(this._modes=re,re&&this.mode!=re&&(this.mode=re))},deleted:function(re){this.element.classList.toggle("mv-deleted",re),re?(this.elementContents=document.createDocumentFragment(),te(this.element.childNodes).forEach(ne=>{this.elementContents.appendChild(ne)}),ee.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){ee.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:()=>this.deleted=!1}}]),this.element.classList.remove("mv-highlight")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"))}},static:{maxId:0,all:new WeakMap,create:function(re,ne,oe={}){return Mavo.is("multiple",re)&&!oe.collection?new Mavo.Collection(re,ne,oe):new Mavo[Mavo.is("group",re)?"Group":"Primitive"](re,ne,oe)},getProperty:function(re){var ne=re.getAttribute("property")||re.getAttribute("itemprop");return!ne&&re.hasAttribute("property")&&(ne=re.name||re.id||re.classList[0]),ne&&re.setAttribute("property",ne),ne},get:function(re,ne){var oe=(ae.all.get(re)||[]).filter(ie=>!(ie instanceof Mavo.Collection));return 2>oe.length||!ne?oe[0]:oe[0]instanceof Mavo.Group?node[1]:void 0},children:function(re){var ne=Mavo.Node.get(re);return ne?[ne]:(ne=te(Mavo.selectors.property,re).map(oe=>Mavo.Node.get(oe)).filter(oe=>!re.contains(oe.parentGroup.element)).map(oe=>oe.collection||oe),Mavo.Functions.unique(ne))}}})}(Bliss,Bliss.$),function(ee,te){var ae=Mavo.Group=ee.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});te(Mavo.selectors.property,this.element).forEach(le=>{var de=Mavo.Node.getProperty(le);if(this.contains(le)){var pe=this.children[de],ue=this.template?this.template.children[de]:null,ce={template:ue,group:this};if(pe){var ve=pe;pe instanceof Mavo.Collection||(ve=new Mavo.Collection(pe.element,this.mavo,ce),this.children[de]=pe.collection=ve,ve.add(pe)),!ve.mutable&&Mavo.is("multiple",le)&&(ve.mutable=!0),ve.add(le)}else{var he=Mavo.Node.create(le,this.mavo,ce);this.children[de]=he}}});var se=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=se.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(re="Node"){return Object.keys(this.children).filter(ne=>this.children[ne]instanceof Mavo[re])},getData:function(re={}){var ne={context:this,options:re,data:this.super.getData.call(this,re)};return void 0===ne.data?(ne.data={},this.propagate(oe=>{if((oe.saved||"*"==re.store)&&!(oe.property in ne.data)){var ie=oe.getData(re);(null!==ie||ne.options.null)&&(ne.data[oe.property]=ie)}}),ee.extend(ne.data,this.unhandled),this.type&&this.type!=ae.DEFAULT_TYPE&&(ne.data["@type"]=this.type),this.vocab&&(ne.data["@context"]=this.vocab),ne.data.summary&&(ne.data.toString=function(){return this.summary}),"*"!=re.store&&this.inPath.length&&(ne.data=Mavo.subset(this.data,this.inPath,ne.data)),Mavo.hooks.run("node-getdata-end",ne),ne.data):ne.data},find:function(re,ne={}){if(this.property==re)return this;if(re in this.children)return this.children[re].find(re,ne);var oe=[];for(var ie in this.children){var se=this.children[ie].find(re,ne);if(se!==void 0)if(Array.isArray(se))oe.push(...se);else return se}if(oe.length)return oe},save:function(){this.unsavedChanges=!1},propagated:["save","import","clear"],dataRender:function(re){if(re){var ne=this.unhandled;for(let oe in this.unhandled=ee.extend({},re,oe=>!(oe in this.children)),this.propagate(oe=>{oe.render(re[oe.property])}),this.unhandled){let ie=this.unhandled[oe];"object"==typeof ie||ne&&ne[oe]==ie||this.dataChanged("propertychange",{property:oe})}}},contains:function(re){return re instanceof Mavo.Node?re.parentGroup===this:re.parentNode&&this.element===re.parentNode.closest(Mavo.selectors.group)},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(re){if(Mavo.is("group",re)){var ne=Mavo.getAttribute(re,"typeof","itemtype")||ae.DEFAULT_TYPE;return re.setAttribute("typeof",ne),ne}return null}}})}(Bliss,Bliss.$),function(ee,te){var ae=Mavo.Primitive=ee.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(re){if(this.fromTemplate("config","attribute","templateValue")||(this.config=ae.getConfig(re),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&ee.events(this.element,this.config.changeEvents,se=>{se.target===this.element&&(this.value=this.getValue())}),this.editor||this.attribute||(this.editor=te(this.element.children).filter(function(se){return se.matches(Mavo.selectors.formControl)&&!se.matches(Mavo.selectors.property)})[0],this.editor&&(this.element.textContent=this.editorValue,ee.remove(this.editor))),!this.editor&&this.element.hasAttribute("mv-edit")){var ie=ee(this.element.getAttribute("mv-edit"));ie&&Mavo.is("formControl",ie)&&(this.editor=ie.cloneNode(!0),!this.template&&new Mavo.Observer(ie,"all",()=>{for(let le of this.copies)le.editor=ie.cloneNode(!0),le.setValue(le.value,{force:!0,silent:!0})}))}this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this._default="read"===this.modes?this.templateValue:this.editor?this.editorValue:void 0:""===this.default?this._default=this.templateValue:this.defaultObserver=new Mavo.Observer(this.element,"mv-default",()=>{this.default=this.element.getAttribute("mv-default")}),this.initialValue=(this.template||void 0!==this.default?this.default:this.templateValue)||this.emptyValue,this.setValue(this.initialValue,{silent:!0}),this.observer=new Mavo.Observer(this.element,this.attribute,()=>{(this.attribute||!this.editing)&&(this.value=this.getValue())}),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){if(this.config.getEditorValue)return this.config.getEditorValue.call(this);if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return ae.getValue(this.editor,{datatype:this.datatype});var re=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(re)return ae.getValue(re)}},set editorValue(re){if(this.config.setEditorValue)return this.config.setEditorValue.call(this,re);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))ae.setValue(this.editor,re,{config:this.editorDefaults});else{var ne=ee(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);ne&&ae.setValue(ne,re)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(re={}){var ne={context:this,options:re,data:this.super.getData.call(this,re)};return void 0===ne.data?(ne.data=this.value,""===ne.data&&(ne.data=null),"*"!=re.store&&this.inPath.length&&(ne.data=Mavo.subset(this.data,this.inPath,ne.data)),Mavo.hooks.run("node-getdata-end",ne),ne.data):ne.data},sneak:function(re){return Mavo.Observer.sneak(this.observer,re)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){if(!this.editor){var re=this.config.editor||Mavo.Elements.defaultEditors[this.datatype]||Mavo.Elements.defaultEditors.string;this.editor=ee.create("function"===ee.type(re)?re.call(this):re),this.editorValue=this.value}ee.events(this.editor,{"input change":()=>{this.value=this.editorValue},focus:()=>{this.editor.select&&this.editor.select()},"mavo:datachange":oe=>{"output"===oe.property&&(oe.stopPropagation(),ee.fire(this.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var ne=/^mv-edit-/i;te(this.element.attributes).forEach(function(oe){ne.test(oe.name)&&this.editor.setAttribute(oe.name.replace(ne,""),oe.value)},this),(this.attribute||this.config.popup)&&(this.popup=new ae.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){return!1!==this.super.edit.call(this)&&(this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0,this.element.addEventListener("click.mavo:edit",re=>re.preventDefault()),this.preEdit=Mavo.defer(re=>{if(this.empty&&!this.attribute)return re();var oe;ee.events(this.element,{"click.mavo:preedit":re,"focus.mavo:preedit":re}),this.attribute||ee.events(this.element,{"mouseenter.mavo:preedit":()=>{clearTimeout(oe),oe=setTimeout(re,150)},"mouseleave.mavo:preedit":()=>{clearTimeout(oe)}})}),this.config.edit?void this.config.edit.call(this):void this.preEdit.then(()=>{ee.unbind(this.element,".mavo:preedit"),this.initEdit&&this.initEdit(),this.popup&&this.popup.show(),this.attribute||this.popup||this.editor.parentNode==this.element||(this.editorValue=this.value,this.element.textContent="",this.element.appendChild(this.editor))}))},done:function(){return!1!==this.super.done.call(this)&&void("preEdit"in this&&ee.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(()=>{return this.config.done?void this.config.done.call(this):void(this.popup?this.popup.close():!this.attribute&&this.editor&&(ee.remove(this.editor),this.element.textContent=this.editorValue))}),null===this.element._.data.prevTabindex?this.element.removeAttribute("tabindex"):this.element.tabIndex=this.element._.data.prevTabindex)},clear:function(){"read"!=this.modes&&(this.value=this.emptyValue)},dataRender:function(re){if(re&&"object"==typeof re)if(Symbol.toPrimitive in re)re=re[Symbol.toPrimitive]();else for(let ne of[this.property,"value",...Object.keys(re)])if(ne in re){re=re[ne],this.inPath.push(ne);break}this.value=void 0===re?this.closestCollection?this.default:this.templateValue:re},find:function(re){if(this.property==re)return this},getValue:function(){return ae.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&ae.getConfig(this.editor)}},setValue:function(re,ne={}){return this.sneak(()=>{if("object"==ee.type(re)&&"value"in re){var oe=re.presentational;re=re.value}return re=re||0===re?re:"",this.datatype||"number"!=typeof re&&"boolean"!=typeof re||(this.datatype=typeof re),re=ae.safeCast(re,this.datatype),re!=this._value||ne.force?void(this.editor&&document.activeElement!=this.editor&&(this.editorValue=re),this.config.humanReadable&&this.attribute&&(oe=this.config.humanReadable.call(this,re)),(!this.editing||this.popup||!this.editor)&&(this.config.setValue?this.config.setValue.call(this,this.element,re):(this.editor&&this.editor.matches("select")&&this.editor.selectedOptions[0]&&(oe=this.editor.selectedOptions[0].textContent),!ne.dataOnly&&ae.setValue(this.element,{value:re,presentational:oe},{config:this.config,attribute:this.attribute,datatype:this.datatype}))),this.empty=""===re,this._value=re,!ne.silent&&(this.saved&&(this.unsavedChanges=this.mavo.unsavedChanges=!0),this.dataChanged("propertychange",{value:re}))):re}),re},dataChanged:function(re="propertychange",ne){return this.super.dataChanged.call(this,re,ne)},live:{default:function(re){this.value==this._default&&(this.value=re)},value:function(re){return this.setValue(re)},empty:function(re){var ne=re&&!this.modes&&this.config.default&&!(this.attribute&&ee(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!ne)}},static:{all:new WeakMap,getValueAttribute:function(re,ne=Mavo.Elements.search(re)){var oe=re.getAttribute("mv-attribute")||ne.attribute;return oe&&"null"!==oe||(oe=null),oe},safeCast:function(re,ne){var ie=ae.cast(re,ne);return null===re||void 0===re?re:"boolean"==ne?"false"===re||0===re||""===re?!1:"true"===re||0<re||re:"number"==ne?/^[-+]?[0-9.e]+$/i.test(re+"")?ie:re:ie},cast:function(re,ne){return"number"===ne?+re:"boolean"===ne?!!re:"string"===ne?re+"":re},getValue:function(re,{config:ne,attribute:oe,datatype:ie}){if(ne||(ne=ae.getConfig(re,oe)),oe=ne.attribute,ie=ne.datatype,ne.getValue&&oe==ne.attribute)return ne.getValue(re);var se;return se=oe in re&&ae.useProperty(re,oe)?re[oe]:oe?re.getAttribute(oe):re.getAttribute("content")||re.textContent||null,ae.safeCast(se,ie)},getConfig:function(re,ne){void 0===ne&&(ne=re.getAttribute("mv-attribute")||void 0),("null"==ne||"none"==ne)&&(ne=null);var oe=Mavo.Elements.search(re,ne);return void 0===oe.attribute&&(oe.attribute=ne||null),oe},setValue:function(re,ne,{config:oe,attribute:ie,datatype:se}){if("object"==ee.type(ne)&&"value"in ne){var le=ne.presentational;ne=ne.value}if(1===re.nodeType&&(oe||(oe=ae.getConfig(re,ie)),ie=oe.attribute,se=void 0===se?oe.datatype:se,oe.setValue&&ie==oe.attribute))return oe.setValue(re,ne);if(ie){if(ie in re&&ae.useProperty(re,ie)&&re[ie]!==ne)try{re[ie]=ne}catch(de){}"boolean"==se?ne!=re.hasAttribute(ie)&&ee.toggleAttribute(re,ie,ne,ne):re.getAttribute(ie)!=ne&&(re.setAttribute(ie,ne),le&&(re.textContent=le))}else"number"!==se||le||(le=ae.formatNumber(ne)),re.textContent=le||ne,le&&re.setAttribute&&re.setAttribute("content",ne)},useProperty:function(re,ne){return!(-1<["href","src"].indexOf(ne))&&"http://www.w3.org/2000/svg"!=re.namespaceURI},lazy:{formatNumber:()=>{var re=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(ne){return ne===Infinity||ne===-Infinity?0>ne?"-\u221E":"\u221E":re.format(ne)}}}}});ae.Popup=ee.Class({constructor:function(re){this.primitive=re,this.popup=ee.create("div",{className:"mv-popup",hidden:!0,contents:[this.primitive.label+":",this.editor],events:{keyup:ne=>{(13==ne.keyCode||27==ne.keyCode)&&(this.popup.contains(document.activeElement)&&this.element.focus(),ne.stopPropagation(),this.hide())}}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){ee.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=re=>{this.popup.contains(re.target)||this.element.contains(re.target)||this.hide()},this.position=()=>{var ne=this.element.getBoundingClientRect(),oe=ne.left,ie=ne.bottom;ee.style(this.popup,{top:`${ie}px`,left:`${oe}px`})},this.position(),document.body.appendChild(this.popup),requestAnimationFrame(()=>this.popup.removeAttribute("hidden")),ee.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){ee.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(()=>{ee.remove(this.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),ee.events(this.element,{"click.mavo:showpopup":()=>{this.show()},"keyup.mavo:showpopup":re=>{-1<[13,113].indexOf(re.keyCode)&&(this.show(),this.editor.focus())}})},close:function(){this.hide(),ee.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})}(Bliss,Bliss.$),function(ee){var ae=Mavo.Elements={};Object.defineProperties(ae,{register:{value:function(re){if("object"==typeof arguments[0]){for(let ie in arguments[0])ae.register(ie,arguments[0][ie]);return}var oe=Mavo.toArray(arguments[1]);for(config of oe){config.attribute=Mavo.toArray(config.attribute||null);for(attribute of config.attribute){let ie=ee.extend({},config);ie.attribute=attribute,ae[re]=ae[re]||[],ae[re].push(ie)}}return ae}},search:{value:function(re,ne,oe){var ie=ae.matches(re,ne,oe);return ie[ie.length-1]||{attribute:ne}}},matches:{value:function(re,ne,oe){var ie=[];selectorloop:for(var se in ae)if(re.matches(se)){var le=ae[se];for(var de of le){var pe=ne===void 0&&de.default||ne===de.attribute;pe&&(void 0===oe||"string"===oe||oe===de.datatype)&&(!de.test||de.test(re,ne,oe))&&ie.push(de)}}return ie}},isSVG:{value:re=>"http://www.w3.org/2000/svg"==re.namespaceURI},defaultEditors:{value:{string:{tag:"input"},number:{tag:"input",type:"number"},boolean:{tag:"input",type:"checkbox"}}}}),ae.register({"*":[{test:(re,ne)=>"hidden"==ne,attribute:"hidden",datatype:"boolean"},{test:ae.isSVG,attribute:"y",datatype:"number"},{default:!0,test:ae.isSVG,attribute:"x",datatype:"number"}],"img, video, audio":{default:!0,attribute:"src",editor:{tag:"input",type:"url",placeholder:"http://example.com"}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},"select, input":{attribute:"value",default:!0,modes:"read",changeEvents:"input change"},textarea:{default:!0,modes:"read",changeEvents:"input",getValue:re=>re.value,setValue:(re,ne)=>re.value=ne},"input[type=range], input[type=number]":{default:!0,attribute:"value",datatype:"number",modes:"read",changeEvents:"input change"},"input[type=checkbox]":{default:!0,attribute:"checked",datatype:"boolean",modes:"read",changeEvents:"click"},"input[type=radio]":{default:!0,attribute:"checked",modes:"read",getValue:re=>{if(re.form)return re.form[re.name].value;var ne=ee(`input[type=radio][name="${re.name}"]:checked`);return ne&&ne.value},setValue:(re,ne)=>{if(re.form)return void(re.form[re.name].value=ne);var oe=ee(`input[type=radio][name="${re.name}"][value="${ne}"]`);ee.properties(oe,{checked:!0})},init:function(re){this.mavo.element.addEventListener("change",ne=>{ne.target.name==re.name&&(this.value=this.getValue())})}},"button, .counter":{default:!0,attribute:"mv-clicked",datatype:"number",modes:"read",init:function(re){"mv-clicked"===this.attribute&&(re.setAttribute("mv-clicked","0"),re.addEventListener("click",()=>{let oe=+re.getAttribute("mv-clicked")||0;this.value=++oe}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var re=+this.element.getAttribute("min")||0,ne=+this.element.getAttribute("max")||1,oe=ne-re,ie=+this.element.getAttribute("mv-edit-step")||(1<oe?1:oe/100);this.element.addEventListener("mousemove.mavo:edit",se=>{var le=this.element.getBoundingClientRect().left,de=Math.max(0,(se.clientX-le)/this.element.offsetWidth),pe=re+oe*de,ue=pe%ie;pe+=ue>ie/2?ie-ue:-ue,pe=Math.max(re,Math.min(pe,ne)),this.sneak(()=>this.element.setAttribute("value",pe))}),this.element.addEventListener("mouseleave.mavo:edit",()=>{this.sneak(()=>this.element.setAttribute("value",this.value))}),this.element.addEventListener("click.mavo:edit",()=>{this.value=this.getValue()}),this.element.addEventListener("keydown.mavo:edit",se=>{if(se.target==this.element&&(37==se.keyCode||39==se.keyCode)){var le=ie*(39==se.keyCode?1:-1)*(se.shiftKey?10:1),de=this.value+le;de=Math.max(re,Math.min(de,ne)),this.element.setAttribute("value",de)}})},done:function(){ee.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address":{default:!0,editor:function(){var re=getComputedStyle(this.element).display,ne=0===re.indexOf("inline")?"input":"textarea",oe=ee.create(ne);if("textarea"==ne){var ie=this.element.offsetWidth;ie&&(oe.width=ie)}return oe},setEditorValue:function(re){if(!(this.datatype&&"string"!=this.datatype)){var ne=getComputedStyle(this.element);return re=re||"",-1<["normal","nowrap"].indexOf(ne.whiteSpace)&&(re=re.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(ne.whiteSpace)&&(re=re.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=re,!0}}},time:{attribute:"datetime",default:!0,editor:function(){var re={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},ne=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var oe in re)if(re[oe].test(ne))break;return{tag:"input",type:oe}},humanReadable:function(re){var ne=new Date(re);if(!re||isNaN(ne))return"(No "+this.label+")";var oe={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},ie=oe[this.editor&&this.editor.type]||oe.date;return ie.timeZone="UTC",ne.toLocaleString("en-GB",ie)}},circle:[{default:!0,attribute:"r",datatype:"number"},{attribute:["cx","cy"],datatype:"number"}],text:{default:!0,popup:!0}})}(Bliss,Bliss.$),function(ee,te){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var ae=Mavo.Collection=ee.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){if(this.templateElement=this.element,this.children=[],this.fromTemplate("properties","mutable","templateElement","accepts")||(this.properties=te(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0)),this.mutable){var ie=this.createItem(this.element);this.add(ie),this.itemTemplate=ie.template||ie}this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(re={}){var ne={context:this,options:re,data:[]};for(item of this.children)if(!item.deleted||re.null){let oe=item.getData(ne.options);(oe||re.null)&&ne.data.push(oe)}return this.unhandled&&(ne.data=this.unhandled.before.concat(ne.data,this.unhandled.after)),this.mutable||1!=ne.data.length||(ne.data=ne.data[0]),Mavo.hooks.run("node-getdata-end",ne),ne.data},createItem:function(re){re||(re=this.templateElement.cloneNode(!0));var ne=Mavo.Node.create(re,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return ne},add:function(re,ne,oe={}){if(re=re instanceof Node?Mavo.Node.get(re)||this.createItem(re):re||this.createItem(),re.collection!=this&&this.adopt(re),this.mutable){var ie=this.children[ne]?this.children[ne].element:this.marker;ee[this.bottomUp?"after":"before"](re.element,ie),void 0===ne&&(ne=this.bottomUp?0:this.length)}var se={context:this,item:re};return se.previousIndex=re.index,se.changed=this.splice({remove:se.item},{index:ne,add:se.item}),oe.silent||(se.changed.forEach(le=>{le.dataChanged(le==se.item&&void 0===se.previousIndex?"add":"move"),le.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0),Mavo.hooks.run("collection-add-end",se),se.item},splice:function(...re){for(let oe of re)void 0===oe.index&&oe.remove&&isNaN(oe.remove)&&(oe.index=this.children.indexOf(oe.remove),oe.remove=1);re.sort((oe,ie)=>ie.index-oe.index);for(let oe of re)-1<oe.index&&(oe.remove||oe.add)&&(oe.remove=oe.remove||0,oe.add=Mavo.toArray(oe.add),this.children.splice(oe.index,+oe.remove,...oe.add));var ne=[];for(let ie,oe=0;oe<this.length;oe++)ie=this.children[oe],ie&&ie.index!==oe&&(ie.index=oe,ne.push(ie));return ne},adopt:function(re){re.collection&&(re.collection.splice({remove:re}),re.collection.dataChanged("delete")),this.walk(ne=>{ne.closestCollection===re.collection&&(ne.closestCollection=this),re.mavo!=this.mavo&&(re.mavo=this.mavo)}),re.collection=this,re.template&&(Mavo.delete(re.template.copies,re),re.template=this.itemTemplate)},delete:function(re,ne){return ne?(ee.remove(re.element),this.splice({remove:re}),void re.destroy()):ee.transition(re.element,{opacity:0}).then(()=>{re.deleted=!0,re.element.style.opacity="",re.dataChanged("delete"),this.unsavedChanges=re.unsavedChanges=this.mavo.unsavedChanges=!0})},move:function(re,ne){index=re.index+ne+(0<ne),0>index?index=this.children.length:index>this.children.length&&(index=0),this.add(re,index)},editItem:function(re){re.itemControls||(re.itemControls=te(".mv-item-controls",re.element).filter(ne=>{return ne.closest(Mavo.selectors.multiple)==re.element&&!Mavo.data(ne,"item")})[0],re.itemControls=re.itemControls||ee.create({className:"mv-item-controls mv-ui"}),Mavo.data(re.itemControls,"item",re),ee.set(re.itemControls,{contents:[{tag:"button",title:"Delete this "+re.name,className:"mv-delete",events:{click:()=>re.collection.delete(re)}},{tag:"button",title:`Add new ${re.name.replace(/s$/i,"")} ${this.bottomUp?"after":"before"}`,className:"mv-add",events:{click:ne=>{var oe=this.add(null,re.index);return ne[Mavo.superKey]&&oe.render(re.data),Mavo.scrollIntoViewIfNeeded(oe.element),this.editItem(oe)}}},{tag:"button",title:"Drag to reorder "+re.name,className:"mv-drag-handle",events:{click:ne=>ne.target.focus(),keydown:ne=>{37<=ne.keyCode&&40>=ne.keyCode&&(this.move(re,38>=ne.keyCode?-1:1),ne.stopPropagation(),ne.preventDefault(),ne.target.focus())}}}]})),re.itemControls.parentNode||Mavo.revocably.add(re.itemControls)||(re instanceof Mavo.Primitive&&!re.attribute?(re.itemControls.classList.add("mv-adjacent"),ee.after(re.itemControls,re.element)):re.element.appendChild(re.itemControls)),re.edit()},edit:function(){if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var re=this.element.tagName.toLowerCase(),ne=Mavo.selectors.container[re],oe=ne?this.marker.parentNode.closest(ne):this.marker;ee[this.bottomUp?"before":"after"](this.addButton,oe)}this.propagate(ie=>{this.editItem(ie)}),ae.dragula.then(()=>{this.getDragula()})}},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(re=>Mavo.revocably.remove(re.itemControls,"item controls"))))},clear:function(){this.mutable&&(this.propagate(re=>{re.element.remove(),re.destroy()}),this.children=[],this.dataChanged("clear"))},dataChanged:function(re,ne={}){return ne.element=ne.element||this.marker,this.super.dataChanged.call(this,re,ne)},save:function(){for(let re of this.children)re.deleted?this.delete(re,!0):re.unsavedChanges=!1},propagated:["save"],dataRender:function(re){if(this.unhandled={before:[],after:[]},!!re)if(re=Mavo.toArray(re),!this.mutable)this.children.forEach((de,pe)=>de.render(re&&re[pe])),re&&(this.unhandled.after=re.slice(this.length));else{for(var ne=0;ne<this.children.length;ne++)ne<re.length?this.children[ne].render(re[ne]):this.delete(this.children[ne],!0);if(re.length>ne){for(var se,oe=document.createDocumentFragment(),ie=ne;ie<re.length;ie++){se=this.createItem(),se.render(re[ie]),this.children.push(se),se.index=ie,oe.appendChild(se.element);var le={context:this,item:se};Mavo.hooks.run("collection-add-end",le)}this.bottomUp?ee.after(oe,0<ne?this.children[ne-1].element:this.marker):ee.before(oe,this.marker)}}},find:function(re,ne={}){var oe=this.children.filter(se=>!se.deleted);if(this.property==re)return ne.collections?this:oe;if(-1<this.properties.indexOf(re)){var ie=oe.map(se=>se.find(re,ne));return Mavo.flatten(ie)}},isCompatible:function(re){return re&&this.itemTemplate.nodeType==re.itemTemplate.nodeType&&(re===this||re.template==this||this.template==re||this.template&&this.template==re.template||-1<this.accepts.indexOf(re.property))},live:{mutable:function(re){re&&re!==this.mutable&&(this._mutable=re,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),ee.after(this.marker,this.templateElement))}},getDragula:function(){if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:ne=>{return!!this.accepts.length&&-1<Mavo.flatten(this.accepts.map(oe=>this.mavo.root.find(oe,{collections:!0}))).filter(oe=>oe&&oe instanceof ae).map(oe=>oe.marker.parentNode).indexOf(ne)},moves:(ne,oe,ie)=>{return ie.classList.contains("mv-drag-handle")&&ie.closest(Mavo.selectors.multiple)==ne},accepts:function(ne,oe,ie,se){if(ne.contains(oe))return!1;var le=se?se.previousElementSibling:oe.lastElementChild,de=ae.get(le)||ae.get(se);if(!de)return!1;var pe=Mavo.Node.get(ne);return pe&&pe.collection.isCompatible(de)}}),this.dragula.on("drop",ne=>{var se=Mavo.Node.get(ne),le=se&&se.index,de=ne.nextElementSibling,pe=ne.previousElementSibling,ue=ae.get(pe)||ae.get(de),ce=Mavo.Node.get(pe)||Mavo.Node.get(de);if(ce&&ce.collection!=ue&&(ce=null),se.collection.isCompatible(ue)){var ve=ce?ce.index+(ce.element===pe):ue.length;ue.add(se,ve)}else return this.dragula.cancel(!0)}),ae.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var re=this.templateElement.getAttribute("mv-order");return null===re?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(re)},closestCollection:function(){var re=this.marker?this.marker.parentNode:this.templateElement.parentNode;return re.closest(Mavo.selectors.multiple)},addButton:function(){var re=`button.mv-add-${this.property}`,ne=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(ne)var oe=te(re,ne).filter(ie=>{return!this.templateElement.contains(ie)})[0];return oe||(oe=ee.create("button",{className:"mv-add",textContent:"Add "+this.name})),oe.classList.add("mv-ui","mv-add"),Mavo.data(oe,"collection",this),this.property&&oe.classList.add(`mv-add-${this.property}`),oe.addEventListener("click",ie=>{ie.preventDefault(),this.editItem(this.add())}),oe}},static:{dragulas:[],get:re=>{var ne=Mavo.data(re,"collection");if(ne)return ne;var oe=Mavo.Node.get(re);return oe&&oe.collection||null},lazy:{dragula:()=>ee.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}})}(Bliss,Bliss.$),function(ee){Mavo.attributes.push("mv-expressions");var te=Mavo.Expression=ee.Class({constructor:function(ae){this.expression=ae},eval:function(ae){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this.function||(this.function=te.compile(this.expression),this.identifiers=this.expression.match(/[$a-z][$\w]*/ig)||[]),this.value=this.function(ae)}catch(re){console.info("%cExpression error!","color: red; font-weight: bold",`${re.message} in expression ${this.expression}`),Mavo.hooks.run("expression-eval-error",{context:this,exception:re}),this.value=re}return this.value},toString(){return this.expression},changedBy:function(ae){if(!ae)return!0;if(!this.identifiers)return!1;if(-1<this.identifiers.indexOf(ae.property))return!0;if(Mavo.hasIntersection(ae.properties,this.identifiers))return!0;if("propertychange"!=ae.action){if(Mavo.hasIntersection(["$index","$all","$previous","$next"],this.identifiers))return!0;var re=ae.node.collection||ae.node;if(Mavo.hasIntersection(re.properties,this.identifiers))return!0}return!!Mavo.hasIntersection(Mavo.allIds,this.identifiers)},live:{expression:function(ae){ae=ae;this.function=null}},static:{serializers:{BinaryExpression:ae=>`${te.serialize(ae.left)} ${ae.operator} ${te.serialize(ae.right)}`,UnaryExpression:ae=>`${ae.operator}${te.serialize(ae.argument)}`,CallExpression:ae=>`${te.serialize(ae.callee)}(${ae.arguments.map(te.serialize).join(", ")})`,ConditionalExpression:ae=>`${te.serialize(ae.test)}? ${te.serialize(ae.consequent)} : ${te.serialize(ae.alternate)}`,MemberExpression:ae=>`get(${te.serialize(ae.object)}, "${ae.property.name||ae.property.value}")`,ArrayExpression:ae=>`[${ae.elements.map(te.serialize).join(", ")}]`,Literal:ae=>ae.raw,Identifier:ae=>ae.name,ThisExpression:()=>"this",Compound:ae=>ae.body.map(te.serialize).join(" ")},transformations:{BinaryExpression:ae=>{let re=Mavo.Script.getOperatorName(ae.operator),ne=Mavo.Script.operators[re];var oe=ae,ie=[];do ie.unshift(oe.right),oe=oe.left;while(Mavo.Script.getOperatorName(oe.operator)===re);if(ie.unshift(oe),1<ie.length)return`${re}(${ie.map(te.serialize).join(", ")})`},CallExpression:ae=>{"Identifier"==ae.callee.type&&"if"==ae.callee.name&&(ae.callee.name="iff")}},serialize:ae=>{if(te.transformations[ae.type]){var re=te.transformations[ae.type](ae);if(re!==void 0)return re}return te.serializers[ae.type](ae)},rewrite:function(ae){try{return te.serialize(te.parse(ae))}catch(re){return ae}},compile:function(ae){return ae=te.rewrite(ae),new Function("data",`with(Mavo.Functions._Trap)
					with(data) {
						return ${ae};
					}`)},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.addBinaryOp("mod",10),jsep.removeBinaryOp("===")),te.serializers.LogicalExpression=te.serializers.BinaryExpression,te.transformations.LogicalExpression=te.transformations.BinaryExpression,te.Syntax=ee.Class({constructor:function(ae,re){this.start=ae,this.end=re,this.regex=RegExp(`${Mavo.escapeRegExp(ae)}([\\S\\s]+?)${Mavo.escapeRegExp(re)}`,"gi")},test:function(ae){return this.regex.lastIndex=0,this.regex.test(ae)},tokenize:function(ae){var re,ne=[],oe=0;for(this.regex.lastIndex=0;null!==(re=this.regex.exec(ae));)re.index>oe&&ne.push(ae.substring(oe,re.index)),oe=this.regex.lastIndex,ne.push(new Mavo.Expression(re[1]));return oe<ae.length&&ne.push(ae.substring(oe)),ne},static:{create:function(ae){if(ae){var re=ae.getAttribute("mv-expressions");if(re)return re=re.trim(),/\s/.test(re)?new te.Syntax(...re.split(/\s+/)):te.Syntax.ESCAPE}},ESCAPE:-1}}),te.Syntax.default=new te.Syntax("[","]")}(Bliss),function(ee){var te=Mavo.DOMExpression=ee.Class({constructor:function(ae={}){this.mavo=ae.mavo,this.template=ae.template&&ae.template.template||ae.template;for(let ne of["item","path","syntax","fallback","attribute"])this[ne]=void 0===ae[ne]&&this.template?this.template[ne]:ae[ne];if(this.node=ae.node,this.node||(this.node=this.path.reduce((ne,oe)=>{return ne.childNodes[oe]},this.item.element)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),!this.expression){if(3===this.node.nodeType&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var re=this.node.firstChild.textContent.match(/^\s*|\s*$/g);re[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-re[1].length),ee.after(this.node.lastChild,this.node)),re[0]&&(this.node.firstChild.splitText(re[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=ae.template?ae.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(ne=>ne instanceof Mavo.Expression?ne.expression:ne),this.mavo.treeBuilt.then(()=>{this.template||(this.item=Mavo.Node.get(this.element.closest(Mavo.selectors.multiple+", "+Mavo.selectors.group)),this.item.expressions=[...(this.item.expressions||[]),this]),Mavo.hooks.run("domexpression-init-treebuilt",this)}),Mavo.hooks.run("domexpression-init-end",this),te.elements.set(this.element,[...(te.elements.get(this.element)||[]),this])},changedBy:function(ae){return!this.parsed.every(re=>!(re instanceof Mavo.Expression)||!re.changedBy(ae))},update:function(ae=this.data,re){var ne={context:this,ret:{},event:re},oe=ne;this.data=ae,ne.ret={},Mavo.hooks.run("domexpression-update-start",ne),this.oldValue=this.value,ne.ret.value=this.value=this.parsed.map((ie,se)=>{if(ie instanceof Mavo.Expression){if(ie.changedBy(oe.event)){var le={context:this,expr:ie,parentEnv:oe};return Mavo.hooks.run("domexpression-update-beforeeval",le),le.value=le.expr.eval(ae),Mavo.hooks.run("domexpression-update-aftereval",le),le.value instanceof Error?void 0===this.fallback?le.expr.expression:this.fallback:void 0===le.value||null===le.value?"":le.value}return this.oldValue[se]}return ie}),this.attribute||(ne.ret.presentational=this.value.map(ie=>{return Array.isArray(ie)?ie.join(", "):"number"==typeof ie?Mavo.Primitive.formatNumber(ie):ie}),ne.ret.presentational=1===ne.ret.presentational.length?ne.ret.presentational[0]:ne.ret.presentational.join("")),ne.ret.value=1===ne.ret.value.length?ne.ret.value[0]:ne.ret.value.join(""),this.primitive&&1===this.parsed.length&&("number"==typeof ne.ret.value?this.primitive.datatype="number":"boolean"==typeof ne.ret.value&&(this.primitive.datatype="boolean")),ne.ret.presentational===ne.ret.value&&(ret=ne.ret.value),this.output(ne.ret),Mavo.hooks.run("domexpression-update-end",ne)},output:function(ae){this.primitive?this.primitive.value=ae:(ae=ae.presentational||ae,Mavo.Primitive.setValue(this.node,ae,{attribute:this.attribute}))},static:{elements:new WeakMap,search:function(ae,re){var ne=te.elements.get(ae)||[];return 1<arguments.length?ne.length?ne.filter(oe=>oe.attribute===re)[0]||null:null:ne}}});Mavo.hooks.add("primitive-init-start",function(){var ae=Mavo.DOMExpression.search(this.element,this.attribute);ae&&!ae.mavoNode&&(ae.primitive=this,this.storage=this.storage||"none",this.modes="read")})}(Bliss),function(ee,te){var ae=Mavo.Expressions=ee.Class({constructor:function(re){this.mavo=re,this.active=!0,this.expressions=[];var ne=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,ne),this.scheduled=new Set,this.mavo.treeBuilt.then(()=>{this.expressions=[],this.mavo.element.addEventListener("mavo:datachange",oe=>{this.active&&("propertychange"==oe.action&&oe.node.closestCollection?!this.scheduled.has(oe.property)&&(setTimeout(()=>{this.scheduled.delete(oe.property),this.update(oe)},ae.PROPERTYCHANGE_THROTTLE),this.scheduled.add(oe.property)):requestAnimationFrame(()=>this.update(oe)))}),this.update()})},update:function(re){var ne,oe;re instanceof Element&&(ne=re.closest(Mavo.selectors.group),re=null),ne=ne||this.mavo.element,oe=Mavo.Node.get(ne);var ie=oe.getData({relative:!0,store:"*",null:!0});oe.walk((se,le)=>{if(se.expressions&&se.expressions.length&&!se.isDeleted()){let de={context:this,data:ee.value(ie,...le)};Mavo.hooks.run("expressions-update-start",de);for(let pe of se.expressions)pe.changedBy(re)&&pe.update(de.data,re)}})},extract:function(re,ne,oe,ie){ne&&"mv-expressions"==ne.name||(ne&&-1<ae.directives.indexOf(ne.name)||ie.test(ne?ne.value:re.textContent))&&this.expressions.push(new Mavo.DOMExpression({node:re,syntax:ie,path:oe?oe.slice(1).split("/").map(se=>+se):[],attribute:ne&&ne.name,mavo:this.mavo}))},traverse:function(re,ne="",oe){if(8!==re.nodeType)if(3===re.nodeType)this.extract(re,null,ne,oe);else{if(re.normalize(),oe=Mavo.Expression.Syntax.create(re)||oe,oe===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("multiple",re)&&(ne=""),te(re.attributes).forEach(ie=>this.extract(re,ie,ne,oe)),te(re.childNodes).forEach((ie,se)=>this.traverse(ie,`${ne}/${se}`,oe))}},static:{directives:[],PROPERTYCHANGE_THROTTLE:50,directive:function(re,ne){ae.directives.push(re),Mavo.attributes.push(re),Mavo.plugin(ne)}}});Mavo.hooks.add({"init-tree-before":function(){this.expressions=new Mavo.Expressions(this)},"node-init-end":function(){var re=this.template;re&&re.expressions&&(this.expressions=re.expressions.map(ne=>new Mavo.DOMExpression({template:ne,item:this,mavo:this.mavo})))},"render-start":function(){this.expressions.active=!1},"render-end":function(){this.expressions.active=!0,this.expressions.update()},"collection-add-end":function(re){this.mavo.treeBuilt.then(()=>this.mavo.expressions.update(re.item.element))},"node-getdata-end":self.Proxy&&function(re){if(re.options.relative&&(re.data&&"object"==typeof re.data||this.collection)){var ne=re.data;this instanceof Mavo.Primitive&&(re.data={[Symbol.toPrimitive]:()=>ne,[this.property]:ne}),re.data=new Proxy(re.data,{get:(oe,ie,se)=>{if(ie in oe||ie in se&&ie in oe)return oe[ie]},has:(oe,ie)=>{if(ie in oe)return!0;if("$index"==ie)return oe[ie]=this.index||0,!0;if("$all"==ie)return oe[ie]=this.closestCollection?this.closestCollection.getData(re.options):[re.data];if("$next"==ie||"$previous"==ie)return this.closestCollection?oe[ie]=this.closestCollection.getData(re.options)[this.index+("$next"==ie?1:-1)]:(oe[ie]=null,null);if(ie==this.mavo.id)return oe[ie]=this.mavo.root.getData(re.options);if(this instanceof Mavo.Group&&ie==this.property&&this.collection)return oe[ie]=re.data;var se=this.walkUp(le=>{if(ie in le.children)return le.children[ie]});return void 0===se&&(se=this.find(ie)),void 0!==se&&(Array.isArray(se)?se=se.map(le=>le.getData(re.options)).filter(le=>null!==le):se instanceof Mavo.Node&&(se=se.getData(re.options)),oe[ie]=se,!0)},set:function(){throw Error("You can\u2019t set data via expressions.")}})}}})}(Bliss,Bliss.$),function(ee,te){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(ae){this._hidden!==ae&&(this._hidden=ae,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){if("mv-if"==this.attribute){var ae=te(Mavo.selectors.property,this.element).filter(re=>re.closest("[mv-if]")==this.element).map(re=>Mavo.Node.get(re));return this.element.addEventListener("mavo:datachange",re=>{requestAnimationFrame(()=>{this.element.parentNode||this.item.element.dispatchEvent(re)})}),ae}}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){if("mv-if"==this.attribute){var ae=this.value[0],re=this.oldValue[0];this.item.mavo.treeBuilt.then(()=>{if(this.parentIf){var ne=this.parentIf.value[0];this.value[0]=ae=ae&&ne}if(ae!==re){if(!1!==ne&&(ae?Mavo.revocably.add(this.element):this.element.parentNode&&Mavo.revocably.remove(this.element,"mv-if")),this.childProperties)for(let oe of this.childProperties)oe.hidden=!ae;if(this.childIfs)for(let oe of this.childIfs)oe.update()}})}},"unit-isdatanull":function(ae){ae.result=ae.result||this.hidden&&"*"==ae.options.store}}})}(Bliss,Bliss.$),Mavo.Expressions.directive("mv-value",{hooks:{"node-init-start":function(){if(this instanceof Mavo.Group||this.collection){var ee=Mavo.DOMExpression.search(this.element).filter(te=>"mv-value"==te.originalAttribute)[0];ee&&(ee.mavoNode=this,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[...(this.collection.expressions||[]),ee],ee.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}},"domexpression-init-start":function(){"mv-value"!=this.attribute||(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end)},"domexpression-init-treebuilt":function(){"mv-value"==this.originalAttribute&&this.mavoNode&&(this.mavoNode==this.item||this.mavoNode==this.item.collection)&&(this.mavoNode==this.item.collection&&Mavo.delete(this.item.expressions,this),this.output=function(ee){ee=ee.value||ee,this.mavoNode.render(ee)},this.changedBy=()=>!0)},"domexpression-update-start":function(){"mv-value"==this.originalAttribute&&this.mavoNode==this.item}}}),function(){function ee(re,ne){return re=Array.isArray(re)?re:ne?$$(ne):[re],re.filter(oe=>!isNaN(oe)&&""!==oe).map(oe=>+oe)}var te=Mavo.Functions={operators:{"=":"eq"},get $now(){return new Date},urlOption:function(...re){var ne="searchParams"in URL.prototype?new URL(location).searchParams:null,oe=null;for(let se of re){if(ne)oe=ne.get(se);else{var ie=location.search.match(RegExp(`[?&]${se}(?:=([^&]+))?(?=&|$)`,"i"));oe=ie&&(ie[1]||"")}if(null!==oe)return oe}return null},get:function(re,ne){return re&&void 0!==re[ne]?re[ne]:null},unique:function(re){return[...new Set(re)]},sum:function(re){return ee(re,arguments).reduce((ne,oe)=>{return+ne+(+oe||0)},0)},average:function(re){return re=ee(re,arguments),re.length&&te.sum(re)/re.length},min:function(re){return Math.min(...ee(re,arguments))},max:function(re){return Math.max(...ee(re,arguments))},count:function(re){return Mavo.toArray(re).filter(ne=>null!==ne&&!1!==ne&&""!==ne).length},round:function(re,ne){return re&&ne&&isFinite(re)?+re.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:ne}):Math.round(re)},iff:function(re,ne,oe=""){return Array.isArray(re)?re.map((ie,se)=>{var le=ie?ne:oe;return Array.isArray(le)?le[Math.min(se,le.length-1)]:le}):re?ne:oe},replace:function(re,ne,oe="",ie=1){if(Array.isArray(re))return re.map(ue=>te.replace(ue,ne,oe));for(var de,se=RegExp(Mavo.escapeRegExp(ne),"g"),le=re,pe=0;le!=de&&pe++<ie;)de=le,le=le.replace(se,oe);return le},len:re=>(re||"").length,search:(re,ne)=>re&&ne?re.toLowerCase().indexOf(ne.toLowerCase()):-1,starts:(re,ne)=>0===te.search(re,ne),ends:function(re,ne){var oe=te.search(re,ne);return-1<oe&&oe===re.length-ne.length},join:function(re,ne=""){return Mavo.toArray(re).join(ne)},idify:re=>((re||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase(),readable:function(re){return re&&re.replace(/([a-z])([A-Z])(?=[a-z])/g,(ne,oe,ie)=>oe+" "+ie.toLowerCase()).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,ne=>ne.toUpperCase())},uppercase:re=>(re+"").toUpperCase(),lowercase:re=>(re+"").toLowerCase()};for(let re in Mavo.Script={addUnaryOperator:function(re,ne){return oe=>Array.isArray(oe)?oe.map(ne.scalar):ne.scalar(oe)},addBinaryOperator:function(re,ne){if(ne.symbol)for(let oe of Mavo.toArray(ne.symbol))Mavo.Script.symbols[oe]=re;return ne.identity=void 0===ne.identity?0:ne.identity,te[re]=ne.code||function(...oe){1===oe.length&&Array.isArray(oe[0])&&(oe=[...oe[0]]);var se,ie=ne.logical?ne.identity:oe[0];for(let le=1;le<oe.length;le++){let de=ne.logical?oe[le-1]:ie,pe=oe[le];Array.isArray(pe)?("number"==typeof ne.identity&&(pe=ee(pe)),se=Array.isArray(de)?[...pe.map((ue,ce)=>ne.scalar(void 0===de[ce]?ne.identity:de[ce],ue)),...de.slice(pe.length)]:pe.map(ue=>ne.scalar(de,ue))):("number"==typeof ne.identity&&(pe=+pe),se=Array.isArray(de)?de.map(ue=>ne.scalar(ue,pe)):ne.scalar(de,pe)),ie=ne.reduce?ne.reduce(ie,se,de,pe):ne.logical?ie&&se:se}return ie}},symbols:{},getOperatorName:re=>Mavo.Script.symbols[re]||re,operators:{not:{scalar:()=>ne=>!ne},multiply:{scalar:(re,ne)=>re*ne,identity:1,symbol:"*"},divide:{scalar:(re,ne)=>re/ne,identity:1,symbol:"/"},add:{scalar:(re,ne)=>+re+ +ne,symbol:"+"},subtract:{scalar:(re,ne)=>re-ne,symbol:"-"},mod:{scalar:(re,ne)=>re%ne},lte:{logical:!0,scalar:(re,ne)=>{return[re,ne]=Mavo.Script.getNumericalOperands(re,ne),re<=ne},identity:!0,symbol:"<="},lt:{logical:!0,scalar:(re,ne)=>{return[re,ne]=Mavo.Script.getNumericalOperands(re,ne),re<ne},identity:!0,symbol:"<"},gte:{logical:!0,scalar:(re,ne)=>{return[re,ne]=Mavo.Script.getNumericalOperands(re,ne),re>=ne},identity:!0,symbol:">="},gt:{logical:!0,scalar:(re,ne)=>{return[re,ne]=Mavo.Script.getNumericalOperands(re,ne),re>ne},identity:!0,symbol:">"},eq:{logical:!0,scalar:(re,ne)=>re==ne,symbol:["=","=="],identity:!0},neq:{logical:!0,scalar:(re,ne)=>re!=ne,symbol:["!="],identity:!0},and:{logical:!0,scalar:(re,ne)=>!!re&&!!ne,identity:!0,symbol:"&&"},or:{logical:!0,scalar:(re,ne)=>!!re||!!ne,reduce:(re,ne)=>re||ne,identity:!1,symbol:"||"},concatenate:{symbol:"&",identity:"",scalar:(re,ne)=>""+re+ne},filter:{scalar:(re,ne)=>ne?re:null}},getNumericalOperands:function(re,ne){if(isNaN(re)||isNaN(ne)){var oe=new Date(re),ie=new Date(ne);if(!isNaN(oe)&&!isNaN(ie))return[oe,ie]}return[re,ne]}},Mavo.Script.operators){let ne=Mavo.Script.operators[re];2>ne.scalar.length?Mavo.Script.addUnaryOperator(re,ne):Mavo.Script.addBinaryOperator(re,ne)}var ae={average:"avg",iff:"iff IF",subtract:"minus",multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"};for(let re in ae)ae[re].split(/\s+/g).forEach(ne=>te[ne]=te[re]);Mavo.Functions._Trap=self.Proxy?new Proxy(te,{get:(re,ne)=>{if(ne in re)return re[ne];var oe=ne.toLowerCase&&ne.toLowerCase();return oe&&re.hasOwnProperty(oe)?re[oe]:ne in Math||oe in Math?Math[ne]||Math[oe]:ne in self?self[ne]:ne},has:(re,ne)=>"data"!=ne}):Mavo.Functions}(),function(ee){if(self.Mavo){Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){this.url=new URL(this.url,location),"dropbox:"!=this.url.protocol&&(this.url.hostname="dl.dropboxusercontent.com",this.url.search=this.url.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.on("read")),this.permissions.on("login"),this.ready=ee.include(self.Dropbox,"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js").then(()=>{var ae=new URL(document.referrer,location);return"www.dropbox.com"===ae.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),ee.fire(window,"load"),void close()):void(this.path=(this.mavo.element.getAttribute("mv-dropbox-path")||"")+new URL(this.url).pathname.match(/[^/]*$/)[0],this.key=this.mavo.element.getAttribute("mv-dropbox-key")||"fle6gsc61w5v79j",this.client=new Dropbox.Client({key:this.key}))}).then(()=>{this.login(!0)})},put:function(ae=this.getFile()){return new Promise((re,ne)=>{this.client.writeFile(ae.name,ae.dataString,function(oe,ie){return oe?ne(Error(oe)):void(console.log("File saved as revision "+ie.versionTag),re(ae))})})},login:function(ae){return this.ready.then(()=>{return this.client.isAuthenticated()?Promise.resolve():new Promise((re,ne)=>{this.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),this.client.authenticate({interactive:!ae},oe=>{oe&&ne(Error(oe)),this.client.isAuthenticated()?(this.permissions.on(["logout","edit"]),re()):(this.permissions.off(["logout","edit","add","delete"]),ne())})})}).then(()=>{this.client.getAccountInfo((re,ne)=>{re||ee.fire(this.mavo.element,"mavo:login",ee.extend({backend:this},ne))})}).catch(()=>{})},logout:function(){return this.client.isAuthenticated()?new Promise(ae=>{this.client.signOut(null,()=>{this.permissions.off(["edit","add","delete"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this}),ae()})}):Promise.resolve()},static:{test:function(ae){return ae=new URL(ae,location),/dropbox.com/.test(ae.host)||"dropbox:"===ae.protocol}}}))}}(Bliss),function(ee){if(self.Mavo)var te=Mavo.Backend.register(ee.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on("login"),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var ae=te.parseURL(this.url);ae.username?(ee.extend(this,ae),this.repo=this.repo||"mv-data",this.branch=this.branch||"master",this.path=this.path||`${this.mavo.id}.json`,this.apiCall=`repos/${this.username}/${this.repo}/contents/${this.path}`):this.apiCall=this.url.pathname.slice(1),this.permissions.on("read"),this.login(!0)},get authenticated(){return!!this.accessToken},req:function(ae,re,ne="GET",oe={method:ne}){re&&(oe.data=JSON.stringify(re));var ie=ee.extend(oe,{responseType:"json"});return this.authenticated&&(ie.headers={Authorization:`token ${this.accessToken}`}),ee.fetch(te.apiDomain+ae,ie).catch(se=>{return se&&se.xhr?Promise.reject(se.xhr):void this.mavo.error("Something went wrong while connecting to Github",se)}).then(se=>Promise.resolve(se.response))},get:function(){return this.req(this.apiCall).then(ae=>Promise.resolve(this.repo?te.atob(ae.content):ae))},put:function(ae,re){var ne=re?`repos/${this.username}/${this.repo}/contents/${re}`:this.apiCall;return Promise.resolve(this.repoInfo||this.req("user/repos",{name:this.repo},"POST")).then(oe=>{return this.repoInfo=oe,this.req(ne,{ref:this.branch})}).then(oe=>this.req(ne,{message:`Updated ${oe.name||"file"}`,content:te.btoa(ae),branch:this.branch,sha:oe.sha},"PUT"),oe=>{return 404==oe.status?this.req(ne,{message:"Created file",content:te.btoa(ae),branch:this.branch},"PUT"):oe})},login:function(ae){return this.ready.then(()=>{return this.authenticated?Promise.resolve():new Promise((re,ne)=>{if(ae)this.accessToken=localStorage["mavo:githubtoken"],this.accessToken&&re(this.accessToken);else{var oe={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};oe.top=(innerHeight-oe.height)/2+(screen.top||screenTop),oe.left=(innerWidth-oe.width)/2+(screen.left||screenLeft),this.authPopup=open(`https://github.com/login/oauth/authorize?client_id=${this.key}&scope=repo,gist&state=${location.href}`,"popup",`width=${oe.width},height=${oe.height},left=${oe.left},top=${oe.top}`),addEventListener("message",ie=>{ie.source===this.authPopup&&(this.accessToken=localStorage["mavo:githubtoken"]=ie.data,!this.accessToken&&ne(Error("Authentication error")),re(this.accessToken))})}}).then(()=>this.getUser()).catch(re=>{401==re.status&&this.logout()}).then(()=>{if(this.user&&(this.permissions.on("logout"),this.repo))return this.req(`repos/${this.username}/${this.repo}`).then(ne=>{this.repoInfo=ne,ne.permissions.push&&this.permissions.on(["edit","save"])}).catch(ne=>{404==ne.status&&this.user.login.toLowerCase()==this.username.toLowerCase()&&this.permissions.on(["edit","save"])})})})},logout:function(){return this.authenticated&&(localStorage.removeItem("mavo:githubtoken"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this})),Promise.resolve()},getUser:function(){return this.req("user").then(ae=>{this.user=ae;var re=ae.name||ae.login;ee.fire(this.mavo.element,"mavo:login",{backend:this,name:`<a href="https://github.com/${ae.login}" target="_blank">
							<img class="mv-avatar" src="${ae.avatar_url}" /> ${re}
						</a>`})})},static:{apiDomain:"https://api.github.com/",test:function(ae){return ae=new URL(ae,location),/\bgithub.com|raw.githubusercontent.com/.test(ae.host)},parseURL:function(ae){var re={};ae=new URL(ae,location);var ne=ae.pathname.slice(1).split("/");if(re.username=ne.shift(),re.repo=ne.shift(),/raw.githubusercontent.com$/.test(ae.host))re.branch=ne.shift();else{if(/api.github.com$/.test(ae.host))return{};/github.com$/.test(ae.host)&&"blob"==ne[0]&&(ne.shift(),re.branch=ne.shift())}return re.path=ne.join("/"),re},btoa:ae=>btoa(unescape(encodeURIComponent(ae))),atob:ae=>decodeURIComponent(escape(window.atob(ae)))}}))}(Bliss);
//# sourceMappingURL=maps/mavo.min.js.map
