!function(){"use strict";function t(e,r,s){return r=void 0===r?1:r,s=s||r+1,1>=s-r?function(){if(arguments.length<=r||"string"===n.type(arguments[r]))return e.apply(this,arguments);var t,s=arguments[r];for(var i in s){var o=Array.from(arguments);o.splice(r,1,i,s[i]),t=e.apply(this,o)}return t}:t(t(e,r+1,s),r,s-1)}function e(t,n,s){var i=r(s);if("string"===i){var o=Object.getOwnPropertyDescriptor(n,s);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?t[s]=n[s]:(delete t[s],Object.defineProperty(t,s,o))}else if("array"===i)s.forEach(function(r){r in n&&e(t,n,r)});else for(var a in n)s&&("regexp"===i&&!s.test(a)||"function"===i&&!s.call(n,a))||e(t,n,a);return t}function r(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var n=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:"string"===n.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(n,{extend:e,overload:t,type:r,property:n.property||"_",sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.from("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?n.set(t,e):(1===arguments.length&&("string"===n.type(t)?e={}:(e=t,t=e.tag,e=n.extend({},e,function(t){return"tag"!==t}))),n.set(document.createElement(t||"div"),e))},each:function(t,e,r){r=r||{};for(var n in t)r[n]=e.call(t,n,t[n]);return r},ready:function(t){return t=t||document,new Promise(function(e,r){"loading"!==t.readyState?e():t.addEventListener("DOMContentLoaded",function(){e()})})},Class:function(t){var e,r=["constructor","extends","abstract","static"].concat(Object.keys(n.classProps)),s=t.hasOwnProperty("constructor")?t.constructor:n.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error("Abstract classes cannot be directly instantiated.");e["super"]&&e["super"].apply(this,arguments),s.apply(this,arguments)},e["super"]=t["extends"]||null,e.prototype=n.extend(Object.create(e["super"]?e["super"].prototype:Object),{constructor:e}),e.prototype["super"]=e["super"]?e["super"].prototype:null,e.__abstract=!!t["abstract"]);var i=function(t){return this.hasOwnProperty(t)&&-1===r.indexOf(t)};if(t["static"]){n.extend(e,t["static"],i);for(var o in n.classProps)o in t["static"]&&n.classProps[o](e,t["static"][o])}n.extend(e.prototype,t,i);for(var o in n.classProps)o in t&&n.classProps[o](e.prototype,t[o]);return e},classProps:{lazy:t(function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t=r.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,r){return"function"===n.type(r)&&(r={set:r}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],n=r.get&&r.get.call(this,t);return void 0!==n?n:t},set:function(t){var n=this["_"+e],s=r.set&&r.set.call(this,t,n);this["_"+e]=void 0!==s?s:t},configurable:r.configurable,enumerable:r.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length?arguments[0]:!1,r=document.createElement("script");return e?Promise.resolve():new Promise(function(e,s){n.set(r,{async:!0,onload:function(){e(),n.remove(r)},onerror:function(){s()},src:t,inside:document.head})})},fetch:function(t,r){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var s=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},r);s.method=s.method.toUpperCase(),n.hooks.run("fetch-args",s),"GET"===s.method&&s.data&&(s.url.search+=s.data),document.body.setAttribute("data-loading",s.url),s.xhr.open(s.method,s.url.href,s.async!==!1,s.user,s.password);for(var i in r)if(i in s.xhr)try{s.xhr[i]=r[i]}catch(o){self.console&&console.error(o)}"GET"===s.method||s.headers["Content-type"]||s.headers["Content-Type"]||s.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var a in s.headers)s.xhr.setRequestHeader(a,s.headers[a]);return new Promise(function(t,e){s.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===s.xhr.status||s.xhr.status>=200&&s.xhr.status<300||304===s.xhr.status?t(s.xhr):e(n.extend(Error(s.xhr.statusText),{xhr:s.xhr,get status(){return this.xhr.status}}))},s.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(n.extend(Error("Network Error"),{xhr:s.xhr}))},s.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(n.extend(Error("Network Timeout"),{xhr:s.xhr}))},s.xhr.send("GET"===s.method?null:s.data)})},value:function(t){var e="string"!==n.type(t);return n.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),n.Hooks=new n.Class({add:function(t,e,r){if("string"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],e&&this[t][r?"unshift":"push"](e)},this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),n.hooks=new n.Hooks;var s=n.property;n.Element=function(t){this.subject=t,this.data={},this.bliss={}},n.Element.prototype={set:t(function(t,e){t in n.setProps?n.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(r,s){if("transition"in this.style){var i=n.extend({},this.style,/^transition(Duration|Property)$/);n.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),n.once(this,"transitionend",function(){clearTimeout(o),n.style(this,i),r(this)});var o=setTimeout(r,e+50,this);n.style(this,t)}else n.style(this,t),r(this)}.bind(this))},fire:function(t,e){var r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),this.dispatchEvent(n.extend(r,e))},unbind:t(function(t,e){(t||"").split(/\s+/).forEach(function(t){if(s in this&&(t.indexOf(".")>-1||!e)){t=(t||"").split(".");var r=t[1];t=t[0];var n=this[s].bliss.listeners=this[s].bliss.listeners||{};for(var i in n)if(!t||i===t)for(var o,a=0;o=n[i][a];a++)r&&r!==o.className||e&&e!==o.callback||(this.removeEventListener(i,o.callback,o.capture),a--)}else this.removeEventListener(t,e)},this)},0)},n.setProps={style:function(t){for(var e in t)e in this.style?this.style[e]=t[e]:this.style.setProperty(e,t[e])},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){n.extend(this,t)},events:function(t){if(t&&t.addEventListener){var e=this;if(t[s]&&t[s].bliss){var r=t[s].bliss.listeners;for(var i in r)r[i].forEach(function(t){e.addEventListener(i,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])}else if(arguments.length>1&&"string"===n.type(t)){var a=arguments[1],u=arguments[2];t.split(/\s+/).forEach(function(t){this.addEventListener(t,a,u)},this)}else for(var c in t)n.events(this,c,t[c])},once:t(function(t,e){t=t.split(/\s+/);var r=this,n=function(){return t.forEach(function(t){r.removeEventListener(t,n)}),e.apply(r,arguments)};t.forEach(function(t){r.addEventListener(t,n)})},0),delegate:t(function(t,e,r){this.addEventListener(t,function(t){t.target.closest(e)&&r.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=n.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=n.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t.appendChild(this)},before:function(t){t.parentNode.insertBefore(this,t)},after:function(t){t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t.insertBefore(this,t.firstChild)},around:function(t){t.parentNode&&n.before(this,t),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(t)}},n.Array=function(t){this.subject=t},n.Array.prototype={all:function(t){var e=$$(arguments).slice(1);return this[t].apply(this,e)}},n.add=t(function(t,e,r,s){r=n.extend({$:!0,element:!0,array:!0},r),"function"==n.type(e)&&(!r.element||t in n.Element.prototype&&s||(n.Element.prototype[t]=function(){return this.subject&&n.defined(e.apply(this.subject,arguments),this.subject)}),!r.array||t in n.Array.prototype&&s||(n.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(r){return r&&n.defined(e.apply(r,t),r)})}),r.$&&(n.sources[t]=n[t]=e,(r.array||r.element)&&(n[t]=function(){var e=[].slice.apply(arguments),s=e.shift(),i=r.array&&Array.isArray(s)?"Array":"Element";return n[i].prototype[t].apply({subject:s},e)})))},0),n.add(n.Array.prototype,{element:!1}),n.add(n.Element.prototype),n.add(n.setProps),n.add(n.classProps,{element:!1,array:!1});var i=document.createElement("_");n.add(n.extend({},HTMLElement.prototype,function(t){return"function"===n.type(i[t])}),null,!0)}(),function(t){"use strict";if(Bliss&&!Bliss.shy){var e=Bliss.property;if(t.add({clone:function(){var e=this.cloneNode(!0),r=t.$("*",e).concat(e);return t.$("*",this).concat(this).forEach(function(e,n,s){t.events(r[n],e),r[n]._.data=t.extend({},e._.data)}),e}},{array:!1}),Object.defineProperty(Node.prototype,e,{get:function o(){return Object.defineProperty(Node.prototype,e,{get:void 0}),Object.defineProperty(this,e,{value:new t.Element(this)}),Object.defineProperty(Node.prototype,e,{get:o}),this[e]},configurable:!0}),Object.defineProperty(Array.prototype,e,{get:function(){return Object.defineProperty(this,e,{value:new t.Array(this)}),this[e]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var r=EventTarget.prototype.addEventListener,n=EventTarget.prototype.removeEventListener,s=function(t,e,r){return r.callback===t&&r.capture==e},i=function(){return!s.apply(this,arguments)};EventTarget.prototype.addEventListener=function(t,n,i){if(this&&this[e]&&this[e].bliss&&n){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};if(t.indexOf(".")>-1){t=t.split(".");var a=t[1];t=t[0]}o[t]=o[t]||[],0===o[t].filter(s.bind(null,n,i)).length&&o[t].push({callback:n,capture:i,className:a})}return r.call(this,t,n,i)},EventTarget.prototype.removeEventListener=function(t,r,s){if(this&&this[e]&&this[e].bliss&&r){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};o[t]&&(o[t]=o[t].filter(i.bind(null,r,s)))}return n.call(this,t,r,s)}}self.$=self.$||t,self.$$=self.$$||t.$}}(Bliss);
/*
 * Stretchy: Form element autosizing, the way it should be.
 * by Lea Verou http://lea.verou.me
 * MIT license
 */
(function() {

if (!self.Element) {
	return; // super old browser
}

if (!Element.prototype.matches) {
	Element.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;
}

if (!Element.prototype.matches) {
	return;
}

function $$(expr, con) {
	return expr instanceof Node || expr instanceof Window? [expr] :
	       [].slice.call(typeof expr == "string"? (con || document).querySelectorAll(expr) : expr || []);
}

var _ = self.Stretchy = {
	selectors: {
		base: 'textarea, select:not([size]), input:not([type]), input[type="' + "text url email tel".split(" ").join('"], input[type="') + '"]',
		filter: "*"
	},

	// Script element this was included with, if any
	script: document.currentScript || $$("script").pop(),

	// Autosize one element. The core of Stretchy.
	resize: function(element) {
		if (!_.resizes(element)) {
			return;
		}

		var cs = getComputedStyle(element);
		var offset = 0;

		if (!element.value && element.placeholder) {
			var empty = true;
			element.value = element.placeholder;
		}

		var type = element.nodeName.toLowerCase();

		if (type == "textarea") {
			element.style.height = "0";

			if (cs.boxSizing == "border-box") {
				offset = element.offsetHeight;
			}
			else if (cs.boxSizing == "content-box") {
				offset = -element.clientHeight;
			}

			element.style.height = element.scrollHeight + offset + "px";
		}
		else if(type == "input") {
			// First test that it is actually visible, otherwise all measurements are off
			element.style.width = "1000px";

			if (element.offsetWidth) {
				element.style.width = "0";

				if (cs.boxSizing == "border-box") {
					offset = element.offsetWidth;
				}
				else if (cs.boxSizing == "padding-box") {
					offset = element.clientWidth;
				}

				// Safari misreports scrollWidth, so we will instead set scrollLeft to a
				// huge number, and read that back to see what it was clipped to
				element.scrollLeft = 1e+10;

				var width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);

				element.style.width = width + "px";
			}
			else {
				// Element is invisible, just set to something reasonable
				element.style.width = element.value.length + 1 + "ch";
			}
		}
		else if (type == "select") {
			var selectedIndex = element.selectedIndex > 0? element.selectedIndex : 0;

			// Need to use dummy element to measure :(
			var option = document.createElement("_");
			option.textContent = element.options[selectedIndex].textContent;
			element.parentNode.insertBefore(option, element.nextSibling);

			// The name of the appearance property, as it might be prefixed
			var appearance;

			for (var property in cs) {
				var value = cs[property];
				if (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == "string") {
					//console.log(property, option.offsetWidth, cs[property]);
					option.style[property] = value;

					if (/appearance$/i.test(property)) {
						appearance = property;
					}
				}
			}

			option.style.width = "";

			if (option.offsetWidth > 0) {
				element.style.width = option.offsetWidth + "px";

				if (!cs[appearance] || cs[appearance] !== "none") {
					// Account for arrow
					element.style.width = "calc(" + element.style.width + " + 2em)";
				}
			}

			option.parentNode.removeChild(option);
			option = null;
		}

		if (empty) {
			element.value = "";
		}
	},

	// Autosize multiple elements
	resizeAll: function(elements) {
		$$(elements || _.selectors.base).forEach(function (element) {
			_.resize(element);
		});
	},

	active: true,

	// Will stretchy do anything for this element?
	resizes: function(element) {
		return element &&
		       element.parentNode &&
		       element.matches &&
		       element.matches(_.selectors.base) &&
		       element.matches(_.selectors.filter);
	},

	init: function(){
		_.selectors.filter = _.script.getAttribute("data-filter") ||
		                     ($$("[data-stretchy-filter]").pop() || document.body).getAttribute("data-stretchy-filter") || Stretchy.selectors.filter || "*";

		_.resizeAll();
	},

	$$: $$
};

// Autosize all elements once the DOM is loaded

// DOM already loaded?
if (document.readyState !== "loading") {
	_.init();
}
else {
	// Wait for it
	document.addEventListener("DOMContentLoaded", _.init);
}

// Listen for changes
var listener = function(evt) {
	if (_.active) {
		_.resize(evt.target);
	}
};

document.documentElement.addEventListener("input", listener);

// Firefox fires a change event instead of an input event
document.documentElement.addEventListener("change", listener);

// Listen for new elements
if (self.MutationObserver) {
	(new MutationObserver(function(mutations) {
		if (_.active) {
			mutations.forEach(function(mutation) {
				if (mutation.type == "childList") {
					Stretchy.resizeAll(mutation.addedNodes);
				}
			});
		}
	})).observe(document.documentElement, {
		childList: true,
		subtree: true
	});
}

})();

/* jsep v0.3.1 (http://jsep.from.so/) */
!function(a){"use strict";var b="Compound",c="Identifier",d="MemberExpression",e="Literal",f="ThisExpression",g="CallExpression",h="UnaryExpression",i="BinaryExpression",j="LogicalExpression",k="ConditionalExpression",l="ArrayExpression",m=46,n=44,o=39,p=34,q=40,r=41,s=91,t=93,u=63,v=59,w=58,x=function(a,b){var c=new Error(a+" at character "+b);throw c.index=b,c.description=a,c},y=!0,z={"-":y,"!":y,"~":y,"+":y},A={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},B=function(a){var b,c=0;for(var d in a)(b=d.length)>c&&a.hasOwnProperty(d)&&(c=b);return c},C=B(z),D=B(A),E={"true":!0,"false":!1,"null":null},F="this",G=function(a){return A[a]||0},H=function(a,b,c){var d="||"===a||"&&"===a?j:i;return{type:d,operator:a,left:b,right:c}},I=function(a){return a>=48&&a<=57},J=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=128&&!A[String.fromCharCode(a)]},K=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a>=128&&!A[String.fromCharCode(a)]},L=function(a){for(var i,j,y=0,B=a.charAt,L=a.charCodeAt,M=function(b){return B.call(a,b)},N=function(b){return L.call(a,b)},O=a.length,P=function(){for(var a=N(y);32===a||9===a;)a=N(++y)},Q=function(){var a,b,c=S();return P(),N(y)!==u?c:(y++,a=Q(),a||x("Expected expression",y),P(),N(y)===w?(y++,b=Q(),b||x("Expected expression",y),{type:k,test:c,consequent:a,alternate:b}):void x("Expected :",y))},R=function(){P();for(var b=a.substr(y,D),c=b.length;c>0;){if(A.hasOwnProperty(b))return y+=c,b;b=b.substr(0,--c)}return!1},S=function(){var a,b,c,d,e,f,g,h;if(f=T(),b=R(),!b)return f;for(e={value:b,prec:G(b)},g=T(),g||x("Expected expression after "+b,y),d=[f,e,g];(b=R())&&(c=G(b),0!==c);){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)g=d.pop(),b=d.pop().value,f=d.pop(),a=H(b,f,g),d.push(a);a=T(),a||x("Expected expression after "+b,y),d.push(e,a)}for(h=d.length-1,a=d[h];h>1;)a=H(d[h-1].value,d[h-2],a),h-=2;return a},T=function(){var b,c,d;if(P(),b=N(y),I(b)||b===m)return U();if(b===o||b===p)return V();if(J(b)||b===q)return Y();if(b===s)return $();for(c=a.substr(y,C),d=c.length;d>0;){if(z.hasOwnProperty(c))return y+=d,{type:h,operator:c,argument:T(),prefix:!0};c=c.substr(0,--d)}return!1},U=function(){for(var a,b,c="";I(N(y));)c+=M(y++);if(N(y)===m)for(c+=M(y++);I(N(y));)c+=M(y++);if(a=M(y),"e"===a||"E"===a){for(c+=M(y++),a=M(y),"+"!==a&&"-"!==a||(c+=M(y++));I(N(y));)c+=M(y++);I(N(y-1))||x("Expected exponent ("+c+M(y)+")",y)}return b=N(y),J(b)?x("Variable names cannot start with a number ("+c+M(y)+")",y):b===m&&x("Unexpected period",y),{type:e,value:parseFloat(c),raw:c}},V=function(){for(var a,b="",c=M(y++),d=!1;y<O;){if(a=M(y++),a===c){d=!0;break}if("\\"===a)switch(a=M(y++)){case"n":b+="\n";break;case"r":b+="\r";break;case"t":b+="\t";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+="\x0B";break;default:b+="\\"+a}else b+=a}return d||x('Unclosed quote after "'+b+'"',y),{type:e,value:b,raw:c+b+c}},W=function(){var b,d=N(y),g=y;for(J(d)?y++:x("Unexpected "+M(y),y);y<O&&(d=N(y),K(d));)y++;return b=a.slice(g,y),E.hasOwnProperty(b)?{type:e,value:E[b],raw:b}:b===F?{type:f}:{type:c,name:b}},X=function(a){for(var c,d,e=[],f=!1;y<O;){if(P(),c=N(y),c===a){f=!0,y++;break}c===n?y++:(d=Q(),d&&d.type!==b||x("Expected comma",y),e.push(d))}return f||x("Expected "+String.fromCharCode(a),y),e},Y=function(){var a,b;for(a=N(y),b=a===q?Z():W(),P(),a=N(y);a===m||a===s||a===q;)y++,a===m?(P(),b={type:d,computed:!1,object:b,property:W()}):a===s?(b={type:d,computed:!0,object:b,property:Q()},P(),a=N(y),a!==t&&x("Unclosed [",y),y++):a===q&&(b={type:g,arguments:X(r),callee:b}),P(),a=N(y);return b},Z=function(){y++;var a=Q();return P(),N(y)===r?(y++,a):void x("Unclosed (",y)},$=function(){return y++,{type:l,elements:X(t)}},_=[];y<O;)i=N(y),i===v||i===n?y++:(j=Q())?_.push(j):y<O&&x('Unexpected "'+M(y)+'"',y);return 1===_.length?_[0]:{type:b,body:_}};if(L.version="0.3.1",L.toString=function(){return"JavaScript Expression Parser (JSEP) v"+L.version},L.addUnaryOp=function(a){return C=Math.max(a.length,C),z[a]=y,this},L.addBinaryOp=function(a,b){return D=Math.max(a.length,D),A[a]=b,this},L.addLiteral=function(a,b){return E[a]=b,this},L.removeUnaryOp=function(a){return delete z[a],a.length===C&&(C=B(z)),this},L.removeBinaryOp=function(a){return delete A[a],a.length===D&&(D=B(A)),this},L.removeLiteral=function(a){return delete E[a],this},"undefined"==typeof exports){var M=a.jsep;a.jsep=L,L.noConflict=function(){return a.jsep===L&&(a.jsep=M),L}}else"undefined"!=typeof module&&module.exports?exports=module.exports=L:exports.parse=L}(this);
//# sourceMappingURL=jsep.min.js.map
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t,e){var n=self.Mavo=t.Class({constructor:function(i){var r=this;this.treeBuilt=Mavo.defer(),this.element=i,this.index=n.all.push(this);var o=n.attributes.map(function(t){return"[data-"+t+"]"}),s=!0,a=!1,u=void 0;try{for(var l,m=e(o.join(", "),this.element).concat(this.element)[Symbol.iterator]();!(s=(l=m.next()).done);s=!0){var c=l.value,v=!0,h=!1,d=void 0;try{for(var f,p=n.attributes[Symbol.iterator]();!(v=(f=p.next()).done);v=!0){var g=f.value,y=c.getAttribute("data-"+g);null!==y&&c.setAttribute(g,y)}}catch(b){h=!0,d=b}finally{try{!v&&p["return"]&&p["return"]()}finally{if(h)throw d}}}}catch(b){a=!0,u=b}finally{try{!s&&m["return"]&&m["return"]()}finally{if(a)throw u}}n.allIds.push(this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index),this.element.setAttribute("mv-app",this.id),this.autoEdit=this.element.classList.contains("mv-autoedit"),
this.autoSave=this.element.hasAttribute("mv-autosave"),this.element.setAttribute("typeof",""),e(n.selectors.primitive,i).forEach(function(e){var i=t(n.selectors.not(n.selectors.formControl)+", "+n.selectors.property,e);if(i){var r=Mavo.Primitive.getConfig(e),o=Mavo.is("multiple",e);(o||!r.attribute&&!r.hasChildren)&&e.setAttribute("typeof","")}}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.ui={bar:t(".mv-bar",this.element)||t.create({className:"mv-bar mv-ui",start:this.element})},this.ui.bar.classList.toggle("mv-compact",this.ui.bar.parentNode.offsetWidth<400),this.ui.bar.classList.toggle("mv-tiny",this.ui.bar.parentNode.offsetWidth<250),this.ui.status=t(".mv-status",this.ui.bar)||t.create("span",{className:"mv-status",inside:this.ui.bar});for(var C=["storage","source","init"],k=0;k<C.length;k++){var L=C[k];1==this.index&&(this[L]=n.Functions.urlOption(L)),this[L]||(this[L]=n.Functions.urlOption(this.id+"_"+L)||this.element.getAttribute("mv-"+L)||null),
this[L]&&(this[L]=this[L].trim(),this[L]="none"==this[L]?null:n.Backend.create(this[L],{mavo:this,format:this.element.getAttribute("mv-format-"+L)||this.element.getAttribute("mv-format")}))}this.storage||this.source||!this.init||(this.source=this.init,this.init=null);for(var x=["storage","source","init"],A=0;A<x.length;A++){var w=x[A];if(this[w]){this.primaryBackend=this[w],this.permissions=this[w].permissions;break}}this.permissions=this.permissions||new Mavo.Permissions,this.primaryBackend&&(this.authControls={},t.style(this.ui.bar,{"--mv-backend":'"'+this.primaryBackend.id+'"'}),this.permissions.can("login",function(){r.loginHash="#login"+(Mavo.all[0]===r?"":"-"+r.id),r.authControls.login=t.create({tag:"a",href:r.loginHash,textContent:"Login",title:"Login",className:"mv-login mv-button",events:{click:function(t){t.preventDefault(),r.primaryBackend.login()}},after:t(".mv-status",r.ui.bar)});var e;(e=function(){location.hash===r.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),
r.primaryBackend.login())})(),window.addEventListener("hashchange.mavo",e)},function(){t.remove(r.authControls.login),r.element._.unbind("hashchange.mavo")}),this.element.addEventListener("mavo:login.mavo",function(e){if(e.backend==r.primaryBackend){var n=t(".mv-status",r.ui.bar);n.innerHTML="",t.set(n,{contents:[{tag:"strong",innerHTML:e.name},{tag:"button",textContent:"Logout",className:"mv-logout",events:{click:function(t){return e.backend.logout()}}}]}),r.root.data||r.unsavedChanges||r.load()}}),this.element.addEventListener("mavo:logout.mavo",function(e){t(".mv-status",r.ui.bar).textContent=""})),t("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(t){t.target!=document.activeElement&&t.preventDefault()}),this.needsEdit=this.some(function(t){return t!=r.root&&!t.modes&&"read"==t.mode}),this.setUnsavedChanges(!1),this.permissions.onchange(function(t){var e=t.action,n=t.value,i=r.element.getAttribute("mv-permissions")||"";i=i.trim().split(/\s+/).filter(function(t){
return t!=e}),n&&i.push(e),r.element.setAttribute("mv-permissions",i.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],function(){r.ui.edit=t.create("button",{className:"mv-edit",textContent:"Edit",title:"Edit",inside:r.ui.bar}),r.modeObserver=new Mavo.Observer(r.element,"mv-mode",function(t){var e=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var a=o.value,u=a.target,l=!0,m=!1,c=void 0;try{t:for(var v,h=n.Node.children(u)[Symbol.iterator]();!(l=(v=h.next()).done);l=!0){var d=v.value,f=d.mode,p=void 0;if(d.element==u)p=d.element.getAttribute("mv-mode"),d.modes=p;else{if(d.modes)continue t;p=n.getStyle(d.element.parentNode,"--mv-mode")}d.mode=p,f!=d.mode&&d["edit"==d.mode?"edit":"done"]()}}catch(g){m=!0,c=g}finally{try{!l&&h["return"]&&h["return"]()}finally{if(m)throw c}}}}catch(g){i=!0,r=g}finally{try{!e&&s["return"]&&s["return"]()}finally{if(i)throw r}}},{subtree:!0}),r.autoEdit&&r.edit()},function(){t.remove(r.ui.edit),r.editing&&r.done(),
r.modeObserver&&r.modeObserver.destroy()}),this.storage&&this.permissions.can("delete",function(){r.ui.clear=t.create("button",{className:"mv-clear",textContent:"Clear",title:"Clear"}),r.ui.bar.appendChild(r.ui.clear)},function(){t.remove(r.ui.clear)}),this.storage||this.source?this.permissions.can("read",function(){return r.load()}):(this.permissions.on(["read","edit"]),t.fire(this.element,"mavo:load")),this.permissions.can("save",function(){if(r.autoSave){var e=1e3*(r.element.getAttribute("mv-autosave")||3);r.element.addEventListener("mavo:load.mavo:autosave",function(t){var i=n.debounce(function(){r.save()},e),o=function(t){t.node.saved&&i()};requestAnimationFrame(function(){r.permissions.can("save",function(){r.element.addEventListener("mavo:datachange.mavo:autosave",o)},function(){r.element.removeEventListener("mavo:datachange.mavo:autosave",o)})})})}(!r.autoSave||e>0)&&(r.ui.save=t.create("button",{className:"mv-save",textContent:"Save",title:"Save",inside:r.ui.bar})),t.events(r.ui.save,{
"mouseenter focus":function(t){r.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(t){return r.element.classList.remove("mv-highlight-unsaved")}})},function(){t.remove(r.ui.save),r.ui.save=null,r.element.removeEventListener(".mavo:autosave")}),t.delegate(this.element,"click",{".mv-save":function(t){r.permissions.save&&r.save()},".mv-edit":function(t){r.editing||!r.permissions.edit?r.done():r.edit()},".mv-clear":function(t){r.permissions["delete"]&&r.clear()}}),this.element.addEventListener("keydown",function(t){83==t.keyCode&&t[n.superKey]&&(t.preventDefault(),r.save())}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(){return this.root.getData()},toJSON:function(){return n.toJSON(this.getData())},error:function l(e){for(var i,r=this,o=function(){return t.transition(l,{opacity:0}).then(t.remove)},l=t.create("p",{className:"mv-error mv-ui",contents:[e,{tag:"button",className:"mv-close mv-ui",textContent:"×",events:{click:o
}}],events:{mouseenter:function(t){return clearTimeout(i)},mouseleave:n.rr(function(t){return i=setTimeout(o,5e3)}),click:function(t){return r.element.scrollIntoView({behavior:"smooth"})}},start:this.element}),s=arguments.length,a=Array(s>1?s-1:0),u=1;u<s;u++)a[u-1]=arguments[u];if(a.length>0){var m;(m=console).log.apply(m,["%c"+this.id+": "+e,"color: red; font-weight: bold"].concat(a))}},render:function(t){var e={context:this,data:t};n.hooks.run("render-start",e),e.data&&this.root.render(e.data),this.unsavedChanges=!1,n.hooks.run("render-end",e)},clear:function(){var t=this;confirm("This will delete all your data. Are you sure?")&&this.store(null).then(function(){return t.root.clear()})},edit:function(){this.root.edit(),t.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(t){if(t.target.matches(".mv-item-controls *")){var e=t.target.closest(".mv-item-controls"),i=Mavo.data(e,"item");i&&i.element&&i.element.classList.toggle("mv-highlight","mouseenter"==t.type)}if(t.target.matches(n.selectors.multiple)){
t.target.classList.remove("mv-has-hovered-item");var r=t.target.parentNode.closest(n.selectors.multiple);r&&r.classList.toggle("mv-has-hovered-item","mouseenter"==t.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(t){var e=!!t;return t||this.walk(function(n){if(n.unsavedChanges)return e=!0,t===!1&&(n.unsavedChanges=!1),!1}),this.unsavedChanges=e},done:function(){this.root.done(),t.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},load:function(){var e=this;this.inProgress="Loading";var n=this.source||this.storage;return n.ready.then(function(){return n.load()})["catch"](function(t){return e.init&&e.init!=n?(n=e.init,e.init.ready.then(function(){return e.init.load()})):Promise.reject(t)})["catch"](function(t){if(t){var n=t instanceof XMLHttpRequest?t:t.xhr;if(n&&404==n.status)e.render(null);else{var i="Problem loading data";n&&(i+=n.status?": HTTP error "+t.status+": "+t.statusText:": Can’t connect to the Internet"),e.error(i,t)}}return null}).then(function(t){return e.render(t);
}).then(function(){e.inProgress=!1,t.fire(e.element,"mavo:load")})},store:function(){var t=this;if(this.storage)return this.inProgress="Saving",this.storage.login().then(function(){return t.storage.store(t.getData())})["catch"](function(e){if(e){var n="Problem saving data";e instanceof XMLHttpRequest&&(n+=xhr.status?": HTTP error "+e.status+": "+e.statusText:": Can’t connect to the Internet"),t.error(n,e)}return null}).then(function(e){return t.inProgress=!1,e})},save:function(){var e=this;return this.store().then(function(n){n&&(t.fire(e.element,"mavo:save",n),e.lastSaved=Date.now(),e.root.save(),e.unsavedChanges=!1)})},walk:function(t){return this.root.walk(t)},some:function(t){return!this.walk(function(e,n){var i=t(e,n);if(i===!0)return!1})},live:{inProgress:function(e){t.toggleAttribute(this.element,"mv-progress",e,e)},unsavedChanges:function(t){this.element.classList.toggle("mv-unsaved-changes",t)},needsEdit:function(e){t.remove(this.ui.edit)}},"static":{all:[],allIds:[],get:function(t){
var e=!0,i=!1,r=void 0;try{for(var o,s=n.all[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var a=o.value;if(a.id===t)return a}}catch(u){i=!0,r=u}finally{try{!e&&s["return"]&&s["return"]()}finally{if(i)throw r}}return null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",init:function(t){return e(n.selectors.init,t||document).filter(function(t){return t==document.documentElement||!t.parentNode.closest(n.selectors.init)}).map(function(t){return new n(t)})},plugin:function(e){n.hooks.add(e.hooks);for(var i in e.extend){var r="Mavo"==i?n:n[i];t.Class(r,e.extend[i])}},hooks:new t.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions"]}}),i=n.selectors={init:".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]",property:"[property], [itemprop]",specificProperty:function(t){return"[property="+t+"], [itemprop="+t+"]"},group:"[typeof], [itemscope], [itemtype], [mv-group]",
multiple:"[mv-multiple]",formControl:"input, select, option, textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},r=i.arr=function(t){return t.split(/\s*,\s*/g)},o=i.not=function(t){return r(t).map(function(t){return":not("+t+")"}).join("")},s=i.or=function(t,e){return t+", "+e},a=i.and=function(t,e){var n=[],i=r(e);return r(t).forEach(function(t){return n.push.apply(n,_toConsumableArray(i.map(function(e){return t+e})))}),n.join(", ")},u=i.andNot=function(t,e){return a(t,o(e))};t.extend(n.selectors,{primitive:u(i.property,i.group),rootGroup:u(i.group,i.property),output:s(i.specificProperty("output"),".mv-output, .mv-value")}),Promise.all([t.ready(),t.include(Array.from&&window.Intl&&document.documentElement.closest,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")])["catch"](function(t){return console.error(t)}).then(function(){return Mavo.init()}),Stretchy.selectors.filter=".mv-editor:not([property])"}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){function n(t,n){for(t="mv-"+t+"-within",e("."+t).forEach(function(e){return e.classList.remove(t)});n&&n.classList;)n.classList.add(t),n=n.parentNode}var r=t.extend(Mavo,{toJSON:function(t){return null===t?"":"string"==typeof t?t:JSON.stringify(t,null,"\t")},queryJSON:function(e,n){return n&&e?t.value.apply(t,[e].concat(n.split("/"))):e},toArray:function(t){return void 0===t?[]:Array.isArray(t)?t:[t]},"delete":function(t,e){var n=t&&t.indexOf(e);n>-1&&t.splice(n,1)},hasIntersection:function(t,e){return t&&e&&!t.every(function(t){return e.indexOf(t)==-1})},flatten:function(t){return Array.isArray(t)?t.reduce(function(t,e){
return r.toArray(t).concat(r.flatten(e))},[]):[t]},is:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=!0,a=!1,u=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value;if(l&&l.matches&&l.matches(r.selectors[t]))return!0}}catch(f){a=!0,u=f}finally{try{!i&&c["return"]&&c["return"]()}finally{if(a)throw u}}return!1},getStyle:function(t,e){return t&&getComputedStyle(t).getPropertyValue(e).trim()},data:function(e,n,r){return 2==arguments.length?t.value(e,"_","data","mavo",n):(e._.data.mavo=e._.data.mavo||{},e._.data.mavo[n]=r)},revocably:{add:function(t){var e=r.revocably.isRemoved(t);return e&&e.parentNode.replaceChild(t,e),e},remove:function(t,e){if(t){var n=r.data(t,"commentstub");return n||(e=e||t.id||t.className||t.nodeName,n=r.data(t,"commentstub",document.createComment(e))),t.parentNode&&t.parentNode.replaceChild(n,t),n}},isRemoved:function(t){if(!t||t.parentNode)return!1;var e=r.data(t,"commentstub");return!(!e||!e.parentNode)&&e;
}},inViewport:function(t){var e=t.getBoundingClientRect();return(0<=e.bottom&&e.bottom<=innerHeight||0<=e.top&&e.top<=innerHeight)&&(0<=e.right&&e.right<=innerWidth||0<=e.left&&e.left<=innerWidth)},scrollIntoViewIfNeeded:function(t){Mavo.inViewport(t)||t.scrollIntoView({behavior:"smooth"})},pushUnique:function(t,e){t.indexOf(e)===-1&&t.push(e)},subset:function(e,n,r){if(3==arguments.length){if(n.length){var o=t.value.apply(t,[e].concat(_toConsumableArray(n.slice(0,-1))));return o[n[n.length-1]]=r,e}return r}return"object"==("undefined"==typeof e?"undefined":_typeof(e))&&n&&n.length?t.value.apply(t,[e].concat(_toConsumableArray(n))):e},getAttribute:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var o,i=0;o=n[i];i++){var a=t.getAttribute(o);if(a)return a}return null},debounce:function(t,e){if(!e)return t;var n,r=null;return function(){var o=this,i=arguments;n=function(){t.apply(o,i),removeEventListener("beforeunload",n)},clearTimeout(r),r=setTimeout(n,e),
addEventListener("beforeunload",n)}},escapeRegExp:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Observer:t.Class({constructor:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r instanceof MutationObserver&&(this.observer=r),this.observer=this.observer||new MutationObserver(r),this.element=e,this.callback=r,this.attribute=n,this.options=t.extend({},o),n&&t.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:[this.attribute],attributeOldValue:!!o.oldValue}),this.attribute&&"all"!=this.attribute||t.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!o.oldValue}),this.run()},stop:function(){return this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(t){if(this.running){this.stop();var e=t();this.run()}else var e=t();return e},destroy:function(){this.observer.disconnect(),
this.observer=this.element=null},"static":{sneak:function(t,e){return t?t.sneak(e):e()}}}),defer:function(t){var e,n,r=new Promise(function(r,o){t&&t(r,o),e=r,n=o});return r.resolve=function(t){return e(t),r},r.reject=function(t){return n(t),r},r},rr:function(t){return t(),t}});t.add("toggleAttribute",function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null!==e;n?this.setAttribute(t,e):this.removeAttribute(t)}),t.proxy=t.classProps.proxy=t.overload(function(t,e,n){return Object.defineProperty(t,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t},configurable:!0,enumerable:!0}),t}),t.classProps.propagated=function(t,e){Mavo.toArray(e).forEach(function(e){var n=t[e];t[e]=function(){var t=n&&n.apply(this,arguments);this.propagate&&t!==!1&&this.propagate(e)}})},document.addEventListener("focus",function(t){n("focus",t.target)},!0),document.addEventListener("blur",function(t){n("focus",null)},!0),addEventListener("hashchange",function(e){n("target",t(location.hash));
}),document.documentElement.addEventListener("mavo:datachange",function(e){n("target",t(location.hash))}),n("focus",document.activeElement!==document.body?document.activeElement:null)}(Bliss,Bliss.$);
"use strict";!function(t){var i=Mavo.Permissions=t.Class({constructor:function(i){this.triggers=[],this.set(i),this.hooks=new t.Hooks},set:function(t){for(var i in t)this[i]=t[i]},on:function(t){var i=this;return Mavo.toArray(t).forEach(function(t){return i[t]=!0}),this},off:function(t){var i=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return i[t]=!1}),this},can:function(t,i,n){this.observe(t,!0,i),n&&this.cannot(t,n)},cannot:function(t,i){this.observe(t,!1,i)},when:function(t){var i=this;return new Promise(function(n,r){i.can(t,n,r)})},observe:function(t,i,n){t=Mavo.toArray(t),this.is(t,i)&&n(),this.triggers.push({actions:t,value:i,callback:n,active:!0})},is:function(t,i){var n=this,r=t.map(function(t){return!!n[t]}).reduce(function(t,i){return t||i});return i?r:!r},onchange:function(t){this.hooks.add("change",t);var n=!0,r=!1,o=void 0;try{for(var s,e=i.actions[Symbol.iterator]();!(n=(s=e.next()).done);n=!0){var a=s.value;t.call(this,{action:a,value:this[a],permissions:this
})}}catch(c){r=!0,o=c}finally{try{!n&&e["return"]&&e["return"]()}finally{if(r)throw o}}},changed:function(t,i,n){var r=this;n=!!n,i=!!i,i!=n&&(this["_"+t]=i,this.triggers.forEach(function(i){var n=r.is(i.actions,i.value);i.active&&i.actions.indexOf(t)>-1&&n?(i.active=!1,i.callback()):n||(i.active=!0)}),this.hooks.run("change",{action:t,value:i,permissions:this}))},or:function(t){var n=!0,r=!1,o=void 0;try{for(var s,e=i.actions[Symbol.iterator]();!(n=(s=e.next()).done);n=!0){var a=s.value;this[a]=this[a]||t[a]}}catch(c){r=!0,o=c}finally{try{!n&&e["return"]&&e["return"]()}finally{if(r)throw o}}return this},"static":{actions:[],register:function(n,r){return Array.isArray(n)?void n.forEach(function(t){return i.register(t,r)}):(t.live(i.prototype,n,function(t,i){r&&r.call(this,t,i),this.changed(n,t,i)}),void i.actions.push(n))}}});i.register(["read","save"]),i.register("login",function(t){t&&this.logout&&(this.logout=!1)}),i.register("logout",function(t){t&&this.login&&(this.login=!1)}),i.register("edit",function(t){
t&&(this.add=this["delete"]=!0)}),i.register(["add","delete"],function(t){t||(this.edit=!1)})}(Bliss);
"use strict";!function(t){var e=Mavo.Backend=t.Class({constructor:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.raw=t,this.url=new URL(this.raw,location),this.mavo=e.mavo,this.format=Mavo.Formats.create(e.format,this),this.permissions=new Mavo.Permissions},get:function(){return t.fetch(this.url.href).then(function(t){return Promise.resolve(t.responseText)},function(){return Promise.resolve(null)})},load:function(){var t=this;return this.ready.then(function(){return t.get()}).then(function(e){return"string"!=typeof e?e:(e=e.replace(/^\ufeff/,""),t.format.parse(e))})},store:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.path,i=r.format,s=void 0===i?this.format:i;return this.ready.then(function(){var r="string"==typeof t?Promise.resolve(t):s.stringify(t);return r.then(function(r){return e.put(r,n).then(function(){return{data:t,serialized:r}})})})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){
return Promise.resolve()},toString:function(){return this.id+" ("+this.url+")"},"static":{create:function(t,r){if(t){var n=e.types.filter(function(e){return e.test(t)})[0]||e.Remote;return new n(t,r)}return null},types:[],register:function(t){return e[t.prototype.id]=t,e.types.push(t),t}}});e.register(t.Class({id:"Element","extends":e,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=t(this.raw)||t.create("script",{type:"application/json",id:this.raw.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(t){return Promise.resolve(this.element.textContent=t)},"static":{test:function(t){return 0===t.indexOf("#")}}})),e.register(t.Class({id:"Remote","extends":e,constructor:function(){this.permissions.on("read")},"static":{test:function(t){return!1}}})),e.register(t.Class({"extends":e,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key]);
},put:function(t){return t?localStorage[this.key]=t:delete localStorage[this.key],Promise.resolve(t)},"static":{test:function(t){return"local"==t}}}))}(Bliss);
"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){var r=Mavo.Formats={},n=r.Base=e.Class({"abstract":!0,constructor:function(e){this.backend=e},proxy:{mavo:"backend"},parse:function(e){return this.constructor.parse(e,this)},stringify:function(e){return this.constructor.stringify(e,this)},"static":{parse:function(e){return Promise.resolve(e)},stringify:function(e){return Promise.resolve(e)},extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(function(t){return e.include(t.test,t.url)}))}}}),o=(r.JSON=e.Class({"extends":r.Base,"static":{parse:function(e){return Promise.resolve(e?JSON.parse(e):null)},stringify:function(e){return Promise.resolve(Mavo.toJSON(e));
},extensions:[".json",".jsonld"]}}),r.Text=e.Class({"extends":r.Base,constructor:function(e){this.property=this.mavo.root.getNames("Primitive")[0]},"static":{extensions:[".txt",".md",".markdown"],parse:function(e,t){return Promise.resolve(_defineProperty({},t?t.property:"content",e))},stringify:function(e,t){return Promise.resolve(e[t?t.property:"content"])}}}),r.CSV=e.Class({"extends":r.Base,constructor:function(t){this.property=this.mavo.root.getNames("Collection")[0],this.options=e.extend({},r.CSV.defaultOptions)},"static":{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:n.ready,parse:function(e,t){return o.ready(function(){var r=Papa.parse(e,o.defaultOptions),n=t?t.property:"content";if(t&&(t.options.delimiter=r.meta.delimiter,t.options.linebreak=r.meta.linebreak),r.meta.aborted)throw r.meta.errors.pop();return _defineProperty({},n,r.data);
})},stringify:function(e,t){return o.ready(function(){var e=t?t.property:"content",r=t?t.options:o.defaultOptions;return Papa.unparse(data[e],r)})}}}));Object.defineProperty(r,"create",{value:function(e,t){if(e&&"object"===("undefined"==typeof e?"undefined":_typeof(e)))return e;if("string"==typeof e){e=e.toLowerCase();for(var n in r){var o=r[n];if(n.toLowerCase()==e)return new o(t)}}if(!e){var s=t.url?t.url.pathname:t.raw,i=(s.match(/\.\w+$/)||[])[0]||".json",o=r.JSON;for(var n in r)r[n].extensions.indexOf(i)>-1&&(o=r[n]);return new o(t)}}})}(Bliss,Bliss.$);
"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t,e){var n=Mavo.Node=t.Class({"abstract":!0,constructor:function(e,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!o)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var r={context:this,options:i};this.uid=++n.maxId,this.nodeType=this.nodeType,this.property=null,t.extend(this,r.options),n.all.set(e,[].concat(_toConsumableArray(n.all.get(this.element)||[]),[this])),this.element=e,this.template=r.options.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=o,this.group=this.parentGroup=r.options.group,this.fromTemplate("property","type")||(this.property=n.getProperty(e),this.type=Mavo.Group.normalize(e),this.store=this.element.getAttribute("mv-storage")),
this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",r),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=r.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup),Mavo.hooks.run("node-init-end",r)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.store},get path(){var t=this.parentGroup?this.parentGroup.path:[];return this.property?[].concat(_toConsumableArray(t),[this.property]):t},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){},getData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isDataNull(t))return null},isDataNull:function(t){var e={context:this,options:t,result:this.deleted||!this.saved&&"*"!=t.store};return Mavo.hooks.run("unit-isdatanull",e),e.result},walk:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=function o(e,n){
var i=t(e,n);if(i!==!1)for(var r in e.children){var s=e.children[r];if(s instanceof Mavo.Node){var i=o.call(s,s,[].concat(_toConsumableArray(n),[r]));if(i===!1)return!1}}return i!==!1};return n(this,e)},walkUp:function(t){for(var e=this;e=e.parentGroup;){var n=t(e);if(void 0!==n)return n}},edit:function(){return this.mode="edit","edit"==this.mode&&(this.propagate("edit"),void Mavo.hooks.run("node-edit-end",this))},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&(t.unbind(this.element,".mavo:edit"),this.propagate("done"),void Mavo.hooks.run("node-done-end",this))},propagate:function(t){for(var e in this.children){var n=this.children[e];n instanceof Mavo.Node&&("function"==typeof t?t.call(n,n):t in n&&n[t]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var o=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done);o=!0){
var l=s.value;this[l]=this.template[l]}}catch(h){i=!0,r=h}finally{try{!o&&a["return"]&&a["return"]()}finally{if(i)throw r}}}return!!this.template},render:function(t){this.data=t,t=Mavo.subset(t,this.inPath);var e={context:this,data:t};if(Mavo.hooks.run("node-render-start",e),"Collection"!=this.nodeType&&Array.isArray(t)){var n;this.isRoot&&1===(n=Object.keys(this.children)).length&&"Collection"===this.children[n[0]].nodeType?e.data=_defineProperty({},n[0],e.data):(this.inPath.push("0"),e.data=e.data[0])}this.editing?(this.done(),this.dataRender(e.data),this.edit()):this.dataRender(e.data),this.save(),Mavo.hooks.run("node-render-end",e)},dataChanged:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.fire(n.element||this.element,"mavo:datachange",t.extend({property:this.property,action:e,mavo:this.mavo,node:this},n))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},getClosestCollection:function(){return this.collection||this.group.collection||(this.parentGroup?this.parentGroup.closestCollection:null);
},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},lazy:{closestCollection:function(){return this.getClosestCollection()},inPath:function(){return"Collection"!=this.nodeType?(this.element.getAttribute("mv-path")||"").split("/").filter(function(t){return t.length}):[]}},live:{store:function(e){t.toggleAttribute(this.element,"mv-storage",e)},unsavedChanges:function(t){return!t||this.saved&&this.editing||(t=!1),this.element.classList.toggle("mv-unsaved-changes",t),t},mode:function(e){var n=this;if(this._mode!=e){if(this.modes&&e!=this.modes&&(e=this.modes),this._mode=e,!(this instanceof Mavo.Collection)&&[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))>-1){var o=this.modes||"edit"==e;Mavo.Observer.sneak(this.mavo.modeObserver,function(){t.toggleAttribute(n.element,"mv-mode",e,o)})}return e}},modes:function(t){return t&&"read"!=t&&"edit"!=t?null:(this._modes=t,void(t&&this.mode!=t&&(this.mode=t)))},deleted:function(n){
var o=this;this.element.classList.toggle("mv-deleted",n),n?(this.elementContents=document.createDocumentFragment(),e(this.element.childNodes).forEach(function(t){o.elementContents.appendChild(t)}),t.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"×",events:{click:function(e){t.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(t){return o.deleted=!1}}}]),this.element.classList.remove("mv-highlight")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"))}},"static":{maxId:0,all:new WeakMap,create:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Mavo.is("multiple",t)&&!n.collection?new Mavo.Collection(t,e,n):new(Mavo[Mavo.is("group",t)?"Group":"Primitive"])(t,e,n)},getProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");return!e&&t.hasAttribute("property")&&(e=t.name||t.id||t.classList[0]),
e&&t.setAttribute("property",e),e},get:function(t,e){var o=(n.all.get(t)||[]).filter(function(t){return!(t instanceof Mavo.Collection)});return o.length<2||!e?o[0]:o[0]instanceof Mavo.Group?node[1]:void 0},children:function(t){var n=Mavo.Node.get(t);return n?[n]:(n=e(Mavo.selectors.property,t).map(function(t){return Mavo.Node.get(t)}).filter(function(e){return!t.contains(e.parentGroup.element)}).map(function(t){return t.collection||t}),Mavo.Functions.unique(n))}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){var n=Mavo.Group=t.Class({"extends":Mavo.Node,nodeType:"Group",constructor:function(t,n,r){var o=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element)){this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this})}e(Mavo.selectors.property,this.element).forEach(function(t){var e=Mavo.Node.getProperty(t);if(o.contains(t)){var n=o.children[e],r=o.template?o.template.children[e]:null,i={template:r,group:o};if(n){var a=n;n instanceof Mavo.Collection||(a=new Mavo.Collection(n.element,o.mavo,i),o.children[e]=n.collection=a,a.add(n)),
!a.mutable&&Mavo.is("multiple",t)&&(a.mutable=!0),a.add(t)}else{var s=Mavo.Node.create(t,o.mavo,i);o.children[e]=s}}});var i=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=i.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Node";return Object.keys(this.children).filter(function(n){return t.children[n]instanceof Mavo[e]})},getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={context:this,options:e,data:this["super"].getData.call(this,e)};return void 0!==r.data?r.data:(r.data={},this.propagate(function(t){if((t.saved||"*"==e.store)&&!(t.property in r.data)){var n=t.getData(e);(null!==n||r.options["null"])&&(r.data[t.property]=n)}}),t.extend(r.data,this.unhandled),this.type&&this.type!=n.DEFAULT_TYPE&&(r.data["@type"]=this.type),this.vocab&&(r.data["@context"]=this.vocab),r.data.summary&&(r.data.toString=function(){
return this.summary}),"*"!=e.store&&this.inPath.length&&(r.data=Mavo.subset(this.data,this.inPath,r.data)),Mavo.hooks.run("node-getdata-end",r),r.data)},find:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.property==t)return this;if(t in this.children)return this.children[t].find(t,e);var n=[];for(var r in this.children){var o=this.children[r].find(t,e);if(void 0!==o){if(!Array.isArray(o))return o;n.push.apply(n,_toConsumableArray(o))}}return n.length?n:void 0},save:function(){this.unsavedChanges=!1},propagated:["save","import","clear"],dataRender:function(e){var n=this;if(e){var r=this.unhandled;this.unhandled=t.extend({},e,function(t){return!(t in n.children)}),this.propagate(function(t){t.render(e[t.property])});for(var o in this.unhandled){var i=this.unhandled[o];"object"==("undefined"==typeof i?"undefined":_typeof(i))||r&&r[o]==i||this.dataChanged("propertychange",{property:o})}}},contains:function(t){return t instanceof Mavo.Node?t.parentGroup===this:t.parentNode&&this.element===t.parentNode.closest(Mavo.selectors.group);
},"static":{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(t){if(Mavo.is("group",t)){var e=Mavo.getAttribute(t,"typeof","itemtype")||n.DEFAULT_TYPE;return t.setAttribute("typeof",e),e}return null}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){var i=Mavo.Primitive=t.Class({"extends":Mavo.Node,nodeType:"Primitive",constructor:function(n,o,a){var r=this;if(this.fromTemplate("config","attribute","templateValue")||(this.config=i.getConfig(n),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&t.events(this.element,this.config.changeEvents,function(t){t.target===r.element&&(r.value=r.getValue())}),this.editor||this.attribute||(this.editor=e(this.element.children).filter(function(t){
return t.matches(Mavo.selectors.formControl)&&!t.matches(Mavo.selectors.property)})[0],this.editor&&(this.element.textContent=this.editorValue,t.remove(this.editor))),!this.editor&&this.element.hasAttribute("mv-edit")){var s=t(this.element.getAttribute("mv-edit"));s&&Mavo.is("formControl",s)&&(this.editor=s.cloneNode(!0),this.template||new Mavo.Observer(s,"all",function(t){var e=!0,i=!1,n=void 0;try{for(var o,a=r.copies[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var u=o.value;u.editor=s.cloneNode(!0),u.setValue(u.value,{force:!0,silent:!0})}}catch(l){i=!0,n=l}finally{try{!e&&a["return"]&&a["return"]()}finally{if(i)throw n}}}))}this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this["default"]?this._default="read"===this.modes?this.templateValue:this.editor?this.editorValue:void 0:""===this["default"]?this._default=this.templateValue:this.defaultObserver=new Mavo.Observer(this.element,"mv-default",function(t){r["default"]=r.element.getAttribute("mv-default");
}),this.initialValue=(this.template||void 0!==this["default"]?this["default"]:this.templateValue)||this.emptyValue,this.setValue(this.initialValue,{silent:!0}),this.observer=new Mavo.Observer(this.element,this.attribute,function(t){!r.attribute&&r.editing||(r.value=r.getValue())}),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){if(this.config.getEditorValue)return this.config.getEditorValue.call(this);if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return i.getValue(this.editor,{datatype:this.datatype});var e=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(e)return i.getValue(e)}},set editorValue(e){if(this.config.setEditorValue)return this.config.setEditorValue.call(this,e);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))i.setValue(this.editor,e,{config:this.editorDefaults});else{var n=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);n&&i.setValue(n,e)}},destroy:function(){this["super"].destroy.call(this),
this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={context:this,options:t,data:this["super"].getData.call(this,t)};return void 0!==e.data?e.data:(e.data=this.value,""===e.data&&(e.data=null),"*"!=t.store&&this.inPath.length&&(e.data=Mavo.subset(this.data,this.inPath,e.data)),Mavo.hooks.run("node-getdata-end",e),e.data)},sneak:function(t){return Mavo.Observer.sneak(this.observer,t)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){var n=this;if(!this.editor){var o=this.config.editor||Mavo.Elements.defaultEditors[this.datatype]||Mavo.Elements.defaultEditors.string;this.editor=t.create("function"===t.type(o)?o.call(this):o),this.editorValue=this.value}t.events(this.editor,{"input change":function(t){n.value=n.editorValue},focus:function(t){n.editor.select&&n.editor.select()},"mavo:datachange":function(e){"output"===e.property&&(e.stopPropagation(),
t.fire(n.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var a=/^mv-edit-/i;e(this.element.attributes).forEach(function(t){a.test(t.name)&&this.editor.setAttribute(t.name.replace(a,""),t.value)},this),(this.attribute||this.config.popup)&&(this.popup=new i.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var e=this;return this["super"].edit.call(this)!==!1&&(this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0,this.element.addEventListener("click.mavo:edit",function(t){return t.preventDefault()}),this.preEdit=Mavo.defer(function(i,n){if(e.empty&&!e.attribute)return i();var o;t.events(e.element,{"click.mavo:preedit":i,"focus.mavo:preedit":i}),e.attribute||t.events(e.element,{"mouseenter.mavo:preedit":function(t){clearTimeout(o),o=setTimeout(i,150)},"mouseleave.mavo:preedit":function(t){clearTimeout(o)}})}),this.config.edit?void this.config.edit.call(this):void this.preEdit.then(function(){
t.unbind(e.element,".mavo:preedit"),e.initEdit&&e.initEdit(),e.popup&&e.popup.show(),e.attribute||e.popup||e.editor.parentNode!=e.element&&(e.editorValue=e.value,e.element.textContent="",e.element.appendChild(e.editor))}))},done:function(){var e=this;return this["super"].done.call(this)!==!1&&("preEdit"in this&&t.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return e.config.done?void e.config.done.call(e):void(e.popup?e.popup.close():!e.attribute&&e.editor&&(t.remove(e.editor),e.element.textContent=e.editorValue))}),void(null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex")))},clear:function(){"read"!=this.modes&&(this.value=this.emptyValue)},dataRender:function(t){if(t&&"object"===("undefined"==typeof t?"undefined":_typeof(t)))if(Symbol.toPrimitive in t)t=t[Symbol.toPrimitive]();else for(var e=[this.property,"value"].concat(_toConsumableArray(Object.keys(t))),i=0;i<e.length;i++){var n=e[i];
if(n in t){t=t[n],this.inPath.push(n);break}}void 0===t?this.value=this.closestCollection?this["default"]:this.templateValue:this.value=t},find:function(t){if(this.property==t)return this},getValue:function(t){return i.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0}return""},editorDefaults:function(){return this.editor&&i.getConfig(this.editor)}},setValue:function(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sneak(function(){if("object"==t.type(e)&&"value"in e){var a=e.presentational;e=e.value}return e=e||0===e?e:"",n.datatype||"number"!=typeof e&&"boolean"!=typeof e||(n.datatype="undefined"==typeof e?"undefined":_typeof(e)),e=i.safeCast(e,n.datatype),e!=n._value||o.force?(n.editor&&document.activeElement!=n.editor&&(n.editorValue=e),n.config.humanReadable&&n.attribute&&(a=n.config.humanReadable.call(n,e)),
n.editing&&!n.popup&&n.editor||(n.config.setValue?n.config.setValue.call(n,n.element,e):(n.editor&&n.editor.matches("select")&&n.editor.selectedOptions[0]&&(a=n.editor.selectedOptions[0].textContent),o.dataOnly||i.setValue(n.element,{value:e,presentational:a},{config:n.config,attribute:n.attribute,datatype:n.datatype}))),n.empty=""===e,n._value=e,void(o.silent||(n.saved&&(n.unsavedChanges=n.mavo.unsavedChanges=!0),n.dataChanged("propertychange",{value:e})))):e}),e},dataChanged:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"propertychange",e=arguments[1];return this["super"].dataChanged.call(this,t,e)},live:{"default":function(t){this.value==this._default&&(this.value=t)},value:function(t){return this.setValue(t)},empty:function(e){var i=e&&!this.modes&&this.config["default"]&&!(this.attribute&&t(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!i)}},"static":{all:new WeakMap,getValueAttribute:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mavo.Elements.search(t),i=t.getAttribute("mv-attribute")||e.attribute;
return i&&"null"!==i||(i=null),i},safeCast:function(t,e){var n=("undefined"==typeof t?"undefined":_typeof(t),i.cast(t,e));return null===t||void 0===t?t:"boolean"==e?"false"!==t&&0!==t&&""!==t&&("true"===t||t>0||t):"number"==e?/^[-+]?[0-9.e]+$/i.test(t+"")?n:t:n},cast:function(t,e){switch(e){case"number":return+t;case"boolean":return!!t;case"string":return t+""}return t},getValue:function(t,e){var n=e.config,o=e.attribute,a=e.datatype;if(n||(n=i.getConfig(t,o)),o=n.attribute,a=n.datatype,n.getValue&&o==n.attribute)return n.getValue(t);var r;return r=o in t&&i.useProperty(t,o)?t[o]:o?t.getAttribute(o):t.getAttribute("content")||t.textContent||null,i.safeCast(r,a)},getConfig:function(t,e){void 0===e&&(e=t.getAttribute("mv-attribute")||void 0),"null"!=e&&"none"!=e||(e=null);var i=Mavo.Elements.search(t,e);return void 0===i.attribute&&(i.attribute=e||null),i},setValue:function(e,n,o){var a=o.config,r=o.attribute,s=o.datatype;if("object"==t.type(n)&&"value"in n){var u=n.presentational;n=n.value;
}if(1===e.nodeType&&(a||(a=i.getConfig(e,r)),r=a.attribute,s=void 0!==s?s:a.datatype,a.setValue&&r==a.attribute))return a.setValue(e,n);if(r){if(r in e&&i.useProperty(e,r)&&e[r]!==n)try{e[r]=n}catch(l){}"boolean"==s?n!=e.hasAttribute(r)&&t.toggleAttribute(e,r,n,n):e.getAttribute(r)!=n&&(e.setAttribute(r,n),u&&(e.textContent=u))}else"number"!==s||u||(u=i.formatNumber(n)),e.textContent=u||n,u&&e.setAttribute&&e.setAttribute("content",n)},useProperty:function(t,e){return!(["href","src"].indexOf(e)>-1)&&"http://www.w3.org/2000/svg"!=t.namespaceURI},lazy:{formatNumber:function(){var t=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(e){return e===1/0||e===-(1/0)?e<0?"-∞":"∞":t.format(e)}}}}});i.Popup=t.Class({constructor:function(e){var i=this;this.primitive=e,this.popup=t.create("div",{className:"mv-popup",hidden:!0,contents:[this.primitive.label+":",this.editor],events:{keyup:function(t){13!=t.keyCode&&27!=t.keyCode||(i.popup.contains(document.activeElement)&&i.element.focus(),
t.stopPropagation(),i.hide())}}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var e=this;t.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(t){e.popup.contains(t.target)||e.element.contains(t.target)||e.hide()},this.position=function(i){var n=e.element.getBoundingClientRect(),o=n.left,a=n.bottom;t.style(e.popup,{top:a+"px",left:o+"px"})},this.position(),document.body.appendChild(this.popup),requestAnimationFrame(function(t){return e.popup.removeAttribute("hidden")}),t.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var e=this;t.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){t.remove(e.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),t.events(this.element,{"click.mavo:showpopup":function(t){
e.show()},"keyup.mavo:showpopup":function(t){[13,113].indexOf(t.keyCode)>-1&&(e.show(),e.editor.focus())}})},close:function(){this.hide(),t.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})}(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){var a=Mavo.Elements={};Object.defineProperties(a,{register:{value:function(e,n){if("object"!==_typeof(arguments[0])){var i=Mavo.toArray(arguments[1]),r=!0,u=!1,o=void 0;try{for(var d,l=i[Symbol.iterator]();!(r=(d=l.next()).done);r=!0){config=d.value,config.attribute=Mavo.toArray(config.attribute||null);var m=!0,c=!1,s=void 0;try{for(var f,v=config.attribute[Symbol.iterator]();!(m=(f=v.next()).done);m=!0){attribute=f.value;var h=t.extend({},config);h.attribute=attribute,a[e]=a[e]||[],a[e].push(h)}}catch(p){c=!0,s=p}finally{try{!m&&v["return"]&&v["return"]()}finally{if(c)throw s}}}}catch(p){u=!0,o=p}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw o}}return a}for(var b in arguments[0])a.register(b,arguments[0][b])}},search:{value:function(t,e,n){
var i=a.matches(t,e,n);return i[i.length-1]||{attribute:e}}},matches:{value:function(t,e,n){var i=[];for(var r in a)if(t.matches(r)){var u=a[r],o=!0,d=!1,l=void 0;try{for(var m,c=u[Symbol.iterator]();!(o=(m=c.next()).done);o=!0){var s=m.value,f=void 0===e&&s["default"]||e===s.attribute;f&&(void 0!==n&&"string"!==n&&n!==s.datatype||s.test&&!s.test(t,e,n)||i.push(s))}}catch(v){d=!0,l=v}finally{try{!o&&c["return"]&&c["return"]()}finally{if(d)throw l}}}return i}},isSVG:{value:function(t){return"http://www.w3.org/2000/svg"==t.namespaceURI}},defaultEditors:{value:{string:{tag:"input"},number:{tag:"input",type:"number"},"boolean":{tag:"input",type:"checkbox"}}}}),a.register({"*":[{test:function(t,e){return"hidden"==e},attribute:"hidden",datatype:"boolean"},{test:a.isSVG,attribute:"y",datatype:"number"},{"default":!0,test:a.isSVG,attribute:"x",datatype:"number"}],"img, video, audio":{"default":!0,attribute:"src",editor:{tag:"input",type:"url",placeholder:"http://example.com"}},"video, audio":{attribute:["autoplay","buffered","loop"],
datatype:"boolean"},"a, link":{"default":!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},"select, input":{attribute:"value","default":!0,modes:"read",changeEvents:"input change"},textarea:{"default":!0,modes:"read",changeEvents:"input",getValue:function(t){return t.value},setValue:function(t,e){return t.value=e}},"input[type=range], input[type=number]":{"default":!0,attribute:"value",datatype:"number",modes:"read",changeEvents:"input change"},"input[type=checkbox]":{"default":!0,attribute:"checked",datatype:"boolean",modes:"read",changeEvents:"click"},"input[type=radio]":{"default":!0,attribute:"checked",modes:"read",getValue:function(e){if(e.form)return e.form[e.name].value;var a=t('input[type=radio][name="'+e.name+'"]:checked');return a&&a.value},setValue:function(e,a){if(e.form)return void(e.form[e.name].value=a);var n=t('input[type=radio][name="'+e.name+'"][value="'+a+'"]');t.properties(n,{checked:!0})},init:function(t){var e=this;this.mavo.element.addEventListener("change",function(a){
a.target.name==t.name&&(e.value=e.getValue())})}},"button, .counter":{"default":!0,attribute:"mv-clicked",datatype:"number",modes:"read",init:function(t){var e=this;"mv-clicked"===this.attribute&&(t.setAttribute("mv-clicked","0"),t.addEventListener("click",function(a){var n=+t.getAttribute("mv-clicked")||0;e.value=++n}))}},"meter, progress":{"default":!0,attribute:"value",datatype:"number",edit:function(){var t=this,e=+this.element.getAttribute("min")||0,a=+this.element.getAttribute("max")||1,n=a-e,i=+this.element.getAttribute("mv-edit-step")||(n>1?1:n/100);this.element.addEventListener("mousemove.mavo:edit",function(r){var u=t.element.getBoundingClientRect().left,o=Math.max(0,(r.clientX-u)/t.element.offsetWidth),d=e+n*o,l=d%i;d+=l>i/2?i-l:-l,d=Math.max(e,Math.min(d,a)),t.sneak(function(){return t.element.setAttribute("value",d)})}),this.element.addEventListener("mouseleave.mavo:edit",function(e){t.sneak(function(){return t.element.setAttribute("value",t.value)})}),this.element.addEventListener("click.mavo:edit",function(e){
t.value=t.getValue()}),this.element.addEventListener("keydown.mavo:edit",function(n){if(n.target==t.element&&(37==n.keyCode||39==n.keyCode)){var r=i*(39==n.keyCode?1:-1)*(n.shiftKey?10:1),u=t.value+r;u=Math.max(e,Math.min(u,a)),t.element.setAttribute("value",u)}})},done:function(){t.unbind(this.element,".mavo:edit")}},meta:{"default":!0,attribute:"content"},"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address":{"default":!0,editor:function n(){var e=getComputedStyle(this.element).display,a=0===e.indexOf("inline")?"input":"textarea",n=t.create(a);if("textarea"==a){var i=this.element.offsetWidth;i&&(n.width=i)}return n},setEditorValue:function(t){if(!this.datatype||"string"==this.datatype){var e=getComputedStyle(this.element);return t=t||"",["normal","nowrap"].indexOf(e.whiteSpace)>-1&&(t=t.replace(/\r?\n/g," ")),["normal","nowrap","pre-line"].indexOf(e.whiteSpace)>-1&&(t=t.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=t,!0}}},time:{attribute:"datetime",
"default":!0,editor:function(){var t={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},e=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var a in t)if(t[a].test(e))break;return{tag:"input",type:a}},humanReadable:function(t){var e=new Date(t);if(!t||isNaN(e))return"(No "+this.label+")";var a={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},n=a[this.editor&&this.editor.type]||a.date;return n.timeZone="UTC",e.toLocaleString("en-GB",n)}},circle:[{"default":!0,attribute:"r",datatype:"number"},{attribute:["cx","cy"],datatype:"number"}],text:{"default":!0,popup:!0}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(e,t){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var n=Mavo.Collection=e.Class({"extends":Mavo.Node,nodeType:"Collection",constructor:function(e,n,a){if(this.templateElement=this.element,this.children=[],this.fromTemplate("properties","mutable","templateElement","accepts")||(this.properties=t(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0)),this.mutable){var i=this.createItem(this.element);this.add(i),this.itemTemplate=i.template||i}this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={
context:this,options:e,data:[]},n=!0,a=!1,i=void 0;try{for(var r,o=this.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)if(item=r.value,!item.deleted||e["null"]){var l=item.getData(t.options);(l||e["null"])&&t.data.push(l)}}catch(s){a=!0,i=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}return this.unhandled&&(t.data=this.unhandled.before.concat(t.data,this.unhandled.after)),this.mutable||1!=t.data.length||(t.data=t.data[0]),Mavo.hooks.run("node-getdata-end",t),t.data},createItem:function(e){e||(e=this.templateElement.cloneNode(!0));var t=Mavo.Node.create(e,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return t},add:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t=t instanceof Node?Mavo.Node.get(t)||this.createItem(t):t||this.createItem(),t.collection!=this&&this.adopt(t),this.mutable){var i=this.children[n]?this.children[n].element:this.marker;
e[this.bottomUp?"after":"before"](t.element,i),void 0===n&&(n=this.bottomUp?0:this.length)}var r={context:this,item:t};return r.previousIndex=t.index,r.changed=this.splice({remove:r.item},{index:n,add:r.item}),a.silent||(r.changed.forEach(function(e){e.dataChanged(e==r.item&&void 0===r.previousIndex?"add":"move"),e.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0),Mavo.hooks.run("collection-add-end",r),r.item},splice:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=!0,i=!1,r=void 0;try{for(var o,l=t[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;void 0===s.index&&s.remove&&isNaN(s.remove)&&(s.index=this.children.indexOf(s.remove),s.remove=1)}}catch(d){i=!0,r=d}finally{try{!a&&l["return"]&&l["return"]()}finally{if(i)throw r}}t.sort(function(e,t){return t.index-e.index});var c=!0,h=!1,m=void 0;try{for(var u,v=t[Symbol.iterator]();!(c=(u=v.next()).done);c=!0){var p=u.value;if(p.index>-1&&(p.remove||p.add)){var f;p.remove=p.remove||0,
p.add=Mavo.toArray(p.add),(f=this.children).splice.apply(f,[p.index,+p.remove].concat(_toConsumableArray(p.add)))}}}catch(d){h=!0,m=d}finally{try{!c&&v["return"]&&v["return"]()}finally{if(h)throw m}}for(var g=[],y=0;y<this.length;y++){var b=this.children[y];b&&b.index!==y&&(b.index=y,g.push(b))}return g},adopt:function(e){var t=this;e.collection&&(e.collection.splice({remove:e}),e.collection.dataChanged("delete")),this.walk(function(n){n.closestCollection===e.collection&&(n.closestCollection=t),e.mavo!=t.mavo&&(e.mavo=t.mavo)}),e.collection=this,e.template&&(Mavo["delete"](e.template.copies,e),e.template=this.itemTemplate)},"delete":function(t,n){var a=this;return n?(e.remove(t.element),this.splice({remove:t}),void t.destroy()):e.transition(t.element,{opacity:0}).then(function(){t.deleted=!0,t.element.style.opacity="",t.dataChanged("delete"),a.unsavedChanges=t.unsavedChanges=a.mavo.unsavedChanges=!0})},move:function(e,t){index=e.index+t+(t>0),index<0?index=this.children.length:index>this.children.length&&(index=0),
this.add(e,index)},editItem:function(n){var a=this;n.itemControls||(n.itemControls=t(".mv-item-controls",n.element).filter(function(e){return e.closest(Mavo.selectors.multiple)==n.element&&!Mavo.data(e,"item")})[0],n.itemControls=n.itemControls||e.create({className:"mv-item-controls mv-ui"}),Mavo.data(n.itemControls,"item",n),e.set(n.itemControls,{contents:[{tag:"button",title:"Delete this "+n.name,className:"mv-delete",events:{click:function(e){return n.collection["delete"](n)}}},{tag:"button",title:"Add new "+n.name.replace(/s$/i,"")+" "+(this.bottomUp?"after":"before"),className:"mv-add",events:{click:function(e){var t=a.add(null,n.index);return e[Mavo.superKey]&&t.render(n.data),Mavo.scrollIntoViewIfNeeded(t.element),a.editItem(t)}}},{tag:"button",title:"Drag to reorder "+n.name,className:"mv-drag-handle",events:{click:function(e){return e.target.focus()},keydown:function(e){e.keyCode>=37&&e.keyCode<=40&&(a.move(n,e.keyCode<=38?-1:1),e.stopPropagation(),e.preventDefault(),e.target.focus());
}}}]})),n.itemControls.parentNode||Mavo.revocably.add(n.itemControls)||(n instanceof Mavo.Primitive&&!n.attribute?(n.itemControls.classList.add("mv-adjacent"),e.after(n.itemControls,n.element)):n.element.appendChild(n.itemControls)),n.edit()},edit:function(){var t=this;if(this["super"].edit.call(this)===!1)return!1;if(this.mutable){if(!this.addButton.parentNode){var a=this.element.tagName.toLowerCase(),i=Mavo.selectors.container[a],r=i?this.marker.parentNode.closest(i):this.marker;e[this.bottomUp?"before":"after"](this.addButton,r)}this.propagate(function(e){t.editItem(e)}),n.dragula.then(function(){t.getDragula()})}},done:function(){return this["super"].done.call(this)!==!1&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(function(e){return Mavo.revocably.remove(e.itemControls,"item controls")})))},clear:function(){this.mutable&&(this.propagate(function(e){e.element.remove(),e.destroy()}),this.children=[],this.dataChanged("clear"))},dataChanged:function(e){
var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.element=t.element||this.marker,this["super"].dataChanged.call(this,e,t)},save:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.children[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var r=a.value;r.deleted?this["delete"](r,!0):r.unsavedChanges=!1}}catch(o){t=!0,n=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}},propagated:["save"],dataRender:function(t){if(this.unhandled={before:[],after:[]},t)if(t=Mavo.toArray(t),this.mutable){for(var n=0;n<this.children.length;n++)n<t.length?this.children[n].render(t[n]):this["delete"](this.children[n],!0);if(t.length>n){for(var a=document.createDocumentFragment(),i=n;i<t.length;i++){var r=this.createItem();r.render(t[i]),this.children.push(r),r.index=i,a.appendChild(r.element);var o={context:this,item:r};Mavo.hooks.run("collection-add-end",o)}this.bottomUp?e.after(a,n>0?this.children[n-1].element:this.marker):e.before(a,this.marker)}}else this.children.forEach(function(e,n){
return e.render(t&&t[n])}),t&&(this.unhandled.after=t.slice(this.length))},find:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.children.filter(function(e){return!e.deleted});if(this.property==e)return t.collections?this:n;if(this.properties.indexOf(e)>-1){var a=n.map(function(n){return n.find(e,t)});return Mavo.flatten(a)}},isCompatible:function(e){return e&&this.itemTemplate.nodeType==e.itemTemplate.nodeType&&(e===this||e.template==this||this.template==e||this.template&&this.template==e.template||this.accepts.indexOf(e.property)>-1)},live:{mutable:function(t){t&&t!==this.mutable&&(this._mutable=t,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),e.after(this.marker,this.templateElement))}},getDragula:function(){var e=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();
return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(t){return!!e.accepts.length&&Mavo.flatten(e.accepts.map(function(t){return e.mavo.root.find(t,{collections:!0})})).filter(function(e){return e&&e instanceof n}).map(function(e){return e.marker.parentNode}).indexOf(t)>-1},moves:function(e,t,n){return n.classList.contains("mv-drag-handle")&&n.closest(Mavo.selectors.multiple)==e},accepts:function(e,t,a,i){if(e.contains(t))return!1;var r=i?i.previousElementSibling:t.lastElementChild,o=n.get(r)||n.get(i);if(!o)return!1;var l=Mavo.Node.get(e);return l&&l.collection.isCompatible(o)}}),this.dragula.on("drop",function(t,a,i){var r=Mavo.Node.get(t),o=(r&&r.index,t.nextElementSibling),l=t.previousElementSibling,s=n.get(l)||n.get(o),d=Mavo.Node.get(l)||Mavo.Node.get(o);if(d&&d.collection!=s&&(d=null),!r.collection.isCompatible(s))return e.dragula.cancel(!0);var c=d?d.index+(d.element===l):s.length;s.add(r,c)}),n.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){
if(!this.mutable)return!1;var e=this.templateElement.getAttribute("mv-order");return null!==e?/^desc\b/i.test(e):!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING)},closestCollection:function(){var e=this.marker?this.marker.parentNode:this.templateElement.parentNode;return e.closest(Mavo.selectors.multiple)},addButton:function(){var n=this,a="button.mv-add-"+this.property,i=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(i)var r=t(a,i).filter(function(e){return!n.templateElement.contains(e)})[0];return r||(r=e.create("button",{className:"mv-add",textContent:"Add "+this.name})),r.classList.add("mv-ui","mv-add"),Mavo.data(r,"collection",this),this.property&&r.classList.add("mv-add-"+this.property),r.addEventListener("click",function(e){e.preventDefault(),n.editItem(n.add())}),r}},"static":{dragulas:[],get:function(e){var t=Mavo.data(e,"collection");if(t)return t;var n=Mavo.Node.get(e);return n&&n.collection||null;
},lazy:{dragula:function(){return e.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(e){Mavo.attributes.push("mv-expressions");var t=Mavo.Expression=e.Class({constructor:function(e){this.expression=e},eval:function(e){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this["function"]||(this["function"]=t.compile(this.expression),this.identifiers=this.expression.match(/[$a-z][$\w]*/gi)||[]),this.value=this["function"](e)}catch(r){console.info("%cExpression error!","color: red; font-weight: bold",r.message+" in expression "+this.expression),Mavo.hooks.run("expression-eval-error",{context:this,exception:r}),this.value=r}return this.value},toString:function(){return this.expression},changedBy:function(e){if(!e)return!0;if(!this.identifiers)return!1;if(this.identifiers.indexOf(e.property)>-1)return!0;if(Mavo.hasIntersection(e.properties,this.identifiers))return!0;if("propertychange"!=e.action){
if(Mavo.hasIntersection(["$index","$all","$previous","$next"],this.identifiers))return!0;var t=e.node.collection||e.node;if(Mavo.hasIntersection(t.properties,this.identifiers))return!0}return!!Mavo.hasIntersection(Mavo.allIds,this.identifiers)},live:{expression:function(e){e=e;this["function"]=null}},"static":{serializers:{BinaryExpression:function(e){return t.serialize(e.left)+" "+e.operator+" "+t.serialize(e.right)},UnaryExpression:function(e){return""+e.operator+t.serialize(e.argument)},CallExpression:function(e){return t.serialize(e.callee)+"("+e.arguments.map(t.serialize).join(", ")+")"},ConditionalExpression:function(e){return t.serialize(e.test)+"? "+t.serialize(e.consequent)+" : "+t.serialize(e.alternate)},MemberExpression:function(e){return"get("+t.serialize(e.object)+', "'+(e.property.name||e.property.value)+'")'},ArrayExpression:function(e){return"["+e.elements.map(t.serialize).join(", ")+"]"},Literal:function(e){return e.raw},Identifier:function(e){return e.name},ThisExpression:function(e){
return"this"},Compound:function(e){return e.body.map(t.serialize).join(" ")}},transformations:{BinaryExpression:function(e){var r=Mavo.Script.getOperatorName(e.operator),i=(Mavo.Script.operators[r],e),n=[];do n.unshift(i.right),i=i.left;while(Mavo.Script.getOperatorName(i.operator)===r);if(n.unshift(i),n.length>1)return r+"("+n.map(t.serialize).join(", ")+")"},CallExpression:function(e){"Identifier"==e.callee.type&&"if"==e.callee.name&&(e.callee.name="iff")}},serialize:function(e){if(t.transformations[e.type]){var r=t.transformations[e.type](e);if(void 0!==r)return r}return t.serializers[e.type](e)},rewrite:function(e){try{return t.serialize(t.parse(e))}catch(r){return e}},compile:function(e){return e=t.rewrite(e),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\t\twith(data) {\n\t\t\t\t\t\treturn "+e+";\n\t\t\t\t\t}")},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.addBinaryOp("mod",10),jsep.removeBinaryOp("===")),t.serializers.LogicalExpression=t.serializers.BinaryExpression,
t.transformations.LogicalExpression=t.transformations.BinaryExpression,t.Syntax=e.Class({constructor:function(e,t){this.start=e,this.end=t,this.regex=RegExp(Mavo.escapeRegExp(e)+"([\\S\\s]+?)"+Mavo.escapeRegExp(t),"gi")},test:function(e){return this.regex.lastIndex=0,this.regex.test(e)},tokenize:function(e){var t,r=[],i=0;for(this.regex.lastIndex=0;null!==(t=this.regex.exec(e));)t.index>i&&r.push(e.substring(i,t.index)),i=this.regex.lastIndex,r.push(new Mavo.Expression(t[1]));return i<e.length&&r.push(e.substring(i)),r},"static":{create:function(e){if(e){var r=e.getAttribute("mv-expressions");if(r)return r=r.trim(),/\s/.test(r)?new(Function.prototype.bind.apply(t.Syntax,[null].concat(_toConsumableArray(r.split(/\s+/))))):t.Syntax.ESCAPE}},ESCAPE:-1}}),t.Syntax["default"]=new t.Syntax("[","]")}(Bliss);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(t){var e=Mavo.DOMExpression=t.Class({constructor:function(){var i=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mavo=n.mavo,this.template=n.template&&n.template.template||n.template;for(var s=["item","path","syntax","fallback","attribute"],r=0;r<s.length;r++){var o=s[r];this[o]=void 0===n[o]&&this.template?this.template[o]:n[o]}if(this.node=n.node,this.node||(this.node=this.path.reduce(function(t,e){return t.childNodes[e]},this.item.element)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),!this.expression){if(3===this.node.nodeType&&(this.element=this.node.parentNode,this.node.parentNode.children.length&&!this.attribute||(this.node=this.element,this.element.normalize())),this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{
if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var a=this.node.firstChild.textContent.match(/^\s*|\s*$/g);a[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-a[1].length),t.after(this.node.lastChild,this.node)),a[0]&&(this.node.firstChild.splitText(a[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=n.template?n.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(t){return t instanceof Mavo.Expression?t.expression:t}),this.mavo.treeBuilt.then(function(){i.template||(i.item=Mavo.Node.get(i.element.closest(Mavo.selectors.multiple+", "+Mavo.selectors.group)),i.item.expressions=[].concat(_toConsumableArray(i.item.expressions||[]),[i])),Mavo.hooks.run("domexpression-init-treebuilt",i)}),Mavo.hooks.run("domexpression-init-end",this),e.elements.set(this.element,[].concat(_toConsumableArray(e.elements.get(this.element)||[]),[this]));
},changedBy:function(t){return!this.parsed.every(function(e){return!(e instanceof Mavo.Expression&&e.changedBy(t))})},update:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,i=arguments[1],n={context:this,ret:{},event:i},s=n;this.data=e,n.ret={},Mavo.hooks.run("domexpression-update-start",n),this.oldValue=this.value,n.ret.value=this.value=this.parsed.map(function(i,n){if(i instanceof Mavo.Expression){if(i.changedBy(s.event)){var r={context:t,expr:i,parentEnv:s};return Mavo.hooks.run("domexpression-update-beforeeval",r),r.value=r.expr.eval(e),Mavo.hooks.run("domexpression-update-aftereval",r),r.value instanceof Error?void 0!==t.fallback?t.fallback:r.expr.expression:void 0===r.value||null===r.value?"":r.value}return t.oldValue[n]}return i}),this.attribute||(n.ret.presentational=this.value.map(function(t){return Array.isArray(t)?t.join(", "):"number"==typeof t?Mavo.Primitive.formatNumber(t):t}),n.ret.presentational=1===n.ret.presentational.length?n.ret.presentational[0]:n.ret.presentational.join("")),
n.ret.value=1===n.ret.value.length?n.ret.value[0]:n.ret.value.join(""),this.primitive&&1===this.parsed.length&&("number"==typeof n.ret.value?this.primitive.datatype="number":"boolean"==typeof n.ret.value&&(this.primitive.datatype="boolean")),n.ret.presentational===n.ret.value&&(ret=n.ret.value),this.output(n.ret),Mavo.hooks.run("domexpression-update-end",n)},output:function(t){this.primitive?this.primitive.value=t:(t=t.presentational||t,Mavo.Primitive.setValue(this.node,t,{attribute:this.attribute}))},"static":{elements:new WeakMap,search:function(t,i){var n=e.elements.get(t)||[];return arguments.length>1?n.length?n.filter(function(t){return t.attribute===i})[0]||null:null:n}}});Mavo.hooks.add("primitive-init-start",function(){var t=Mavo.DOMExpression.search(this.element,this.attribute);t&&!t.mavoNode&&(t.primitive=this,this.storage=this.storage||"none",this.modes="read")})}(Bliss);
"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){var n=Mavo.Expressions=e.Class({constructor:function(e){var t=this;this.mavo=e,this.active=!0,this.expressions=[];var o=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax["default"];this.traverse(this.mavo.element,void 0,o),this.scheduled=new Set,this.mavo.treeBuilt.then(function(){t.expressions=[],t.mavo.element.addEventListener("mavo:datachange",function(e){t.active&&("propertychange"==e.action&&e.node.closestCollection?t.scheduled.has(e.property)||(setTimeout(function(){
t.scheduled["delete"](e.property),t.update(e)},n.PROPERTYCHANGE_THROTTLE),t.scheduled.add(e.property)):requestAnimationFrame(function(){return t.update(e)}))}),t.update()})},update:function(t){var n,o,i=this;t instanceof Element&&(n=t.closest(Mavo.selectors.group),t=null),n=n||this.mavo.element,o=Mavo.Node.get(n);var r=o.getData({relative:!0,store:"*","null":!0});o.walk(function(n,o){if(n.expressions&&n.expressions.length&&!n.isDeleted()){var a={context:i,data:e.value.apply(e,[r].concat(_toConsumableArray(o)))};Mavo.hooks.run("expressions-update-start",a);var s=!0,u=!1,l=void 0;try{for(var c,p=n.expressions[Symbol.iterator]();!(s=(c=p.next()).done);s=!0){var f=c.value;f.changedBy(t)&&f.update(a.data,t)}}catch(v){u=!0,l=v}finally{try{!s&&p["return"]&&p["return"]()}finally{if(u)throw l}}}})},extract:function(e,t,o,i){t&&"mv-expressions"==t.name||(t&&n.directives.indexOf(t.name)>-1||i.test(t?t.value:e.textContent))&&this.expressions.push(new Mavo.DOMExpression({node:e,syntax:i,path:o?o.slice(1).split("/").map(function(e){
return+e}):[],attribute:t&&t.name,mavo:this.mavo}))},traverse:function(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments[2];if(8!==e.nodeType)if(3===e.nodeType)this.extract(e,null,o,i);else{if(e.normalize(),i=Mavo.Expression.Syntax.create(e)||i,i===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("multiple",e)&&(o=""),t(e.attributes).forEach(function(t){return n.extract(e,t,o,i)}),t(e.childNodes).forEach(function(e,t){return n.traverse(e,o+"/"+t,i)})}},"static":{directives:[],PROPERTYCHANGE_THROTTLE:50,directive:function(e,t){n.directives.push(e),Mavo.attributes.push(e),Mavo.plugin(t)}}});Mavo.hooks.add({"init-tree-before":function(){this.expressions=new Mavo.Expressions(this)},"node-init-end":function(){var e=this,t=this.template;t&&t.expressions&&(this.expressions=t.expressions.map(function(t){return new Mavo.DOMExpression({template:t,item:e,mavo:e.mavo})}))},"render-start":function(){this.expressions.active=!1},"render-end":function(){this.expressions.active=!0,
this.expressions.update()},"collection-add-end":function(e){var t=this;this.mavo.treeBuilt.then(function(){return t.mavo.expressions.update(e.item.element)})},"node-getdata-end":self.Proxy&&function(e){var t=this;if(e.options.relative&&(e.data&&"object"===_typeof(e.data)||this.collection)){var n=e.data;if(this instanceof Mavo.Primitive){var o;e.data=(o={},_defineProperty(o,Symbol.toPrimitive,function(){return n}),_defineProperty(o,this.property,n),o)}e.data=new Proxy(e.data,{get:function(e,t,n){if(t in e||t in n&&t in e)return e[t]},has:function(n,o){if(o in n)return!0;if("$index"==o)return n[o]=t.index||0,!0;if("$all"==o)return n[o]=t.closestCollection?t.closestCollection.getData(e.options):[e.data];if("$next"==o||"$previous"==o)return t.closestCollection?n[o]=t.closestCollection.getData(e.options)[t.index+("$next"==o?1:-1)]:(n[o]=null,null);if(o==t.mavo.id)return n[o]=t.mavo.root.getData(e.options);if(t instanceof Mavo.Group&&o==t.property&&t.collection)return n[o]=e.data;var i=t.walkUp(function(e){
if(o in e.children)return e.children[o]});return void 0===i&&(i=t.find(o)),void 0!==i&&(Array.isArray(i)?i=i.map(function(t){return t.getData(e.options)}).filter(function(e){return null!==e}):i instanceof Mavo.Node&&(i=i.getData(e.options)),n[o]=i,!0)},set:function(e,t,n){throw Error("You can’t set data via expressions.")}})}}})}(Bliss,Bliss.$);
"use strict";!function(e,t){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(e){this._hidden!==e&&(this._hidden=e,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var e=this;if("mv-if"==this.attribute){var i=t(Mavo.selectors.property,this.element).filter(function(t){return t.closest("[mv-if]")==e.element}).map(function(e){return Mavo.Node.get(e)});return this.element.addEventListener("mavo:datachange",function(t){requestAnimationFrame(function(){e.element.parentNode||e.item.element.dispatchEvent(t)})}),i}}}}},hooks:{"domexpression-init-start":function(){"mv-if"==this.attribute&&(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)));
},"domexpression-update-end":function(){var e=this;if("mv-if"==this.attribute){var t=this.value[0],i=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(e.parentIf){var n=e.parentIf.value[0];e.value[0]=t=t&&n}if(t!==i){if(n!==!1&&(t?Mavo.revocably.add(e.element):e.element.parentNode&&Mavo.revocably.remove(e.element,"mv-if")),e.childProperties){var r=!0,s=!1,a=void 0;try{for(var o,h=e.childProperties[Symbol.iterator]();!(r=(o=h.next()).done);r=!0){var l=o.value;l.hidden=!t}}catch(d){s=!0,a=d}finally{try{!r&&h["return"]&&h["return"]()}finally{if(s)throw a}}}if(e.childIfs){var f=!0,v=!1,u=void 0;try{for(var m,c=e.childIfs[Symbol.iterator]();!(f=(m=c.next()).done);f=!0){var p=m.value;p.update()}}catch(d){v=!0,u=d}finally{try{!f&&c["return"]&&c["return"]()}finally{if(v)throw u}}}}})}},"unit-isdatanull":function(e){e.result=e.result||this.hidden&&"*"==e.options.store}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Mavo.Expressions.directive("mv-value",{hooks:{"node-init-start":function(){if(this instanceof Mavo.Group||this.collection){var t=Mavo.DOMExpression.search(this.element).filter(function(t){return"mv-value"==t.originalAttribute})[0];t&&(t.mavoNode=this,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[].concat(_toConsumableArray(this.collection.expressions||[]),[t]),t.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}},"domexpression-init-start":function(){"mv-value"==this.attribute&&(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),
this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end)},"domexpression-init-treebuilt":function(){"mv-value"!=this.originalAttribute||!this.mavoNode||this.mavoNode!=this.item&&this.mavoNode!=this.item.collection||(this.mavoNode==this.item.collection&&Mavo["delete"](this.item.expressions,this),this.output=function(t){t=t.value||t,this.mavoNode.render(t)},this.changedBy=function(t){return!0})},"domexpression-update-start":function(){"mv-value"!=this.originalAttribute||this.mavoNode!=this.item}}});
"use strict";function _toConsumableArray(r){if(Array.isArray(r)){for(var t=0,n=Array(r.length);t<r.length;t++)n[t]=r[t];return n}return Array.from(r)}var _slicedToArray=function(){function r(r,t){var n=[],a=!0,e=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(c){e=!0,i=c}finally{try{!a&&u["return"]&&u["return"]()}finally{if(e)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function r(r,t){return r=Array.isArray(r)?r:t?$$(t):[r],r.filter(function(r){return!isNaN(r)&&""!==r}).map(function(r){return+r})}var t=Mavo.Functions={operators:{"=":"eq"},get $now(){return new Date},urlOption:function(){for(var r=("searchParams"in URL.prototype?new URL(location).searchParams:null),t=null,n=arguments.length,a=Array(n),e=0;e<n;e++)a[e]=arguments[e];var i=!0,o=!1,u=void 0;try{
for(var c,l=a[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var s=c.value;if(r)t=r.get(s);else{var f=location.search.match(RegExp("[?&]"+s+"(?:=([^&]+))?(?=&|$)","i"));t=f&&(f[1]||"")}if(null!==t)return t}}catch(y){o=!0,u=y}finally{try{!i&&l["return"]&&l["return"]()}finally{if(o)throw u}}return null},get:function(r,t){return r&&void 0!==r[t]?r[t]:null},unique:function(r){return[].concat(_toConsumableArray(new Set(r)))},sum:function(t){return r(t,arguments).reduce(function(r,t){return+r+(+t||0)},0)},average:function(n){return n=r(n,arguments),n.length&&t.sum(n)/n.length},min:function(t){return Math.min.apply(Math,_toConsumableArray(r(t,arguments)))},max:function(t){return Math.max.apply(Math,_toConsumableArray(r(t,arguments)))},count:function(r){return Mavo.toArray(r).filter(function(r){return null!==r&&r!==!1&&""!==r}).length},round:function(r,t){return r&&t&&isFinite(r)?+r.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t}):Math.round(r)},iff:function(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";
return Array.isArray(r)?r.map(function(r,a){var e=r?t:n;return Array.isArray(e)?e[Math.min(a,e.length-1)]:e}):r?t:n},replace:function(r,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(Array.isArray(r))return r.map(function(r){return t.replace(r,n,a)});for(var i,o=RegExp(Mavo.escapeRegExp(n),"g"),u=r,c=0;u!=i&&c++<e;)i=u,u=u.replace(o,a);return u},len:function(r){return(r||"").length},search:function(r,t){return r&&t?r.toLowerCase().indexOf(t.toLowerCase()):-1},starts:function(r,n){return 0===t.search(r,n)},ends:function(r,n){var a=t.search(r,n);return a>-1&&a===r.length-n.length},join:function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Mavo.toArray(r).join(t)},idify:function(r){return((r||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},readable:function(r){return r&&r.replace(/([a-z])([A-Z])(?=[a-z])/g,function(r,t,n){return t+" "+n.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(r){
return r.toUpperCase()})},uppercase:function(r){return(r+"").toUpperCase()},lowercase:function(r){return(r+"").toLowerCase()}};Mavo.Script={addUnaryOperator:function(r,t){return function(r){return Array.isArray(r)?r.map(t.scalar):t.scalar(r)}},addBinaryOperator:function(n,a){if(a.symbol){var e=!0,i=!1,o=void 0;try{for(var u,c=Mavo.toArray(a.symbol)[Symbol.iterator]();!(e=(u=c.next()).done);e=!0){var l=u.value;Mavo.Script.symbols[l]=n}}catch(s){i=!0,o=s}finally{try{!e&&c["return"]&&c["return"]()}finally{if(i)throw o}}}return a.identity=void 0===a.identity?0:a.identity,t[n]=a.code||function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];1===n.length&&Array.isArray(n[0])&&(n=[].concat(_toConsumableArray(n[0])));for(var i,o=a.logical?a.identity:n[0],u=function(t){var e=a.logical?n[t-1]:o,u=n[t];Array.isArray(u)?("number"==typeof a.identity&&(u=r(u)),i=Array.isArray(e)?[].concat(_toConsumableArray(u.map(function(r,t){return a.scalar(void 0===e[t]?a.identity:e[t],r)})),_toConsumableArray(e.slice(u.length))):u.map(function(r){
return a.scalar(e,r)})):("number"==typeof a.identity&&(u=+u),i=Array.isArray(e)?e.map(function(r){return a.scalar(r,u)}):a.scalar(e,u)),o=a.reduce?a.reduce(o,i,e,u):a.logical?o&&i:i},c=1;c<n.length;c++)u(c);return o}},symbols:{},getOperatorName:function(r){return Mavo.Script.symbols[r]||r},operators:{not:{scalar:function(r){return function(r){return!r}}},multiply:{scalar:function(r,t){return r*t},identity:1,symbol:"*"},divide:{scalar:function(r,t){return r/t},identity:1,symbol:"/"},add:{scalar:function(r,t){return+r+ +t},symbol:"+"},subtract:{scalar:function(r,t){return r-t},symbol:"-"},mod:{scalar:function(r,t){return r%t}},lte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<=t},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<t},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);
return r=a[0],t=a[1],r>=t},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r>t},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(r,t){return r==t},symbol:["=","=="],identity:!0},neq:{logical:!0,scalar:function(r,t){return r!=t},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(r,t){return!!r&&!!t},identity:!0,symbol:"&&"},or:{logical:!0,scalar:function(r,t){return!!r||!!t},reduce:function(r,t){return r||t},identity:!1,symbol:"||"},concatenate:{symbol:"&",identity:"",scalar:function(r,t){return""+r+t}},filter:{scalar:function(r,t){return t?r:null}}},getNumericalOperands:function(r,t){if(isNaN(r)||isNaN(t)){var n=new Date(r),a=new Date(t);if(!isNaN(n)&&!isNaN(a))return[n,a]}return[r,t]}};for(var n in Mavo.Script.operators){var a=Mavo.Script.operators[n];a.scalar.length<2?Mavo.Script.addUnaryOperator(n,a):Mavo.Script.addBinaryOperator(n,a)}var e={average:"avg",iff:"iff IF",subtract:"minus",
multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"},i=function(r){e[r].split(/\s+/g).forEach(function(n){return t[n]=t[r]})};for(var o in e)i(o);Mavo.Functions._Trap=self.Proxy?new Proxy(t,{get:function(r,t){if(t in r)return r[t];var n=t.toLowerCase&&t.toLowerCase();return n&&r.hasOwnProperty(n)?r[n]:t in Math||n in Math?Math[t]||Math[n]:t in self?self[t]:t},has:function(r,t){return"data"!=t}}):Mavo.Functions}();
"use strict";!function(e){if(self.Mavo){var t="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Mavo.Backend.register(e.Class({"extends":Mavo.Backend,id:"Dropbox",constructor:function(){var o=this;this.url=new URL(this.url,location),"dropbox:"!=this.url.protocol&&(this.url.hostname="dl.dropboxusercontent.com",this.url.search=this.url.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.on("read")),this.permissions.on("login"),this.ready=e.include(self.Dropbox,t).then(function(){var t=new URL(document.referrer,location);return"www.dropbox.com"===t.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),e.fire(window,"load"),void close()):(o.path=(o.mavo.element.getAttribute("mv-dropbox-path")||"")+new URL(o.url).pathname.match(/[^\/]*$/)[0],o.key=o.mavo.element.getAttribute("mv-dropbox-key")||"fle6gsc61w5v79j",void(o.client=new Dropbox.Client({key:o.key})))}).then(function(){o.login(!0)})},put:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getFile();
return new Promise(function(o,n){e.client.writeFile(t.name,t.dataString,function(e,i){return e?n(Error(e)):(console.log("File saved as revision "+i.versionTag),void o(t))})})},login:function(t){var o=this;return this.ready.then(function(){return o.client.isAuthenticated()?Promise.resolve():new Promise(function(e,n){o.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),o.client.authenticate({interactive:!t},function(t,i){t&&n(Error(t)),o.client.isAuthenticated()?(o.permissions.on(["logout","edit"]),e()):(o.permissions.off(["logout","edit","add","delete"]),n())})})}).then(function(){o.client.getAccountInfo(function(t,n){t||e.fire(o.mavo.element,"mavo:login",e.extend({backend:o},n))})})["catch"](function(){})},logout:function(){var e=this;return this.client.isAuthenticated()?new Promise(function(t,o){e.client.signOut(null,function(){e.permissions.off(["edit","add","delete"]).on("login"),e.mavo.element._.fire("mavo:logout",{backend:e}),t()})}):Promise.resolve();
},"static":{test:function(e){return e=new URL(e,location),/dropbox.com/.test(e.host)||"dropbox:"===e.protocol}}}))}}(Bliss);
"use strict";!function(t){if(self.Mavo)var e=Mavo.Backend.register(t.Class({"extends":Mavo.Backend,id:"Github",constructor:function(){this.permissions.on("login"),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var n=e.parseURL(this.url);n.username?(t.extend(this,n),this.repo=this.repo||"mv-data",this.branch=this.branch||"master",this.path=this.path||this.mavo.id+".json",this.apiCall="repos/"+this.username+"/"+this.repo+"/contents/"+this.path):this.apiCall=this.url.pathname.slice(1),this.permissions.on("read"),this.login(!0)},get authenticated(){return!!this.accessToken},req:function(n,o){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{method:s};o&&(r.data=JSON.stringify(o));var a=t.extend(r,{responseType:"json"});return this.authenticated&&(a.headers={Authorization:"token "+this.accessToken}),t.fetch(e.apiDomain+n,a)["catch"](function(t){return t&&t.xhr?Promise.reject(t.xhr):void i.mavo.error("Something went wrong while connecting to Github",t);
}).then(function(t){return Promise.resolve(t.response)})},get:function(){var t=this;return this.req(this.apiCall).then(function(n){return Promise.resolve(t.repo?e.atob(n.content):n)})},put:function(t,n){var o=this,i=n?"repos/"+this.username+"/"+this.repo+"/contents/"+n:this.apiCall;return Promise.resolve(this.repoInfo||this.req("user/repos",{name:this.repo},"POST")).then(function(t){return o.repoInfo=t,o.req(i,{ref:o.branch})}).then(function(n){return o.req(i,{message:"Updated "+(n.name||"file"),content:e.btoa(t),branch:o.branch,sha:n.sha},"PUT")},function(n){return 404==n.status?o.req(i,{message:"Created file",content:e.btoa(t),branch:o.branch},"PUT"):n})},login:function(t){var e=this;return this.ready.then(function(){return e.authenticated?Promise.resolve():new Promise(function(n,o){if(t)e.accessToken=localStorage["mavo:githubtoken"],e.accessToken&&n(e.accessToken);else{var i={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};i.top=(innerHeight-i.height)/2+(screen.top||screenTop),
i.left=(innerWidth-i.width)/2+(screen.left||screenLeft),e.authPopup=open("https://github.com/login/oauth/authorize?client_id="+e.key+"&scope=repo,gist&state="+location.href,"popup","width="+i.width+",height="+i.height+",left="+i.left+",top="+i.top),addEventListener("message",function(t){t.source===e.authPopup&&(e.accessToken=localStorage["mavo:githubtoken"]=t.data,e.accessToken||o(Error("Authentication error")),n(e.accessToken))})}}).then(function(){return e.getUser()})["catch"](function(t){401==t.status&&e.logout()}).then(function(t){if(e.user&&(e.permissions.on("logout"),e.repo))return e.req("repos/"+e.username+"/"+e.repo).then(function(t){e.repoInfo=t,t.permissions.push&&e.permissions.on(["edit","save"])})["catch"](function(t){404==t.status&&e.user.login.toLowerCase()==e.username.toLowerCase()&&e.permissions.on(["edit","save"])})})})},logout:function(){return this.authenticated&&(localStorage.removeItem("mavo:githubtoken"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),
this.mavo.element._.fire("mavo:logout",{backend:this})),Promise.resolve()},getUser:function(){var e=this;return this.req("user").then(function(n){e.user=n;var o=n.name||n.login;t.fire(e.mavo.element,"mavo:login",{backend:e,name:'<a href="https://github.com/'+n.login+'" target="_blank">\n\t\t\t\t\t\t\t<img class="mv-avatar" src="'+n.avatar_url+'" /> '+o+"\n\t\t\t\t\t\t</a>"})})},"static":{apiDomain:"https://api.github.com/",test:function(t){return t=new URL(t,location),/\bgithub.com|raw.githubusercontent.com/.test(t.host)},parseURL:function(t){var e={};t=new URL(t,location);var n=t.pathname.slice(1).split("/");if(e.username=n.shift(),e.repo=n.shift(),/raw.githubusercontent.com$/.test(t.host))e.branch=n.shift();else{if(/api.github.com$/.test(t.host))return{};/github.com$/.test(t.host)&&"blob"==n[0]&&(n.shift(),e.branch=n.shift())}return e.path=n.join("/"),e},btoa:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return btoa(unescape(encodeURIComponent(t)));
}),atob:function(t){return decodeURIComponent(escape(window.atob(t)))}}}))}(Bliss);
//# sourceMappingURL=maps/mavo.min.js.map
