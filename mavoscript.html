<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<title>MavoScript Tests</title>
<link rel="stylesheet" href="mavo/mavo.css" />
<link rel="stylesheet" href="style.css" />
<style>
td {
	font: bold 100%/1.5 Consolas, Monaco, monospace;
}
</style>
<script src="mavo/mavo.js"></script>
</head>
<body>

<h1>MavoScript Tests</h1>

<section>
	<h1>Expression Rewrite</h1>

	<p>These tests check if MavoScript is rewritten to JS correctly</p>

	<table class="reftest" data-test="expressionRewrite" data-columns="3">
		<tr>
			<td>1 + 1</td>
			<td>add(1, 1)</td>
		</tr>
		<tr>
			<td>1 + 2 + 3</td>
			<td>add(1, 2, 3)</td>
		</tr>
		<tr>
			<td>if(2, 3, 4)</td>
			<td>iff(2, 3, 4)</td>
		</tr>
		<tr>
			<td>foo and 5 or baz</td>
			<td>or(and(foo, 5), baz)</td>
		</tr>
		<tr>
			<td>"foo"</td>
		</tr>
		<tr>
			<td>if(foo >= 5, 1, 2)</td>
			<td>iff(gte(foo, 5), 1, 2)</td>
		</tr>
		<tr>
			<td>foo == "bar"</td>
			<td>eq(foo, "bar")</td>
		</tr>
		<tr title="Single character equals">
			<td>foo = 5</td>
			<td>eq(foo, 5)</td>
		</tr>
		<tr>
			<td>foo > bar</td>
			<td>gt(foo, bar)</td>
		</tr>
		<tr title="3 operand comparison">
			<td>foo > bar > baz</td>
			<td>gt(foo, bar, baz)</td>
		</tr>
		<tr title="3 operand equality">
			<td>foo = bar = baz</td>
			<td>eq(foo, bar, baz)</td>
		</tr>
		<tr title="4 operand equality">
			<td>foo = bar = baz = yolo</td>
			<td>eq(foo, bar, baz, yolo)</td>
		</tr>
		<tr title="4 operand equality">
			<td>foo = bar = baz == yolo</td>
			<td>eq(foo, bar, baz, yolo)</td>
		</tr>
		<tr>
			<td>foo != bar</td>
			<td>neq(foo, bar)</td>
		</tr>
		<tr>
			<td>foo != bar != baz</td>
			<td>neq(foo, bar, baz)</td>
		</tr>
		<tr>
			<td>foo & bar & baz</td>
			<td>concatenate(foo, bar, baz)</td>
		</tr>
		<tr>
			<td>foo.bar</td>
			<td>get(foo, "bar")</td>
		</tr>
		<tr>
			<td>foo["bar"]</td>
			<td>get(foo, "bar")</td>
		</tr>
		<tr title="Pass-through to JS">
			<td>foo.filter(a => a + 5)</td>
		</tr>
		<tr title="Pass-through to JS">
			<td>/* js */ 5+5</td>
		</tr>
	</table>
</section>

<script src="test.js"></script>
<script>
function expressionRewrite(test, result, expected) {
	var r = result.textContent = Mavo.Expression.rewrite(test.textContent);

	return Test.equals(r, expected.textContent);
}
</script>

</body>
</html>
